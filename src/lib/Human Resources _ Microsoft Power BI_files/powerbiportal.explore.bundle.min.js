
window.parseTimeMarkers = window.parseTimeMarkers || {};
window.parseTimeMarkers['powerbiportal.explore.bundle.min.js'] = {
    nominalStart: Date.now(),
    start: Date.now()
};
var __assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},__extends=this&&this.__extends||(function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}})(),__awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return i([e,t])}}function i(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,a&&(o=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,a=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],a=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,a,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return{next:r(0),throw:r(1),return:r(2)}},powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var r=t.get("Embed_Updated"),i=r+" "+e.lastRefreshTime,n={snapshotId:e.objectId,reportId:e.reportId,name:e.snapshotName,date:i,resourceUri:e.resourceAbsoluteUri,culture:e.snapshotCulture,size:{height:e.snapshotHeight,width:e.snapshotWidth},type:e.type,metadata:e.metadata,hostUri:e.hostUri,embedType:e.embedType,disabled:e.disabled,createDate:e.createDate};return n}function r(e){return{snapshotEmbedResource:e.snapshotEmbedResource,options:{name:e.options.name,culture:e.options.culture,version:e.options.version,type:e.options.type,size:e.options.size,reportId:e.options.reportId,metadata:e.options.metadata,embedType:e.options.embedType}}}e.convertEmbed=t,e.serializeEmbedCreationRequest=r})(t=e.EmbedSerializer||(e.EmbedSerializer={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(t,r,i,n,a,o,s,l,u,c,p,d,f,h){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===o&&(o=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===u&&(u=void 0),void 0===c&&(c=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===f&&(f=!1),void 0===h&&(h=!1);var v={visualType:t,isEnabled:r,parentId:i,isError:n,errorSource:a,errorCode:o,errorMessage:s,activityName:l,activityId:u,isDebug:c,isCancelled:p,pingLatency:d,isAppInactive:f,isInCapacity:h},m={name:"PBI.EX.ToggleSeeData",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({visualType:v.visualType,isEnabled:v.isEnabled,parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXToggleSeeDataLoggers};return m}function i(t,r,i,n,a,o,s,l,u,c,p,d,f){void 0===i&&(i=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===o&&(o=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===u&&(u=!1),void 0===c&&(c=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===f&&(f=!1);var h={fromCache:t,parentId:r,isError:i,errorSource:n,errorCode:a,errorMessage:o,activityName:s,activityId:l,isDebug:u,isCancelled:c,pingLatency:p,isAppInactive:d,isInCapacity:f},v={name:"PBI.EX.GetExploration",category:e.TelemetryCategory.Verbose,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({fromCache:h.fromCache,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXGetExplorationLoggers};return v}function n(t,r,i,n,a,o,s,l,u,c,p,d,f){void 0===i&&(i=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===o&&(o=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===u&&(u=!1),void 0===c&&(c=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===f&&(f=!1);var h={code:t,parentId:r,isError:i,errorSource:n,errorCode:a,errorMessage:o,activityName:s,activityId:l,isDebug:u,isCancelled:c,pingLatency:p,isAppInactive:d,isInCapacity:f},v={name:"PBI.EX.VisualQueryGeneratorWarning",category:e.TelemetryCategory.Verbose,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({code:h.code,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXVisualQueryGeneratorWarningLoggers};return v}function a(t,r,i){var n={code:t,debugInfo:r,message:i},a={name:"PBI.EX.VisualQueryGeneratorError",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({code:n.code,debugInfo:n.debugInfo,message:n.message},{})},info:n,loggers:e.telemetry.EXVisualQueryGeneratorErrorLoggers};return a}function o(t,r,i,n,a,o,s,l,u,c,p,d,f,h,v,m,y,C,b,S,x,E,w){void 0===f&&(f=!1),void 0===h&&(h=void 0),void 0===v&&(v=void 0),void 0===m&&(m=void 0),void 0===y&&(y=void 0),void 0===C&&(C=void 0),void 0===b&&(b=!1),void 0===S&&(S=!1),void 0===x&&(x=void 0),void 0===E&&(E=!1),void 0===w&&(w=!1);var F={action:t,editor:r,dataType:i,groupCount:n,totalGroupCount:a,groupedValues:o,groupedValuesMin:s,groupedValuesMax:l,ungroupedValues:u,isOtherEnabled:c,hasGroupOnKeys:p,parentId:d,isError:f,errorSource:h,errorCode:v,errorMessage:m,activityName:y,activityId:C,isDebug:b,isCancelled:S,pingLatency:x,isAppInactive:E,isInCapacity:w},P={name:"PBI.EX.Groups.GroupsAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({action:e.telemetry.EditorAction[F.action],editor:e.telemetry.EditorType[F.editor],dataType:F.dataType,groupCount:F.groupCount,totalGroupCount:F.totalGroupCount,groupedValues:F.groupedValues,groupedValuesMin:F.groupedValuesMin,groupedValuesMax:F.groupedValuesMax,ungroupedValues:F.ungroupedValues,isOtherEnabled:F.isOtherEnabled,hasGroupOnKeys:F.hasGroupOnKeys,parentId:F.parentId},{isError:F.isError,errorSource:e.telemetry.ErrorSource[F.errorSource],errorCode:F.errorCode,errorMessage:F.errorMessage,activityName:F.activityName,activityId:F.activityId,isDebug:F.isDebug,isCancelled:F.isCancelled,pingLatency:F.pingLatency,isAppInactive:F.isAppInactive,isInCapacity:F.isInCapacity})},info:F,loggers:e.telemetry.EXGroupsGroupsActionLoggers};return P}function s(t,r,i,n,a,o,s,l,u,c,p,d,f,h,v,m,y){void 0===s&&(s=!1),void 0===l&&(l=void 0),void 0===u&&(u=void 0),void 0===c&&(c=void 0),void 0===p&&(p=void 0),void 0===d&&(d=void 0),void 0===f&&(f=!1),void 0===h&&(h=!1),void 0===v&&(v=void 0),void 0===m&&(m=!1),void 0===y&&(y=!1);var C={action:t,editor:r,sourceDataType:i,binSize:n,binUnit:a,parentId:o,isError:s,errorSource:l,errorCode:u,errorMessage:c,activityName:p,activityId:d,isDebug:f,isCancelled:h,pingLatency:v,isAppInactive:m,isInCapacity:y},b={name:"PBI.EX.Groups.BinBySizeAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({action:e.telemetry.EditorAction[C.action],editor:e.telemetry.EditorType[C.editor],sourceDataType:C.sourceDataType,binSize:C.binSize,binUnit:e.telemetry.BinUnit[C.binUnit],parentId:C.parentId},{isError:C.isError,errorSource:e.telemetry.ErrorSource[C.errorSource],errorCode:C.errorCode,errorMessage:C.errorMessage,activityName:C.activityName,activityId:C.activityId,isDebug:C.isDebug,isCancelled:C.isCancelled,pingLatency:C.pingLatency,isAppInactive:C.isAppInactive,isInCapacity:C.isInCapacity})},info:C,loggers:e.telemetry.EXGroupsBinBySizeActionLoggers};return b}function l(t,r,i,n,a,o,s,l,u,c,p,d,f,h,v,m,y,C){void 0===l&&(l=!1),void 0===u&&(u=void 0),void 0===c&&(c=void 0),void 0===p&&(p=void 0),void 0===d&&(d=void 0),void 0===f&&(f=void 0),void 0===h&&(h=!1),void 0===v&&(v=!1),void 0===m&&(m=void 0),void 0===y&&(y=!1),void 0===C&&(C=!1);var b={action:t,editor:r,sourceDataType:i,binCount:n,min:a,max:o,parentId:s,isError:l,errorSource:u,errorCode:c,errorMessage:p,activityName:d,activityId:f,isDebug:h,isCancelled:v,pingLatency:m,isAppInactive:y,isInCapacity:C},S={name:"PBI.EX.Groups.BinByCountAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({action:e.telemetry.EditorAction[b.action],editor:e.telemetry.EditorType[b.editor],sourceDataType:b.sourceDataType,binCount:b.binCount,min:b.min,max:b.max,parentId:b.parentId},{isError:b.isError,errorSource:e.telemetry.ErrorSource[b.errorSource],errorCode:b.errorCode,errorMessage:b.errorMessage,activityName:b.activityName,activityId:b.activityId,isDebug:b.isDebug,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isAppInactive:b.isAppInactive,isInCapacity:b.isInCapacity})},info:b,loggers:e.telemetry.EXGroupsBinByCountActionLoggers};return S}function u(t,r,i,n,a,o,s,l,u,c,p,d,f,h,v,m,y){void 0===s&&(s=!1),void 0===l&&(l=void 0),void 0===u&&(u=void 0),void 0===c&&(c=void 0),void 0===p&&(p=void 0),void 0===d&&(d=void 0),void 0===f&&(f=!1),void 0===h&&(h=!1),void 0===v&&(v=void 0),void 0===m&&(m=!1),void 0===y&&(y=!1);var C={visualType:t,role:r,sourceRole:i,action:n,groupType:a,parentId:o,isError:s,errorSource:l,errorCode:u,errorMessage:c,activityName:p,activityId:d,isDebug:f,isCancelled:h,pingLatency:v,isAppInactive:m,isInCapacity:y},b={name:"PBI.EX.Groups.Usage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({visualType:C.visualType,role:C.role,sourceRole:C.sourceRole,action:e.telemetry.EditorAction[C.action],groupType:e.telemetry.GroupType[C.groupType],parentId:C.parentId},{isError:C.isError,errorSource:e.telemetry.ErrorSource[C.errorSource],errorCode:C.errorCode,errorMessage:C.errorMessage,activityName:C.activityName,activityId:C.activityId,isDebug:C.isDebug,isCancelled:C.isCancelled,pingLatency:C.pingLatency,isAppInactive:C.isAppInactive,isInCapacity:C.isInCapacity})},info:C,loggers:e.telemetry.EXGroupsUsageLoggers};return b}function c(t,r,i,n){var a={errorType:t,action:r,groupType:i,message:n},o={name:"PBI.EX.Groups.Error",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({errorType:e.telemetry.GroupErrorType[a.errorType],action:e.telemetry.EditorAction[a.action],groupType:e.telemetry.GroupType[a.groupType],message:a.message},{})},info:a,loggers:e.telemetry.EXGroupsErrorLoggers};return o}function p(t,r,i,n,a,o,s,l,u,c,p,d,f){void 0===i&&(i=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===o&&(o=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===u&&(u=!1),void 0===c&&(c=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===f&&(f=!1);var h={operation:t,parentId:r,isError:i,errorSource:n,errorCode:a,errorMessage:o,activityName:s,activityId:l,isDebug:u,isCancelled:c,pingLatency:p,isAppInactive:d,isInCapacity:f},v={name:"PBI.EX.ModelChange",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({operation:h.operation,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXModelChangeLoggers};return v}function d(t,r,i,n,a,o,s,l,u,c,p,d,f,h){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===o&&(o=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===u&&(u=void 0),void 0===c&&(c=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===f&&(f=!1),void 0===h&&(h=!1);var v={message:t,actionId:r,parentId:i,isError:n,errorSource:a,errorCode:o,errorMessage:s,activityName:l,activityId:u,isDebug:c,isCancelled:p,pingLatency:d,isAppInactive:f,isInCapacity:h},m={name:"PBI.EX.Measures",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({message:v.message,actionId:v.actionId,parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXMeasuresLoggers};return m}function f(t,r,i,n,a,o,s,l,u,c,p,d,f,h){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===o&&(o=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===u&&(u=void 0),void 0===c&&(c=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===f&&(f=!1),void 0===h&&(h=!1);var v={sourceType:t,targetType:r,parentId:i,isError:n,errorSource:a,errorCode:o,errorMessage:s,activityName:l,activityId:u,isDebug:c,isCancelled:p,pingLatency:d,isAppInactive:f,isInCapacity:h},m={name:"PBI.EX.ReportMeasureDataTypeChange",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({sourceType:v.sourceType,targetType:v.targetType,parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXReportMeasureDataTypeChangeLoggers};return m}function h(t,r,i,n,a,o,s,l,u,c,p,d,f,h,v){void 0===a&&(a=!1),void 0===o&&(o=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===u&&(u=void 0),void 0===c&&(c=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1),void 0===f&&(f=void 0),void 0===h&&(h=!1),void 0===v&&(v=!1);var m={dataType:t,sourceTypes:r,targetTypes:i,parentId:n,isError:a,errorSource:o,errorCode:s,errorMessage:l,activityName:u,activityId:c,isDebug:p,isCancelled:d,pingLatency:f,isAppInactive:h,isInCapacity:v},y={name:"PBI.EX.ReportMeasureMoveRoleKind",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({dataType:m.dataType,sourceTypes:m.sourceTypes,targetTypes:m.targetTypes,parentId:m.parentId},{isError:m.isError,errorSource:e.telemetry.ErrorSource[m.errorSource],errorCode:m.errorCode,errorMessage:m.errorMessage,activityName:m.activityName,activityId:m.activityId,isDebug:m.isDebug,isCancelled:m.isCancelled,pingLatency:m.pingLatency,isAppInactive:m.isAppInactive,isInCapacity:m.isInCapacity})},info:m,loggers:e.telemetry.EXReportMeasureMoveRoleKindLoggers};return y}function v(t,r,i,n,a,o,s,l,u,c,p,d,f,h){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===o&&(o=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===u&&(u=void 0),void 0===c&&(c=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===f&&(f=!1),void 0===h&&(h=!1);var v={visualType:t,fixedRoleByProjectionCount:r,parentId:i,isError:n,errorSource:a,errorCode:o,errorMessage:s,activityName:l,activityId:u,isDebug:c,isCancelled:p,pingLatency:d,isAppInactive:f,isInCapacity:h},m={name:"PBI.EX.VisualDrillableRoleActiveItemsFixed",category:e.TelemetryCategory.Verbose,time:Date.now(),id:g.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({visualType:v.visualType,fixedRoleByProjectionCount:v.fixedRoleByProjectionCount,parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXVisualDrillableRoleActiveItemsFixedLoggers};return m}var m,g=jsCommon.Utility;!(function(e){e[e.Create=0]="Create",e[e.Update=1]="Update",e[e.Delete=2]="Delete",e[e.Other=3]="Other"})(m=t.EditorAction||(t.EditorAction={}));var y;!(function(e){e[e.Visual=0]="Visual",e[e.Dialog=1]="Dialog",e[e.FieldList=2]="FieldList",e[e.FieldWell=3]="FieldWell",e[e.Other=4]="Other"})(y=t.EditorType||(t.EditorType={}));var C;!(function(e){e[e.DAX=0]="DAX",e[e.DQLimit=1]="DQLimit",e[e.ModelAuthoring=2]="ModelAuthoring",e[e.Other=3]="Other"})(C=t.GroupErrorType||(t.GroupErrorType={}));var b;!(function(e){e[e.List=0]="List",e[e.Bin=1]="Bin"})(b=t.GroupType||(t.GroupType={}));var S;!(function(e){e[e.Number=0]="Number",e[e.Year=1]="Year",e[e.Month=2]="Month",e[e.Day=3]="Day",e[e.Hour=4]="Hour",e[e.Minute=5]="Minute",e[e.Second=6]="Second"})(S=t.BinUnit||(t.BinUnit={})),t.EXToggleSeeData=r,t.EXGetExploration=i,t.EXVisualQueryGeneratorWarning=n,t.EXVisualQueryGeneratorError=a,t.EXGroupsGroupsAction=o,t.EXGroupsBinBySizeAction=s,t.EXGroupsBinByCountAction=l,t.EXGroupsUsage=u,t.EXGroupsError=c,t.EXModelChange=p,t.EXMeasures=d,t.EXReportMeasureDataTypeChange=f,t.EXReportMeasureMoveRoleKind=h,t.EXVisualDrillableRoleActiveItemsFixed=v})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e){return void 0===e&&(e=[]),i.extendWithName(i.extendWithId(e))}var i=jsCommon.ArrayExtensions,n=e.data.DataReaderUtils;t.createDataSourceArray=r;var a;!(function(e){function t(e){return _.contains(Object.keys(e),"extends")}function r(e,t){if(!_.isEmpty(e)){var r,i=n.findSchemas(t);return r=i?_.filter(e,(function(e){return _.contains(i,e.name)})):e,a(r)}}function i(e,r){if(!_.isEmpty(e)){var i=n.findSchemas(r);return i?_.chain(e).filter((function(e){return _.contains(i,e.name)})).map((function(r){return t(r)?_.find(e,(function(e){return e.name===r.extends})):r})).uniq().value():_.filter(e,(function(e){return!t(e)}))}}function a(e){return _.map(e,(function(e){return e[n.readerType(e)]}))}e.isExtension=t,e.referenced=r,e.queried=i,e.dataReaderDataSources=a})(a=t.DataSource||(t.DataSource={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Categorical=0]="Categorical",e[e.Range=1]="Range",e[e.Advanced=2]="Advanced",e[e.Passthrough=3]="Passthrough",e[e.Visual=4]="Visual",e[e.TopN=5]="TopN",e[e.Include=6]="Include",e[e.Exclude=7]="Exclude"})(t=e.FilterType||(e.FilterType={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.createDisplayNameGetter;!(function(e){function t(e){return _.filter(e,(function(e){return!e.transient}))}e.objectDescriptors={background:{displayName:i("PagePropertyPane_PageBackground"),properties:{color:{displayName:i("PagePropertyPane_PageBackgroundColor"),type:{fill:{solid:{color:!0}}}},image:{type:{image:{}}},transparency:{displayName:i("Visual_Background_Transparency"),type:{numeric:!0}}}}},e.filterTransient=t})(r=t.Section||(t.Section={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.SnapshotReportType="Report";var t;!(function(e){e[e.Static=0]="Static",e[e.Interactive=1]="Interactive"})(t=e.EmbedType||(e.EmbedType={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.DataViewObjectDefinitions;!(function(e){function t(e){return!!e&&e.show===!1}e.isHidden=t})(r=t.VisualTitle||(t.VisualTitle={}));var n;!(function(t){function r(e,r){var i=__assign({},t.CommonObjectDescriptors);if(!r)return i;var n=r.getStylePresets(e);if(!n||!n.presets)return i;var a=r.getEnumFromStylePresets(n);return i.stylePresetName={displayName:n.sectionTitle,properties:{name:{displayName:n.sliceTitle,type:{enumeration:a}}}},i}function i(e,t){if(e){var r=t.serializeVisualContainer(e);return t.deserializeVisualContainer(r,!0)}}t.CommonObjectDescriptors={title:{displayName:e.data.createDisplayNameGetter("Visual_Title"),description:e.data.createDisplayNameGetter("Visual_TitleDescription"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},text:{displayName:e.data.createDisplayNameGetter("Visual_Title_Text"),description:e.data.createDisplayNameGetter("Visual_Title_TextDescription"),type:{text:!0},suppressFormatPainterCopy:!0},fontColor:{displayName:e.data.createDisplayNameGetter("Visual_Title_FontColor"),description:e.data.createDisplayNameGetter("Visual_Title_FontColorDescription"),type:{fill:{solid:{color:!0}}}},background:{displayName:e.data.createDisplayNameGetter("Visual_Title_BackgroundColor"),description:e.data.createDisplayNameGetter("Visual_Title_BackgroundColorDescription"),type:{fill:{solid:{color:{nullable:!0}}}}},alignment:{displayName:e.data.createDisplayNameGetter("Visual_Title_Alignment"),description:e.data.createDisplayNameGetter("Visual_Title_AlignmentDescription"),type:{formatting:{alignment:!0}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),description:e.data.createDisplayNameGetter("Visual_TextSizeDescription"),type:{formatting:{fontSize:!0}}}}},background:{displayName:e.data.createDisplayNameGetter("Visual_Background"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_Background_Color"),description:e.data.createDisplayNameGetter("Visual_Background_ColorDescription"),type:{fill:{solid:{color:!0}}}},transparency:{displayName:e.data.createDisplayNameGetter("Visual_Background_Transparency"),description:e.data.createDisplayNameGetter("Visual_Background_TransparencyDescription"),type:{numeric:!0}}}},lockAspect:{displayName:e.data.createDisplayNameGetter("Visual_BasicShape_LockAspect"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}}}},general:{displayName:e.data.createDisplayNameGetter("Visual_General_Properties"),properties:{x:{displayName:e.data.createDisplayNameGetter("Visual_General_Properties_X_Coordinate"),type:{numeric:!0}},y:{displayName:e.data.createDisplayNameGetter("Visual_General_Properties_Y_Coordinate"),type:{numeric:!0}},width:{displayName:e.data.createDisplayNameGetter("Visual_General_Properties_Width"),type:{numeric:!0}},height:{displayName:e.data.createDisplayNameGetter("Visual_General_Properties_Height"),type:{numeric:!0}},altText:{displayName:e.data.createDisplayNameGetter("Visual_General_Properties_Description"),placeHolderText:e.data.createDisplayNameGetter("Visual_General_Properties_Description_Placeholder"),type:{formatting:{altText:!0}}}}},border:{displayName:e.data.createDisplayNameGetter("Visual_Border"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_Border_Color"),type:{fill:{solid:{color:!0}}}}}}},t.getObjectDescriptors=r,t.clone=i})(n=t.VisualContainer||(t.VisualContainer={}));var a;!(function(e){function t(e){if(e){var t={visualType:e.visualType};e.stylePresetName&&(t.stylePresetName=_.cloneDeep(e.stylePresetName)),e.aspectRatio&&(t.aspectRatio=_.cloneDeep(e.aspectRatio)),e.background&&(t.background=_.cloneDeep(e.background)),e.title&&(t.title=_.cloneDeep(e.title)),e.border&&(t.border=_.cloneDeep(e.border)),e.query&&(t.query=e.query.clone()),e.objects&&(t.objects=i.clone(e.objects));var r=e.conversionSourceContext;if(r){var n={};n.visualType=r.visualType,r.query&&(n.query=r.query.clone()),t.conversionSourceContext=n}return t}}function r(e,t){if(!e||!e.getCurrentVisual)return t.resolve();var r=e.getCurrentVisual();return r?r.enumerateObjectRepetitionAsync?r.enumerateObjectRepetitionAsync():r.enumerateObjectRepetition?t.resolve(r.enumerateObjectRepetition()):t.resolve():t.resolve()}e.clone=t,e.enumerateObjectRepetition=r})(a=t.SingleVisualConfig||(t.SingleVisualConfig={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){if(e.visualContainer)return e.visualContainer.config.singleVisual.visualType}e.getVisualType=t})(t=e.PinData||(e.PinData={}))})(t=e.contracts||(e.contracts={}))})(t=e.common||(e.common={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){switch(e){case 0:return"Default";case 1:return"DataFilter";case 2:return"HighlightFilter";case 3:return"NoFilter"}}e.toString=t})(t=e.VisualRelationshipFilterActionUtil||(e.VisualRelationshipFilterActionUtil={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=jsCommon.ArrayExtensions,i=e.data.ProjectionUtils,n=e.data.QueryProjectionCollection,a=e.data.QueryProjectionsByRole,o=e.data.SemanticQuery,s=e.data.transforms.plugins.KMeansClustering,l=e.data.transforms.plugins.SpatialClustering,u=e.data.SQExpr,c=e.data.SQExprBuilder,p=(function(){function e(e,t){this.defn=e,this.projections=t;for(var r in t)_.isEmpty(t[r].activeProjectionRefs)||this.ensureActiveItems(r)}return e.prototype.add=function(e,t,r){var i=r&&r.exprName,a=r&&r.index,o=this.defn.selectNameOf(e);o||(o=this.addSelect(e,i));var s=this.getRoleProjections(t);s||(s=[],this.projections[t]=new n(s));var l={queryRef:o};return null==a||a>s.length?(s.push(l),s.length-1):(s.splice(a,0,l),this.addNewQueryRefToActiveProjectionRefsIfNeeded(t,o,a),a)},e.prototype.removeExpr=function(t,r){if(r){for(var i=this.defn.select(),n=!1,a=i.length-1;a>=0;--a){var o=i[a].expr;if(e.areEqualIgnoringAggregate(o,t)){if(!this.removeAllProjectionsForExpr(o))return!1;n=!0}}return n}return this.removeAllProjectionsForExpr(t)},e.prototype.removeProjection=function(e,t){var r=this.getRoleProjections(e);if(!r)return!1;if(t>=r.length)return!1;var i=r[t].queryRef,n=this.defn.select().withName(i).expr;r.splice(t,1);var a=this.projections[e].activeProjectionRefs;return _.pull(a,i),_.isEmpty(r)?delete this.projections[e]:a&&0===a.length&&a.push(r[0].queryRef),this.isUsed(i)||this.removeExpr(n,!1),!0},e.prototype.moveProjection=function(e,t,r,i){if(t===r)return!1;var n=this.getRoleProjections(e);if(!n||r+i>n.length)return!1;if(t<0||r<0)return!1;for(var a=n.splice(t,i),o=0;o<a.length;o++)n.splice(r+o,0,a[o]);var s=this.projections[e].activeProjectionRefs;if(s&&r<s.length){var l=_.take(n,r+1);this.projections[e].activeProjectionRefs=_.map(l,(function(e){return e.queryRef}))}return!0},e.prototype.setAggregate=function(e,t,r,i){return this.updateExpression(e,t,(function(e){return c.setAggregate(e,r)}),i)},e.prototype.removeAggregate=function(e,t,r){return this.updateExpression(e,t,(function(e){return c.removeAggregate(e)}),r)},e.prototype.setPercentOfGrandTotal=function(e,t,r){var i=this.updateExpression(e,t,(function(e){return c.setPercentOfGrandTotal(e)}),r);return i},e.prototype.removePercentOfGrandTotal=function(e,t,r){var i=this.updateExpression(e,t,(function(e){return c.removePercentOfGrandTotal(e)}),r);return i},e.prototype.setPercentOfRoleTotal=function(e,t,r,i){var n=this.updateExpression(t,r,(function(t){return c.setPercentOfRoleTotal(t,e)}),i);return n},e.prototype.removePercentOfRoleTotal=function(e,t,r){var i=this.updateExpression(e,t,(function(e){return c.removePercentOfRoleTotal(e)}),r);return i},e.prototype.orderBy=function(e){this.defn=this.defn.orderBy(e)},e.prototype.removeOrderBy=function(e){this.defn=this.defn.removeOrderBy(e)},e.prototype.removeUnusedOrderBy=function(){for(var e=this.defn,t=e.orderBy(),r=0,i=t;r<i.length;r++){var n=i[r],a=n.expr,o=e.selectNameOf(a);o||(this.defn=e.removeOrderBy(a))}},e.prototype.addTransform=function(e,t,r){for(var i={},n=this.defn.transforms(),a=0,o=n;a<o.length;a++){var u=o[a];i[u.name]=!0}var p=jsCommon.StringExtensions.findUniqueName(i,e.name),d={algorithm:e.name,name:p,input:{parameters:t},output:void 0};this.defn=this.defn.transforms(n.concat([d]));for(var f=(e.name===s.name||e.name===l.name)&&r.grouping&&r.grouping.cluster,h=0,v=e.outputRoles;h<v.length;h++){var m=v[h],g=m.name;f&&(g=r.grouping.cluster.clusteringRole),this.add(c.transformOutputRoleRef(m.algorithmRole),g,{exprName:m.columnName?m.columnName:m.algorithmRole})}return p},e.prototype.removeTransform=function(e,t){var r=_.find(this.defn.transforms(),(function(e){return e.name===t}));if(r){for(var i=0,n=e.outputRoles;i<n.length;i++){var a=n[i];this.removeExpr(c.transformOutputRoleRef(a.algorithmRole),!1)}this.defn=this.defn.removeTransform(r)}},e.prototype.updateTransform=function(e,t){var r=_.find(this.defn.transforms(),(function(t){return t.name===e}));r&&(r.input.parameters=t)},e.prototype.clone=function(){return new e(this.defn,a.clone(this.projections))},e.prototype.equals=function(e){return!!o.equals(this.defn,e.defn)&&_.isEqual(this.projections,e.projections)},e.prototype.ensureDrillableRoles=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];this.ensureActiveItems(n)&&t.push(n)}return t},e.prototype.ensureActiveItems=function(e){var t=this.projections[e];if(t){var r=t.all();return _.isEmpty(r)||t.activeProjectionRefs?void 0:(t.activeProjectionRefs=[r[0].queryRef],!0)}},e.prototype.toggleShowAll=function(e){var t=this.projections[e];t&&(t.showAll=!t.showAll)},e.prototype.roleContainsExpr=function(e,t){var r=this.projections[e],i=r&&r.all();if(_.isEmpty(i))return!1;for(var n=this.defn.select(),a=0,o=n;a<o.length;a++)for(var s=o[a],l=0,c=i;l<c.length;l++){var p=c[l];if(p.queryRef===s.name&&u.equals(t,s.expr))return!0}return!1},e.prototype.getRoleNameForExpr=function(e){var t=this.projections;for(var r in t){var i=this.tryGetExprs(r);if(i&&i.length>0)for(var n=0,a=i;n<a.length;n++){var o=a[n];if(u.equals(e,o))return r}}},e.prototype.tryGetExpr=function(e,t){var r=this.getRoleProjections(e);if(r){var n=r[t];return i.tryGetExprByProjection(this.defn,n)}},e.prototype.tryGetExprs=function(e){return i.tryGetExprs(this.defn,this.projections,e)},e.prototype.getUniqueQueryRefs=function(){var e=_.values(this.projections);return _.chain(e).map((function(e){return e.all()})).flatten(!0).map((function(e){return e.queryRef})).uniq().value()},e.prototype.currentDrillMode=function(e){var t=this.getRoleProjections(e),r=this.projections[e].activeProjectionRefs;if(!_.isEmpty(r)){if(r.length>1)return 2;if(r[0]!==t[0].queryRef)return 3}},e.prototype.addSelect=function(e,t){
var r=this.defn;this.defn=r=r.addSelect(e,t);var i=r.select(),n=i.length-1;return i[n].name},e.prototype.removeAllProjectionsForExpr=function(e){var t=this.defn,r=t.selectNameOf(e);if(!r)return!1;var i=this.projections;for(var n in i){for(var a=i[n].all(),o=a.length-1;o>=0;o--){var s=a[o];if(s.queryRef===r){a.splice(o,1);var l=i[n].activeProjectionRefs;_.pull(l,r)}}0===a.length&&delete i[n]}return this.defn=t.removeSelect(e).removeOrderBy(e),!0},e.prototype.updateExpression=function(e,t,i,n){var a=this.getRoleProjections(e);if(!a||t>=a.length)return!1;var o=a[t],s=this.defn,l=o.queryRef,u=s.select(),c=r.indexWithName(u,l),p=u[c].expr,d=i(p),f=s.selectNameOf(d);return f?(o.queryRef=f,this.isUsed(l)||(this.defn=s.removeSelect(p)),!0):(this.getUsageCount(l)>1?o.queryRef=this.addSelect(d):this.defn=s.setSelectAt(c,d),!0)},e.prototype.isUsed=function(e){return this.getUsageCount(e)>0},e.prototype.getUsageCount=function(e){var t=0,r=this.projections;for(var i in r){var n=r[i].all();t+=_.filter(n,(function(t){return t.queryRef===e})).length}return t},e.prototype.getRoleProjections=function(e){var t=a.getRole(this.projections,e);if(t)return t.all()},e.prototype.addNewQueryRefToActiveProjectionRefsIfNeeded=function(e,t,r){var i=this.getRoleProjections(e),n=this.projections[e].activeProjectionRefs;n&&(n.length>1&&r<n.length?n.splice(r,0,t):1===n.length&&0===r&&i.length>1&&i[1].queryRef===n[0]&&n.splice(0,1,t))},e.areEqualIgnoringAggregate=function(e,t){return u.equals(c.removeAggregate(e),c.removeAggregate(t))},e})();t.VisualQuery=p})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t,r=jsCommon.StringExtensions.parseIntSubstrFast;!(function(e){function t(e){for(var t,n=0,a=0,o=0,s=0,l=0,u=0,c=e.length;l<=c;l++){var p=l===c?46:e.charCodeAt(l);switch(p){case 46:case 45:if(l===u)return;var d=r(e,u,l-u);if(null==d)return;switch(s){case 0:n=d;break;case 1:a=d;break;case 2:o=d;break;default:return}if(s++,u=l+1,45===p){if(3!==s)return;if(t=e.substr(l+1),!i(t))return;l=c}break;default:if(p<48||p>57)return}}var f={major:n,minor:a,patch:o};return t&&(f.prerel=t),f}function i(e){for(var t=0,r=e.length;t<r;t++){var i=e.charCodeAt(t);if(!(65<=i&&i<=90||97<=i&&i<=122||48<=i&&i<=57||45===i||46===i))return!1}return!0}function n(e){return _.isString(e)?e:null==e.prerel?e.major+"."+e.minor+"."+e.patch:e.major+"."+e.minor+"."+e.patch+"-"+e.prerel}function a(e,t){return c(u(e),u(t))>0}function o(e,t){return c(u(e),u(t))<0}function s(e,t){return e=u(e),t=u(t),!c(u(e),u(t))}function l(e,t){return a(u(e),u(t))?e:t}function u(r){return _.isString(r)?t(r)||e.Zero:r}function c(e,t){var r=p(e.major,t.major);return r?r:(r=p(e.minor,t.minor))?r:(r=p(e.patch,t.patch),r?r:d(e.prerel,t.prerel))}function p(e,t){e=e||0,t=t||0;var r=e-t;return 0===r?0:r<0?-1:1}function d(e,t){var i=_.isEmpty(e),n=_.isEmpty(t);if(i)return n?0:1;if(n)return-1;var a=r(e,0,e.length),o=r(t,0,t.length);return null!=a?null!=o?p(a,o):-1:null!=o?1:e.localeCompare(t)}e.Zero={major:0,minor:0,patch:0},e.ZeroStr="0.0",e.tryParse=t,e.toString=n,e.gt=a,e.lt=o,e.eq=s,e.max=l})(t=e.Version||(e.Version={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t,r=jsCommon.ArrayExtensions;!(function(e){function t(e,t){return e.modelExtensions&&e.modelExtensions.withName(t)}function i(e,r){var i=t(e,r);if(!i)throw new Error("Unable to find expected model extension: "+r);return i}function n(e,t,i){e.modelExtensions||(e.modelExtensions=r.createWithName());var n=e.modelExtensions.withName(t);return n||(n=a(t,i),e.modelExtensions.push(n)),n}function a(e,t){return{name:e,extends:t,entities:r.createWithName()}}function o(e,t){return e.entities.withName(t)}function s(e,t,r){var n=i(e,t),a=o(n,r);if(!a)throw new Error("Unable to find expected entity: "+r);return a}function l(e,t){e.entities||(e.entities=r.createWithName());var i=e.entities.withName(t);return i||(i={name:t,extends:t,measures:r.createWithName()},e.entities.push(i)),i}function u(e,t){if(e.measures||(e.measures=r.createWithName()),e.measures.withName(t.name))throw new Error("Measure "+t.name+" already exists and cannot be added");e.measures.push(t)}function c(e,t,r,i){var n=s(e,t,r);return d(n,i)}function p(e,t){return e.measures.withName(t)}function d(e,t){var r=p(e,t);if(!r)throw new Error("Unable to find expected measure:"+t);return r}function f(e,t,r,i){var n=s(e,t,r),a=d(n,i),o=n.measures.indexOf(a);n.measures.splice(o,1),0===n.measures.length&&(delete n.measures,y(e,t,n))}function h(e,t,r){var i=null===r||void 0===r;i?m(e,t):v(e,t,r)}function v(e,t,i){e.annotations||(e.annotations=r.createWithName());var n=e.annotations.withName(t);n?n.value=i:(n={name:t,value:i},e.annotations.push(n))}function m(e,t){var r=e.annotations&&e.annotations.withName(t);if(r){var i=e.annotations.indexOf(r);e.annotations.splice(i,1),e.annotations&&0===e.annotations.length&&delete e.annotations}}function g(e,t){var r=e.annotations&&e.annotations.withName(t);if(r)return r.value}function y(e,t,r){if(!b(r)){var n=i(e,t),a=n.entities.indexOf(r);n.entities.splice(a,1),0===n.entities.length&&(delete n.entities,C(e,n))}}function C(e,t){if(!b(t)){var r=e.modelExtensions.indexOf(t);e.modelExtensions.splice(r,1),0===e.modelExtensions.length&&delete e.modelExtensions}}function b(e){var t=Object.keys(e),r=_.chain(t).filter((function(e){return"name"!==e&&"extends"!==e})).filter((function(t){return!(_.isArray(e[t])&&_.isEmpty(e[t]))})).value();return _.any(r)}function S(e){if(e){var t={Name:e.name,Extends:e.extends};return e.entities&&(t.Entities=_.map(e.entities,(function(e){return x(e)}))),t}}function x(e){var t={Extends:e.extends,Name:e.name};return e.measures&&(t.Measures=_.map(e.measures,(function(e){return E(e)}))),t}function E(e){var t=e.dataType;return 6!==t&&9!==t||(t=7),{Name:e.name,Expression:e.expression,DataType:t}}e.getOptionalModelExtension=t,e.getExpectedModelExtension=i,e.getOrCreateModelExtension=n,e.createModelExtension=a,e.findEntity=o,e.getExpectedEntity=s,e.getOrCreateExtendingEntity=l,e.addMeasure=u,e.getExpectedMeasure=c,e.findMeasureFromEntity=p,e.removeMeasure=f,e.setAnnotation=h,e.getAnnotationValue=g,e.toQueryExtensionSchema=S})(t=e.ModelExtensionUtils||(e.ModelExtensionUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function t(e){this.modelExtension=e,this.visited={}}return t.prototype.visitReference=function(t){if(t.schema===this.modelExtension.name){var r=e.ModelExtensionUtils.findEntity(this.modelExtension,t.entity);if(r){var i=e.ModelExtensionUtils.findMeasureFromEntity(r,t.name);if(i){var n=this.toVisitedKey(t);if(!this.visited[n]){this.visitMeasure(this.modelExtension,r,i),this.visited[n]=!0;for(var a=0,o=i.references.measures;a<o.length;a++){var s=o[a];this.visitReference(s)}}}}}},t.prototype.visitMeasure=function(e,t,r){},t.prototype.toVisitedKey=function(e){return JSON.stringify(e)},t})();e.ModelExtensionDependencyVisitor=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(t,r,i){t[e.ExplorationDataReaderType]={name:"exploration",extends:"dsr",queryExtensionProvider:e.createExplorationQueryExtensionProvider(),schemaReader:function(t){return e.createConceptualSchemaReader(r,i)}}}e.ExplorationDataReaderType="exploration",e.registerExplorationDataReaderExtension=t})(t=e.dataReaderPlugins||(e.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(){return i}function i(e){return function(t){if(1===e.length){var r=e[0],i=r.getModelExtensions();if(i)return n.toQueryExtensionSchema(u.build(t,i.withName(r.schemaName)))}}}var n=e.explore.util.ModelExtensionUtils,a=e.explore.util.ModelExtensionDependencyVisitor,o=e.data.SQExpr,s=e.data.SQExprRewriter;t.createExplorationQueryExtensionProvider=r;var l=(function(e){function t(t){var r=e.call(this)||this;return r.dependencyVisitor=t,r}return __extends(t,e),t.prototype.visitMeasureRef=function(e){return o.isEntity(e.source)&&this.dependencyVisitor.visitReference({schema:e.source.schema,entity:e.source.entity,name:e.ref}),e},t})(s),u=(function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.build=function(e,r){var i=new t(r);return e.rewrite(new l(i)),i.result},t.prototype.visitMeasure=function(e,t,r){this.result=this.result||n.createModelExtension(e.name,e.extends);var i=n.getOrCreateExtendingEntity(this.result,t.name),a=n.findMeasureFromEntity(i,r.name);a||n.addMeasure(i,r)},t})(a)})(r=t.dataReaderPlugins||(t.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=jsCommon.ArrayExtensions,n=e.data.ConceptualSchema;!(function(t){function r(e,t,r){var a=new n;return a.name=e,a.extends=t,a.capabilities={canEdit:r,discourageQueryAggregateUsage:!1,isExtendable:!1,normalizedFiveStateKpiRange:!1,supportsMedian:!1,supportsPercentile:!1,supportsScopedEval:!1,supportsClustering:!1,supportsStringMinMax:!1,limitOnNumberOfGroups:null,supportsMultiTableTupleFilters:!1,supportsTimeIntelligenceQuickMeasures:!1,measureRestrictions:0,supportsBinByCount:!1},a.entities=i.createWithName(),a}function a(t,n){var a=r(t.name,t.extends,n);if(!t.entities)return a;for(var o=0,s=t.entities;o<s.length;o++){var l=s[o],u={name:l.name,extends:l.extends,displayName:l.name,properties:i.createWithName(),hierarchies:i.createWithName(),displayFolders:i.createWithName()};if(a.entities.push(u),l.measures)for(var c=0,p=l.measures;c<p.length;c++){var d=p[c],f={name:d.name,displayName:d.name,type:e.ValueType.fromPrimitiveTypeAndCategory(d.dataType),kind:1,hidden:d.hidden,errorMessage:d.errorMessage,queryable:d.errorMessage?1:0,format:d.formatInformation&&d.formatInformation.formatString,measure:{canDelete:a.capabilities.canEdit,canRename:a.capabilities.canEdit}};u.properties.push(f)}}return a}t.createExtensionSchema=r,t.convertModelExtension=a})(r=t.ExplorationConceptualSchemaFactory||(t.ExplorationConceptualSchemaFactory={}))})(r=t.dataReaderPlugins||(t.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){return void 0===t&&(t=!1),new n(e,t)}var i=e.data.FederatedConceptualSchema;t.createConceptualSchemaReader=r;var n=(function(){function e(e,t){this.promiseFactory=e,this.canEditSchemas=t}return e.prototype.execute=function(e){var r=e.dataSources;if(!r||r.length>1)return this.promiseFactory.reject({});var i=r[0],n=i.exploration;if(!n)return this.promiseFactory.reject({});var a=[],o=n.getModelExtensions();if(o)for(var s=0,l=o;s<l.length;s++){var u=l[s];a.push(t.ExplorationConceptualSchemaFactory.convertModelExtension(u,this.canEditSchemas))}else a.push(t.ExplorationConceptualSchemaFactory.createExtensionSchema(i.name,i.extends,this.canEditSchemas));return this.promiseFactory.resolve({data:{extensionSchemas:a}})},e.prototype.transform=function(e){for(var t=e.data,r={schemas:{}},n=0,a=t.extensionSchemas;n<a.length;n++){var o=a[n];r.schemas[o.name]=o}return{schema:new i(r)}},e})()})(r=t.dataReaderPlugins||(t.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.explore.contracts;!(function(e){function t(e,t,i,a){var o=r(e,i),s=n(e,i);return{added:{visualContainers:o.added,relationships:s.added},updated:{visualContainers:o.updated,relationships:s.updated},removed:{visualContainers:o.removed,relationships:s.removed},page:{page:i,ordinal:a},originalPage:{page:e,ordinal:t}}}function r(e,t){for(var r=[],i=[],n=e.visualContainers.slice(),a=0,o=t.visualContainers;a<o.length;a++){var s=o[a];if(void 0===s.id)r.push(s);else{var l=jsCommon.ArrayExtensions.findWithId(n,s.id);if(l){var u=n.indexOf(l);n.splice(u,1),jsCommon.JsonComparer.equals(l,s)||i.push(s)}else r.push(s)}}return{added:r,updated:i,removed:n}}function n(e,t){for(var r=e.relationships?e.relationships.slice():[],i=t.relationships||[],n=[],a=[],o=0;o<i.length;o++){var s=t.relationships[o];if(void 0===s.source.id||void 0===s.target.id)n.push(s);else{var l=s.source.id,u=s.target.id,c=_.find(r,(function(e){return e.source.id===l&&e.target.id===u}));if(c){var p=r.indexOf(c);r.splice(p,1),c.type!==s.type&&a.push(s)}else n.push(s)}}return{added:n,updated:a,removed:r}}function a(e,r){for(var i=[],n=[],a=e.slice(),o=0,s=r.length;o<s;o++){var l=r[o];if(void 0===l.id)i.push({page:l,ordinal:o});else{var u=jsCommon.ArrayExtensions.findWithId(a,l.id);if(u){var c=a.indexOf(u);a.splice(c,1);var p=e.indexOf(u),d=t(u,p,l,o);n.push(d)}else i.push({page:l,ordinal:o})}}return{added:i,updated:n,removed:a}}function o(e,t){for(var r=[],i=[],n=t||[],a=e?e.slice():[],o=0,s=n;o<s.length;o++){var l=s[o];if(void 0===l.id)r.push(l);else{var u=l.id,c=_.findIndex(a,(function(e){return e.id===u}));c>=0?(i.push({updatedPod:l,originalPod:a[c]}),a.splice(c,1)):r.push(l)}}return{added:r,removed:a,updated:i}}function s(e,t){var r=i.Section.filterTransient(t.sections),n=a(e.sections,r),s=o(e.pods,t.pods);return{pages:n,pods:s}}e.diff=s})(r=t.ExplorationDiffer||(t.ExplorationDiffer={}))})(r=t.proxies||(t.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,a){return new l(e,t,r,i,n,a)}var n=jsCommon.JsonExtensions;r.createExplorationProxy=i;var a="_",o="[0-9]+",s=18e5,l=(function(){function i(e,t,r,i,n,a){this.promiseFactory=e,this.httpService=t,this.serializer=r,this.telemetryService=i,this.featureSwitchService=n,this.cache={},this.uriPrefix=a||"explore/"}return i.prototype.get=function(t){var r=this,n=this.telemetryService,a=n.startEvent(e.telemetry.EXGetExploration,!1),o=t.sectionId,s=t.id,l=t.model,u=i.getKey(s,o);if(t.allowCache){var c=this.getExplorationCache(s,o,l);if(c)return a.event.info.fromCache=!0,a.resolve(),c}var p=this.promiseFactory.defer(),d=this.uriPrefix+"reports/"+s+"/exploration";return _.isNumber(o)&&(d+="/sections/"+o),this.cache[u]={promise:p.promise},this.httpService.get(d,this.httpService.powerbiRequestOptions(a.event,"GetExploration")).then((function(e){a.resolve(),r.onSuccess(e.data,p,l,u)}),(function(t){a.reject(e.errorDetailsHelper.getTelemetryErrorDetails(t.error,t.status)),r.onError(t,s,p,u)})),p.promise},i.prototype.save=function(e,t,n){var a=this,o=this.promiseFactory.defer(),s=i.getKey(n),l=this.serializer.serializeExploration(t,{withData:!0});if(null==t.id){var u=this.uriPrefix+"explorations/?reportid="+n;this.httpService.put(u,l,this.httpService.powerbiRequestOptions(null,"SaveExploration")).then((function(e){return a.onSuccess(e.data,o,null,s)}),(function(e){return a.onError(e,n,o,s)}))}else{var c=r.ExplorationDiffer.diff(e,t);this.featureSwitchService.featureSwitches.allUpSaveReport?this.explorationUpdateDiff(c,t.id,t).then((function(){o.resolve(t),a.updateExplorationCache(s,l)}),(function(e){o.reject(e)})):this.updateExploration(c,t.id,t).then((function(e){o.resolve(t),a.updateExplorationCache(s,l)}),(function(){return o.reject()}))}return o.promise},i.prototype.doUpdatePage=function(e,t,r){var i=this;return e.then((function(){return i.updatePage(t,r)}))},i.prototype.doAddPage=function(e,t,r){var i=this;return e.then((function(){return i.addPage(r,t)}))},i.prototype.doDeletePage=function(e,t,r){var i=this;return e.then((function(){return i.deletePage(t,r)}))},i.prototype.updateExploration=function(e,t,r){var i=this.promiseFactory.resolve();return i=this.doUpdateTopLevelProperties(i,r),i=this.doUpdateExplorationPods(i,e.pods,t),i=this.doUpdateExplorationPages(i,e.pages,t)},i.prototype.updateTopLevelProperties=function(e){var t=this.promiseFactory.defer(),r=this.serializer.serializeExplorationShallowWithResourcePackages(e),i=this.uriPrefix+"explorations/"+e.id;return this.httpService.post(i,r,this.httpService.powerbiRequestOptions(null,"UpdateExplorationProperty")).then((function(e){t.resolve(null)}),(function(e){return t.reject(null)})),t.promise},i.prototype.doUpdateTopLevelProperties=function(e,t){var r=this;return e.then((function(){return r.updateTopLevelProperties(t)}))},i.prototype.getModelsAndExploration=function(e){var t=this,r=this.promiseFactory.defer(),i=this.uriPrefix+"reports/"+e+"/modelsAndExploration";return this.httpService.get(i,this.httpService.powerbiRequestOptions(null,"GetModelsAndExploration")).then((function(e){var i=e.data.models;t.featureSwitchService.registerFeatureSwitches(e.data.featureSwitches),t.serializer.ensureInitialized().then((function(){var n=t.serializer.deserializeExploration(e.data.exploration,[],!0,i);r.resolve({exploration:n,models:i,featureSwitches:e.data.featureSwitches})}))}),(function(e){r.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{})})),r.promise},i.prototype.explorationUpdateDiff=function(e,t,r){var i=this,n=this.promiseFactory.defer(),a={};a.exploration=this.serializer.serializeExplorationShallowWithResourcePackages(r);var o=-1;a.addedPods=e.pods.added.reduce((function(e,t){if(null!=t){t.id=o--;var r=i.serializer.serializePod(t);null!=r&&e.push(r)}return e}),[]),a.deletedPods=e.pods.removed.reduce((function(e,t){return null!=t&&e.push(t.id),e}),[]),a.updatedPods=e.pods.updated.reduce((function(e,t){if(null!=t){var r=i.serializer.serializePod(t.originalPod),n=i.serializer.serializePod(t.updatedPod);jsCommon.JsonComparer.equals(r,n)||e.push(n)}return e}),[]);var s=-1,l=-1;a.addedPages=e.pages.added.map((function(e){if(e.page.id=s--,e.page.visualContainers)for(var t=0,r=e.page.visualContainers;t<r.length;t++){var n=r[t];n.id=l--}return i.serializer.serializePage(e.page,e.ordinal)})),a.deletedPages=e.pages.removed.reduce((function(e,t){return null!=t&&e.push(t.id),e}),[]),a.updatedPages=e.pages.updated.reduce((function(e,t){if(null!=t){for(var r=0,n=t.added.visualContainers;r<n.length;r++){var a=n[r];a.id=l--}var o=i.getUpdatedPageProperty(t);null!=o&&e.push(o)}return e}),[]);var u=this.uriPrefix+"explorations/savereport/"+t;return this.httpService.post(u,a,this.httpService.powerbiRequestOptions()).then((function(e){var t=!1,i=!1,a=!1;if(e&&e.data&&e.data.addedPodIds&&e.data.addedPodIds.length>0&&(t=!0),e&&e.data&&e.data.addedSectionIds&&e.data.addedSectionIds.length>0&&(i=!0),e&&e.data&&e.data.addedVisualContainerIds&&e.data.addedVisualContainerIds.length>0&&(a=!0),r.pods&&t)for(var o=0,s=r.pods;o<s.length;o++){var l=s[o];l.id<0&&(l.id=_.find(e.data.addedPodIds,{oldId:l.id}).id)}if(r.sections)for(var u=0,c=r.sections;u<c.length;u++){var p=c[u];if(p.id<0&&i&&(p.id=_.find(e.data.addedSectionIds,{oldId:p.id}).id),p.visualContainers&&a)for(var d=0,f=p.visualContainers;d<f.length;d++){var h=f[d];h.id<0&&(h.id=_.find(e.data.addedVisualContainerIds,{oldId:h.id}).id)}}n.resolve(r)}),(function(e){return n.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{})})),n.promise},i.prototype.doAddPod=function(e,t,r){var i=this;return e.then((function(){return i.addPod(r,t)}))},i.prototype.doUpdatePod=function(e,t,r){var i=this;return e.then((function(){return i.updatePod(t,r)}))},i.prototype.doDeletePod=function(e,t,r){var i=this;return e.then((function(){return i.deletePod(t,r)}))},i.prototype.updateExplorationPods=function(e,t){for(var r=this.promiseFactory.resolve(),i=0,n=e.added;i<n.length;i++){var a=n[i];r=this.doAddPod(r,t,a)}for(var o=0,s=e.updated;o<s.length;o++){var l=s[o];r=this.doUpdatePod(r,t,l)}for(var u=0,c=e.removed;u<c.length;u++){var p=c[u];r=this.doDeletePod(r,t,p.id)}return r},i.prototype.doUpdateExplorationPods=function(e,t,r){var i=this;return e.then((function(){return i.updateExplorationPods(t,r)}))},i.prototype.updateExplorationPages=function(e,t){for(var r=this.promiseFactory.resolve(),i=0,n=e.added;i<n.length;i++){var a=n[i];r=this.doAddPage(r,t,a)}for(var o=0,s=e.updated;o<s.length;o++){var l=s[o];r=this.doUpdatePage(r,t,l)}for(var u=0,c=e.removed;u<c.length;u++){var p=c[u];r=this.doDeletePage(r,t,p.id)}return r},i.prototype.doUpdateExplorationPages=function(e,t,r){var i=this;return e.then((function(){return i.updateExplorationPages(t,r)}))},i.prototype.addPod=function(e,t){var r=this;e.id=void 0;var i=this.serializer.serializePod(e),n=this.uriPrefix+"explorations/"+t+"/pods";return this.httpService.post(n,i,this.httpService.powerbiRequestOptions(null,"AddPod")).then((function(t){var i=r.serializer.deserializePod(t.data);e.id=i.id}),_.noop)},i.prototype.updatePod=function(e,t){var r=this,i=this.promiseFactory.resolve(),n=this.serializer.serializePod(t.originalPod),a=this.serializer.serializePod(t.updatedPod);return jsCommon.JsonComparer.equals(n,a)||(i=i.then((function(){var i=r.uriPrefix+"explorations/"+e+"/pods/"+t.updatedPod.id;return r.httpService.post(i,a,r.httpService.powerbiRequestOptions(null,"UpdatePod"))}))),i},i.prototype.deletePod=function(e,t){var r=this.uriPrefix+"explorations/"+e+"/pods/"+t;return this.httpService.delete(r,this.httpService.powerbiRequestOptions(null,"DeletePod"))},i.prototype.addPage=function(e,t){var r=this,i=this.promiseFactory.defer(),n=this.serializer.serializePage(e.page,e.ordinal),a=this.uriPrefix+"explorations/"+t+"/pages";return this.httpService.post(a,n,this.httpService.powerbiRequestOptions(null,"AddPage")).then((function(t){var n=r.serializer.deserializePage(t.data);e.page.id=n.id;var a=e.page.visualContainers,o=n.visualContainers;if(o)for(var s=0;s<o.length;s++)a[s].id=o[s].id;i.resolve(null)}),(function(e){return i.reject(null)})),i.promise},i.prototype.doUpdateVisualContainer=function(e,t,r,i,n){var a=this;return e.then((function(){return a.updateVisualContainer(t,r,i,n)}))},i.prototype.doDeleteVisualContainer=function(e,t,r,i){var n=this;return e.then((function(){return n.deleteVisualContainer(t,r,i)}))},i.prototype.doAddVisualContainer=function(e,t,r,i,n){var a=this;return e.then((function(){return a.addVisualContainer(t,r,i,n)}))},i.prototype.updatePage=function(e,t){for(var r=this.promiseFactory.resolve(),i=t.page.page.id,n=!(_.isEmpty(t.added.relationships)&&_.isEmpty(t.updated.relationships)&&_.isEmpty(t.removed.relationships)&&_.isEmpty(t.updated.visualContainers)),a=0,o=t.added.visualContainers;a<o.length;a++){var s=o[a],l=n?s.name:void 0;r=this.doAddVisualContainer(r,e,i,s,l)}for(var u=0,c=t.updated.visualContainers;u<c.length;u++){var p=c[u],l=n?p.name:void 0;r=this.doUpdateVisualContainer(r,e,i,p,l)}for(var d=0,f=t.removed.visualContainers;d<f.length;d++){var h=f[d];r=this.doDeleteVisualContainer(r,e,i,h.id)}return r=n?this.updatePageDeep(r,e,t):this.updatePageShallow(r,e,t)},i.prototype.updatePageShallow=function(e,t,r){var i=this,n=this.serializer.serializePageShallow(r.originalPage.page,r.originalPage.ordinal),a=this.serializer.serializePageShallow(r.page.page,r.page.ordinal);return jsCommon.JsonComparer.equals(n,a)||(e=e.then((function(){var e=i.promiseFactory.defer(),n=i.uriPrefix+"explorations/"+t+"/pages/"+r.page.page.id;return i.httpService.post(n,a,i.httpService.powerbiRequestOptions(null,"UpdatePageShallow")).then((function(t){return e.resolve(null)}),(function(t){return e.reject(null)})),e.promise}))),e},i.prototype.updatePageDeep=function(e,t,r){var i=this,n=this.serializer.serializePage(r.page.page,r.page.ordinal);return e=e.then((function(){var e=i.promiseFactory.defer(),a=i.uriPrefix+"explorations/"+t+"/pages/"+r.page.page.id;return i.httpService.post(a,n,i.httpService.powerbiRequestOptions(null,"UpdatePageDeep")).then((function(t){return e.resolve(null)}),(function(t){return e.reject(null)})),e.promise}))},i.prototype.deletePage=function(e,t){var r=this.promiseFactory.defer(),i=this.uriPrefix+"explorations/"+e+"/pages/"+t;return this.httpService.delete(i,this.httpService.powerbiRequestOptions(null,"DeletePage")).then((function(e){return r.resolve(void 0)}),(function(e){return r.reject()})),r.promise},i.prototype.addVisualContainer=function(e,t,r,i){var n=this,a=this.promiseFactory.defer();r.id=void 0;var o=this.serializer.serializeVisualContainer(r,{withData:!0},i),s=this.uriPrefix+"explorations/"+e+"/pages/"+t+"/visualcontainers";return this.httpService.post(s,o,this.httpService.powerbiRequestOptions(null,"AddVisualContainer")).then((function(e){var t=n.serializer.deserializeVisualContainer(e.data);r.id=t.id,a.resolve(null)}),(function(e){return a.reject(null)})),a.promise},i.prototype.updateVisualContainer=function(e,t,r,i){var n=this.promiseFactory.defer(),a=this.uriPrefix+"explorations/"+e+"/pages/"+t+"/visualcontainers/"+r.id,o=this.serializer.serializeVisualContainer(r,{withData:!0},i);return this.httpService.post(a,o,this.httpService.powerbiRequestOptions(null,"UpdateVisualContainer")).then((function(e){return n.resolve(null)}),(function(e){return n.reject(null)})),n.promise},i.prototype.deleteVisualContainer=function(e,t,r){var i=this.promiseFactory.defer(),n=this.uriPrefix+"explorations/"+e+"/pages/"+t+"/visualcontainers/"+r;return this.httpService.delete(n,this.httpService.powerbiRequestOptions(null,"DeleteVisualContainer")).then((function(e){return i.resolve(void 0)}),(function(e){return i.reject()})),i.promise},i.prototype.saveAs=function(e,t,r,i){var n=this,a=this.promiseFactory.defer(),o=this.serializer.serializeExploration(e,{withData:!0});o.reportId=void 0;var s={modelIds:[r],exploration:o,packageId:i};t=encodeURIComponent(t);var l=this.uriPrefix+"explorations/?name="+t;return this.httpService.put(l,s,this.httpService.powerbiRequestOptions(null,"SaveExplorationAs")).then((function(e){return n.onSuccess(e.data,a)}),(function(e){return n.onError(e,r,a)})),a.promise},i.prototype.saveVisualContainerQueries=function(e,t){var r=this.uriPrefix+"explorations/"+e+"/cache";return this.httpService.post(r,t,this.httpService.powerbiRequestOptions(null,"SaveVisualContainerQueries"))},i.prototype.getUpdatedPageProperty=function(e){var t=this,r=!(_.isEmpty(e.added.relationships)&&_.isEmpty(e.updated.relationships)&&_.isEmpty(e.removed.relationships)&&_.isEmpty(e.updated.visualContainers)),i={pageId:e.page.page.id};if(i.addedVisualContainers=e.added.visualContainers.reduce((function(e,i){if(null!=i){var n=r?i.name:void 0;e.push(t.serializer.serializeVisualContainer(i,{withData:!0},n))}return e}),[]),i.updatedVisualContainers=e.updated.visualContainers.reduce((function(e,i){if(null!=i){var n=r?i.name:void 0;e.push(t.serializer.serializeVisualContainer(i,{withData:!0},n))}return e}),[]),i.deletedVisualContainers=e.removed.visualContainers.reduce((function(e,t){return null!=t&&e.push(t.id),e}),[]),r){var n=this.serializer.serializePage(e.page.page,e.page.ordinal);i.pageProperty=n}else{var a=this.serializer.serializePageShallow(e.originalPage.page,e.originalPage.ordinal),o=this.serializer.serializePageShallow(e.page.page,e.page.ordinal);jsCommon.JsonComparer.equals(a,o)||(i.pageProperty=o)}return i},i.prototype.getExplorationCache=function(e,t,r){var n=i.getKey(e,t),a=this.cache[n];if(a||(n=i.getKey(e),a=this.cache[n]),a){if(a.promise)return a.promise;if(a.data){if(null!=t&&!_.any(a.data.sections,(function(e){return e.id===t})))return;var o=this.promiseFactory.defer(),s=[];return o.resolve(this.serializer.deserializeExploration(a.data,s,!0,r)),o.promise}}},i.prototype.updateExplorationCache=function(e,t){var r=this;if(e){if(!t)return void delete this.cache[e];var n=this.cache[e];n?(n.promise&&delete n.promise,n.data=t):this.cache[e]={data:t,promise:null},i.isAllSectionsKey(e)&&_.forOwn(this.cache,(function(t,i){i!==e&&null!=i.match(new RegExp("^"+e+"$"))&&delete r.cache[i]})),this.cacheExpirationTimerId&&clearTimeout(this.cacheExpirationTimerId),this.cacheExpirationTimerId=setTimeout((function(){r.clearCache()}),s)}},i.prototype.clearCache=function(){this.cache={}},i.prototype.logDeserializationErrorsTelemetryEvents=function(r,i){if(_.find(i,(function(e){return 0===e.errorType}))){var a=n.tryParseJSON(r.config);this.telemetryService.logEvent(e.telemetry.NewerExplorationVersion,a.version.toString(),t.services.upgrade.CurrentExplorationVersion.toString())}},i.prototype.onSuccess=function(e,t,r,i){var n=[],a=this.serializer.deserializeExploration(e,n,!0,r);t.resolve(a),this.logDeserializationErrorsTelemetryEvents(e,n),this.updateExplorationCache(i,e)},i.prototype.onError=function(e,t,r,i){r.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{}),this.updateExplorationCache(i,null)},i.getKey=function(e,t){return null!=t?e+a+t:e+a+o},i.isAllSectionsKey=function(e){if(!e)return!1;var t=e.split(a);return!(!t||2!==t.length)&&t[1]===o},i})()})(r=t.proxies||(t.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new a(e,t)}var r,i=jsCommon.StringExtensions;!(function(e){var t;!(function(e){e[e.User=0]="User",e[e.Generated=1]="Generated",e[e.Deleted=2]="Deleted"})(t=e.LinguisticItemSource||(e.LinguisticItemSource={}))})(r=e.wireContracts||(e.wireContracts={})),e.createLinguisticSchemaProxy=t;var n=0,a=(function(){function e(e,t){this.promiseFactory=e,this.httpService=t,this.schemas={},this.originalSchemas={}}return e.prototype.init=function(e,t){var r=this,i=this.promiseFactory.defer();if(e=e||n,this.schemas[e]={content:{Entities:[]}},this.originalSchemas[e]={content:{Entities:[]}},e&&t){var a="explore/reports/"+e+"/linguisticschema";this.httpService.get(a,this.httpService.powerbiRequestOptions()).then((function(t){r.schemas[e]=t.data,r.originalSchemas[e]=_.cloneDeep(t.data),i.resolve(null)}),(function(t){r.schemas[e]=null;var n=t?{error:t.error,requestId:t.requestId}:{};i.reject(n)}))}return i.promise},e.prototype.save=function(e){var t=this,r=this.promiseFactory.defer(),i=this.schemas[e],a=this.originalSchemas[e];if(i||(i=this.schemas[n],i&&(this.schemas[n]=null,this.schemas[e]=i,a=this.originalSchemas[n],this.originalSchemas[n]=null,this.originalSchemas[e]=a)),!_.isEqual(i,a)){if(i){var o="explore/reports/"+e+"/linguisticschema";i.content&&!_.isEmpty(i.content.Entities)?(i.id=void 0,this.httpService.post(o,i,this.httpService.powerbiRequestOptions()).then((function(i){t.originalSchemas[e]=_.cloneDeep(i.data),r.resolve(null)}),(function(e){var t=e?{error:e.error,requestId:e.requestId}:{};r.reject(t)}))):a?this.httpService.delete(o,this.httpService.powerbiRequestOptions()).then((function(i){delete t.originalSchemas[e],r.resolve(null)}),(function(e){var t=e?{error:e.error,requestId:e.requestId}:{};r.reject(t)})):(this.originalSchemas[e]=i,r.resolve(null))}return r.promise}},e.prototype.get=function(e,t){e=e||n;var r,i=this.schemas[e];return i&&(r=this.getWordsForPodEntity(i,t)),this.promiseFactory.resolve({podName:t,words:r||[]})},e.prototype.set=function(e,t,r){e=e||n;var i=this.schemas[e];i&&this.setWordsForPodEntity(i,t,r)},e.prototype.getSchema=function(e){return _.cloneDeep(this.schemas[e||n])},e.prototype.setSchema=function(e,t){this.schemas[e||n]=t},e.prototype.getWordsForPodEntity=function(e,t){var i=this.findPodEntity(e,t);if(i&&i.Source!==r.LinguisticItemSource.Deleted)return _.map(_.filter(i.Words,(function(e){return null==e.Source||e.Source===r.LinguisticItemSource.User})),(function(e){return e.Value}))},e.prototype.setWordsForPodEntity=function(e,t,n){var a=this.findPodEntity(e,t);if(_.isEmpty(n)){if(a){var o=e.content.Entities.indexOf(a);e.content.Entities.splice(o,1)}}else{a?a.Source===r.LinguisticItemSource.Deleted&&(a.Source=r.LinguisticItemSource.Generated):(a={Name:null,ConceptualEntity:t,Source:r.LinguisticItemSource.Generated},e.content.Entities.push(a));var s=n[0],l=i.deriveClsCompliantName(s,"pod");a.Name=this.makeUniquePodEntityName(l,e.content.Entities,a),a.Words=_.map(n,(function(e){return{Value:e,Source:r.LinguisticItemSource.User}}))}},e.prototype.findPodEntity=function(e,t){if(e.content&&e.content.Entities)return _.find(e.content.Entities,(function(e){return e.ConceptualEntity===t}))},e.prototype.makeUniquePodEntityName=function(e,t,r){for(var n={},a=0,o=t;a<o.length;a++){var s=o[a];s!==r&&(n[s.Name]=!0)}return i.findUniqueName(n,e);
},e})();e.LinguisticSchemaProxy=a})(t=e.proxies||(e.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function r(e,t,r){return new i(e,t,r)}t.createEmbedProxy=r;var i=(function(){function t(e,t,r){this.httpService=e,this.promiseFactory=t,this.localizationService=r}return t.prototype.createEmbed=function(t){var r=this,i="snapshots/embed/",n=this.promiseFactory.defer(),a=e.services.EmbedSerializer.serializeEmbedCreationRequest(t);return this.httpService.post(i,a,this.httpService.powerbiRequestOptions()).then((function(t){return n.resolve(e.services.EmbedSerializer.convertEmbed(t.data,r.localizationService))}),(function(e){return n.reject(e)})),n.promise},t.prototype.getSnapshotEmbedsForReport=function(t){var r=this,i="snapshots/embed/reports/"+t.toString(),n=this.promiseFactory.defer();return this.httpService.get(i,this.httpService.powerbiRequestOptions()).then((function(t){return n.resolve(_.map(t.data,(function(t){return e.services.EmbedSerializer.convertEmbed(t,r.localizationService)})))}),(function(e){return n.reject(e)})),n.promise},t.prototype.getLiveEmbeds=function(){var t=this,r="snapshots/embed/reports/interactive/",i=this.promiseFactory.defer();return this.httpService.get(r,this.httpService.powerbiRequestOptions()).then((function(r){return i.resolve(_.map(r.data,(function(r){return e.services.EmbedSerializer.convertEmbed(r,t.localizationService)})))}),(function(e){return i.reject(e)})),i.promise},t.prototype.getLiveEmbedsForReport=function(t){var r=this,i="snapshots/embed/reports/interactive/"+t.toString(),n=this.promiseFactory.defer();return this.httpService.get(i,this.httpService.powerbiRequestOptions()).then((function(t){return n.resolve(_.map(t.data,(function(t){return e.services.EmbedSerializer.convertEmbed(t,r.localizationService)})))}),(function(e){return n.reject(e)})),n.promise},t.prototype.getLiveEmbedsByEmbedKeyAsSysAdmin=function(t,r){var i=this,n=r+"/snapshots/embed/admin/reports/interactive/"+t,a=this.promiseFactory.defer();return this.httpService.get(n,this.httpService.sysAdminRequestOptions()).then((function(t){return a.resolve(_.map(t.data,(function(t){return e.services.EmbedSerializer.convertEmbed(t,i.localizationService)})))}),(function(e){return a.reject(e)})),a.promise},t.prototype.saveSnapshotEmbed=function(e,t){var r="snapshots/embed/"+e,i=this.promiseFactory.defer();return this.httpService.put(r,t,this.httpService.powerbiRequestOptions()).then((function(e){return i.resolve(null)}),(function(e){return i.reject(e)})),i.promise},t.prototype.deleteSnapshotEmbed=function(e){var t="snapshots/embed/"+e,r=this.promiseFactory.defer();return this.httpService.delete(t,this.httpService.powerbiRequestOptions()).then((function(e){return r.resolve(null)}),(function(e){return r.reject(e)})),r.promise},t.prototype.deleteLiveEmbed=function(e){var t="snapshots/embed/interactive/"+e,r=this.promiseFactory.defer();return this.httpService.delete(t,this.httpService.powerbiRequestOptions()).then((function(e){return r.resolve(null)}),(function(e){return r.reject(e)})),r.promise},t.prototype.deleteLiveEmbedAsSysAdmin=function(e,t){var r=t+"/snapshots/embed/admin/interactive/"+e,i=this.promiseFactory.defer();return this.httpService.delete(r,this.httpService.sysAdminRequestOptions()).then((function(e){return i.resolve(null)}),(function(e){return i.reject(e)})),i.promise},t.prototype.updateLiveEmbed=function(e,t){var r="/snapshots/embed/interactive/"+e,i=this.promiseFactory.defer();return this.httpService.put(r,t,this.httpService.powerbiRequestOptions()).then((function(e){return i.resolve(null)}),(function(e){return i.reject(e)})),i.promise},t.prototype.updateLiveEmbedAsSysAdmin=function(e,t,r){var i=r+"/snapshots/embed/admin/interactive/"+e,n=this.promiseFactory.defer();return this.httpService.put(i,t,this.httpService.sysAdminRequestOptions()).then((function(e){return n.resolve(null)}),(function(e){return n.reject(e)})),n.promise},t})()})(t=e.proxies||(e.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(t,r,i,n){if(!(t&&t.clientError&&t.clientError.ignorable)){var a;if(t&&t.serviceError)a=e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessageFromServiceError(t.serviceError);else if(t&&t.clientError)a=e.helpers.PowerBIServiceExceptionErrorHelper.GetErrorDetailsFromClientError(t.clientError);else{var o=$.Deferred();o.resolve(null),a=o.promise()}a.then((function(e){r.error(e&&e.message?e.message:i,n,{requestId:t?t.requestId:void 0,displayableErrorInfo:e?e.displayableErrorInfo:void 0})}))}}t.handleConceptualSchemaError=r})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){var t=e.drilldown;return null!=t?t.roles:[]}function r(e,t,r,i){var n,a=!1;if(null!=t)if(c(e.projections,t)){a=!0;var o=e.projections[r].all()[i-1];o&&(n=e.defn.select().withName(o.queryRef).expr)}else n=e.defn.select().withName(t).expr;return{expr:n,isActiveProjection:a,roleName:r,index:i}}function i(e,t,r){if(t)switch(r){case 1:return o(e,t);case 0:var i=t;if(i.expr){var s=void 0;s=_.isArray(i.expr)?i.expr:[i.expr];for(var l=[],u=0,c=s;u<c.length;u++){var p=c[u];l.push(a(e,p))}return l}return n(e,t)}}function n(e,t){for(var i=e.clone(),n=[],a=t.count||1,o=t.role,s=i.projections[o],l=s.all(),u=a-1;u>-1;u--){var c=t.index+u,p=r(i,l[c].queryRef,o,c);if(p.isActiveProjection){var d=l[p.index-1];d&&s.addActiveQueryReference(d.queryRef)}n.push(p)}return n}function a(e,t){var i,n,a=e.defn.selectNameOf(t),o=u(e.projections,a);return o&&(i=o.index,n=o.roleName),r(e,a,n,i)}function o(e,t){var r=e.projections[t.sourceRole];if(!r.activeProjectionRefs)return[];var i=r.activeProjectionRefs,n=r.all(),a=_.last(i),o=_.findIndex(n,(function(e){return e.queryRef===a}));if(o<0)return[];var u=l(t,o);return null==u?[]:s(u,e,t)}function s(e,t,r){if(1===e)return[];if(3===e||0===e){var i={role:r.sourceRole,index:r.sourceIndex,count:r.replacementExpressions&&r.replacementExpressions.length};return n(t,i)}if(2===e){for(var a=[],o=r.sourceIndex,s=r.targetIndex;s<o;){var i={role:r.sourceRole,index:s},l=n(t,i);a.push(_.first(l)),s++}return a}}function l(e,t){var r=e.sourceIndex,i=e.targetIndex;return e.sourceRole!==e.targetRole?3:r===t&&i<t?2:r<i&&i>=t?0:r>i&&i<=t?1:void 0}function u(e,t){for(var r in e)if(e[r].activeProjectionRefs){var i=e[r].all(),n=_.findIndex(i,(function(e){return e.queryRef===t}));if(n>=0)return{roleName:r,index:n}}}function c(e,t){for(var r in e){var i=e[r];if(_.last(i.activeProjectionRefs)===t)return!0}return!1}e.getDrillableRoles=t,e.getDrillFilterRemovalInfoList=i,e.getMoveType=l})(t=e.DrillUtils||(e.DrillUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){t.visitExploration(e),n(e.filters,t.visualContainerVisitor);var a=e.sections;if(!_.isEmpty(a))for(var o=0,s=a.length;o<s;o++)r(a[o],t,i)}function r(e,t,r){t.visitSection(e),n(e.filters,t.visualContainerVisitor);var a=e.visualContainers;if(!_.isEmpty(a))for(var o=0,s=a.length;o<s;o++)i(a[o],t.visualContainerVisitor,r)}function i(t,r,i){var o;if(r.visitVisualContainer(t),t.config&&(o=t.config.singleVisual)){r.visitSingleVisualConfig(o);var s=o.query;s&&r.visitQuery(s);var l=o.objects;if(l){var u=void 0,c=e.VisualContainerUtils.getVisualCapabilities(t,i);c&&(u=c.objects),u&&r.visitDataViewObjects(l,u),a(l,r)}}n(t.filters,r)}function n(e,t){if(!_.isEmpty(e))for(var r=0,i=e.length;r<i;r++){var n=e[r];t.visitFilter(n)}}function a(e,t){for(var r in e){var i=e[r];if(!_.isEmpty(i))for(var n=0,a=i;n<a.length;n++){var o=a[n],s=o.selector;s&&t.visitSelector(s)}}}e.traverseExploration=t,e.traverseVisualContainer=i})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=(function(){function e(){}return e.prototype.visitVisualContainer=function(e){},e.prototype.visitSingleVisualConfig=function(e){},e.prototype.visitQuery=function(e){},e.prototype.visitDataViewObjects=function(e,t){},e.prototype.visitFilter=function(e){},e.prototype.visitSelector=function(e){},e})();t.DefaultVisualContainerVisitor=r;var i=(function(t){function r(e){var r=this;return r=t.call(this)||this,r.rewriters=e,r}return __extends(r,t),r.prototype.visitQuery=function(e){var t=e.defn;if(t)for(var r=this.rewriters,i=0,n=r;i<n.length;i++){var a=n[i];e=a.rewriteQuery(e)}},r.prototype.visitDataViewObjects=function(t,r){var i=e.data.DataViewObjectDescriptors.findFilterOutput(r);if(i){var n=e.data.DataViewObjectDefinitions.getPropertyContainer(t,i,null);if(n){var a=i.propertyName,o=n[a];if(o){for(var s=this.rewriters,l=0,u=s;l<u.length;l++){var c=u[l];o=c.rewriteFilter(o)}n[a]=o}}}},r.prototype.visitFilter=function(e){var t=this.rewriters,r=e.filter,i=e.expression;if(i&&(e.expression=this.rewriteExpr(e.expression)),r){for(var n=0,a=t;n<a.length;n++){var o=a[n];r=o.rewriteFilter(r)}e.filter=r}},r.prototype.visitSelector=function(e){var t=e.data;if(!_.isEmpty(t)){for(var r=[],i=0,n=t;i<n.length;i++){var a=n[i];a.expr?r.push(this.rewriteDataViewScopeIdentity(a)):_.isEmpty(a.exprs)?_.isEmpty(a.roles)||r.push(a):r.push(this.rewriteDataViewScopeWildcard(a))}e.data=r}},r.prototype.rewriteDataViewScopeIdentity=function(t){return e.data.createDataViewScopeIdentity(this.rewriteExpr(t.expr))},r.prototype.rewriteDataViewScopeWildcard=function(t){for(var r=[],i=0,n=t.exprs;i<n.length;i++){var a=n[i];r.push(this.rewriteExpr(a))}return e.data.DataViewScopeWildcard.fromExprs(r)},r.prototype.rewriteExpr=function(e){for(var t=this.rewriters,r=0,i=t;r<i.length;r++){var n=i[r];e=n.rewriteExpr(e)}return e},r})(r);t.VisualContainerRewriter=i})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.visualContainerVisitor=e}return e.prototype.visitExploration=function(e){},e.prototype.visitSection=function(e){},e})();e.DefaultExplorationVisitor=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){var r=e.getMetadata(t);if(r){var i=r.format;return A.create({format:i,allowFormatBeautification:!0})}}function n(e,r,i){void 0===i&&(i=null);var n=e.getMetadata(r);if(n){var a=n.type,o=a&&(a.text||a.bool||a.dateTime),s=n.idOnEntityKey&&i&&I.equals(e,i);return!o||M.isMeasure(e)||s?t.contracts.FilterType.Advanced:t.contracts.FilterType.Categorical}}function a(e,t,r,i,n){if(!e||!t)return!1;var a=N.asFieldPattern(e),s=R.toFieldExprEntityItemPattern(a),l=t.schema(s.schema);if(!l)return!1;var u,c=l.findProperty(s.entity,R.getPropertyName(a));if(!c&&a.hierarchyLevel){var p=l.findHierarchy(s.entity,a.hierarchyLevel.name);p&&(u=p.levels.withName(a.hierarchyLevel.level))}if(!c&&!u||!r||!r.container)return!1;if(0!==r.scopeType&&c&&1===c.kind)return!1;if(0===r.scopeType){var d=r.container;return d&&o(d,i,n)}return!0}function o(e,r,i){var n=t.util.VisualContainerUtils.getVisualType(e);return!i.supportsFilterOutput(e)&&r.isQueryVisual(n)}function s(e,t){e.filters||(e.filters=[]),e.filters.push(t)}function l(i,n,a,o,s){if(!a)return!1;var l=i.expression;if(!l)return!1;var u=e.data.SQExprUtils.isMeasure(l),c=!_.isEmpty(r.validate(i,n,o)),p=t.util.VisualContainerUtils.hasGrouping(a,n);return!(!u||p||c)||(!!t.util.VisualContainerUtils.hasFilterMappingWithNonAggregatableColumns(a,n,s)||!(!t.util.VisualContainerUtils.hasGroupByItemsInQuery(a)||!u))}function u(e,t){var r=e.getMetadata(t);if(r)return r.type}function c(t,r){var i=e.data.SQExprUtils.getDefaultValues(t,r);if(!_.isEmpty(i)){var n=e.data.createDataViewScopeIdentity(e.data.SQExprUtils.getDataViewScopeIdentityComparisonExpr(t,i));return{isNot:!1,scopeIds:[n]}}}function p(e,r,i){var n=e.expression,a=e.filter,o=t.util.ModelAuthoringUtility.validate(n,r,i);if(a&&(o=a.validate(r,i,o)),!_.isEmpty(o))return o}function d(e){if(_.isEmpty(e))return O;for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n.name]=!0}return j.findUniqueName(t,O)}function f(e,t,r){var i=1,n=r.format(t,[i.toFixed()]);if(_.isEmpty(e))return n;for(var a={},o=0,s=e;o<s.length;o++){var l=s[o];l.restatement&&(a[l.restatement]=!0)}for(;a[n];)n=r.format(t,[(++i).toFixed()]);return n}function h(e){return e===t.contracts.FilterType.Categorical||e===t.contracts.FilterType.Visual}function v(e,t,r){var i=e.filters,n=[];if(i)for(var a=0,o=i;a<o.length;a++){var s=o[a],l=s&&s.filter;if(l&&_.isEmpty(l.validate(t,r))&&2===s.howCreated&&m(l.where())){var u=b(e,s.expression);u&&n.push(u)}}return n}function m(e){return!_.isEmpty(e)&&_.all(e,(function(e){return g(e)}))}function g(e){if(null==e)return!1;var t=e.condition;return I.isIn(t)?t.values&&1===t.values.length:I.isCompareRef(t)?0===t.comparison:void 0}function y(e,t){if(!_.isEmpty(e)){if(!t)return e;for(var r=[],i=0,n=e;i<n.length;i++){var a=n[i],o=a.condition;if(I.isIn(o)){var s=o.args;_.any(s,(function(e){return I.equals(e,t)}))&&r.push(a)}else if(I.isCompareRef(o)){var l=I.isConstant(o.left)?o.right:o.left;I.equals(l,t)&&r.push(a)}}return r}}function C(e,t){if(e){var r=e.condition;if(I.isIn(r)){if(!t)return r.values;if(_.isEmpty(r.values))return[[]];var i=r.args,n=_.findIndex(i,(function(e){return I.equals(e,t)})),a=n!==-1?_.map(r.values,(function(e){return[e[n]]})):[[]];return a}if(I.isCompareRef(r)){var o=I.isConstant(r.left),s=o?r.right:r.left,l=I.isConstant(r.left)?r.left:r.right;return!t||I.equals(s,t)?[[l]]:[[]]}}}function b(e,r){var i=t.util.VisualContainerUtils.getVisualQuery(e);if(i)return i.defn.selectNameOf(r)}function S(t,i,n){var a=[],o=n&&n.Filters&&0!==n.Filters.length?n.Filters:null;o&&o.length!==i.length&&(o=null);for(var s=0,l=i.length;s<l;s++){var u=i[s],c=o&&o[s],p=c&&c.expression&&T.deserializeExpr(c.expression);a.push({name:r.getNextFilterName(a),filter:new e.data.SemanticFilter(t,[u]),restatement:c&&c.Restatement,expression:p,howCreated:0,type:c&&c.type})}return a}function x(t,i){var n=_.filter(t.From,(function(t){return t.Type!==e.data.EntitySourceType.Pod})),a={Version:t.Version,From:n,Where:t.Where},o={RemovedIndexes:[]},s=T.deserializeFilter(a,o);if(i&&!_.isEmpty(o.RemovedIndexes)&&(i.Filters=_.filter(i.Filters,(function(e,t){return!_.contains(o.RemovedIndexes,t)}))),s)return r.deriveFromSQFilters(s.from(),s.where(),i)}function E(e,t){_.isEmpty(e.filters)||(t.filters=P(t.filters,e.filters,"explore"),e.filters=[])}function w(e,t,r,i){var n=i;if(!_.isEmpty(r)){t&&!_.isEmpty(t.parameters)&&_.remove(e.filters,(function(e){return _.any(t.parameters,(function(t){return t.boundFilter===e.name}))}));var a=D(r);_.remove(e.filters,(function(e){return _.any(V(e),(function(e){return _.any(a,(function(t){return I.equals(e,t)}))}))})),e.filters=P(e.filters,r,"param"),n=!0}if(n)for(var o=0,s=e.visualContainers;o<s.length;o++){var l=s[o];l.cachedData=null}}function F(e,t){e=e||[],t=t||[];for(var r={},i=[],n=0,a=t;n<a.length;n++){var o=a[n];r[o.name]=o}for(var s=0,l=e;s<l.length;s++){var o=l[s],u=r[o.name];u&&_.isEqual(u,o)||i.push(o)}return i}function P(e,t,r){for(var i={},n=0,a=e;n<a.length;n++){var o=a[n];i[o.name]=!0}for(var s=0,l=t;s<l.length;s++){var o=l[s];o.name=r+"_"+o.name,i[o.name]||(i[o.name]=!0)}return e.concat(t)}function D(e){return _.flatten(_.map(e,(function(e){return V(e)})))}function V(e){var t=[];if(e.expression&&t.push(e.expression),e.filter)for(var r=0,i=e.filter.conditions();r<i.length;r++){var n=i[r],a=new q;n.accept(a),t=t.concat(a.fields)}return t}var R=e.data.FieldExprPattern,T=e.data.services.SemanticQuerySerializer,I=e.data.SQExpr,N=e.data.SQExprConverter,M=e.data.SQExprUtils,j=jsCommon.StringExtensions,A=e.visuals.valueFormatter,O="Filter";r.getFormatter=i,r.getDefaultFilterType=n,r.canAdd=a,r.supportsVisualFilters=o,r.add=s,r.shouldDisableFilter=l,r.getValueType=u,r.getDefaultRetainedValue=c,r.validate=p,r.getNextFilterName=d,r.getNextAutoGenRestatement=f,r.isCategoricalFilter=h,r.getQueryRefsForSingleItemDrillFilters=v,r.areSingleValueFilters=m,r.isSingleValueFilter=g,r.getFiltersForColumn=y,r.getFilterValues=C,r.deriveFromSQFilters=S,r.extractParameterFilters=x,r.mergeExplorationSectionFilters=E,r.applySectionParameterFilters=w,r.extractParameterFiltersFromSection=F;var q=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=[],t}return __extends(t,e),t.prototype.visitColumnRef=function(e){this.fields.push(e)},t.prototype.visitHierarchyLevel=function(e){this.fields.push(e)},t.prototype.visitMeasureRef=function(e){this.fields.push(e)},t.prototype.visitEntity=function(e){this.fields.push(e)},t.prototype.visitAggr=function(e){},t})(e.data.DefaultSQExprVisitorWithTraversal)})(r=t.FilterUtils||(t.FilterUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.cultureInfo=e,this.maxDecimalPlaces=15}return e.prototype.updateFormatUponDataTypeChange=function(e,t){var r=this;return this.updateFormatInformation(e,t,(function(t){return _.contains(r.getValidFormatsForDataType(e),t.format)||(t=r.getDefaultFormatInformationForDataType(e)),r.updateFormatInformationForDateTimeDataType(e,t),t}))},e.prototype.changeFormat=function(e,t,r){var i=this;return this.updateFormatInformation(e,t,(function(e){return i.setFormatAndDownstreamEffects(e,r),e}))},e.prototype.toggleThousandsSeparator=function(e,t){var r=this;return this.updateFormatInformation(e,t,(function(t){var i=r.getThousandSeparatorValidSettingsForFormat(t.format).isChangeable;if(!i){var n=r.getFormatThatWillAllowThousandSeparatorToChange(e);null!=n&&(r.setFormatAndDownstreamEffects(t,n),i=!0)}return i&&(t.thousandSeparator=!t.thousandSeparator),t}))},e.prototype.setAccuracy=function(e,t,r){var i=this;return this.updateFormatInformation(e,t,(function(t){var n=i.isAccuracyValidForFormat(t.format,r);if(!n){var a=i.getFormatThatWillAllowAccuracyToChange(e,t.format);n=a&&i.isAccuracyValidForFormat(a,r),n&&i.setFormatAndDownstreamEffects(t,a)}return n&&(t.accuracy=r),t}))},e.prototype.setDateTimeFormat=function(e,t,r,i,n){var a=this;return this.updateFormatInformation(e,t,(function(e){return a.setFormatAndDownstreamEffects(e,r),n||(n=a.buildDateTimeFormatString(i)),e.dateTimeCustomFormat={lcid:a.cultureInfo.lcid,formatGroup:i,formatString:n},e}))},e.prototype.setCurrencyFormat=function(e,t,r,i,n,a,o,s){var l=this;return this.updateFormatInformation(e,t,(function(e){return l.setFormatAndDownstreamEffects(e,r),e.currencyFormat={lcid:i,displayName:n,currencySymbol:a,positivePattern:o,negativePattern:s},e}))},e.prototype.updateFormatInformation=function(e,t,r){return t||(t=this.getDefaultFormatInformationForDataType(e)),t=r(t),this.finalizeFormatInformation(t),t},e.prototype.getValidFormatsForDataType=function(e){switch(e){case 11:return["Binary"];case 5:return["Boolean"];case 2:case 3:case 4:return["General","NumberDecimal","NumberWhole","CurrencyCustom","CurrencyGeneral","Percentage","Scientific"];case 7:case 8:case 6:case 9:return["DateTimeGeneralPattern","DateTimeCustom"];case 1:case 13:return["Text"];default:return[]}},e.prototype.getDefaultFormatInformationForDataType=function(e){var t=this.getDefaultFormatForDataType(e);if(!t)return null;var r={formatString:null,format:t,accuracy:this.getDefaultAccuracyForFormat(t),thousandSeparator:this.getDefaultThousandSeparatorForFormat(t),currencyFormat:this.isCurrencyFormat(t)?this.buildDefaultCurrencyFormat():null,dateTimeCustomFormat:this.isDateTimeFormat(t)?this.buildDefaultDateTimeFormat():null};return r},e.prototype.getDefaultFormatForDataType=function(e){switch(e){default:case 0:case 12:case 13:return null;case 1:return"Text";case 2:return"CurrencyGeneral";case 3:return"General";case 4:return"NumberWhole";case 5:return"Boolean";case 6:case 7:case 8:case 9:case 10:return"DateTimeGeneralPattern";case 11:return"Binary"}},e.prototype.setFormatAndDownstreamEffects=function(e,t){e.format=t,this.makeAccuracyValid(e),this.makeThousandSeparatorValid(e),this.makeCurrencyFormatValid(e),this.makeDateTimeFormatValid(e)},e.prototype.makeAccuracyValid=function(e){var t=this.getAccuracyRangeForFormat(e.format);t?(null==e.accuracy||e.accuracy<t.min||e.accuracy>t.max)&&(e.accuracy=t.default):e.accuracy=null},e.prototype.getFormatThatWillAllowAccuracyToChange=function(e,t){switch(e){case 2:return"CurrencyCustom";case 3:case 4:return"CurrencyGeneral"===t?"CurrencyCustom":"NumberDecimal"}},e.prototype.getDefaultAccuracyForFormat=function(e){var t=this.getAccuracyRangeForFormat(e);return t&&t.default},e.prototype.isAccuracyValidForFormat=function(e,t){var r=this.getAccuracyRangeForFormat(e);return null!=r&&t>=r.min&&t<=r.max},e.prototype.getAccuracyRangeForFormat=function(e){switch(e){case"NumberWhole":return{min:0,max:0,default:0};case"CurrencyCustom":return{min:0,max:this.maxDecimalPlaces,default:this.cultureInfo.currencyDecimalDigits};case"NumberDecimal":case"Scientific":return{min:0,max:this.maxDecimalPlaces,default:this.cultureInfo.numberDecimalDigits};case"Percentage":return{min:0,max:this.maxDecimalPlaces,default:this.cultureInfo.percentDecimalDigits}}},e.prototype.makeThousandSeparatorValid=function(e){var t=this.getThousandSeparatorValidSettingsForFormat(e.format);t.isChangeable||(e.thousandSeparator=t.defaultValue)},e.prototype.getFormatThatWillAllowThousandSeparatorToChange=function(e){switch(e){case 2:case 3:return"NumberDecimal";case 4:return"NumberWhole"}},e.prototype.getDefaultThousandSeparatorForFormat=function(e){return this.getThousandSeparatorValidSettingsForFormat(e).defaultValue},e.prototype.getThousandSeparatorValidSettingsForFormat=function(e){switch(e){case"CurrencyGeneral":case"CurrencyCustom":return{isChangeable:!1,defaultValue:!0};case"General":case"Scientific":case"Binary":case"Boolean":case"DateTimeGeneralPattern":case"DateTimeCustom":case"Text":default:return{isChangeable:!1,defaultValue:!1};case"NumberDecimal":case"NumberWhole":case"Percentage":return{isChangeable:!0,defaultValue:!1}}},e.prototype.finalizeFormatInformation=function(e){e.formatString=this.buildFormatString(e)},e.prototype.buildFormatString=function(e){var t=this.buildThousandsPartOfFormatString(e.thousandSeparator),r=this.buildDecimalPartOfFormatString(e.accuracy);switch(e.format){case"Text":case"General":return"G";case"NumberDecimal":return t+"0"+r;case"NumberWhole":return t+"0";case"CurrencyGeneral":case"CurrencyCustom":"CurrencyGeneral"===e.format&&(r=".###############");var i=e.currencyFormat,n=i.currencySymbol,a=t+"0"+r,o=this.buildCurrencyPositiveFormatter(n,i.positivePattern,a),s=this.buildCurrencyNegativeFormatter(n,i.negativePattern,a);return o+";"+s+";"+o;case"Percentage":var l=this.cultureInfo.percentSymbol,u=this.cultureInfo.percentPositivePattern,c=this.cultureInfo.percentNegativePattern,a=t+"0"+r,o=this.buildPercentPositiveFormatter(l,u,a),s=this.buildPercentNegativeFormatter(l,c,a);return o+";"+s+";"+o;case"Scientific":return"0"+r+"E+000";case"DateTimeGeneralPattern":case"DateTimeCustom":return e.dateTimeCustomFormat.formatString;case"Boolean":return'"TRUE";"TRUE";"FALSE"'}return""},e.prototype.buildThousandsPartOfFormatString=function(e){return e?"#,":""},e.prototype.buildDecimalPartOfFormatString=function(e){return null==e||e<=0?"":"."+_.repeat("0",e)},e.prototype.buildCurrencyNegativeFormatter=function(e,t,r){switch(e=this.escapeCurrencySymbol(e),t){case 0:return"("+e+r+")";case 1:return"-"+e+r;case 2:return e+"-"+r;case 3:return""+e+r+"-";case 4:return"("+r+e+")";case 5:return"-"+r+e;case 6:return r+"-"+e;case 7:return""+r+e+"-";case 8:return"-"+r+" "+e;case 9:return"-"+e+" "+r;case 10:return r+" "+e+"-";case 11:return e+" "+r+"-";case 12:return e+" -"+r;case 13:return r+"- "+e;case 14:return"("+e+" "+r+")";case 15:return"("+r+" "+e+")"}return""},e.prototype.buildCurrencyPositiveFormatter=function(e,t,r){switch(e=this.escapeCurrencySymbol(e),t){case 0:return""+e+r;case 1:return""+r+e;case 2:return e+" "+r;case 3:return r+" "+e}return""},e.prototype.escapeCurrencySymbol=function(e){return"$"===e?"\\$":'"'+e+'"'},e.prototype.buildPercentNegativeFormatter=function(e,t,r){switch(t){case 0:return"-"+r+" "+e;case 1:return"-"+r+e;case 2:return"-"+e+r;case 3:return e+"-"+r;case 4:return""+e+r+"-";case 5:return r+"-"+e;case 6:return""+r+e+"-";case 7:return"-"+e+" "+r;case 8:return r+" "+e+"-";case 9:return e+" "+r+"-";case 10:return e+" -"+r;case 11:return r+"- "+e}return""},e.prototype.buildPercentPositiveFormatter=function(e,t,r){switch(t){case 0:return r+" "+e;case 1:return""+r+e;case 2:return""+e+r;case 3:return e+" "+r}return""},e.prototype.buildDateTimeFormatString=function(e){switch(e){case"GeneralDateTimeLong":return"G";case"ShortDate":return this.cultureInfo.shortDatePattern;case"LongDate":return this.cultureInfo.longDatePattern;case"MonthDay":return this.cultureInfo.monthDayPattern;case"RFC1123":return this.cultureInfo.rfc1123Pattern;case"SortableDateTime":return this.cultureInfo.sortableDateTimePattern;case"ShortTime":return this.cultureInfo.shortTimePattern;case"LongTime":return this.cultureInfo.longTimePattern;case"UniversalSortableDateTime":return this.cultureInfo.universalSortableDateTimePattern;case"YearMonth":return this.cultureInfo.yearMonthPattern;case"YearYY":return"yy";case"YearYYYY":return"yyyy";case"FullDateTimeShort":case"GeneralDateTimeShort":case"RoundTripDateTime":case"UniversalFullDateTime":case"FullDateTimeLong":default:return this.cultureInfo.fullDateTimePattern}},e.prototype.buildDateTimeFormat=function(e){return{lcid:this.cultureInfo.lcid,formatGroup:e,formatString:this.buildDateTimeFormatString(e)}},e.prototype.buildDefaultDateTimeFormat=function(){return this.buildDateTimeFormat("GeneralDateTimeLong")},e.prototype.buildDefaultDateFormat=function(){return this.buildDateTimeFormat("LongDate")},e.prototype.buildDefaultTimeFormat=function(){return this.buildDateTimeFormat("LongTime")},e.prototype.updateFormatInformationForDateTimeDataType=function(e,t){if(6===e||9===e){var r=t.dateTimeCustomFormat,i=r.formatGroup;6===e?"LongDate"!==i&&"ShortDate"!==i&&(t.dateTimeCustomFormat=this.buildDefaultDateFormat()):"LongTime"!==i&&"ShortTime"!==i&&(t.dateTimeCustomFormat=this.buildDefaultTimeFormat())}},e.prototype.makeDateTimeFormatValid=function(e){this.isDateTimeFormat(e.format)?e.dateTimeCustomFormat||(e.dateTimeCustomFormat=this.buildDefaultDateTimeFormat()):e.dateTimeCustomFormat=null},e.prototype.isDateTimeFormat=function(e){return"DateTimeCustom"===e||"DateTimeGeneralPattern"===e},e.prototype.buildDefaultCurrencyFormat=function(){return{lcid:this.cultureInfo.lcid,displayName:this.cultureInfo.currencySymbol+" "+this.cultureInfo.displayName,currencySymbol:this.cultureInfo.currencySymbol,positivePattern:this.cultureInfo.currencyPositivePattern,negativePattern:this.cultureInfo.currencyNegativePattern}},e.prototype.makeCurrencyFormatValid=function(e){this.isCurrencyFormat(e.format)?e.currencyFormat||(e.currencyFormat=this.buildDefaultCurrencyFormat()):e.currencyFormat=null},e.prototype.isCurrencyFormat=function(e){return"CurrencyCustom"===e||"CurrencyGeneral"===e},e})();e.FormatUtils=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.SQExpr,n=e.data.SQExprBuilder,a=e.data.SQExprConverter,o=e.data.SQExprGroupUtils,s=e.data.SQHierarchyExprUtils;!(function(t){function r(e,t,r,n){if(r&&t&&i.isHierarchyLevel(n)){for(var a=n,l=a.arg,u=s.expandExpr(e,l),c=[],p=0,d=t.dataRoles;p<d.length;p++){var f=d[p],h=r.tryGetExprs(f.name);if(h)for(var v=_(o.groupExprs(e,h)).filter((function(e){return i.equals(e.expr,l)})).reverse().value(),m=0,g=v;m<g.length;m++){var y=g[m],C=s.getInsertionIndex(u,y.children,a);c.push({expr:a,schema:e,targetRole:f.name,targetIndex:y.selectQueryIndex+C})}}return c}}function l(t,r){if(t&&t.kind===e.VisualDataRoleKind.Measure){var i=s.getHierarchySourceAsVariationSource(r);if(i)return n.columnRef(i.arg,i.property)}}function u(e,t,r,n,a,o){var s=e.singleVisual.query.tryGetExprs(t)||[],u=s.slice(r,r+n);if(!_.isEmpty(s)&&!_.isEmpty(u)){var c;if(c=_.isEmpty(o)?u[0]:o[0],i.isHierarchyLevel(c)){var p=l(a,c);if(p)return[p]}return _.isEmpty(o)?u:o}}function c(e,t){return i.isHierarchyLevel(e)&&i.isHierarchyLevel(t)&&i.equals(e.arg,t.arg)}function p(e,t){var r=a.asFieldPattern(t),i=r.hierarchyLevel;if(i){var n=e.findHierarchy(i.entity,i.name);return n?_.findIndex(n.levels,(function(e){return e.name===i.level})):void 0}}function d(e){_.isEmpty(e)||e.sort(f)}function f(e,t){return e.displayName.localeCompare(t.displayName,void 0,{sensitivity:"base"})}t.getOptionsToAddHierarchyLevelToExistingHierarchies=r,t.getHierarchyReplacementExpressions=u,t.hierarchyLevelComparer=c,t.findHierarchyLevelIndex=p,t.sortHierarchies=d})(r=t.HierarchyUtils||(t.HierarchyUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.visuals.matrixRoleNames;!(function(e){function t(e,t,o,s,l){if(e.matrix){for(var u=[],c=[],p=[],d=[],f=e.matrix,h=0,v=t;h<v.length;h++){var m=v[h],g=__assign({},m);g.roles={},u.push(g)}var y=function(e){if(l&&l.featureSwitches.showGeneratedColumnsInDetailView)return!0;var r=t[e.index];return!r||!_.isEmpty(r.roles)},C=r(f.rows,u,c,i.rows)&&r(f.columns,u,p,i.columns,(function(e){return!e.isMeasure}))&&n(f.valueSources,u,d,i.values,y);if(C){a(o,s,c,p,d);var b={};c.length>0&&(b[i.rows]=c),p.length>0&&(b[i.columns]=p),d.length>0&&(b[i.values]=d);var S={selects:u,roles:{ordering:b}};return S}}}function r(e,t,r,i,a){if(!e||_.isEmpty(e.levels))return!0;for(var o=0,s=e.levels;o<s.length;o++){var l=s[o];if(!n(l.sources,t,r,i,a))return!1}return!0}function n(e,t,r,i,n){if(_.isEmpty(e))return!0;for(var a=0,o=e;a<o.length;a++){var s=o[a];if(!n||n(s)){if(r.push(s.index),!t[s.index])return!1;t[s.index].roles[i]=!0}}return!0}function a(e,t,r,i,n){if(!_.isEmpty(e)&&t){var a=r.length>=2,l=i.length>=2,u=n.length>=2;if(a||l||u){var c=o(e,t);c&&(a&&s(r,c),l&&s(i,c),u&&s(n,c))}}}function o(e,t){var r=_.chain(e).map((function(e){return t[e]})).flatten().filter((function(e){return _.isNumber(e)})).value(),i=_.reduce(r,(function(e,t,r){return void 0===e[t]&&(e[t]=r),e}),{});return Object.keys(i).length>=2?i:void 0}function s(e,t){e.sort((function(e,r){return l(e,t)-l(r,t)}))}function l(e,t,r){return void 0===r&&(r=Number.MAX_VALUE),_.isNumber(t[e])?t[e]:r}e.generate=t})(r=t.MatrixVisualDataViewConverter||(t.MatrixVisualDataViewConverter={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.FieldExprPattern,n=e.data.contracts.SchemaChangeType.ObjectTypeEnum,a=e.data.SQExpr,o=e.data.SQExprBuilder,s=e.data.SQExprConverter;!(function(e){function t(e,t,r){if(e){var n=s.asFieldPattern(e),a=i.toFieldExprEntityItemPattern(n),o=""===a.entity?null:a.entity,l={itemShowHide:{schema:a.schema,entity:o,property:C(n),objectType:y(n),makeHidden:t}};g(l,r)}}function r(e,t){if(e){var r,n=s.asFieldPattern(e);if(n.hierarchyLevel){var a=n.hierarchyLevel;r={hierarchyLevelDelete:{schema:a.schema,entity:a.entity,hierarchy:a.name,hierarchyLevel:a.level}}}else{var o=i.toFieldExprEntityItemPattern(n);r={itemDelete:{schema:o.schema,entity:o.entity,property:C(n),objectType:y(n)}}}g(r,t)}}function l(e,t,r){if(e){var i=s.asFieldPattern(e),n=i.hierarchyLevel;if(n){var a={hierarchyLevelMove:{schema:n.schema,entity:n.entity,hierarchy:n.name,level:n.level,index:t}};g(a,r)}}}function u(e,t){var r=i.toFieldExprEntityItemPattern(e),n={entityRefresh:{schema:r.schema,entity:r.entity}};g(n,t)}function c(e,t,r){if(e){var n,a=s.asFieldPattern(e),o=i.toFieldExprEntityItemPattern(a);if(a.hierarchyLevel){var l=a.hierarchyLevel;n={hierarchyLevelRename:{schema:l.schema,entity:l.entity,hierarchy:l.name,before:l.level,after:t}}}else i.hasFieldExprName(a)?n={propertyRename:{schema:o.schema,entity:o.entity,
objectType:y(a),before:C(a),after:t}}:a.hierarchy?n={propertyRename:{schema:o.schema,entity:o.entity,objectType:y(a),before:i.getHierarchyName(a),after:t}}:o.entity&&(n={entityRename:{schema:o.schema,before:o.entity,after:t}});g(n,r)}}function p(e,t){var r={newMeasure:{schema:e.schema,entity:e.entity}};g(r,t)}function d(e,t){if(!_.isEmpty(e)){for(var r,i=[],n=0,o=e;n<o.length;n++){var l=o[n],u=s.asFieldPattern(l),c=u.column||u.groupingColumn;if(!c)return;if(r){if(!a.equals(l.source,r))return}else r=l.source;i.push(c.name)}var p={hierarchyCreate:{schema:r.schema,entity:r.entity,name:null,properties:i}};g(p,t)}}function f(e,t,r,i){if(e){var n=s.asFieldPattern(e),a=n.column||n.groupingColumn;if(a){var o={hierarchyLevelCreate:{schema:a.schema,entity:a.entity,hierarchy:t,property:a.name,index:r}};g(o,i)}}}function h(e,t){var r={newCalculatedColumn:{schema:e.schema,entity:e.entity}};g(r,t)}function v(e){if(null!=e&&!_.isEmpty(e.changes)){var t=_.filter(e.changes,(function(e){return e.newMeasureCreated||e.newCalculatedColumnCreated||e.measureMove||e.newCalculatedTableCreated||e.newBins||e.newGroups}));if(0!==t.length){var r,i,n,a,s=t[t.length-1];return s.newMeasureCreated?(r=s.newMeasureCreated.schema,i=s.newMeasureCreated.entity,a=s.newMeasureCreated.measureDefinition.name,o.measureRef(o.entity(r,i),a)):s.newCalculatedColumnCreated?(r=s.newCalculatedColumnCreated.schema,i=s.newCalculatedColumnCreated.entity,n=s.newCalculatedColumnCreated.name,o.columnRef(o.entity(r,i),n||a)):s.newCalculatedTableCreated?(r=s.newCalculatedTableCreated.schema,i=s.newCalculatedTableCreated.entity,o.entity(r,i)):s.measureMove?(r=s.measureMove.schema,i=s.measureMove.destination,a=s.measureMove.property,o.measureRef(o.entity(r,i),a)):s.newBins?(r=s.newBins.schema,i=s.newBins.entity,n=s.newBins.name,o.columnRef(o.entity(r,i),n)):s.newGroups?(r=s.newGroups.schema,i=s.newGroups.entity,n=s.newGroups.name,o.columnRef(o.entity(r,i),n)):void 0}}}function m(e,t,r){var i=[];if(e&&(i=e.validate(t,r,i)),!_.isEmpty(i))return i}function g(e,t){t.apply({changes:[e]})}function y(e){return C(e)?e.column||e.groupingColumn?n.Column:e.measure?n.Measure:e.hierarchy?n.Hierarchy:"":n.Table}function C(e){return i.getPropertyName(e)||i.getHierarchyName(e)}e.hide=t,e.deleteItem=r,e.move=l,e.refreshEntity=u,e.rename=c,e.createMeasure=p,e.createHierarchy=d,e.createHierarchyLevel=f,e.createCalculatedColumn=h,e.getLastNewCalculationSchemaChangeAsFieldExpr=v,e.validate=m,e.GetObjectTypeForSchemaChange=y})(r=t.ModelAuthoringUtility||(t.ModelAuthoringUtility={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new i(e,t)}var r;!(function(e){e[e.None=0]="None",e[e.DuplicatedName=1]="DuplicatedName",e[e.EmptyName=2]="EmptyName",e[e.NameTooLong=3]="NameTooLong"})(r=e.NameValidationError||(e.NameValidationError={})),e.createNameValidator=t;var i=(function(){function e(e,t){this.federatedConceptualSchema=e,this.localizationService=t,this.MaximumNameLength=512}return e.prototype.validateMeasureName=function(t,i){if(!t||0===t.trim().length)return{error:r.EmptyName,reason:this.localizationService.get("NameValidationFailedEmptyName")};if(t.length>this.MaximumNameLength)return{error:r.NameTooLong,reason:this.localizationService.format("NameValidationFailedLongName",[t,this.MaximumNameLength])};var n=e.normalizeModelItemName(t);return i&&e.normalizeModelItemName(i)===n?{error:r.None}:this.validateColumnAndMeasureNameUniqueness(n)},e.prototype.validateExistingMeasureName=function(t){var r=e.normalizeModelItemName(t.name);return this.validateColumnAndMeasureNameUniqueness(r,(function(e,r){return r!==t}))},e.prototype.makeValidMeasureName=function(e){var t=this;return this.makeValidName(e,(function(e){return t.validateMeasureName(e).error}))},e.prototype.makeValidName=function(e,t){var i,n=e,a=t(n);if(a===r.DuplicatedName)i=2;else{if(a===r.None)return e;i=0}for(;;){var o=void 0;switch(o=i?n+" "+i:n,a=t(o)){case r.None:return o;case r.DuplicatedName:i++,1===i&&(i=2);continue;case r.NameTooLong:n=n.slice(0,Math.min(this.MaximumNameLength,n.length-1)),i=0;continue;default:throw new Error("MakeValidName encountered a problem it can't fix.")}}},e.prototype.validateColumnAndMeasureNameUniqueness=function(t,i){for(var n=0,a=this.federatedConceptualSchema.schemas;n<a.length;n++)for(var o=a[n],s=0,l=o.entities;s<l.length;s++)for(var u=l[s],c=0,p=u.properties;c<p.length;c++){var d=p[c];if((!i||i(u,d))&&e.normalizeModelItemName(d.name)===t){var f=d.measure?"NameValidationFailedCollisionMeasure":"NameValidationFailedCollisionColumn";return{error:r.DuplicatedName,reason:this.localizationService.format(f,[d.name,u.name])}}}return{error:r.None}},e.normalizeModelItemName=function(e){return jsCommon.StringExtensions.normalizeCase(e)},e})()})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new o(e,t,r,i)}var i=e.data.QueryProjectionCollection,n=e.data.QueryProjectionsByRole,a=(function(){function e(e,t,r){this.plugin=e,this.initialize(t,r)}return Object.defineProperty(e,"ValuesRoleName",{get:function(){return e.ValuesRole},enumerable:!0,configurable:!0}),e.getProjection=function(e,t){var r=n.getRole(e,t);return r||(e[t]=r=new i([])),r.all()},e.addCategoryRole=function(t,r){e.getProjection(t,e.CategoryRole).push(r.projection)},e.addValuesRole=function(t,r){e.getProjection(t,e.ValuesRole).push(r.projection)},e.addSeriesRole=function(t,r){e.getProjection(t,e.SeriesRole).push(r.projection)},e.addGroupRole=function(t,r){e.getProjection(t,e.GroupRole).push(r.projection)},e.addDetailsRole=function(t,r){e.getProjection(t,e.DetailsRole).push(r.projection)},e.addYRole=function(t,r){e.getProjection(t,e.YRole).push(r.projection)},e.addTargetValueRole=function(t,r){e.getProjection(t,e.TargetValueRole).push(r.projection)},e.addMinValueRole=function(t,r){e.getProjection(t,e.MinValueRole).push(r.projection)},e.addMaxValueRole=function(t,r){e.getProjection(t,e.MaxValueRole).push(r.projection)},e.addXRole=function(t,r){e.getProjection(t,e.XRole).push(r.projection)},e.addSizeRole=function(t,r){e.getProjection(t,e.SizeRole).push(r.projection)},e.addGradientRole=function(t,r){e.getProjection(t,e.GradientRole).push(r.projection)},e.addTooltipRole=function(t,r){e.getProjection(t,e.TooltipRole).push(r.projection)},e.addRowsRole=function(t,r){e.getProjection(t,e.RowsRole).push(r.projection)},e.addColumnsRole=function(t,r){e.getProjection(t,e.ColumnsRole).push(r.projection)},e.prototype.initialize=function(e,t){var r=e.select();this.projectionsInfo=[];for(var i=0,n=r.length;i<n;i++){var a=r[i];this.projectionsInfo.push({projection:{queryRef:a.name},metadata:a.expr.getMetadata(t)})}},e})();a.ValuesRole="Values",a.SeriesRole="Series",a.CategoryRole="Category",a.GroupRole="Group",a.DetailsRole="Details",a.YRole="Y",a.XRole="X",a.SizeRole="Size",a.GradientRole="Gradient",a.PlayRole="Play",a.RowsRole="Rows",a.ColumnsRole="Columns",a.MinValueRole="MinValue",a.MaxValueRole="MaxValue",a.TargetValueRole="TargetValue",a.TooltipRole="Tooltips",t.QueryProjectionBuilder=a;var o=(function(e){function t(t,r,i,n){var a=e.call(this,t,i,n)||this;return a.dataRoles=r,a}return __extends(t,e),t.prototype.validatePlugin=function(){return!0},t.prototype.build=function(e){for(var t={},r=0,i=this.dataRoles.length;r<i;r++){var n=this.dataRoles[r],o=this.projectionsInfo[n.Projection];if(o&&(a.getProjection(t,n.Name).push(o.projection),n.isActive)){var s=t[n.Name];s.addActiveQueryReference(o.projection.queryRef)}}return t},t})(a);t.DataRolesQueryProjectionBuilder=o,t.createProjectionBuilderFromDataRoles=r})(r=t.QueryProjectionBuilderCoreUtils||(t.QueryProjectionBuilderCoreUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(t,r,i){var n=e.createJQueryPromiseFactory().defer(),a=f(t,r);return a===-1?n.resolve(void 0):i.get(t.reportId,t.pods[a].name).then((function(e){var t=e&&e.words.slice();if(_.isEmpty(t))n.resolve(void 0);else{t.shift();var r={altNames:t};n.resolve(r)}})),n.promise}function i(e,t,r){var i=f(e,t);i>-1&&(r.set(e.reportId,e.pods[i].name,[]),e.pods.splice(i,1))}function n(e,t,r){return a(e,t.name,t.displayName,r)}function a(e,t,r,i){var n=f(e,t);n===-1&&(n=v(e,t));var a=e.pods[n];return i.get(e.reportId,a.name).then((function(t){var n=t&&t.words;_.isEmpty(n)?n=[r]:n[0]=r,i.set(e.reportId,a.name,n)}))}function o(e,t,r,i){var n=f(e,t.name);n===-1&&(n=v(e,t.name)),r.unshift(t.displayName),i.set(e.reportId,e.pods[n].name,r)}function s(e,t,r){var i=f(e,t);i===-1&&(i=v(e,t));var n=e.pods[i];n.parameters||(n.parameters=[]),n.parameters.push({name:"Param_"+r,boundFilter:r})}function l(e,t,r,i){var n=f(e,t);if(n>-1){var a=e.pods[n],o=h(a,r);o>-1&&(a.parameters.splice(o,1),m(e,n,i))}}function u(e,t,r){var i=f(e,t);if(i===-1)return!1;var n=h(e.pods[i],r);return n!==-1}function c(e,t,r,i){var n=f(e,t);(n!==-1||r)&&(n===-1&&(n=v(e,t)),e.pods[n].cortanaEnabled=r,m(e,n,i))}function p(e,t){if(e&&e.pods){var r=e.pods,i=_.findIndex(r,(function(e){return e.name===t}));return i!==-1?i:void 0}}function d(t,r,i,n){var a=f(t,t.sections[i].name);if(a===-1)return e.createJQueryPromiseFactory().resolve();var o=v(t,r.name),s=t.pods[o],l=t.pods[a];return s.cortanaEnabled=l.cortanaEnabled,s.parameters=_.cloneDeep(l.parameters),y(t.reportId,r,s,l,n)}function f(e,t){return e&&e.pods?_.findIndex(e.pods,(function(e){return e.boundSection===t})):-1}function h(e,t){return e&&e.parameters?_.findIndex(e.parameters,(function(e){return e.boundFilter===t})):-1}function v(e,t){return e.pods||(e.pods=[]),e.pods.push({name:g(e.pods),boundSection:t,parameters:[]}),e.pods.length-1}function m(e,t,r){var i=e.pods[t];!i.cortanaEnabled&&_.isEmpty(i.parameters)&&r.get(e.reportId,i.name).then((function(r){r&&!_.isEmpty(r.words)||(e.pods.splice(t,1),0===e.pods.length&&(e.pods=void 0))}))}function g(e){for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n.name]=!0}return C.findUniqueName(t,b)}function y(e,t,r,i,n){return n.get(e,i.name).then((function(i){var a=i&&i.words.slice();_.isEmpty(a)||(a.shift(),a.unshift(t.displayName),n.set(e,r.name,a))}))}var C=jsCommon.StringExtensions,b="Pod";t.getLinguisticMetadata=r,t.deletePod=i,t.ensurePod=n,t.updateLinguisticPrimaryName=a,t.updateLinguisticAltNames=o,t.addParameter=s,t.deleteParameter=l,t.hasParameter=u,t.setCortanaEnabled=c,t.findPodIndexForPodName=p,t.duplicatePod=d,t.findPodIndexForSectionName=f})(r=t.PodUtils||(t.PodUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t,r=jsCommon.ArrayExtensions;!(function(e){function t(e){var t=e.resourcePackages;return t||(t=r.createWithName(),e.resourcePackages=t),t}function i(e,t,r){var i=_.find(e,(function(e){return e.type===t&&e.name===r}));return i||(i={id:void 0,name:r,type:t,items:[]},e.push(i)),i}e.ensureResourcePackages=t,e.ensureResourcePackage=i})(t=e.ResourcePackageUtils||(e.ResourcePackageUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(t){for(var r=[],i=0,n=t;i<n.length;i++){var a=n[i];a.measureMove&&r.push(new c(e.data.createMoveMeasureRewriter(a.measureMove))),a.entityRename&&r.push(new c(e.data.createEntityRenameRewriter(a.entityRename))),a.propertyRename&&r.push(new c(e.data.createPropertyRenameRewriter(a.propertyRename))),a.hierarchyLevelRename&&r.push(new c(e.data.createHierarchyLevelRenameRewriter(a.hierarchyLevelRename))),a.removeVariation&&r.push(new p(new u(a.removeVariation),a.removeVariation))}return r}function i(e,t){var r=s.asFieldPattern(e);return r.columnHierarchyLevelVariation&&r.columnHierarchyLevelVariation.source.entity===t.entity&&r.columnHierarchyLevelVariation.source.schema===t.schema&&r.columnHierarchyLevelVariation.source.name===t.property&&r.columnHierarchyLevelVariation.variationName===t.name}var n=e.data.SQColumnRefExpr,a=e.data.SQEntityExpr,o=e.data.SQExpr,s=e.data.SQExprConverter,l=e.data.SQExprRewriter;t.createSchemaChangeRewriters=r;var u=(function(e){function t(t){var r=this;return r=e.call(this)||this,r.change=t,r}return __extends(t,e),t.prototype.visitHierarchyLevel=function(e){return i(e,this.change)?new n(new a(this.change.schema,this.change.entity),this.change.property):e},t})(l),c=(function(){function e(e){this.rewriter=e}return e.prototype.rewriteQuery=function(e){var t=e.defn;return t=t.rewrite(this.rewriter),e.defn=t,e},e.prototype.rewriteFilter=function(e){return e.rewrite(this.rewriter)},e.prototype.rewriteExpr=function(e){return e.accept(this.rewriter)},e})();t.VisualQueryExprRewriter=c;var p=(function(){function e(e,t){this.rewriter=e,this.change=t}return e.prototype.rewriteQuery=function(e){this.removeDuplicateSQHierarchyLevelExpr(e);var t=e.defn;return t=t.rewrite(this.rewriter),e.defn=t,e},e.prototype.rewriteFilter=function(e){return e.rewrite(this.rewriter)},e.prototype.rewriteExpr=function(e){return e.accept(this.rewriter)},e.prototype.removeDuplicateSQHierarchyLevelExpr=function(e){for(var t=e.defn.select(),r=0;r<t.length;){var n=t[r];if(r++,o.isHierarchyLevel(n.expr)&&i(n.expr,this.change))for(;r<t.length&&o.isHierarchyLevel(t[r].expr)&&o.equals(n.expr.arg,t[r].expr.arg);)e.removeExpr(t[r].expr,!1),r++}},e})()})(r=t.schemaRewriterUtils||(t.schemaRewriterUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var r=[];if(!e||!e.visualContainers)return r;for(var i=0,n=e.visualContainers;i<n.length;i++){var a=n[i];t.addScriptVisualId(a,r)}return r}function r(e,r){var i={totalVisualsCount:0,scriptVisualsUniqueIds:[]};if(!e||!e.sections)return i;for(var n=0,a=e.sections;n<a.length;n++){var o=a[n];if(o.visualContainers){var s=t(o,r);i.scriptVisualsUniqueIds=i.scriptVisualsUniqueIds.concat(s),i.totalVisualsCount+=o.visualContainers.length}}return i}function i(e,r,i,n,a){var o=[];switch(e){case 0:if(!n)return o;a.addScriptVisualId(n,o);break;case 1:o=t(i,a);break;case 2:if(!r)return o;for(var s=0,l=r.sections;s<l.length;s++){var u=l[s],c=t(u,a);o=o.concat(c)}break;default:return o}return o}function n(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(n&&n.config&&n.config.singleVisual){var a=n.config.singleVisual.visualType;if(a&&t.isScriptVisual(a))return!0}}return!1}function a(e,t,r,i,n,a){var o=e.control(),s=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_OkButton"),l=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_CancelButton"),u=[new InJs.ModalDialogAction(s,function(e,t){o.hideDialog(),n()}),new InJs.ModalDialogAction(l,function(e,t){o.hideDialog(),a()})],c=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_Title"),p=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_WarningMessage"),d="<div><span>"+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart1")+' </span><a href= "https://go.microsoft.com/fwlink/?LinkId=821887" target= "_blank">'+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessageLink1")+"</a><span> "+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart2")+"</span><br/><span>"+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart3")+' </span><a href= "https://go.microsoft.com/fwlink/?LinkId=821886" target= "_blank">'+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessageLink2")+"</a></div>";i.message=p;var f={dialogName:c,isDismissable:!1,scope:i,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"customModalDialog",dialogActions:u,notificationType:jsCommon.ModalDialogNotificationType.SecurityWarning,notificationText:p,htmlMessageText:d,focusOnFirstButton:!1,noActiveButtons:!0,flipContentAndNotificationOrder:!0};r.showLegacyWebModalDialog(f)}e.defaultScript="##############################",e.getScriptVisualIdsInSection=t,e.getVisualStasInExploration=r,e.getScriptVisualIds=i,e.visualContainerHasScriptVisuals=n,e.confirmRefreshForRDataSource=a})(t=e.ScriptVisualsUtil||(e.ScriptVisualsUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t,r){void 0===r&&(r=!0),this.containerSelector=e,this.itemsSelector=t,this.includeDescendants=r}return Object.defineProperty(e.prototype,"position",{get:function(){},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.scrollItemIntoView=function(e,t,r){var i=this.getContainer(),n=this.getRange(i),a=this.getItems(),o=a[e];if(o){var s=0===e,l=e===a.length-1,u=this.getRange($(o),!0);if(s?t=0:l?t=r||0:null!==t&&void 0!==t||(t=this.getDefaultOverscroll()),n&&u){var c=this.calculatePositionDelta(n,u,t);this.position=this.position+c}}},e.prototype.getPageDownItemIndex=function(e){var t=this.getRange(this.getContainer());if(t){var r=this.getItems();if(0===r.length)return-1;for(var i=0,n=e;n<r.length-1;n++){var a=this.getRange(r.eq(n));if(i+=a.size,i>t.size)return n}return r.length-1}return-1},e.prototype.getPageUpItemIndex=function(e){var t=this.getRange(this.getContainer());if(t){var r=this.getItems();if(0===r.length)return-1;for(var i=0,n=e;n>0;n--){var a=this.getRange(r.eq(n));if(i+=a.size,i>t.size)return n}return 0}return-1},e.prototype.retainPosition=function(e){var t=this.position;try{e()}finally{this.position=t}},e.prototype.handleKeyDown=function(e,t,r){var i=!0,n=e,a=this.getItems(),o=a.length-1;switch(t.keyCode){case $.ui.keyCode.PAGE_UP:var s=this.getPageUpItemIndex(e);n=Math.max(s,0);break;case $.ui.keyCode.PAGE_DOWN:var l=this.getPageDownItemIndex(e);n=Math.min(l,o);break;case $.ui.keyCode.END:n=o;break;case $.ui.keyCode.HOME:n=0;break;default:n=this.getNewIndexOnKeyDown(e,o,t),i=void 0!==n}return void 0!==n&&n!==e&&(r(n),this.scrollItemIntoView(n)),i},e.prototype.onScroll=function(e){var t=this,r=this.getContainer();r.scroll((function(r){var i=t.position/t.max;e(i)}))},e.prototype.getNewIndexOnKeyDown=function(e,t,r){},e.prototype.getRange=function(e,t){void 0===t&&(t=!1)},e.prototype.getDefaultOverscroll=function(){},e.prototype.getContainer=function(){return $(this.containerSelector)},e.prototype.getItems=function(){return this.retrieveItems()},e.prototype.retrieveItems=function(){return this.includeDescendants?this.getContainer().find(this.itemsSelector):this.getContainer().children(this.itemsSelector)},e.prototype.calculatePositionDelta=function(e,t,r){return t.min<e.min?-(e.min-t.min+r):t.max>e.max?t.max-e.max+r:0},e})();e.BaseScrollHelper=t;var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"position",{get:function(){var e=this.getContainer();return e.scrollTop()},set:function(e){var t=this.getContainer();t.scrollTop()!==e&&t.scrollTop(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){var e=this.getContainer()[0];return e?e.scrollHeight:void 0},enumerable:!0,configurable:!0}),t.prototype.getNewIndexOnKeyDown=function(e,t,r){switch(r.keyCode){case $.ui.keyCode.UP:return r.scrollHandled=!0,Math.min(Math.max(e-1,0),t);case $.ui.keyCode.DOWN:return Math.min(e+1,t)}},t.prototype.getRange=function(e,t){void 0===t&&(t=!1);var r=e.offset();if(r){var i=t?e.outerHeight():e.innerHeight();return{min:r.top,max:r.top+i,size:i}}return null},t.prototype.getDefaultOverscroll=function(){return 0},t})(t);e.VerticalScrollHelper=r;var i=(function(e){function t(t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=!0);var a=e.call(this,t,r,n)||this;return a.isRtl=i,a}return __extends(t,e),Object.defineProperty(t.prototype,"position",{get:function(){var e=this.getContainer();return e.scrollLeft()},set:function(e){var t=this.getContainer();t.scrollLeft()!==e&&t.scrollLeft(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){var e=this.getContainer()[0];return e?e.scrollWidth:void 0},enumerable:!0,configurable:!0}),t.prototype.getNewIndexOnKeyDown=function(e,t,r){var i=0;switch(r.keyCode){case $.ui.keyCode.LEFT:i=-1;break;case $.ui.keyCode.RIGHT:i=1}if(this.isRtl&&(i=-i),0!==i)return e+=i,e<0&&(e=0),e>t&&(e=t),e},t.prototype.getRange=function(e,t){void 0===t&&(t=!1);var r=e.offset();if(r){var i=t?e.outerWidth():e.innerWidth();return{min:r.left,max:r.left+i,size:i}}return null},t.prototype.getDefaultOverscroll=function(){return 16},t.prototype.calculatePositionDelta=function(t,r,i){var n=e.prototype.calculatePositionDelta.call(this,t,r,i);return this.isRtl?-n:n},t})(t);e.HorizontalScrollHelper=i;var n=(function(){function e(e,t,r){this.lastScrollLeft=0,this.lastScrollTop=0,this.scrollPanel=e,this.syncedPanel=t,this.syncOptions=r,this.onScroll=this.onScroll.bind(this),this.scrollPanel.addEventListener("scroll",this.onScroll)}return e.prototype.dispose=function(){this.scrollPanel.removeEventListener("scroll",this.onScroll)},e.prototype.onScroll=function(e){var t=this;this.syncOptions.syncDelay?(clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(){t.syncScrollPositions()}),this.syncOptions.syncDelay)):this.syncScrollPositions()},e.prototype.syncScrollPositions=function(){if(this.syncOptions.syncX){var e=this.scrollPanel.scrollLeft;e!==this.lastScrollLeft&&(this.syncedPanel.scrollLeft=e,this.lastScrollLeft=e)}if(this.syncOptions.syncY){var t=this.scrollPanel.scrollTop;t!==this.lastScrollTop&&(this.syncedPanel.scrollTop=t,this.lastScrollTop=t)}},e})();e.ScrollSyncHelper=n})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function t(t,r,i){this.selection=e.createTreeSelectionManager(t),this.scrollHelper=new e.VerticalScrollHelper(r,i),this.getVisibleNodes=t}return t.prototype.onNodeClick=function(e,t){if(t.ctrlKey)this.selection.toggle(e);else if(t.shiftKey&&this.selection.lastSelected){var r=this.selection.lastSelected;this.selection.clear(),this.selection.selectRange(this.getNodesRange(r,e))}else{var i=500;this.lastNodeClickTime&&t.timeStamp-this.lastNodeClickTime>i&&_.isEqual(this.selection.getSelectedItems(),[e])?this.selection.toggle(e):(this.selection.clear(),this.selection.select(e)),this.lastNodeClickTime=t.timeStamp}t.stopPropagation()},t.prototype.onBackgroundClick=function(e){this.selection.clear(),e.stopPropagation()},t.prototype.onKeyDown=function(e){var t=this,r=this.getVisibleNodes(),i=!1,n=this.selection.lastSelected,a=65;e.ctrlKey&&e.keyCode===a&&(this.selection.selectAll(),i=!0),e.keyCode===$.ui.keyCode.ESCAPE&&(this.selection.clear(),i=!0),e.keyCode===$.ui.keyCode.LEFT&&n&&(n.isExpanded?n.isExpanded=!1:n.parent&&this.selectAndScrollTo([n.parent]),i=!0),e.keyCode===$.ui.keyCode.RIGHT&&n?(n.children&&(n.isExpanded?n.children.length>0&&this.selectAndScrollTo([n.children[0]]):n.isExpanded=!0),i=!0):i=this.scrollHelper.handleKeyDown(r.indexOf(this.selection.lastSelected),e,(function(i){e.ctrlKey||e.shiftKey||t.selection.clear(),t.selection.select(r[i])})),i&&(e.stopPropagation(),e.preventDefault())},t.prototype.toggleExpandCollapse=function(e,t){e.isExpanded=!e.isExpanded,t&&t.stopPropagation()},t.prototype.selectAndScrollTo=function(e){var t=this;this.selection.clear(),this.selection.selectRange(e),requestAnimationFrame((function(){var r=t.getVisibleNodes(),i=r.indexOf(e[0]),n=30;t.scrollHelper.scrollItemIntoView(i,n)}))},t.prototype.getNodesRange=function(e,t){var r,i=this.getVisibleNodes(),n=i.indexOf(e),a=i.indexOf(t),o=Math.min(n,a),s=Math.max(n,a);if(o>-1){r=[];for(var l=o;l<=s;l++)r.push(i[l])}return r},t})();e.TreeHelper=t})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createTreeSelectionManager=t;var r=(function(){function e(e){this.selectedItems=[],this.getItems=e}return Object.defineProperty(e.prototype,"lastSelected",{get:function(){return _.last(this.selectedItems)},enumerable:!0,configurable:!0}),e.prototype.getSelectedItems=function(){return this.selectedItems.slice()},e.prototype.select=function(e){e.isSelected||(e.isSelected=!0,this.selectedItems.push(e))},e.prototype.selectRange=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.select(i)}},e.prototype.selectAll=function(){this.selectRange(this.getItems())},e.prototype.toggle=function(e){e.isSelected?(e.isSelected=!1,this.selectedItems.splice(this.selectedItems.indexOf(e),1)):(e.isSelected=!0,this.selectedItems.push(e))},e.prototype.clear=function(){for(var e=0,t=this.selectedItems;e<t.length;e++){var r=t[e];r.isSelected=!1}this.selectedItems.splice(0)},e})()})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(){return{automaticallyImport:!1,sandboxProperties:[i.AllowSameOrigin,i.AllowForms,i.AllowPopups,i.AllowScripts]}}var i=e.visualHost.SandboxProperty;t.createVisioVisualRegisterOptions=r})(r=t.VisioVisualHelper||(t.VisioVisualHelper={}))})(r=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(r,i,n,a,o,s,l){var u=t.FilterUtils.deriveFromSQFilters(i.from(),i.where(),n),c=[],p=i.where(c,new e.data.SQFrom),d={expr:[],visualType:o.plugin.name,schema:s,query:new t.contracts.VisualQuery(p,o.build(a))},f={name:r,config:l.create(d),filters:u,layouts:jsCommon.ArrayExtensions.extendWithId([{id:0,position:null}])};return f}r.create=i})(r=t.VisualContainerFactory||(t.VisualContainerFactory={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i,n=jsCommon.CssConstants,a=e.data.services.DataViewObjectSerializer,o=jsCommon.PixelConverter,s=e.data.SQExpr,l=e.data.SQExprUtils,u=jsCommon.StringExtensions;!(function(r){function i(e){if(e&&e.config&&e.config.singleVisual)return e.config.singleVisual.visualType}function c(e){return e.config&&e.config.singleVisual?e.config.singleVisual.query:null}function p(e){var t=e.config;if(t){var r=t.singleVisual;if(r&&r.query){var i=r.query;return i.defn.select()}}}function d(e,t){var i=r.getVisualType(e);if(i&&t){var n=t.getPlugin(i);if(n)return n.capabilities}}function f(e,t){var r=d(e,t);if(r&&!_.isEmpty(r.dataRoles))return r.dataRoles}function h(e){if(e){var t=e.capabilities;if(t&&!_.isEmpty(t.dataRoles))return t.dataRoles}}function v(e,r,i){var n=d(e,r);if(n){var a=c(e);if(a){var o=t.services.createVisualCapabilitiesHelper(n,i);return o.getNumberRangesForRoles(a)}}}function m(e,t){var i=r.getVisualType(e);return t&&t.isScriptVisual(i)}function g(e){return e.config&&e.config.singleVisual&&e.config.singleVisual.objects}function y(t,r,i,n,a){if(i){var o=i.defn.select(),u=i.projections,c=[],p=[],d=k(i),f=e.DataViewAnalysis.chooseDataViewMappings(i.projections,n.dataViewMappings,d),h=f.supportedMappings;if(h){for(var v=0,m=h;v<m.length;v++){var g=m[v],y=h.length>1?b(g):null,C=[];for(var E in u)if(null==y||_.contains(y,E))for(var w=u[E],F=0,P=w.all();F<P.length;F++){var D=P[F],V=H.indexWithName(o,D.queryRef),R=o[V];if(!s.isTransformOutputRoleRef(R.expr)){var T=R.expr.getMetadata(r),I={Restatement:t.getDisplayName(R.expr,r,n),Name:D.queryRef,Type:S(T.type)},N=l.getKpiMetadata(R.expr,r);N&&(I.kpi=N);var M=D.format||T.format;M&&(I.Format=M);var j=x(T.type);j&&(I.DataCategory=j),c[V]=I,C.push({Name:E,Projection:V,isActive:_.contains(w.activeProjectionRefs,D.queryRef)})}}p.push({DataRoles:C})}return{queryMetadata:{Select:c,Filters:a},visualElements:p}}}}function C(e,t){var r=e;if(r.role)return void t.push(r.role);var i=e;if(i.bind)return void(i.bind.to&&t.push(i.bind.to));var n=e;if(n.for)return void(n.for.in&&t.push(n.for.in));var a=e;if(a.group){if(a.group.by&&t.push(a.group.by),a.group.select)for(var o=0,s=a.group.select;o<s.length;o++){var l=s[o];C(l,t)}}else{var u=e;if(u.composite)for(var c=0,p=u.composite;c<p.length;c++){var d=p[c];C(d,t)}else{var f=e;if(f.select)for(var h=0,v=f.select;h<v.length;h++){var l=v[h];C(l,t)}}}}function b(e){var t=[];return e&&(e.categorical&&(e.categorical.categories&&C(e.categorical.categories,t),e.categorical.values&&C(e.categorical.values,t)),e.table&&e.table.rows&&C(e.table.rows,t),e.single&&C(e.single,t),e.tree&&(e.tree.nodes&&C(e.tree.nodes,t),e.tree.values&&C(e.tree.values,t)),e.matrix&&(e.matrix.columns&&C(e.matrix.columns,t),e.matrix.rows&&C(e.matrix.rows,t),e.matrix.values&&C(e.matrix.values,t))),t=_.unique(t)}function S(e){switch(e.extendedType){case 66048:return 67;case 131584:return 35}switch(e.primitiveType){case 1:return 2048;case 2:case 3:return 1;case 4:return 3;case 5:return 4096;case 6:return 20;case 7:return 4;case 9:return 8}}function x(e){return W[e.categoryString]}function E(e,t){if(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query&&e.config.singleVisual.query.defn){var r=e.config.singleVisual.query.projections,i=e.config.singleVisual.query.defn.select();if(r&&i.length>0)for(var n in r)for(var a=r[n],o=0,s=a.all();o<s.length;o++){var l=s[o],u=jsCommon.ArrayExtensions.findItemWithName(i,l.queryRef);if(u){var c=u.expr,p=c.getMetadata(t);if(p&&0===p.kind&&null==p.aggregate)return!0}}return!1}}function w(e){return function(t){return e===t}}function F(e){return function(t){return e!==t}}function P(e,t,r,i){return function(n){if(e===n)return!0;var a=r&&r.relationshipFilterAction(t,e,n,i);return 3!==a}}function D(t,r){t.publishToChannel(e.explore.services.events.dataSelectionChanged,{affectContainer:function(e){return e===r}})}function V(t,i,n,o,s,l,u,c){if(l){var p,d=t.capabilities(l.visualType);if(d){var f=r.describeForPinning(i,s,l.query,d,u);if(f){var h=a.serializeObjects(l.objects,d.objects);p=o.transforms&&d&&d.objects?e.data.services.DataViewTransformActionsSerializer.serializeDataViewTransformActions(o.transforms,d.objects):{objects:h},p.objects=p.objects||h,p.visualElements=f.visualElements,p.queryMetadata=f.queryMetadata}}return{queryObject:o.options.query.command,dataObject:n,transformsObject:p,dataUpdatedTime:c}}}function R(e){for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n.name]=!0}return T(t,e.length)}function T(e,t){return u.findUniqueName(e,"VisualContainer",t+1)}function I(t,r){t.publishToChannel(e.explore.services.events.visualContainerChanged,{affectContainer:function(e){return e!==r}})}function N(t){return _.some(t,(function(t){return t.dsr&&t.dsr.vsName===e.common.constants.onPremiseVSName}))}function M(e){return e&&null!=e.fontSize?o.fromPoint(e.fontSize):o.toString(r.DefaultTitleFontSizeInPixel)}function j(t){var r=M(t),i={fontFamily:K,fontSize:r};return e.TextMeasurementService.estimateSvgTextHeight(i)}function A(e,t,r,i){var a={},o=null!=t;return a[n.transformProperty]=o?"scale("+t+")":"",a[n.widthProperty]=o?e.width:"",a[n.heightProperty]=o?e.height:"",a[n.borderProperty]=i||"",a[n.backgroundColorProperty]=r||"",a}function O(t){if(t&&t.show){var r=e.visuals.visualBackgroundHelper.getDefaultValues();return(t.transparency||0===t.transparency)&&(r.transparency=t.transparency),t.color&&(r.color=t.color),e.common.utils.ColorUtility.hexToRGBString(r.color,(100-r.transparency)/100)}}function q(e){return null!=e&&null!=e.metadata&&null!=e.metadata.segment}function z(e){if(e&&e.defn){var t=e.defn.groupBy();return!_.isEmpty(t)}return!1}function U(e){var t=r.getVisualQuery(e);return z(t)}function L(e,t,i){var n=r.getDataRolesForVisual(e,t),a=c(e);if(a&&!_.isEmpty(n)){var o=n[0].name,s=a.tryGetExprs(o);return!_.isEmpty(s)&&_.any(s,(function(e){var t=e.getMetadata(i);if(t)return t.type.text}))}}function B(e,t,r){var i=Q(e,r);if(_.isEmpty(i))return!1;for(var n=0,a=i;n<a.length;n++){var o=a[n],s=1===l.getAggregateBehavior(o,t);if(s)return!0}return!1}function k(t){for(var r={},i=t.defn.select(),n=0,a=i;n<a.length;n++){
var o=a[n],s=void 0;s=l.isMeasure(o.expr)?e.VisualDataRoleKind.Measure:e.VisualDataRoleKind.Grouping,r[o.name]=s}return r}function G(e){for(var t=0,r=e.sections;t<r.length;t++)for(var i=r[t],n=0,a=i.visualContainers;n<a.length;n++){var o=a[n];delete o.cachedData}}function Q(t,r){var i=c(t);if(i){var n=d(t,r);if(n&&n.filterMappings&&n.filterMappings.measureFilter&&n.filterMappings.measureFilter.targetRoles){for(var a=n.filterMappings.measureFilter.targetRoles,o=_.chain(n.dataRoles).filter((function(t){return t.kind===e.VisualDataRoleKind.Grouping})).map((function(e){return e.name})).difference(a).value(),s=[],l=0,u=o;l<u.length;l++){var f=u[l];i.projections[f]&&s.push.apply(s,i.projections[f].all())}var h=p(t);return _.isEmpty(s)?void 0:_.chain(h).filter((function(e){return _.some(s,(function(t){return t.queryRef===e.name}))})).map((function(e){return e.expr})).value()}}}var H=jsCommon.ArrayExtensions,W=e.data.ConceptualDataCategory;r.DefaultTitleFontSizeInPixel=12;var K="wf_segoe-ui_normal";r.getVisualType=i,r.getVisualQuery=c,r.getSelectExprs=p,r.getVisualCapabilities=d,r.getDataRolesForVisual=f,r.getDataRolesForVisualPlugin=h,r.getNumberRangesForRoles=v,r.isScriptVisual=m,r.getObjectDefinitions=g,r.describeForPinning=y,r.getRolesForDataViewMapping=b,r.toSemanticType=S,r.toConceptualDataCategory=x,r.hasGrouping=E,r.contractEqualityComparator=w,r.contractUnEqualityComparator=F,r.filterAffects=P,r.clearDataSelection=D,r.createCacheEntry=V,r.uniqueName=R,r.nextUniqueName=T,r.notifyVisualContainersExceptSource=I,r.hasOnPremDataSource=N,r.getTitleFontSize=M,r.getTitleHeight=j,r.getVisualStyleAttributes=A,r.getVisualBackgroundRGBColor=O,r.isSegment=q,r.hasGroupByItems=z,r.hasGroupByItemsInQuery=U,r.containSearchableField=L,r.hasFilterMappingWithNonAggregatableColumns=B,r.createRoleKindByQueryRef=k,r.clearVisualContainerQueryCaches=G})(i=r.VisualContainerUtils||(r.VisualContainerUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i,n=e.data.SQExpr,a=e.data.SQExprConverter,o=jsCommon.StringExtensions,s=e.explore.util.VisualContainerUtils;!(function(r){function i(e,r,i){if(!r||!r.column||!r.column.groupingMetadata)return t.services.GroupMode.None;if(i){var n=i.getGroupingDesignState(e,r.name);if(!n)return t.services.GroupMode.Basic;if(n.partitionTable)return t.services.GroupMode.Clustering;if(n.binItem)return t.services.GroupMode.Binning}return t.services.GroupMode.Basic}function l(e,r,n){var a=i(e,r,n);return a===t.services.GroupMode.Basic||a===t.services.GroupMode.Binning}function u(e,r,n){var a=i(e,r,n);return a===t.services.GroupMode.Clustering}function c(e,t,r){if(!t||!t.column||!t.column.groupingMetadata)return!1;var i=r.getGroupingDesignState(e,t.name);return!(!i||!i.groupItems&&!i.partitionTable)}function p(e,t){if(t&&d(e,t)&&(n.isColumn(t)||n.isGroupRef(t))){var r=t.getConceptualProperty(e);return f(r)}return!1}function d(e,t){return x(e,t).capabilities.canEdit}function f(e){return e&&!!(e.type.dateTime||e.type.integer||e.type.numeric||e.type.text)}function h(e,t){return o.constructNameFromList(e,t.get("GroupDefinition_And"),M)}function v(e){if(e&&e.column&&e.column.keys){var t=e.column.keys;return 1===t.length&&t[0].name!==e.name||t.length>1}return!1}function m(e,t){var r=t&&t.defn.select();if(r&&r.length>0&&e)for(var i=0,n=e;i<n.length;i++){var a=n[i];if(!a||!a.dataMap)return;var o=Object.keys(a.dataMap),s=_.size(o);if(2===s){var l=r.withName(o[0]),u=r.withName(o[1]);if(l&&u)return I(l.expr,u.expr)}}}function g(e,t){_.any(e,(function(e){return e.blankDefaultPlaceholder}))||e.splice(0,0,{name:t.get("NullValue"),blankDefaultPlaceholder:!0})}function y(e){return _.filter(e,(function(e){return!e.blankDefaultPlaceholder}))}function C(t,r,i){var n=[],a=s.getVisualCapabilities(t,r);if(a&&a.grouping)for(var o=s.getVisualQuery(t),l=o.projections,u=s.createRoleKindByQueryRef(o),c=_.filter(a.grouping.groupingRules,(function(e){return e.kind===i})),p=0,d=c;p<d.length;p++){var f=d[p],h=e.DataViewAnalysis.checkForConditionErrors(l,f.condition,u,!1);_.isEmpty(h)&&n.push(f)}return n}function b(t,r,i){var n=a.asFieldPattern(t);if(n.groupingColumn)return _.map(n.groupingColumn.groupedColumns,(function(t){return e.data.SQExprBuilder.fieldExpr(t)}));if(n.column){var o=r.schema(n.column.schema),s=o.findProperty(n.column.entity,n.column.name);if(c(n.column.entity,s,i)){var l=t.getTargetEntity();return S(s.column.groupingMetadata,l)}}}function S(t,r){return _.map(t.groupedColumns,(function(t){if(R(t))return e.data.SQExprBuilder.columnRef(r,t.name)}))}function x(t,r){var i=e.data.FieldExprPattern.getSchema(a.asFieldPattern(r));return t.schema(i)}function E(e,t){var r=t&&t.defn.select();if(!_.isEmpty(r)&&!_.isEmpty(e)){for(var i=0,a=e;i<a.length;i++){var o=a[i];if(!o||!o.dataMap)return!1;var s=Object.keys(o.dataMap),l=_.size(o.dataMap);if(l>2)return!1;if(2===l){var u=r.withName(s[0]),c=r.withName(s[1]);if(u&&c&&!T(u.expr,c.expr))return!1}else if(1===l){var p=r.withName(s[0]);if(p&&!n.isColumn(p.expr)&&!n.isGroupRef(p.expr))return!1}}return!0}return!1}function w(e){return e.dateTime?t.services.GroupDataType.DateTime:e.numeric?t.services.GroupDataType.Number:t.services.GroupDataType.Category}function F(e){switch(e){case 4:return 3;case 6:return 2;case 8:return 0;case 9:return 7;case 10:return 6;case 11:return 5}}function P(e){switch(e){case 3:return 4;case 2:return 6;case 0:return 8;case 7:return 9;case 6:return 10;case 5:return 11}}function D(e){if(!e.get()){var r={dbName:"dbName",id:1,vsName:"vsName"},i=void 0,n=[{type:"dsr",id:r.id,name:i,dsr:{schemaName:i,vsName:r.vsName,dbName:r.dbName}}],a=t.contracts.createDataSourceArray(n);e.set(a)}}function V(t,r){var i=r.getDetails(e.common.localize);t.error(i.message,"GroupDialog",{debugErrorInfo:i.debugErrorInfo,displayableErrorInfo:i.displayableErrorInfo,helpLink:i.helpLink})}function R(e){return 0===e.kind}function T(e,t){return!!I(e,t)}function I(e,t){if(n.isGroupRef(e)&&n.isColumn(t)&&N(e,t))return e;if(n.isGroupRef(t)&&n.isColumn(e)&&N(t,e))return t;if(n.isGroupRef(e)&&n.isGroupRef(t)){if(N(e,t))return e;if(N(t,e))return t}}function N(t,r){return e.data.SQExprUtils.sequenceEqual(t.groupedExprs,[r])}var M=50;r.getGroupMode=i,r.isGroupOrBinColumn=l,r.isClusteringColumn=u,r.isGroupOrClusteringColumn=c,r.canExprBeGrouped=p,r.canEditSchema=d,r.canPropertyBeGrouped=f,r.generateGroupDisplayName=h,r.hasGroupOnKeys=v,r.findGroupingColumn=m,r.ensureBlankDefaultPlaceholder=g,r.filterOutBlankDefaultPlaceholder=y,r.getValidGroupingRules=C,r.getGroupedColumns=b,r.getGroupedColumnsFromMetadata=S,r.getConceptualSchema=x,r.canGroup=E,r.getGroupDataType=w,r.convertToTimeUnit=F,r.convertToBinUnit=P,r.ensureDataSources=D,r.showQueryError=V})(i=r.GroupUtils||(r.GroupUtils={}))})(r=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{getFormatInfo:function(){return r}}}e.createCultureService=t;var r={lcid:1033,displayName:"English (United States)",currencyDecimalDigits:2,numberDecimalDigits:2,percentDecimalDigits:2,percentSymbol:"%",percentPositivePattern:0,percentNegativePattern:0,currencySymbol:"$",currencyPositivePattern:0,currencyNegativePattern:0,shortDatePattern:"M/d/yyyy",longDatePattern:"dddd, MMMM d, yyyy",fullDateTimePattern:"dddd, MMMM d, yyyy h:mm:ss tt",monthDayPattern:"MMMM d",rfc1123Pattern:"ddd, dd MMM yyyy HH':'mm':'ss 'GMT'",sortableDateTimePattern:"yyyy'-'MM'-'dd'T'HH':'mm':'ss",shortTimePattern:"h:mm tt",longTimePattern:"h:mm:ss tt",universalSortableDateTimePattern:"yyyy'-'MM'-'dd HH':'mm':'ss'Z'",yearMonthPattern:"MMMM yyyy"}})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createDataSourcesService=t;var r=(function(){function e(){}return e.prototype.set=function(e){this.dataSources=e},e.prototype.get=function(){return this.dataSources},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createDaxParserService=t;var r=(function(){function e(){}return e.prototype.getMeasureReferences=function(e,t){return _.isArray(t)?_.map(t,(function(e){return{measures:[],unrecognizedReferences:!1}})):[]},e.prototype.renameMeasureReferences=function(e,t,r,i){return _.map(t,(function(e){return e.expression}))},e.prototype.renameMovedMeasureTableReference=function(e,t,r,i,n){return _.map(t,(function(e){return e.expression}))},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){return new d(e,t)}function n(e,t,r,i){if(!r||!r.includeDefaultAggregate)return i.defaultAggregate(e,t,!1)===e.func}function a(e,t,r,i){var n=o(t,r),a=i.aggregateDisplayNames[n];return l.format(a,[e])}function o(t,r){var i=e.data.aggregateFunctionName(t);return(3===t||4===t)&&r&&r.type&&(r.type.dateTime?i="Date"+i:r.type.text&&(i="String"+i)),i}var s=e.data.FieldExprPattern,l=e.formattingService,u=e.data.SQExpr,c=e.data.SQExprBuilder,p=jsCommon.StringExtensions;r.createDisplayNameService=i;var d=(function(){function r(e,t){this.locOptions=e,this.aggrOps=t}return r.prototype.getDisplayName=function(t,r,i,n){if(e.data.SQExprConverter.asFieldPattern(t))return s.visit(t,new f(r,this.locOptions,this.aggrOps,i,n))},r.prototype.getQualifiedDisplayName=function(t,r,i,n){if(e.data.SQExprConverter.asFieldPattern(t))return h.run(t,r,this.locOptions,this.aggrOps,i,n)},r.prototype.getVisualTitle=function(r,i,n){var a=r.title;if(a){if(t.contracts.VisualTitle.isHidden(a))return a;if(null==a.show&&(a.show=!(!n||n.suppressDefaultTitle)),void 0!==a.text)return a}var o=[],s=[],l=[];if(r&&r.query){var u=r.query,c=u.projections;if(c&&n&&!n.suppressDefaultTitle&&n.dataRoles)for(var d=u.defn.select(),f=0,h=n.dataRoles;f<h.length;f++){var v=h[f],m=this.getDisplayNamesByDataRole(c[v.name],d,i,n);if(m)switch(v.kind){case e.VisualDataRoleKind.Grouping:s=s.concat(m);break;case e.VisualDataRoleKind.Measure:o=o.concat(m);break;case e.VisualDataRoleKind.GroupingOrMeasure:l=l.concat(m)}}}var g=e.Prototype.inherit(a||{show:!n.suppressDefaultTitle});g.titleComponents={};var y;return o.length>0?(g.titleComponents.title=this.concatStringsWithAnd(o),s.length>0&&(y=this.concatStringsWithAnd(s),g.titleComponents.subtitle=p.format(this.locOptions.stringResourceProvider.get("VisualTitle_By_Template"),"",y).trim())):l.length>0?g.titleComponents.title=this.concatStringsWithAnd(o):s.length>0&&(g.titleComponents.title=this.concatStringsWithAnd(s)),y?g.text=p.format(this.locOptions.stringResourceProvider.get("VisualTitle_By_Template"),g.titleComponents.title,y):g.text=g.titleComponents.title,g},r.prototype.getDisplayNamesByDataRole=function(e,t,r,i){var n=[];if(e)if(_.isEmpty(e.activeProjectionRefs))for(var a=0,o=e.all();a<o.length;a++){var s=o[a],l=t.withName(s.queryRef),u=this.getDisplayName(l.expr,r,i);n.push(u)}else for(var c=0,p=e.activeProjectionRefs;c<p.length;c++){var d=p[c],l=t.withName(d);l&&l.expr&&n.push(this.getDisplayName(l.expr,r,i))}return n},r.prototype.concatStringsWithAnd=function(e){if(!_.isEmpty(e)){if(1===e.length)return e[0];var t=e.pop();return p.format(this.locOptions.stringResourceProvider.get("VisualTitle_And_Template"),e.length>1?e.join(this.locOptions.stringResourceProvider.get("ListJoin_Separator")):e[0],t)}return null},r})(),f=(function(){function t(e,t,r,i,n){this.schema=e,this.locOptions=t,this.aggrOps=r,this.visualCapabilities=i,this.displayOptions=n}return t.prototype.visitColumn=function(e){return t.getDisplayNameForProperty(e,this.schema)},t.prototype.visitColumnAggr=function(e){return t.getDisplayNameForSQAggregate(e,c.fromColumnAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions)},t.prototype.visitGroupingColumn=function(e){return t.getDisplayNameForProperty(e,this.schema)},t.prototype.visitGroupingColumnAggr=function(e){return t.getDisplayNameForSQAggregate(e,c.fromGroupingColumnAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions)},t.prototype.visitColumnHierarchyLevelVariation=function(e){return t.getVariationLevelName(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider)},t.prototype.visitEntity=function(e){return t.getDisplayNameForEntity(e,this.schema)},t.prototype.visitEntityAggr=function(e){return t.getDisplayNameForSQAggregate(e,c.fromEntityAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions)},t.prototype.visitHierarchy=function(e){return t.getDisplayNameForHierarchy(e,this.schema)},t.prototype.visitHierarchyLevel=function(e){return t.getDisplayNameForHierarchyLevel(e,this.schema,this.displayOptions)},t.prototype.visitHierarchyLevelAggr=function(e){return t.getDisplayNameForSQAggregate(e,c.fromHierarchyLevelAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions)},t.prototype.visitMeasure=function(e){return t.getDisplayNameForProperty(e,this.schema)},t.prototype.visitSelectRef=function(e){},t.prototype.visitPercentile=function(e){var t=this.locOptions.showValueAsDisplayNames;return l.format(e.exclusive?t.PercentileExclusive:t.PercentileInclusive,[s.visit(e.arg,this),e.k])},t.prototype.visitPercentOfGrandTotal=function(e){return l.format(this.locOptions.showValueAsDisplayNames.PercentOfGrandTotal,[s.visit(e.baseExpr,this)])},t.prototype.visitPercentOfRoleTotal=function(t){var r=this.visualCapabilities.dataRoleTotals,i=_.find(r,(function(e){return _.isEqual(t.roles,e.roles)})),n=e.data.getDisplayName(i.shortDisplayName,this.locOptions.stringResourceProvider);return l.format(n,[s.visit(t.baseExpr,this)])},t.prototype.visitTransformOutputRoleRef=function(e){return e.expressionName},t.getDisplayNameForEntity=function(e,t){var r=t.schema(e.schema).entities.withName(e.entity);if(r)return r.displayName},t.getDisplayNameForProperty=function(e,t){var r=t.schema(e.schema),i=r.findProperty(e.entity,e.name);if(i)return i.displayName},t.getDisplayNameForHierarchyLevel=function(e,t,r){var i=t.schema(e.schema),n=i.findHierarchy(e.entity,e.name);if(n){var a=n.levels.withName(e.level);if(a)return a.displayName||a.column.displayName}},t.getDisplayNameForHierarchy=function(e,t){var r=t.schema(e.schema),i=r.findHierarchy(e.entity,e.name);if(i)return i.displayName},t.getVariationLevelName=function(e,t,r,i){var n=t.schema(e.source.schema).findProperty(e.source.entity,e.source.name);if(n)for(var a=n.column.variations,o=0,s=a;o<s.length;o++){var l=s[o];if(l.name===e.variationName)for(var u=0,c=l.defaultHierarchy.levels;u<c.length;u++){var d=c[u];if(d.name===e.level.level){var f=d.column.displayName;return r&&r.includeVariationSource&&i?p.format(i.get("IncludeVariationSourceDisplayName"),n.displayName,f):f}}}},t.getDisplayNameForSQAggregate=function(e,r,i,o,l,u,c){var p=i.schema(e.schema).entities.withName(e.entity);if(p){var d=s.visit(r.arg,new t(i,o,u,l,c));return d?n(r,i,c,u)?d:a(d,r.func,r.arg.getMetadata(i),o):a(p.displayName,r.func,r.arg.getMetadata(i),o)}},t})(),h=(function(){function t(e,t,r,i,n){this.schema=e,this.locOptions=t,this.aggrOps=r,this.visualCapabilities=i,this.displayOptions=n}return t.run=function(e,r,i,n,a,o){var s=new t(r,i,n,a,o);return s.accept(e)},t.prototype.accept=function(e){var t=e;if(u.isAggregation(t)){var r=s.visit(t.arg,this);return n(t,this.schema,this.displayOptions,this.aggrOps)?r:a(r,t.func,t.arg.getMetadata(this.schema),this.locOptions)}return s.visit(e,this)},t.prototype.visitEntity=function(e){var t=f.getDisplayNameForEntity(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitColumn=function(e){var t=f.getDisplayNameForProperty(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitColumnAggr=function(e){},t.prototype.visitGroupingColumn=function(e){var t=f.getDisplayNameForProperty(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitGroupingColumnAggr=function(e){},t.prototype.visitColumnHierarchyLevelVariation=function(e){var t=f.getVariationLevelName(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider);return this.formatWithEntity(t,e.source)},t.prototype.visitEntityAggr=function(e){var t=f.getDisplayNameForSQAggregate(e,c.fromEntityAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions);return this.formatWithEntity(t,e)},t.prototype.visitHierarchy=function(e){var t=f.getDisplayNameForHierarchy(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitHierarchyLevel=function(e){var t=f.getDisplayNameForHierarchyLevel(e,this.schema,this.displayOptions);return this.formatWithEntity(t,e)},t.prototype.visitHierarchyLevelAggr=function(e){},t.prototype.visitMeasure=function(e){var t=this.locOptions.qualifiedDisplayNameTemplate,r=f.getDisplayNameForProperty(e,this.schema),i=f.getDisplayNameForEntity(e,this.schema);return i?p.format(t,i,r):r},t.prototype.visitSelectRef=function(e){},t.prototype.visitPercentile=function(e){var t=this.locOptions.showValueAsDisplayNames;return l.format(e.exclusive?t.PercentileExclusive:t.PercentileInclusive,[this.accept(c.fieldExpr(e.arg)),e.k])},t.prototype.visitPercentOfGrandTotal=function(e){return l.format(this.locOptions.showValueAsDisplayNames.PercentOfGrandTotalTooltip,[this.accept(c.fieldExpr(e.baseExpr))])},t.prototype.visitPercentOfRoleTotal=function(t){var r=this.visualCapabilities.dataRoleTotals,i=_.find(r,(function(e){return _.isEqual(t.roles,e.roles)})),n=e.data.getDisplayName(i.tooltip,this.locOptions.stringResourceProvider);return l.format(n,[this.accept(c.fieldExpr(t.baseExpr))])},t.prototype.visitTransformOutputRoleRef=function(e){return e.expressionName},t.prototype.formatWithEntity=function(e,t){var r=this.locOptions.qualifiedDisplayNameTemplate,i=f.getDisplayNameForEntity(t,this.schema);return i?p.format(r,i,e):e},t})();r.getAggregateKey=o})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.common.EventChannelType;!(function(e){e[e.Unknown=0]="Unknown",e[e.Swipe=1]="Swipe"})(r=t.SectionNavigationAction||(t.SectionNavigationAction={}));var n;!(function(e){e.explorationLoaded={type:i.Section,name:"explorationLoaded"},e.explorationUnloaded={type:i.Section,name:"explorationUnloaded"},e.filterContainerChanged={type:i.Visual,name:"filterContainerChanged"},e.formFactorChanged={type:i.Section,name:"formFactorChanged"},e.modelChanged={type:i.Data,name:"modelChanged"},e.enableEditing={type:i.Section,name:"enableEditing"},e.visualRelationshipsModeChanged={type:i.Visual,name:"visualRelationshipsModeChanged"},e.schemaItemActivationChanged={type:i.Data,name:"schemaItemActivationChanged"},e.selectionChanged={type:i.Visual,name:"selectionChanged"},e.dataPointsSelected={type:i.Visual,name:"dataPointsSelected"},e.undoRedoStackUpdated={type:i.Section,name:"undoRedoStackUpdated"},e.undoRedoStackCleared={type:i.Section,name:"undoRedoStackCleared"},e.clipboardDataUpdated={type:i.Section,name:"clipboardDataUpdated"},e.dataSelectionChanged={type:i.Visual,name:"dataSelectionChanged"},e.drillModeChanged={type:i.Visual,name:"drillModeChanged"},e.refreshExploration={type:i.Visual,name:"refreshExploration"},e.clearAnnotations={type:i.Visual,name:"clearAnnotations"},e.saveReportCompleted={type:i.Data,name:"saveReportCompleted"},e.customSaveAsTriggered={type:i.Data,name:"customSaveAsTriggered"},e.sectionLayoutRemoved={type:i.Section,name:"sectionLayoutRemoved"},e.canvasChanged={type:i.Section,name:"canvasChanged"},e.visualContainerChanged={type:i.Visual,name:"visualContainerChanged"},e.visualContainerDataRendered={type:i.Visual,name:"visualContainerDataRendered"},e.visualContainerPositionChanged={type:i.Visual,name:"visualContainerPositionChanged"},e.visualConversion={type:i.Visual,name:"visualConversion"},e.canvasSizeChangedEvent={type:i.Visual,name:"canvasSizeChanged"},e.visualPluginsChanged={type:i.Visual,name:"visualPluginsChanged"},e.addCustomVisual={type:i.Visual,name:"addCustomVisual"},e.deleteCustomVisual={type:i.Visual,name:"deleteCustomVisual"},e.modelingContextChanged={type:i.Data,name:"modelingContextChanged"},e.changeViewMode={type:i.Visual,name:"changeViewMode"},e.requestViewModeChange={type:i.Visual,name:"requestViewModeChange"},e.changeEditMode={type:i.Visual,name:"changeEditMode"},e.saveKeyPressedEvent={type:i.Section,name:"saveEventViaCtrlS"},e.canvasDisplayChanged={type:i.Section,name:"canvasDisplayChanged"},e.canvasDimensionChanged={type:i.Section,name:"canvasDimensionChanged"},e.canvasBackgroundChanged={type:i.Section,name:"canvasBackgroundChanged"},e.popOutModeChanged={type:i.Visual,name:"popOutModeChanged"},e.align={type:i.Section,name:"align"},e.deleteSectionInitiated={type:i.Section,name:"deleteSectionInitiated"},e.sectionNameChanged={type:i.Section,name:"sectionNameChanged"},e.renameSection={type:i.Section,name:"renameSection"},e.sectionChanged={type:i.Section,name:"sectionChanged"},e.podParameterChanged={type:i.Section,name:"podParameterChanged"},e.missingTableRelationship={type:i.Visual,name:"missingTableRelationship"},e.addVisualContainer={type:i.Section,name:"addVisualContainer"},e.changeFormFactor={name:"changeFormFactor",type:i.Section},e.arrangeVisualsOrder={type:i.Section,name:"arrangeVisualsOrder"},e.createImage={type:i.Section,name:"createImage"},e.createBasicShape={type:i.Section,name:"createBasicShape"},e.createTextbox={type:i.Section,name:"createTextbox"},e.importVisual={type:i.Section,name:"importVisual"},e.visualContainerQueryBlocked={type:i.Visual,name:"visualContainerQueryBlocked"},e.newQueryCacheResultAvailable={type:i.Visual,name:"newQueryCacheResultAvailable"},e.exportVisualData={type:i.Visual,name:"exportVisualData"},e.reportSlidesChanged={type:i.Section,name:"reportSlidesChanged"},e.createSection={type:i.Section,name:"createSection"},e.deleteSection={type:i.Section,name:"deleteSection"},e.duplicateSection={type:i.Section,name:"duplicateSection"},e.copyTable={type:i.Section,name:"copyDataTable"},e.showEnableScriptVisualsDialog={type:i.Visual,name:"showEnableScriptVisualsDialog"},e.deleteVisualContainer={name:"deleteVisualContainer"},e.removeVisualContainerFromLayout={name:"removeVisualContainerFromLayout"},e.toggleSortVisualContainer={name:"toggleSortVisualContainer"},e.filterValueChanged={name:"filterValueChanged"},e.reorderSection={name:"reorderSection"},e.saveAsExploration={name:"saveAsExploration"},e.generateReportQR={name:"generateReportQR"},e.saveExploration={name:"saveExploration"},e.switchSection={name:"switchSection"},e.pauseQueriesChanged={name:"pauseQueriesChanged"},e.redo={name:"redo"},e.undo={name:"undo"},e.showErrorNotification={name:"showErrorNotification"},e.deleteVisual={name:"deleteVisual"},e.deleteCustomVisuals={name:"deleteCustomVisuals"},e.exportToPowerPoint={name:"exportToPowerPoint"},e.exportAsImage={name:"exportAsImage"},e.getClusters={name:"getClusters"}})(n=t.events||(t.events={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,r,i,n,a,o,s,l,u,c){var p=t.services.createVisualAuthoringCore(e,o,a,s);return new g(p,e,r,i,n,l,u,c)}var n=e.data.CsvWriter,a=e.data.DataShapeBindingDataReduction,o=t.contracts.DataSource,s=e.data.DataViewTransform,l=e.data.dsr,u=t.QueryProjectionBuilderCoreUtils.QueryProjectionBuilder,c=e.data.services.SemanticQuerySerializer,p=jsCommon.StringExtensions,d=e.data.SQExpr,f=e.data.SQExprRewriter,h=e.data.SQScopedEvalExpr;r.createExportVisualDataService=i;var v=1e6,m="data",g=(function(){function r(e,t,r,i,n,a,o,s){this.visualPluginService=t,this.visualAuthoring=e,this.visualQueryGenerator=r,this.dataProxy=i,this.conceptualSchemaProxy=n,this.promiseFactory=a,this.displayNameService=o,this.localizationService=s}return r.prototype.exportToCsv=function(e,t,r,i,n,a){var o=this,s=this.promiseFactory.defer();if(null!=r&&null!=n){var l=this.exportDataViewSourceToCSV(t,n,!1,e);if(null!=l)return s.resolve(l),s.promise}return this.conceptualSchemaProxy.get(r).then((function(t){var n=o.getGeneratedQuery(t,i,r,a);if(!n||!n.result||n.result.error)return void s.resolve({blob:null,error:0});var l=n.result;o.overrideDataQueryLimit(l.options.query.command);var u=l.transforms,c=function(t){return o.exportDataViewSourceToCSV(t,u,!0,e)};o.queryData(l.options,c).then((function(e){s.resolve(e)}),(function(e){s.reject(e)}))}),(function(){s.reject({blob:null,error:3})})),s.promise},r.prototype.exportToExcel=function(t,i,n,a,s){var u=this,c=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(i).then((function(p){var d=u.getGeneratedQuery(p,n,i,a);if(d&&d.result&&!d.result.error){var f=d.result,h=f.options.query.command,v=u.generateExportDataCommand(p,h.Commands[0].SemanticQueryDataShapeCommand.Query,s,n,f.transforms,d.selectsWithDisplayName);h.Commands.push(v),u.overrideDataQueryLimit(h),u.clearDataQuerySubtotal(h);var m=e.common.httpService.powerbiRequestOptions();m.responseType="blob";var g=l.generateSemanticQueryRequest([h],o.referenced(i,n.query&&n.query.defn));e.common.httpService.post("/export/xlsx",g,m).then((function(e){if(0===e.data.size)return void c.reject({blob:null,error:1});var i={blob:e.data,isPartialResult:!1,format:1,fileName:r.getFileName(t,1)};c.resolve(i)}),(function(e){c.reject({blob:null,error:2})}))}else c.reject({blob:null,error:0})}),(function(){c.reject({blob:null,error:3})})),c.promise},r.prototype.getGeneratedQuery=function(r,i,n,a){var o=t.contracts.SingleVisualConfig.clone(i),s=this.getPercentRoleSelectIndexToDisplayNameMapping(o,r);this.rewritePercentRoleRefs(o,r,a);var l=this.mapSelectIndexWithExprs(o,s);this.clearConversionContextWithPercentRole(o);var u=this.visualPluginService.getPlugin(e.visuals.plugins.table.name);if(i.visualType!==u.name){var c=this.visualAuthoring.convert({schema:r,source:o,target:u.name});if(!c)return}for(var p=o.query,f=p.projections,h=function(e){var t=_.find(p.defn.select(),(function(t){return d.equals(t.expr,e.expr)})),r=m.getQueryProjectionForSelect(t,f);r&&(r.displayName=e.name)},m=this,g=0,y=l;g<y.length;g++){var C=y[g];h(C)}var b=this.visualPluginService.capabilities(e.visuals.plugins.table.name),S=_.cloneDeep(b.dataViewMappings);return S[0].table.rows.dataReductionAlgorithm={top:{count:v}},this.clearVisualConfigObjects(o),{result:this.visualQueryGenerator.execute({dataSources:n,config:o,schema:r,additionalFilters:a,dataViewMappingsOverride:S}),selectsWithDisplayName:l}},r.prototype.queryData=function(e,t){var r=this.promiseFactory.defer();return this.dataProxy.execute(e).then((function(e){var i=t(e.dataViewSource);null!=i?r.resolve(i):r.reject({blob:null,error:1})}),(function(){r.reject({blob:null,error:2})})),r.promise},r.prototype.exportDataViewSourceToCSV=function(t,i,a,o){var l=r.readDataViewSource(t);if(l){var u=l.dataView,c=u&&u.table;if(c&&c.columns.length===i.selects.length){var p=r.isPartialResult(l);if(!p||a){var d=this.visualPluginService.capabilities(e.visuals.plugins.table.name),f=s.apply({transforms:i,dataRoles:d.dataRoles,objectDescriptors:d.objects,prototype:u,colorAllocatorFactory:e.visuals.createColorAllocatorFactory(),dataViewMappings:d.dataViewMappings});if(!_.isEmpty(f))return{isPartialResult:p,blob:n.fromDataView(f[0]),format:0,fileName:r.getFileName(o,0)}}}}},r.readDataViewSource=function(e){var t;try{t=l.read(31,e.data,"csv")}catch(e){return}return t},r.isPartialResult=function(t){if(!t)return!1;var r=_.some(t.warnings,(function(t){return t instanceof e.data.dsr.DsrLimitsWarning}));return!!t.restartToken||r},r.getFileName=function(e,t){var r=m;if(!_.isEmpty(e)){var i=p.normalizeFileName(e);_.isEmpty(i)||(r=i)}switch(t){case 0:return r+".csv";case 1:return r+".xlsx"}},r.prototype.generateExportDataCommand=function(e,t,r,i,n,a){var o=this,s=c.deserializeQuery(t),l={includeVariationSource:!0,includeDefaultAggregate:!0},u=this.visualPluginService.capabilities(i.visualType),p=_.map(s.select(),(function(t){var r=_.find(a,(function(e){return d.equals(t.expr,e.expr)}));return{queryName:t.name,displayName:r?r.name:o.displayNameService.getDisplayName(t.expr,e,u,l),qualifiedDisplayName:r?r.name:o.displayNameService.getQualifiedDisplayName(t.expr,e,u,l)}}));this.ensureUniqueName(p,r);var f={ExportDataCommand:{Columns:_.map(p,(function(e){return{QueryName:e.queryName,Name:e.useQualified?e.qualifiedDisplayName:e.displayName}})),Ordering:this.getTableOrderingFromTransforms(n)||this.getDefaultTableOrdering(s.select().length),FiltersDescription:this.generateFiltersDescriptionString(r)}};return f},r.prototype.getTableOrderingFromTransforms=function(e){if(e.roles&&e.roles.ordering)return e.roles.ordering[u.ValuesRoleName]},r.prototype.getDefaultTableOrdering=function(e){return _.range(e)},r.prototype.ensureUniqueName=function(e,t){for(var r={},i={},n=t.filtersNamesAndRestatements||[],a=e.concat(n),o=0,s=a;o<s.length;o++){var l=s[o],u=l.displayName.toLowerCase(),c=l.qualifiedDisplayName.toLowerCase();u in r&&r[u]!==c&&(i[u]=!0),r[u]=c}for(var p=0,d=e;p<d.length;p++){var f=d[p];f.useQualified=i[f.displayName.toLowerCase()]}for(var h=0,v=n;h<v.length;h++){var m=v[h];m.useQualified=i[m.displayName.toLowerCase()]}},r.prototype.generateFiltersDescriptionString=function(e){if(null==e.filtersNamesAndRestatements)return"";if(0===e.filtersNamesAndRestatements.length)return this.localizationService.get("ExportData_NoAppliedFiltersText");for(var t="",r=0,i=e.filtersNamesAndRestatements;r<i.length;r++){var n=i[r];t=t.concat(this.localizationService.format("ExportData_SingleFilterText",["\n",n.useQualified?n.qualifiedDisplayName:n.displayName,n.restatement]))}return this.localizationService.format("ExportData_AppliedFiltersText",[t])},r.prototype.overrideDataQueryLimit=function(e){e.Commands[0].SemanticQueryDataShapeCommand.Binding.DataReduction={Primary:a.createFrom({top:{count:v}})}},r.prototype.clearDataQuerySubtotal=function(e){for(var t=0,r=e.Commands[0].SemanticQueryDataShapeCommand.Binding.Primary.Groupings;t<r.length;t++){var i=r[t];null!=i.Subtotal&&(i.Subtotal=0)}},r.prototype.clearVisualConfigObjects=function(e){e.objects=void 0},r.prototype.getPercentRoleSelectIndexToDisplayNameMapping=function(t,r){for(var i=this.visualPluginService.capabilities(t.visualType),n=t.query,a=n.defn.select(),o=[],s=0;s<a.length;s++){var l=a[s];if(e.data.FieldExprPattern.isPercentRoleTotalExpr(l.expr)){var u=this.displayNameService.getDisplayName(l.expr,r,i);o.push({selectIndex:s,displayName:u})}}return o},r.prototype.rewritePercentRoleRefs=function(e,t,r){var i=e.query,n=i.defn.select(),a=i.projections,o=new y(n,a,t);i.defn=i.defn.rewrite(o),r&&r.dataFilter&&(r.dataFilter=r.dataFilter.rewrite(o))},r.prototype.mapSelectIndexWithExprs=function(e,t){for(var r=e.query.defn.select(),i=[],n=0,a=t;n<a.length;n++){var o=a[n];i.push({expr:r[o.selectIndex].expr,name:o.displayName})}return i},r.prototype.clearConversionContextWithPercentRole=function(t){if(t.conversionSourceContext&&t.conversionSourceContext.query)for(var r=t.conversionSourceContext.query,i=r.defn.select(),n=0;n<i.length;n++){var a=i[n];if(e.data.FieldExprPattern.isPercentRoleTotalExpr(a.expr)){t.conversionSourceContext=void 0;break}}},r.prototype.getQueryProjectionForSelect=function(e,t){for(var r in t){var i=t[r].all(),n=_.find(i,(function(t){return t.queryRef===e.name}));if(n)return n}},r})();r.ExportVisualDataService=g;var y=(function(e){function t(t,r,i){var n=e.call(this)||this;return n.selects=t,n.projections=r,n.schema=i,n}return __extends(t,e),t.prototype.visitScopedEval=function(e){for(var t=this,r=[],i=!1,n=0,a=e.scope;n<a.length;n++){var o=a[n];if(d.isRoleRef(o)){i=!0;var s=this.projections[o.role];if(s){var l=s.all();r.push.apply(r,_.map(l,(function(e){return t.selects.withName(e.queryRef).expr})))}}else r.push(o)}return i?new h(e.expression,r):e},t})(f)})(r=t.services||(t.services={}));
})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function r(e){return new i(e)}t.createFederatedSchemaValidator=r;var i=(function(){function t(e){this.localization=e}return t.prototype.validate=function(t){if(t)for(var r=e.util.createNameValidator(t,this.localization),i=0,n=t.schemas;i<n.length;i++){var a=n[i];if(a.isExtensionSchema)for(var o=t.schema(a.extends),s=0,l=a.entities;s<l.length;s++){var u=l[s],c=!1,p=o.entities.withName(u.name);if(!p){c=!0,u.errorMessage=this.localization.get("ReportMeasuresMissingTableErrorMessage"),u.queryable=1;var d=u;d.isAbandoned=!0}for(var f=0,h=u.properties;f<h.length;f++){var v=h[f];if(1===v.kind){var m=r.validateExistingMeasureName(v);m.error===e.util.NameValidationError.DuplicatedName?(v.errorMessage=m.reason,v.queryable=1):c&&(v.errorMessage=this.localization.get("ReportMeasuresMissingTableMeasureErrorMessage"),v.queryable=1)}}}}},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,a,o){return new m(e,t,r,i,n,a,o)}var n=e.data.DataViewObjectDefinitions,a=e.data.DataViewObjectDescriptors,o=e.data.FilterKindDetector,s=e.visuals.plugins,l=e.explore.util.ScriptVisualsUtil,u=e.data.Selector,c=e.data.SemanticFilter,p=e.data.services.SemanticQuerySerializer,d=e.data.SQExprUtils,f=e.data.SubqueryRewriter,h=e.data.TopNFilterPruner,v=e.explore.util.VisualContainerUtils;r.createFilterGenerator=i;var m=(function(){function i(e,t,r,i,n,a,o){this.eventBridge=e,this.visualPlugins=t,this.aggrOps=r,this.relationshipService=i,this.hostFilters=n,this.telemetryService=a,this.scriptVisuals=o}return i.prototype.collectVisualContainerFilters=function(e,t,r){var i=new g;i.collectFilters(r.filters,r),t&&i.collectFilters(t.filters),this.collectSelfFilter(i,r),e&&i.collectFilters(e.filters);var n=this.hostFilters.getSelectedHostFilters();return n&&i.collectFilters(n.filters),t&&this.collectCrossFilter(i,t,r),i.getCollectedFilters()},i.prototype.addVisualContainerFilters=function(e,t,r,i,n){e.addCollectedFilters(this.collectVisualContainerFilters(t,r,i),!0,this.getShouldApplyFilter(i,n,r)),r&&this.addHighlightFilter(e,r,i,n)},i.prototype.calculateVisualContainerFilter=function(e,r,i,n){var a=new y(i);return this.addVisualContainerFilters(a,e,r,i,n),{dataFilter:a.getMergedDataFilter(),highlightFilter:a.getHighlightFilter(),filterMetadata:a.getMetadata(),queryRefsForSingleItemDrillFilters:t.FilterUtils.getQueryRefsForSingleItemDrillFilters(i,n,this.aggrOps)}},i.prototype.calculateDetailVisualFilter=function(e,r,i,n,a){var o=new y(i);return this.addVisualContainerFilters(o,e,r,i,n),0===a&&(a=1),o.mergeHighlightFilterBasedOnRelationship(a),{dataFilter:o.getMergedDataFilter(),highlightFilter:o.getHighlightFilter(),filterMetadata:o.getMetadata(),queryRefsForSingleItemDrillFilters:t.FilterUtils.getQueryRefsForSingleItemDrillFilters(i,n,this.aggrOps)}},i.prototype.clearCrossHighlight=function(e){e.crossHighlight&&this.setCrossHighlight(null,null,e)},i.prototype.calculateFilterContainerInputFilter=function(e,t,r,i,n){if(r&&t&&n){var a;0===n.scopeType&&(a=n.container);var o=new g;e&&o.collectFilters(e.filters),2!==n.scopeType&&o.collectFilters(t.filters),a&&(o.collectFilters(a.filters,a),this.collectCrossFilter(o,t,a));var s=new y(a);return s.addCollectedFilters(o.getCollectedFilters(),!1,this.getShouldApplyFilterContainerInputFilter(r,a,i,t)),s.getMergedDataFilter()}},i.prototype.mergeFiltersBasedOnRelationship=function(e,t,r,i){var n=new y(null);return e&&n.addVisualFilter(e),t&&n.addCrossFilter(t),r&&n.setHighlight(r),n.mergeHighlightFilterBasedOnRelationship(i),{dataFilter:n.getMergedDataFilter(),highlightFilter:n.getHighlightFilter()}},i.prototype.getVisualContainerCrossFilters=function(e,t,r){var i=new g;this.collectCrossFilter(i,e,t);var n=new y(t);return n.addCollectedFilters(i.getCollectedFilters(),!1,this.getShouldApplyFilter(t,r,e)),this.addHighlightFilter(n,e,t,r),{dataFilters:n.getCrossFilters(),highlightFilter:n.getHighlightFilter()}},i.prototype.logRFilterTelemetry=function(e,t,r){var i=l.getScriptVisualIdsInSection(t,this.scriptVisuals);_.isEmpty(i)||this.telemetryService.logEvent(e,r,JSON.stringify(i))},i.prototype.setCrossHighlight=function(t,r,i,n){var a=i.crossHighlight;_.isEmpty(r)?i.crossHighlight=void 0:(i.crossHighlight={sourceVisualContainer:n,selection:r,selectorFilter:u.filterFromSelector(r),collectedFilters:this.collectVisualContainerFilters(t,i,n)},this.logRFilterTelemetry(e.telemetry.EXCrossFilterScriptVisual,i,e.telemetry.CrossFilterType.Highlight)),a!==i.crossHighlight&&(null!=a&&a.sourceVisualContainer!==n&&(v.clearDataSelection(this.eventBridge,a.sourceVisualContainer),n=null),v.notifyVisualContainersExceptSource(this.eventBridge,n))},i.prototype.collectSelfFilter=function(e,t){var r=v.getVisualCapabilities(t,this.visualPlugins),i=this.tryGetSelfFilterProperty(r);if(i){var a=t.config.singleVisual.objects;if(a){var o=n.getValue(a,i,null);o&&e.collectFilter(o,null,t)}}},i.prototype.collectCrossFilter=function(t,r,i){for(var n=0,a=r.visualContainers;n<a.length;n++){var o=a[n];if(o!==i){var s=v.getVisualCapabilities(o,this.visualPlugins),l=this.tryGetFilterPropertyIdentifier(s);if(l){var u=v.getObjectDefinitions(o);if(u){var c=e.data.DataViewObjectDefinitions.getValue(u,l,null);c&&t.collectFilter(c,null,o)}}}}},i.prototype.addHighlightFilter=function(e,t,r,i){if(t.crossHighlight&&t.crossHighlight.sourceVisualContainer!==r&&v.getVisualType(r)!==s.slicer.name){var n=this.buildHighlightFilter(t.crossHighlight,i,t);if(n){e.setHighlight(n);var a=this.relationshipService.relationshipFilterAction(t,t.crossHighlight.sourceVisualContainer,r,i),o=v.getVisualCapabilities(r,this.visualPlugins);e.mergeHighlightFilterBasedOnRelationship(a,!o.supportsHighlight)}}},i.prototype.buildHighlightFilter=function(e,t,r){var i=new y(e.sourceVisualContainer);return e.selectorFilter&&i.setSelectorFilter(e.selectorFilter),i.addCollectedFilters(e.collectedFilters,!1,this.getShouldApplyHighlightFilter(e.sourceVisualContainer,t,r)),i.getMergedHighlightFilter()},i.prototype.getShouldApplyFilterContainerInputFilter=function(e,t,r,i){var n=this;return function(a,o,s){return n.shouldApplyFilterContainerInputFilter(a,o,s,e,t,r,i)}},i.prototype.shouldApplyFilterContainerInputFilter=function(t,r,i,n,a,o,s){if(r===n)return!1;if(!this.shouldApplyFilter(t,r,i,a,o,s))return!1;var l=r&&r.expression;return(!l||!d.isMeasure(l))&&!e.data.TopNFilterPattern.extractParametersFromFilter(t)},i.prototype.getShouldApplyHighlightFilter=function(e,t,r){var i=this;return function(n,a,o){return i.shouldApplyHighlightFilter(n,a,o,e,t,r)}},i.prototype.shouldApplyHighlightFilter=function(e,t,r,i,n,a){return!!this.shouldApplyFilter(e,t,r,i,n,a)&&!_.any(e.conditions(),(function(e){return 1===o.run(e)}))},i.prototype.getShouldApplyFilter=function(e,t,r){var i=this;return function(n,a,o){return i.shouldApplyFilter(n,a,o,e,t,r)}},i.prototype.shouldApplyFilter=function(e,r,i,n,a,o){if(r&&t.FilterUtils.shouldDisableFilter(r,a,i,this.aggrOps,this.visualPlugins))return!1;if(!(_.isEmpty(e.validate(a,this.aggrOps))||i&&i===n))return!1;if(i&&n&&i!==n){var s=this.relationshipService.relationshipFilterAction(o,i,n,a);if(3===s)return!1}return!0},i.prototype.generateFilterMetadata=function(e){if(!_.isEmpty(e)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r],a={Restatement:n.restatement,type:n.type};n.expression&&(a.expression=p.serializeExpr(n.expression)),t.push(a)}return t}},i.prototype.setFilterOnSelectData=function(t,r,i,n){this.supportsFilterOutput(n)?(this.clearCrossHighlight(i),v.notifyVisualContainersExceptSource(this.eventBridge,n),this.logRFilterTelemetry(e.telemetry.EXCrossFilterScriptVisual,i,e.telemetry.CrossFilterType.Data)):this.setCrossHighlight(t,r,i,n)},i.prototype.supportsFilterOutput=function(e){return null!=this.tryGetFilterPropertyIdentifier(v.getVisualCapabilities(e,this.visualPlugins))},i.prototype.tryGetFilterPropertyIdentifier=function(e){if(e)return a.findFilterOutput(e.objects)},i.prototype.tryGetSelfFilterEnabledProperty=function(e){if(e)return a.findSelfFilterEnabled(e.objects)},i.prototype.tryGetSelfFilterProperty=function(e){if(e)return a.findSelfFilter(e.objects)},i.prototype.resolveFilterTargets=function(e,t,i,n,a){var o={dataRoles:i,mappings:n,queryProjections:t.projections,select:t.defn.select(),schema:e},s=new r.VisualFilterMappingResolver(o),l=t.defn;return a&&(l=l.addSemanticFilter(a)),s.resolveSemanticQuery(l)},i.prototype.applyFilterOutput=function(e){this.supportsFilterOutput(e)&&v.notifyVisualContainersExceptSource(this.eventBridge,e)},i})(),g=(function(){function e(){this.collectedFilters=[]}return e.prototype.collectFilters=function(e,t){if(e)for(var r=0,i=e;r<i.length;r++){var n=i[r];n.filter&&this.collectFilter(n.filter,n,t)}},e.prototype.collectFilter=function(e,t,r){e&&this.collectedFilters.push({filter:e,filterContainer:t,sourceVisualContainer:r})},e.prototype.getCollectedFilters=function(){return this.collectedFilters},e})(),y=(function(){function e(e){if(this.visualContainer=e,e){var t=v.getVisualQuery(e);t&&(this.visualSemanticQuery=t.defn)}this.needToEnsurePrecedence=!1,this.shouldPruneUnnecessaryFilters=!1}return e.prototype.setSelectorFilter=function(e){this.selectorFilter=e,this.shouldPruneUnnecessaryFilters=!0},e.prototype.addDrillFilter=function(e){this.drillFilters=this.drillFilters||[],this.drillFilters.push(e)},e.prototype.addVisualFilter=function(e){this.visualSemanticQuery&&(e=f.rewriteSubqueriesForContainingQuery(e,this.visualSemanticQuery)),this.visualFilters=this.visualFilters||[],this.visualFilters.push(e),this.needToEnsurePrecedence=!0,this.shouldPruneUnnecessaryFilters=!0},e.prototype.addExternalFilter=function(e){this.externalFilters=this.externalFilters||[],this.externalFilters.push(e),this.needToEnsurePrecedence=!0},e.prototype.addCrossFilter=function(e){this.crossFilters=this.crossFilters||[],this.crossFilters.push(e),this.needToEnsurePrecedence=!0},e.prototype.setHighlight=function(e){this.highlightFilter=e},e.prototype.addCollectedFilters=function(e,t,r){for(var i=0,n=e;i<n.length;i++){var a=n[i],o=a.filter,s=a.filterContainer,l=a.sourceVisualContainer;if((!r||r(o,s,l))&&(s&&0===s.precedence?this.addDrillFilter(o):a.sourceVisualContainer?a.sourceVisualContainer===this.visualContainer?this.addVisualFilter(o):this.addCrossFilter(o):this.addExternalFilter(o),t&&s)){var u=s.expression&&p.serializeExpr(s.expression);this.metadata=this.metadata||[],this.metadata.push({Restatement:s.restatement,expression:u,type:s.type})}}},e.prototype.mergeHighlightFilterBasedOnRelationship=function(e,t){switch(e){case 0:case 2:if(!t)break;case 1:this.highlightFilter&&(this.addCrossFilter(this.highlightFilter),this.highlightFilter=void 0);break;case 3:this.highlightFilter=void 0}},e.prototype.getMergedDataFilter=function(){if(this.pruneUnnecessaryFilters(),this.ensurePrecedence(),this.drillFilters||this.externalFilters||this.visualFilters||this.crossFilters){var e=this.drillFilters||[],t=this.visualFilters||[],r=this.externalFilters||[],i=this.crossFilters||[];return c.merge(e.concat(t).concat(r).concat(i))}},e.prototype.getMergedHighlightFilter=function(){if(this.pruneUnnecessaryFilters(),this.ensurePrecedence(),this.selectorFilter||this.visualFilters){var e=this.selectorFilter?[this.selectorFilter]:[],t=this.visualFilters||[];return c.merge(e.concat(t))}},e.prototype.getCrossFilters=function(){return this.crossFilters},e.prototype.getHighlightFilter=function(){return this.highlightFilter},e.prototype.getMetadata=function(){return this.metadata},e.prototype.ensurePrecedence=function(){if(this.needToEnsurePrecedence){if(this.visualFilters){var e=c.merge(this.visualFilters);e=f.makeSubqueriesLowerPrecedenceThanColumnFilters(e),this.externalFilters&&(e=f.makeSubqueriesLowerPrecedenceThanSpecificFilters(e,this.externalFilters)),this.crossFilters&&(e=f.makeSubqueriesLowerPrecedenceThanSpecificFilters(e,this.crossFilters)),this.visualFilters=[e]}this.needToEnsurePrecedence=!1}},e.prototype.pruneUnnecessaryFilters=function(){if(this.shouldPruneUnnecessaryFilters){if(this.visualFilters&&this.selectorFilter){var e=c.merge(this.visualFilters);e=h.removeUnnecessaryTopNFilters(e,this.selectorFilter),this.visualFilters=[e]}this.shouldPruneUnnecessaryFilters=!1}},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i,n,a,o,s){return new r(e,t,i,n,a,o,s)}e.createClipboardService=t;var r=(function(){function t(e,t,r,i,n,a,o){this.eventBridge=e,this.popOutService=t,this.undoRedoService=r,this.visualStylePresetService=i,this.rootScope=n,this.registeredResourceReferences=a,this.promiseFactory=o,a.addReferenceSource(this)}return t.prototype.getReferences=function(){return this.data&&this.data.referencedStaticResources},t.prototype.restoreMissingResources=function(e){return this.registeredResourceReferences.restoreReferences(_.map(this.data.referencedStaticResources,(function(e){return e.name})))},t.prototype.setData=function(t){this.data=t,this.eventBridge.publishToChannel(e.events.clipboardDataUpdated)},t.prototype.getData=function(){return this.data},t.prototype.clearData=function(){this.data=void 0,this.eventBridge.publishToChannel(e.events.clipboardDataUpdated)},t.prototype.copySelectedVisuals=function(){var e=this.handler.serializeSelection(),t=this.handler.getSelectionResources();return{visuals:e,referencedStaticResources:t}},t.prototype.copy=function(){this.setData(this.copySelectedVisuals())},t.prototype.cut=function(){var e=this;this.rootScope.$evalAsync((function(){e.undoRedoService.register("Cut",(function(){e.setData(e.copySelectedVisuals()),e.handler.deleteSelection()}))}))},t.prototype.paste=function(){var e=this;if(this.canPaste()){var t=this.getData();this.restoreMissingResources(t&&t.referencedStaticResources).then((function(){e.rootScope.$evalAsync((function(){e.undoRedoService.register("Paste",(function(){e.handler.deserializeAndDuplicateData(t.visuals)}))}))}))}},t.prototype.canPaste=function(){return Boolean(null==this.popOutService.getPoppedOutVisualContainer()&&this.data&&this.data.visuals)},t.prototype.setHandler=function(e){this.handler=e},t.prototype.getFormatData=function(){return this.formatData},t.prototype.setFormatData=function(t){this.formatData=t,this.eventBridge.publishToChannel(e.events.clipboardDataUpdated)},t.prototype.clearFormatData=function(){this.formatData=void 0,this.eventBridge.publishToChannel(e.events.clipboardDataUpdated)},t.prototype.copyFormat=function(){var e=this.handler.serializeSelection();if(1===e.length){var t=e[0],r={visuals:[t]};this.setFormatData(r)}},t.prototype.tryPasteFormat=function(){var e=this;this.canPasteFormat()&&this.rootScope.$evalAsync((function(){e.undoRedoService.register("PasteFormat",(function(){var t=e.getFormatData(),r=e.handler.deserializeVisualContainer(t.visuals[0]).config.singleVisual;e.handler.pasteVisualFormat(r,e.visualStylePresetService),e.clearFormatData()}))}))},t.prototype.canPasteFormat=function(){return!(!this.formatData||!this.formatData.visuals)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.DataViewObjectDefinition,n=e.data.DataViewObjectDefinitions,a=e.explore.contracts.VisualContainer;!(function(r){function o(e,r){var i=t.selectionUtils.getSelectedVisual(e);if(i){var n=i.config.singleVisual.visualType,a=r.isCustomVisual(n);if(!a)return i.config.singleVisual}}function s(e,r,i,n){var o=t.selectionUtils.getSelectedVisual(e);if(o&&n){var s=o.config.singleVisual,c=s.visualType,p=r.isCustomVisual(c);if(!p){s.objects||(s.objects={});var d=r.capabilities(c),f=r.capabilities(n.visualType);if(d&&f){for(var h in n.objects){var v=d.objects[h],m=f.objects[h];l(v,m,n,s,h)}var g=a.getObjectDescriptors(c,i);u(g,n,s)}return o}}}function l(t,r,i,a,o){if(t&&r&&o&&!t.suppressFormatPainterCopy&&!r.suppressFormatPainterCopy){var s=i.objects[o];for(var l in t.properties)for(var u=t.properties[l],p=r.properties[l],d=0,f=s;d<f.length;d++){var h=f[d];if(u&&p&&!u.suppressFormatPainterCopy&&!p.suppressFormatPainterCopy&&e.ValueType.fromDescriptor(u.type).equals(e.ValueType.fromDescriptor(p.type))){var v=n.ensure(i.objects,o,h.selector),m=n.ensure(a.objects,o,h.selector);c(l,v,m)}}}}function u(e,t,r){if(e)for(var i in e){var n=e[i];if(n&&t[i])for(var a in n.properties){var o=t[i],s=n.properties;o&&o[a]&&s&&s[a]&&!s[a].suppressFormatPainterCopy&&(r[i]||(r[i]={}),r[i][a]=o[a])}}}function c(e,t,r){var n=t.properties[e],a=r.properties[e];n?r.properties[e]=n:a&&i.deleteSingleProperty(r,e)}r.copyFormatVisualConfig=o,r.pasteFormatVisualConfig=s})(r=t.FormatPainter||(t.FormatPainter={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,a,s,l){return new o(e,t,r,i,n,a,s,l)}var n=t.contracts.DataSource,a=e.explore.util.VisualContainerUtils;r.createModelChangeHandler=i;var o=(function(){function t(e,t,i,n,a,o,s,l){var u=this;this.dataProxy=t,this.eventBridge=a,this.undoRedoService=o,this.visualPluginService=s,this.conceptualSchemaProxy=e,this.promiseFactory=l,this.dataSources=n,this.scope=i,this.handlerTokens=[];var c=a.createChannelSubscriptionManager().subscribe(r.events.explorationLoaded,(function(e,t){return u.currentExplorationContract=t}));i.$on("$destroy",(function(){return c.unsubscribeAll()}))}return t.prototype.applyChange=function(t){var i=this,o=t.providerType;o||(o="dsr");var s=this.dataSources.get(),l=n.referenced(s,null);if(l){var u=n.dataReaderDataSources(n.queried(s,null)),c=this.conceptualSchemaProxy,p=this.dataProxy;c.stopCommunication(new e.IgnorableClientError),c.clearCache(),p.stopCommunication(o),t.change.then((function(n){n.isSchemaChangeListComplete||(p.clearCache(o,u),i.currentExplorationContract&&a.clearVisualContainerQueryCaches(i.currentExplorationContract));var s;n&&(s=n.changes)&&!_.isEmpty(s)&&(n.isSchemaChangeListComplete&&"dsr"===o&&e.data.dsr.createQueryCacheHandler().apply(p,u,s),i.currentExplorationContract&&r.createSchemaChangeHandler(i.visualPluginService).apply(i.currentExplorationContract,s)),i.conceptualSchemaProxy.resumeCommunication();var l=[];try{for(var c=0,d=i.handlerTokens;c<d.length;c++){var f=d[c];l.push(f.handle(n))}}finally{i.promiseFactory.all(l).finally((function(){i.dataProxy.resumeCommunication(o),t.leaveUndo||(i.undoRedoService.canUndo()||i.undoRedoService.canRedo())&&(i.undoRedoService.clear(),i.eventBridge.publishToChannel(r.events.undoRedoStackCleared));var e=i.eventBridge;e.publishToChannel(r.events.enableEditing),e.publishToChannel(r.events.modelChanged,n),e.publishToChannel(r.events.visualContainerChanged,{affectContainer:function(){return!0}})}))}}),(function(){return i.resumeCommunication(o)}))}},t.prototype.register=function(e){var t=this,r={handle:e,stopHandling:function(){var e=t.handlerTokens.indexOf(r);e>-1&&t.handlerTokens.splice(e,1)}};return this.handlerTokens.push(r),r},t.prototype.resumeCommunication=function(e){this.conceptualSchemaProxy.resumeCommunication(),this.dataProxy.resumeCommunication(e)},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createServicePauser=t;var r=(function(){function e(){this.isPaused=!1}return e.prototype.register=function(e){var t=jQuery.extend(!0,{},e);return this.updateService(t),t},e.prototype.pause=function(){this.isPaused=!0},e.prototype.resume=function(){this.isPaused=!1},e.prototype.updateService=function(e){var t=function(t){if(_.isFunction(e[t])){var i=e[t],n=r;e[t]=function(){if(!n.isPaused)return i.apply(e,arguments)}}},r=this;for(var i in e)t(i)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r){return new a(e,t,r)}var n=t.util.VisualContainerUtils;r.createPopOutService=i;var a=(function(){function t(e,t,i){var n=this;this.telemetryService=e,this.eventBridge=t,this.selectionService=i,this.eventBridge=t,this.selectionService=i,t.createChannelSubscriptionManager().subscribe(r.events.selectionChanged,(function(){return n.updatePopOutMode()}))}return t.prototype.popOutVisualContainer=function(e,t){this.popOutVisualContainerInternal(e,t,!0)},t.prototype.getPoppedOutVisualContainer=function(){if(this.poppedOutElement)return this.poppedOutElement.visualContainer},t.prototype.clearPopOut=function(){this.clearPopOutInternal(!0,!0)},t.prototype.popOutVisualContainerInternal=function(e,t,i){if(0===t)return void this.clearPopOutInternal(!0,i);r.selectionUtils.selectVisualContainer(e,this.selectionService);var n=new o(e,t);o.equals(n,this.poppedOutElement)||(this.clearPopOutInternal(!1,!1),this.setPopOutMode(n,t,i),this.poppedOutElement=n,this.raiseEvent())},t.prototype.clearPopOutInternal=function(e,t){this.poppedOutElement&&(this.setPopOutMode(this.poppedOutElement,0,t),this.poppedOutElement=void 0,e&&this.raiseEvent())},t.prototype.updatePopOutMode=function(){var e=r.selectionUtils.getDefaultSelectedVisualInSingleOrMultiCase(this.selectionService);e&&null!=e.popOutMode&&0!==e.popOutMode?this.popOutVisualContainerInternal(e,e.popOutMode,!1):this.clearPopOutInternal(!0,!1)},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(r.events.popOutModeChanged)},t.prototype.setPopOutMode=function(t,r,i){var a=t.visualContainer;!i||2!==a.popOutMode&&2!==r||this.telemetryService.logEvent(e.telemetry.EXToggleSeeData,n.getVisualType(a),2===r),a.popOutMode=r},t})(),o=(function(){function e(e,t){this.visual=e,this.mode=t}return Object.defineProperty(e.prototype,"id",{get:function(){if(this.visual)return this.visual.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visualContainer",{get:function(){return this.visual},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"popOutMode",{get:function(){return this.mode},enumerable:!0,configurable:!0}),e.equals=function(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.id===t.id&&e.visualContainer===t.visualContainer&&e.popOutMode===t.popOutMode)},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n){return new a(e,t,r,i,n)}var i=e.data.DataViewObjectDefinitions;t.createRegisteredResourceReferenceService=r;var n;!(function(e){function r(e,r,n){e&&i.visitPropertyExprs({definitions:e,visitor:function(e){if(25===e.kind){var i=t.findRegisteredResourceReference(e,r);if(i){var a={name:i.name,type:i.type};n.push(a)}}}})}e.addObjectsReferences=r})(n=t.RegisteredResourceReferences||(t.RegisteredResourceReferences={}));var a=(function(){function e(e,t,r,i,n){this.promiseFactory=e,this.resourceLoader=t,this.explorationNavigation=r,this.explorationSerializer=i,this.resourceRegistration=n,this.referenceSources=[],this.preservedReferences={}}return e.prototype.addReferenceSource=function(e){this.referenceSources.push(e)},e.prototype.removeReferenceSource=function(e){_.pull(this.referenceSources,e)},e.prototype.garbageCollectUnreferencedRegisteredResources=function(){var e=this.explorationNavigation.getCurrentExploration();if(e&&!_.isEmpty(e.resourcePackages)){var r=t.getRegisteredResourcePackage(e.resourcePackages);if(r&&!_.isEmpty(r.items)){for(var i=_.indexBy(this.explorationSerializer.getReferencedRegisteredResources(e),(function(e){return e.name})),n=_.map(_.filter(r.items,(function(e){return!i[e.name]})),(function(e){return{name:e.name,type:e.type}})),a={},o=0,s=this.referenceSources;o<s.length;o++){var l=s[o],u=l.getReferences();if(!_.isEmpty(u))for(var c=0,p=u;c<p.length;c++){var d=p[c];a[d.name]=d}}var f={};for(var h in a)i[h]||f[h]||(f[h]=this.preservedReferences[h]||{name:h,type:a[h].type,uri:t.loadRegisteredResourceAsDataUri(this.promiseFactory,this.resourceLoader,e.resourcePackages,h)});if(this.preservedReferences=f,!_.isEmpty(n)){var v=_.indexBy(n,(function(e){return e.name}));r.items=_.filter(r.items,(function(e){return!v[e.name]}))}return _.map(n,(function(e){return r.name+"/"+e.name}))}}},e.prototype.needingRestore=function(e){var r=this;if(!_.isEmpty(e)){var i=this.explorationNavigation.getCurrentExploration();if(i){var n=i.resourcePackages;if(!_.isEmpty(n))return _.map(_.filter(e,(function(e){return r.preservedReferences[e]&&!t.findRegisteredResource(e,n)})),(function(e){return r.preservedReferences[e]}))}}},e.prototype.restoreReferences=function(e){var t=this,r=this.needingRestore(e);if(_.isEmpty(r))return this.promiseFactory.resolve(void 0);var i=_.map(r,(function(e){return e.uri.then((function(r){t.resourceRegistration.restore(e.name,e.type,r)}))}));return this.promiseFactory.all(i).then((function(){}))},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){return new g(e,t)}function i(e,t){var r=s(t);if(r)return _.find(r.items,(function(t){return t.name===e}))}function n(e,t){if(e&&e.packageName===v&&e.packageType===m)return i(e.itemName,t)}function a(e){return e&&e.name===v&&e.type===m}function o(e){var t=d.ensureResourcePackages(e),r=d.ensureResourcePackage(t,m,v);return r}function s(e){return _.find(e,(function(e){return a(e)}))}function l(e,t,r,i){if(r){var n=s(r);if(n)return t.loadResourcePackageItem(n,i)}return e.reject()}function u(t,r,i,n){var a=l(t,r,i,n);return a.then((function(r){return r instanceof Blob?e.visualHost.BlobHelper.readAsDataUrl(r,t):("string"!=typeof r||h.isDataUri(r)||(r=h.makeJsonDataUri(r)),r)}))}function c(t,r,i,n){var a=l(t,r,i,n);return a.then((function(r){return r instanceof Blob?e.visualHost.BlobHelper.readAsText(r,t):r})).then((function(e){try{"string"==typeof e&&h.isDataUri(e)&&(e=h.atou(h.getBase64ContentFromDataUri(e)))}catch(t){jsCommon.Trace.error("Error decoding registeredResource applying custom theme: "+JSON.stringify(t),!!t.stack),e=void 0}return e}))}var p=jsCommon.FileUtils,d=e.explore.util.ResourcePackageUtils,f=e.data.SQExprBuilder,h=jsCommon.UrlUtils;t.createResourceRegistrationService=r;var v="RegisteredResources",m=1;t.findRegisteredResource=i,t.findRegisteredResourceReference=n,t.isRegisteredResourcePackage=a,t.ensureRegisteredResourcePackage=o,t.getRegisteredResourcePackage=s,t.loadRegisteredResource=l,t.loadRegisteredResourceAsDataUri=u,t.loadRegisteredResourceAsDecodedString=c;var g=(function(){function e(e,t){this.explorationNavigationService=e,this.resourcePublishingService=t}return e.prototype.addResource=function(e,t,r,i){var n=h.getBase64ContentFromDataUri(i);this.resourcePublishingService.publish(v,t,n);var a={type:r,path:t,name:t,content:i};e.items.push(a)},e.prototype.restore=function(e,t,r){var i=this.ensureResourcePackageExists();_.find(i.items,(function(t){return t.name===e}))||this.addResource(i,e,t,r)},e.prototype.add=function(e,t,r){var i=this.ensureResourcePackageExists(),n=this.getUniqueName(e,i);return this.addResource(i,n,t,r),f.resourcePackageItem(i.name,m,n)},e.prototype.getUniqueName=function(e,t){var r=e.replace(/[^a-zA-Z0-9:@\-._~!$&'()*+,;=]/g,"_"),i=p.getFileWithoutExtension(r),n=p.getFileExtension(r);n&&(n="."+n);for(var a;;){var o=Math.random().toString().substr(2);if(a=i+o+n,!_.find(t.items,(function(e){return e.name.toUpperCase()===a.toUpperCase()})))break}return a},e.prototype.ensureResourcePackageExists=function(){var e=this.explorationNavigationService.getCurrentExploration();return o(e)},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{publish:_.noop}}e.createResourcePublishingService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.v1_0="1.0",e.v2_0="2.0",e.v2_2="2.2",e.v2_3="2.3",e.v2_5="2.5",e.v3_0="3.0",e.v3_1="3.1"})(t=e.ExplorationVersions||(e.ExplorationVersions={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){return new y(e,t)}var n=jsCommon.ArrayExtensions,a=e.explore.contracts,o=e.data.services.DataViewObjectSerializer,s=e.data.DefaultSQExprVisitor,l=e.explore.services.upgrade.ExplorationVersions,u=jsCommon.JsonExtensions,c=e.data.QueryProjectionCollection,p=e.data.services.SemanticQuerySerializer,d=jsCommon.StringExtensions,f=e.explore.contracts.Version,h=t.util.VisualContainerUtils,v=a.VisualQuery,m="Gradient",g="Size";r.createExplorationSerializer=i;var y=(function(){function i(e,t){this.visualPlugins=e,this.telemetryService=t,this.explorationUpgrader=r.upgrade.createExplorationUpgrader()}return i.prototype.deepCopyExploration=function(e,t){return this.deserializeExploration(this.serializeExploration(e,t),[],!0)},i.prototype.ensureInitialized=function(){return this.visualPlugins.ensureBuiltInPlugins()},i.prototype.deserializeExploration=function(t,r,i,n){var o,s=this;if(t){var l=this.explorationUpgrader.upgrade(t,r,i);if(!l)return;if(o={id:l.id,width:void 0,height:void 0,sections:void 0,dataSources:void 0,reportId:l.reportId,theme:l.theme},l.sections){var c=_.sortBy(l.sections,(function(e){return void 0!==e.ordinal?e.ordinal:0}));if(o.sections=_.map(c,(function(e){return s.deserializePage(e)})),o.filters=this.deserializeFilterContainers(l.filters),o.dataSources=a.createDataSourceArray(),l.resourcePackages&&(o.resourcePackages=this.deserializeResourcePackages(l.resourcePackages)),l.pods&&(o.pods=_.map(l.pods,(function(e){return s.deserializePod(e)}))),l.config){var p=u.tryParseJSON(l.config);p&&(_.isNumber(p.activeSectionIndex)&&p.activeSectionIndex<l.sections.length&&(o.activeSectionIndex=p.activeSectionIndex),p.modelExtensions&&(o.modelExtensions=this.deserializeModelExtensions(p.modelExtensions)))}if(n&&n.lastTimeAModelChangeWasDetectedInTheCluster&&!_.isEmpty(n.onPremModelConnectionString))for(var d=jsCommon.DateExtensions.deserializeDate(n.lastTimeAModelChangeWasDetectedInTheCluster),f=0,h=o.sections;f<h.length;f++)for(var v=h[f],m=0,g=v.visualContainers;m<g.length;m++){var y=g[m];if(y.cachedData&&y.cachedData.dataUpdatedTime&&y.cachedData.data){var C=+y.cachedData.dataUpdatedTime-+d;y.useInitialCachedQuery=C>=0}else y.useInitialCachedQuery=!1}}l.report&&(o.report=e.Prototype.inherit(l.report),l.report.linguisticSchemaId&&(o.reportHasLinguisticSchema=!0))}return o},i.prototype.deserializeResourcePackages=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var a=i[r];this.upgradeResourcePackage(a.resourcePackage),t.push(a.resourcePackage)}return n.extendWithName(t)},i.prototype.deserializePage=function(e){if(e){var r={id:e.id,objectId:e.objectId,name:e.name,displayName:e.displayName,visualContainers:void 0,size:{displayOption:void 0!==e.displayOption?e.displayOption:0,height:void 0!==e.height?e.height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight,width:void 0!==e.width?e.width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth},filters:this.deserializeFilterContainers(e.filters)};e.transient&&(r.transient=e.transient);var i;if(e.config&&(i=u.tryParseJSON(e.config)),i&&i.objects&&(r.objects=o.deserializeObjects(i.objects,a.Section.objectDescriptors)),e.visualContainers){r.visualContainers=[];for(var n=0,s=e.visualContainers;n<s.length;n++){var l=s[n],c=this.deserializeVisualContainer(l);r.visualContainers.push(c)}if(this.ensureNames(r.visualContainers),i&&i.relationships){r.relationships=[];for(var p=0,d=i.relationships;p<d.length;p++){var f=d[p],h=this.deserializeRelationship(f,r.visualContainers);h&&r.relationships.push(h)}}}return r}},i.prototype.deserializePod=function(e){if(e)return{id:e.id,
name:e.name,boundSection:e.boundSection,parameters:this.deserializePodParameters(e.parameters),cortanaEnabled:e.cortanaEnabled}},i.prototype.deserializeModelExtensions=function(e){var t=this;return n.extendWithName(_.map(e,(function(e){var r={name:e.name,extends:e.extends};return e.entities&&(r.entities=t.deserializeModelExtensionEntities(e.entities)),r})))},i.prototype.deserializeModelExtensionEntities=function(e){var t=this;return n.extendWithName(_.map(e,(function(e){var r;return r=e.extends?{name:e.name,extends:e.extends}:{name:e.name},e.measures&&(r.measures=t.deserializeModelExtensionMeasures(e.measures)),r})))},i.prototype.deserializeModelExtensionMeasures=function(e){var t=this;return n.extendWithName(_.map(e,(function(e){var r={name:e.name,dataType:e.dataType,expression:e.expression,errorMessage:e.errorMessage,hidden:e.hidden,references:t.deserializeExpressionReferences(e.references),formulaOverride:e.formulaOverride};return e.annotations&&(r.annotations=t.deserializeModelExtensionAnnotations(e.annotations)),r})))},i.prototype.deserializeExpressionReferences=function(e){if(!e)return{unrecognizedReferences:!1,measures:[]};var t={unrecognizedReferences:!!e.unrecognizedReferences,measures:e.measures||[]};return t},i.prototype.deserializeModelExtensionAnnotations=function(e){return n.extendWithName(_.map(e,(function(e){return{name:e.name,value:e.value}})))},i.prototype.deserializeFilterCollection=function(e,t,r){if(e){var i=this.explorationUpgrader.upgradeFilterCollection(e,t,r);if(i)return this.deserializeFilterContainers(i.filters)}},i.prototype.deserializeFilterContainer=function(e){return{name:e.name,type:a.FilterType[e.type],expression:e.expression?p.deserializeExpr(e.expression):void 0,filter:e.filter&&e.filter.Where?p.deserializeFilter(e.filter):void 0,restatement:e.restatement,cachedValueItems:this.deserializeFilterLabelIdPairs(e.cachedDisplayNames),howCreated:e.howCreated}},i.prototype.deserializeFilterLabelIdPairs=function(e){if(e&&!(e.length<1)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];if(n.id){var a=o.deserializeScopeIdentity(n.id);a&&t.push({identity:a,displayName:n.displayName})}}return t}},i.prototype.deserializeVisualContainer=function(e,t,r){var i={name:r,id:t?void 0:e.id,layouts:n.createWithId()};null!=e.popOutMode&&(i.popOutMode=e.popOutMode),null!=e.detailVisualLayout&&(i.detailVisualLayout=e.detailVisualLayout),void 0===e.dataBinaryBase64Encoded&&void 0===e.query&&void 0===e.dataTransforms||(i.cachedData={data:e.dataBinaryBase64Encoded,query:e.query,transforms:e.dataTransforms,dataUpdatedTime:e.dataUpdatedTime?jsCommon.DateExtensions.parseUtcDate(e.dataUpdatedTime):void 0}),i.filters=this.deserializeFilterContainers(e.filters);var a=u.tryParseJSON(e.config);return a&&(r||(i.name=a.name),a.singleVisual&&(i.config={singleVisual:this.deserializeSingleVisual(a.singleVisual,e.prototypeQuery)}),(o=i.layouts).push.apply(o,a.layouts)),i;var o},i.prototype.deserializeRelationship=function(e,t){var r=n.findItemWithName(t,e.source),i=n.findItemWithName(t,e.target);if(0!==e.type&&r&&i)return{source:r,target:i,type:e.type}},i.prototype.deserializeFilterContainers=function(e){var t=this,r=[];if(!d.isNullOrUndefinedOrWhiteSpaceString(e)){var i=u.tryParseJSON(e);i&&(r=i.map((function(e){return t.deserializeFilterContainer(e)})))}return r},i.prototype.deserializePodParameters=function(e){var t=this,r=[];if(!d.isNullOrUndefinedOrWhiteSpaceString(e)){var i=u.tryParseJSON(e);i&&(r=i.map((function(e){return t.deserializePodParameter(e)})))}return r},i.prototype.deserializePodParameter=function(e){return{name:e.name,boundFilter:e.boundFilter}},i.prototype.deserializeVisualQuery=function(e,t,r,i){var n=new v(t,this.convertProjections(r,t.select(),i));this.upgradeVisualQuery(n,e.visualType),e.query=n},i.prototype.deserializeSingleVisual=function(e,t){var r={visualType:e.visualType||e.visualConfig.visualType},i=e.visualConfig?e.visualConfig.projections:void 0,n=e.projections||{};if(i)for(var a=0,s=i;a<s.length;a++){var l=s[a],c=n[l.role];c||(c=[],n[l.role]=c),c.push(l)}else if(n&&n.length>0){i=n,n={};for(var d=0,f=i;d<f.length;d++){var l=f[d],c=n[l.role];c||(c=[],n[l.role]=c),c.push(l)}}var h=e.prototypeQuery?e.prototypeQuery:t?u.tryParseJSON(t):null;if(h){var v=p.deserializeQuery(h);this.deserializeVisualQuery(r,v,n,e.showAllRoles)}var m=this.deserializeVisualTitle(e.title);m&&(r.title=m);var g=e.background;g&&(r.background=g);var y=e.aspectRatio;y&&(r.aspectRatio=y);var C=e.border;C&&(r.border=C);var b=e.stylePresetName;b&&(r.stylePresetName=b);var S=e.altText;S&&(r.altText=S);var x=this.visualPlugins.capabilities(r.visualType);if(x&&e.objects)r.objects=o.deserializeObjects(e.objects,x.objects);else{var E=e.objects;E&&(r.objects=o.deserializeObjects(E,null))}return r},i.prototype.deserializeVisualTitle=function(e){if(e)return e.hidden?{show:!1}:e},i.prototype.ensureNames=function(e){for(var t,r=e.length,i={},n=0;n<r;n++){var a=e[n].name;_.isEmpty(a)?t=!0:i[a]=!0}if(t)for(var n=0;n<r;n++){var o=e[n],s=o.name;_.isEmpty(s)&&(o.name=h.nextUniqueName(i,r))}},i.prototype.convertProjections=function(e,t,r){var i={};for(var n in e){var a=_.contains(r,n);i[n]=this.convertProjectionArray(e[n],t,a)}return i},i.prototype.convertProjectionArray=function(e,t,r){for(var i,n=[],a=0,o=e;a<o.length;a++){var s=o[a],l=this.convertProjection(s,t);s.active&&(i=i||[],i.push(l.queryRef)),n.push(l)}return new c(n,i,r)},i.prototype.convertProjection=function(e,t){var r=e.queryRef;_.isNumber(e.queryRef)&&(r=t[e.queryRef].name);var i={queryRef:r};return e.format&&(i.format=e.format),i},i.prototype.serializeExploration=function(e,t){var r=new b(this.visualPlugins);return r.serializeExploration(e,t)},i.prototype.serializeExplorationShallowWithResourcePackages=function(e,t){var r=new b(this.visualPlugins);return r.serializeExplorationShallowWithResourcePackages(e,t)},i.prototype.serializeModelExtensions=function(e){var t=new b(this.visualPlugins);return t.serializeModelExtensions(e)},i.prototype.serializePage=function(e,t,r){var i=new b(this.visualPlugins);return i.serializePage(e,t,r)},i.prototype.serializePageShallow=function(e,t,r){var i=new b(this.visualPlugins);return i.serializePageShallow(e,t,r)},i.prototype.serializeVisualContainer=function(e,t){var r=new b(this.visualPlugins);return r.serializeVisualContainer(e,t)},i.prototype.serializePod=function(e){var t=new b(this.visualPlugins);return t.serializePod(e)},i.prototype.serializeFilterCollection=function(e){var t=new b(this.visualPlugins);return t.serializeFilterCollection(e)},i.prototype.serializeResourcePackages=function(e){var t=new b(this.visualPlugins);return t.serializeResourcePackages(e)},i.prototype.upgradeVisualQuery=function(r,i){if(i===e.visuals.plugins.filledMap.name&&r.projections[m]){var n=r.projections[m],a=r.projections[g];if(a&&a.all.length>0)for(var o=a.all().length,s=o-1;s>=0;s--)r.removeProjection(g,s);r.projections[g]=n,delete r.projections[m]}var l=this.visualPlugins.capabilities(i);if(l){var u=t.util.DrillUtils.getDrillableRoles(l),c=r.ensureDrillableRoles(u);if(!_.isEmpty(c)){for(var p={},d=0,f=c;d<f.length;d++){var h=f[d],v=r.projections[h],y=0;v&&(y=_.size(v.all())),p[h]=y}this.telemetryService.logEvent(e.telemetry.EXVisualDrillableRoleActiveItemsFixed,i,JSON.stringify(p))}}},i.prototype.upgradeResourcePackage=function(e){void 0===e.type&&(e.type=0)},i.prototype.getReferencedRegisteredResources=function(e){var t=[];if(r.findRegisteredResource(e.theme,e.resourcePackages)&&t.push({name:e.theme,type:201}),!_.isEmpty(e.sections))for(var i=0,n=e.sections;i<n.length;i++){var a=n[i];if(r.RegisteredResourceReferences.addObjectsReferences(a.objects,e.resourcePackages,t),!_.isEmpty(a.visualContainers))for(var o=0,s=a.visualContainers;o<s.length;o++){var l=s[o],u=l.config&&l.config.singleVisual&&l.config.singleVisual.objects;r.RegisteredResourceReferences.addObjectsReferences(u,e.resourcePackages,t)}}return t},i})(),C=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.visitColumnRef=function(e){var t=e.source.accept(this);if(t)return t.column=e.ref,t},t.prototype.visitMeasureRef=function(e){var t=e.source.accept(this);if(t)return t.measure=e.ref,t},t.prototype.visitAggr=function(e){var t=e.arg.accept(this);if(t)return t.aggregate=e.func,t},t.prototype.visitEntity=function(e){var t={schema:e.schema,entity:e.entity};return e.variable&&(t.entityVar=e.variable),t},t})(s);C.instance=new C;var b=(function(){function t(e){this.visualPlugins=e,this.version=l.v2_5}return t.prototype.serializeExploration=function(e,t){var r=this,i=e.sections;t&&t.withTransientPages||(i=a.Section.filterTransient(i));var n,o=_.map(i,(function(e,i){return r.serializePage(e,i,t)}));_.isEmpty(e.pods)||(n=_.map(e.pods,(function(e){return r.serializePod(e)})));var s=this.serializeExplorationShallowWithResourcePackages(e,t);return s.sections=o,s.pods=n,s},t.prototype.serializeExplorationShallowWithResourcePackages=function(e,t){var r=e.activeSectionIndex,i=this.createVersionedElementConfig(l.v2_5);_.isNumber(r)&&(i.activeSectionIndex=r),_.isEmpty(e.modelExtensions)||(this.version=f.max(this.version,l.v3_0),i.modelExtensions=this.serializeModelExtensions(e.modelExtensions));var n={id:e.id,reportId:e.reportId,theme:e.theme,filters:this.serializeFilterContainers(e.filters),resourcePackages:this.serializeResourcePackages(e.resourcePackages),sections:void 0,config:JSON.stringify(i),layoutOptimization:this.getLayoutOptimizations(e)};return this.requireVersion(i,this.version),n.config=JSON.stringify(i),n},t.prototype.serializeFilterCollection=function(e){if(!_.isEmpty(e)){var t=this.createVersionedElementConfig(l.v2_5);return{filters:this.serializeFilterContainers(e),config:JSON.stringify(t)}}},t.prototype.serializePage=function(e,t,r){var i=this.serializePageShallow(e,t,r);i.visualContainers=[];for(var n=0,a=e.visualContainers;n<a.length;n++){var o=a[n];i.visualContainers.push(this.serializeVisualContainer(o,r))}return i},t.prototype.serializePageShallow=function(e,t,r){var i={id:e.id,name:e.name,displayName:e.displayName,filters:this.serializeFilterContainers(e.filters),ordinal:t,visualContainers:void 0,transient:e.transient};e.size&&(i.displayOption=e.size.displayOption,i.width=e.size.width,i.height=e.size.height);var n={};if(!_.isEmpty(e.relationships)){n.relationships=[];for(var s=0,l=e.relationships;s<l.length;s++){var u=l[s],c=this.serializeRelationship(u);c&&n.relationships.push(c)}r&&r.featureUsage&&(r.featureUsage.hasVisualRelationships=!0)}var p=o.serializeObjects(e.objects,a.Section.objectDescriptors);return p&&(n.objects=p),i.config=JSON.stringify(n),i},t.prototype.serializePod=function(e){var t=this.serializePodParameters(e.parameters);return{id:e.id,name:e.name,boundSection:e.boundSection,parameters:_.isEmpty(t)?void 0:JSON.stringify(t),cortanaEnabled:e.cortanaEnabled?e.cortanaEnabled:void 0}},t.prototype.serializeVisualContainer=function(t,r,i){var n,a=this.serializeVisualContainerConfig(t,r),o=t.layouts&&t.layouts.withId(0);return n=o?{id:t.id,x:o.position.x,y:o.position.y,z:o.position.z,width:o.position.width,height:o.position.height,config:JSON.stringify(a),filters:this.serializeFilterContainers(t.filters)}:{id:t.id,config:JSON.stringify(a),filters:this.serializeFilterContainers(t.filters)},r&&r.withPopOut&&(null!=t.popOutMode&&(n.popOutMode=t.popOutMode),null!=t.detailVisualLayout&&(n.detailVisualLayout=t.detailVisualLayout)),r&&t.cachedData&&((r.withQuery||r.withData)&&(n.query=t.cachedData.queryObject?JSON.stringify(t.cachedData.queryObject):t.cachedData.query,n.dataTransforms=t.cachedData.transformsObject?e.data.services.DataViewTransformActionsSerializer.serializeTransformActions(t.cachedData.transformsObject):t.cachedData.transforms,n.dataUpdatedTime=t.cachedData.dataUpdatedTime?t.cachedData.dataUpdatedTime.toISOString():void 0),r.withData&&(n.dataBinaryBase64Encoded=t.cachedData.dataObject?jsCommon.GzipUtility.compress(JSON.stringify(t.cachedData.dataObject)):t.cachedData.data)),n},t.prototype.serializeModelExtensions=function(e){var t=this;if(e)return _.map(e,(function(e){var r={name:e.name,extends:e.extends,entities:t.serializeModelExtensionEntities(e.entities)};return r}))},t.prototype.serializeRelationship=function(e){return{source:e.source.name,target:e.target.name,type:e.type}},t.prototype.serializeVisualContainerConfig=function(e,t){var r={name:e.name,layouts:e.layouts},i=e.config;if(i&&i.singleVisual){var n=i.singleVisual,a=n.query;r.singleVisual={title:n.title,background:n.background,aspectRatio:n.aspectRatio,border:n.border,stylePresetName:n.stylePresetName,visualType:n.visualType,projections:this.serializeQueryProjections(a?a.projections:void 0),prototypeQuery:a?p.serializeQuery(a.defn):void 0},n.altText&&(this.version=f.max(this.version,l.v3_1),r.singleVisual.altText=n.altText);var s=this.serializeShowAllRoles(a?a.projections:void 0);_.isEmpty(s)||(r.singleVisual.showAllRoles=s,t&&t.featureUsage&&(t.featureUsage.hasShowAllEnabled=!0));var u=this.visualPlugins.capabilities(n.visualType);if(u){var c=o.serializeObjects(n.objects,u.objects);c&&(r.singleVisual.objects=c)}else{var d=n.objects;d&&(r.singleVisual.objects=o.serializeObjects(d,null))}}return r},t.prototype.serializeShowAllRoles=function(e){if(e){var t=_.pick(e,(function(e){return e.showAll===!0}));return _.keys(t)}},t.prototype.serializeQueryProjections=function(e){if(e){var t={};for(var r in e){var i=e[r].all(),n=e[r].activeProjectionRefs;if(i.length>0){t[r]=[];for(var a=0,o=i;a<o.length;a++){var s=o[a],l=s.queryRef,u={queryRef:l};s.format&&(u.format=s.format),_.contains(n,l)&&(u.active=!0),t[r].push(u)}}}return t}},t.prototype.serializeModelExtensionEntities=function(t){var r=this;if(e.contract)return _.map(t,(function(e){var t={name:e.name};return e.extends&&(t.extends=e.extends),e.measures&&(t.measures=r.serializeModelExtensionMeasures(e.measures)),t}))},t.prototype.serializeExpressionReferences=function(e){if(e&&(e.unrecognizedReferences||!_.isEmpty(e.measures))){var t={unrecognizedReferences:e.unrecognizedReferences};return _.isEmpty(e.measures)||(t.measures=e.measures),t}},t.prototype.serializeModelExtensionAnnotations=function(e){if(e)return _.map(e,(function(e){return{name:e.name,value:e.value}}))},t.prototype.serializeModelExtensionMeasures=function(e){var t=this;if(e)return _.map(e,(function(e){var r={name:e.name,dataType:e.dataType,expression:e.expression,errorMessage:e.errorMessage,hidden:e.hidden,references:t.serializeExpressionReferences(e.references),formulaOverride:e.formulaOverride};return e.annotations&&(r.annotations=t.serializeModelExtensionAnnotations(e.annotations)),r}))},t.prototype.serializeFilterContainers=function(e){if(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];(0!==n.howCreated||n.filter)&&t.push({name:n.name,expression:n.expression?p.serializeExpr(n.expression):void 0,filter:n.filter?p.serializeFilter(n.filter):void 0,type:a.FilterType[n.type],restatement:n.restatement,cachedDisplayNames:this.serializeFilterLabelIdPairs(n.cachedValueItems),howCreated:n.howCreated})}return t.length>0?JSON.stringify(t):void 0}},t.prototype.serializeFilterLabelIdPairs=function(e){if(e&&!(e.length<1)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];if(n.identity&&n.identity.expr){var a=o.serializeScopeIdentity(n.identity);a&&t.push({id:a,displayName:n.displayName})}}return t}},t.prototype.createVersionedElementConfig=function(e){return{version:e}},t.prototype.requireVersion=function(e,t){e.version=f.toString(f.max(e.version,t))},t.prototype.serializeResourcePackages=function(e){if(!_.isEmpty(e)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r],a=_.find(n.items,(function(e){return 5===e.type}));if(a&&void 0!==a.content){var o=_.isString(a.content)?jsCommon.JsonExtensions.tryParseJSON(a.content):a.content;o&&(o.content=void 0,a.content=JSON.stringify(o))}var s=n.items;!_.isEmpty(s)&&_.any(s,(function(e){return e.content||e.contentBlob||e.contentBlobUrl}))&&(s=_.map(s,(function(e){return _.omit(e,"content","contentBlob","contentBlobUrl")}))),t.push({resourcePackage:{id:n.id,name:n.name,type:n.type,items:s}})}return t}},t.prototype.getLayoutOptimizations=function(e){var t=this.getDistinctLayouts(e);return this.getLayoutOptimizationFromLayouts(t)},t.prototype.getLayoutOptimizationFromLayouts=function(e){for(var t=0,r=0,i=e;r<i.length;r++){var n=i[r];switch(n.id){case 1:t|=1}}return t},t.prototype.getDistinctLayouts=function(e){for(var t=e.sections,r=n.createWithId(),i=0,a=t;i<a.length;i++)for(var o=a[i],s=0,l=o.visualContainers;s<l.length;s++)for(var u=l[s],c=0,p=u.layouts;c<p.length;c++){var d=p[c];r.withId(d.id)||r.push(d)}return r},t.prototype.serializePodParameters=function(e){if(!_.isEmpty(e)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];t.push({name:n.name,boundFilter:n.boundFilter})}return t}},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(){return new a}var i=e.explore.contracts.Version,n=jsCommon.JsonExtensions;t.createExplorationUpgrader=r;var a=(function(){function e(){this.versionUpgraders=[t.v1_0.createVersionUpgrader(),t.v2_0.createVersionUpgrader(),t.v2_2.createVersionUpgrader(),t.v2_3.createVersionUpgrader(),t.v2_5.createVersionUpgrader()]}return e.prototype.upgrade=function(e,t,r){if(this.upgradeElement(e,t,r,(function(e,t){return e.upgrade(t)})))return e},e.prototype.upgradeFilterCollection=function(e,t,r){if(this.upgradeElement(e,t,r,(function(e,t){return e.upgradeFilterCollection(t)})))return e},e.prototype.getVersionUpgraders=function(){return this.versionUpgraders},e.prototype.upgradeElement=function(e,r,n,a){var o=this.getVersionedElementConfig(e),s=o.version&&_.isString(o.version)?o.version:i.ZeroStr;if(i.gt(s,t.CurrentExplorationVersion)){if(r.push({errorType:0}),!n)return}else{for(var l=0,u=this.versionUpgraders;l<u.length;l++){var c=u[l],p=c.getVersion();(i.lt(p,"2.2")||i.gt(p,s))&&a(c,e)}o.version=t.CurrentExplorationVersion,e.config=JSON.stringify(o)}return e},e.prototype.getVersionedElementConfig=function(e){var t;return e.config&&(t=n.tryParseJSON(e.config)),t||(t={version:i.ZeroStr}),t},e})()})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.CurrentExplorationVersion="3.0"})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new p}var n=e.data.services.DataViewObjectSerializer,a=e.visuals.GradientUtils,o=jsCommon.JsonExtensions,s=e.visuals.labelStyle,l=e.visuals.plugins,u=e.data.services.SemanticQuerySerializer,c=e.data.SQExprBuilder;r.createVersionUpgrader=i;var p=(function(){function r(){}return r.prototype.upgrade=function(e){if(e&&(e.filters=this.upgradeFilterContainers(e.filters),e.sections))for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.filters=this.upgradeFilterContainers(i.filters),i.visualContainers)for(var n=0,a=i.visualContainers;n<a.length;n++){var s=a[n];if(s.filters=this.upgradeFilterContainers(s.filters),s.config){var l=o.tryParseJSON(s.config);if(l&&l.singleVisual){var u=l.singleVisual,c=u.visualType||u.visualConfig.visualType;u.objects=this.upgradeVisualObjects(u.objects,c)}s.config=JSON.stringify(l)}}}},r.prototype.upgradeFilterCollection=function(e){e&&e.filters&&(e.filters=this.upgradeFilterContainers(e.filters))},r.prototype.getVersion=function(){return t.ExplorationVersions.v1_0},r.prototype.upgradeFilterContainers=function(e){if(!_.isEmpty(e)){var t=o.tryParseJSON(e);if(t)for(var r=0,i=t;r<i.length;r++){var n=i[r];this.upgradeFilterContainer(n)}return JSON.stringify(t)}},r.prototype.upgradeFilterContainer=function(e){if(!e.expression&&e.field){var t=d.fieldDef(e.field);t&&(e.expression=u.serializeExpr(t))}void 0===e.howCreated&&(e.howCreated=e.autoGenerated?0:1)},r.prototype.upgradeVisualObjects=function(e,t){switch(this.dropMalformedSelectors(e),t){case l.filledMap.name:return this.upgradeObjectsFilledMap(e);case l.card.name:return this.upgradeObjectsCard(e);case l.donutChart.name:case l.pieChart.name:return this.upgradeObjectsDonutChart(e)}return e},r.prototype.dropMalformedSelectors=function(e){if(e)for(var t in e){var r=e[t];if(r)for(var i=r.length-1;i>=0;i--){var n=r[i],a=n.selector;a&&(a.metadata||delete a.metadata,_.isEmpty(Object.keys(a))&&r.splice(i,1))}}},r.prototype.upgradeObjectsFilledMap=function(t){var r="dataPoint",i="fillRule";t||(t={});var o=t[r];o||(t[r]=o=[]);for(var s,l=0,u=o;l<u.length;l++){var c=u[l];if(!c.selector){s=c;break}}return s||(s={selector:null,properties:{}},o.push(s)),null==s.properties[i]&&(s.properties[i]=n.serializeObjectProperty(a.getDefaultFillRuleDefinition(),e.visuals.filledMapCapabilities.objects[r].properties[i])),t},r.prototype.upgradeObjectsCard=function(e){var t="cardTitle",r="categoryLabels";if(e){var i=e[t];i&&(e[r]=i,delete e[t])}return e},r.prototype.upgradeObjectsDonutChart=function(t){var r="categoryLabels",i="labels",a="labelStyle",o="show";if(t){var l,p=this.getMetadataOnceObjectDefn(t,i),d=this.getPropertyExpr(p,o),f=!!d&&u.deserializeExpr(d).value,h=this.getMetadataOnceObjectDefn(t,r);if(h){var v=this.getPropertyExpr(h,o),m=!!v&&u.deserializeExpr(v).value;f&&m?l=s.categoryAndData:f&&!m?l=s.data:!f&&m&&(l=s.category),delete t[r]}else{var g=p&&p.properties[a];g||(l=f?s.categoryAndData:s.category)}if(null!=l){var y=e.visuals.donutChartCapabilities.objects[i].properties;if(!p){var C=t[i];C||(t[i]=C=[]),p=_.find(C,(function(e){return!e.selector})),p||(p={properties:{}},C.push(p))}p.properties[o]=n.serializeObjectProperty(c.boolean(!0),y[o]),p.properties[a]=n.serializeObjectProperty(c.text(l),y[a])}return t}},r.prototype.getMetadataOnceObjectDefn=function(e,t){if(e){var r=e[t];if(!_.isEmpty(r))return _.find(r,(function(e){return!e.selector}))}},r.prototype.getPropertyExpr=function(e,t){if(e){var r=e.properties[t];if(r)return r.expr}},r})();r.VersionUpgrader=p;var d;!(function(e){function t(e){return r(e)||i(e)||n(e)||a(e)}function r(e){var t=e.aggregate;if(void 0!==t){var r=i(e)||a(e);if(r)return c.aggregate(r,t)}}function i(e){var t=e.column;if(t){var r=a(e);if(r)return c.columnRef(r,t)}}function n(e){var t=e.measure;if(t){var r=a(e);if(r)return c.measureRef(r,t)}}function a(e){return c.entity(e.schema,e.entity,e.entityVar)}e.fieldDef=t})(d||(d={}))})(r=t.v1_0||(t.v1_0={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new n}var i=jsCommon.JsonExtensions;t.createVersionUpgrader=r;var n=(function(){function t(){}return t.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var n=r[t];if(n.visualContainers)for(var a=0,o=n.visualContainers;a<o.length;a++){var s=o[a],l=void 0;if(s.config&&(l=i.tryParseJSON(s.config)),l=l||{},!l.layouts){var u={x:s.x,y:s.y,z:s.z,width:s.width,height:s.height};l.layouts=[{id:0,position:u}],s.config=JSON.stringify(l)}}}},t.prototype.upgradeFilterCollection=function(e){},t.prototype.getVersion=function(){return e.ExplorationVersions.v2_0},t})()})(t=e.v2_0||(e.v2_0={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new n}var i=jsCommon.JsonExtensions;t.createVersionUpgrader=r;var n=(function(){function t(){}return t.prototype.upgrade=function(e){},t.prototype.upgradeFilterCollection=function(e){e&&e.filters&&(e.filters=this.upgradeFilterContainers(e.filters))},t.prototype.upgradeFilterContainers=function(e){if(!_.isEmpty(e)){var t=i.tryParseJSON(e);if(t)for(var r=0,n=t;r<n.length;r++){var a=n[r];this.upgradeFilterContainer(a)}return JSON.stringify(t)}},t.prototype.upgradeFilterContainer=function(e){2!==e.howCreated||e.precedence||(e.precedence=0)},t.prototype.getVersion=function(){return e.ExplorationVersions.v2_2},t})()})(t=e.v2_2||(e.v2_2={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new c}var n=e.data.DataViewObjectDefinitions,a=e.data.services.DataViewObjectSerializer,o=jsCommon.JsonExtensions,s=e.visuals.plugins,l=e.visuals.slicerMode,u=e.data.SQExprBuilder;r.createVersionUpgrader=i;var c=(function(){function r(){}return r.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,a=i.visualContainers;n<a.length;n++){var s=a[n];if(s.config){var l=o.tryParseJSON(s.config);if(l&&l.singleVisual){var u=l.singleVisual,c=u.visualType||u.visualConfig.visualType;u.objects=this.upgradeVisualObjects(u.objects,c)}s.config=JSON.stringify(l)}}}},r.prototype.upgradeFilterCollection=function(e){},r.prototype.getVersion=function(){return t.ExplorationVersions.v2_3},r.prototype.upgradeVisualObjects=function(e,t){return t===s.slicer.name?this.upgradeSlicerObjects(e):e},r.prototype.upgradeSlicerObjects=function(t){var r="data",i="mode";t||(t={});var o=n.ensure(t,r,null),s=e.visuals.slicerCapabilities.objects[r].properties;return null==o.properties[i]&&(o.properties[i]=a.serializeObjectProperty(u.text(l.basic),s[i])),t},r})();r.VersionUpgrader=c})(r=t.v2_3||(t.v2_3={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new s}var n=e.data.DataViewObjectDefinitions,a=jsCommon.JsonExtensions,o=e.visuals.plugins;r.createVersionUpgrader=i;var s=(function(){function e(){}return e.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,o=i.visualContainers;n<o.length;n++){var s=o[n];if(s.config){var l=a.tryParseJSON(s.config);if(l&&l.singleVisual){var u=l.singleVisual,c=u.visualType||u.visualConfig.visualType;u.objects=this.upgradeVisualObjects(u.objects,c)}s.config=JSON.stringify(l)}}}},e.prototype.upgradeFilterCollection=function(e){},e.prototype.getVersion=function(){return t.ExplorationVersions.v2_5},e.prototype.upgradeVisualObjects=function(e,t){return t===o.gauge.name?this.upgradeGaugeTarget(e):e},e.prototype.upgradeGaugeTarget=function(e){var t="labels",r="target",i=["show","labelDisplayUnits","labelPrecision","color"];e||(e={});var a=n.getObjectDefinition(e,t,null);if(!a)return e;for(var o=n.ensure(e,r,null),s=0,l=i;s<l.length;s++){var u=l[s];null!=a.properties[u]&&(o.properties[u]=a.properties[u])}return e},e})();r.VersionUpgrader=s})(r=t.v2_5||(t.v2_5={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createSchemaItemActivationService=t;var r=(function(){function t(e){this.eventBridge=e}return t.prototype.setActiveItem=function(e){_.isEqual(this.activeItems,e)||(this.activeItems=e,this.raiseEvent())},t.prototype.clearActiveItem=function(){this.activeItems&&(this.activeItems=null,this.raiseEvent())},t.prototype.getActiveItem=function(){return this.activeItems},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(e.events.schemaItemActivationChanged)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.FieldExprPattern,n=e.data.SQExprConverter;!(function(e){function t(e,t){var r=n.asFieldPattern(t),o=i.toFieldExprEntityItemPattern(r),s=o.schema,l=o.entity,u=a.createActiveSchemaItem(s,l,r);e.setActiveItem(u)}e.setActiveSchemaItem=t})(r=t.schemaItemActivationUtils||(t.schemaItemActivationUtils={}));var a;!(function(e){function t(e,t,r){var n=i.getPropertyName(r),a=i.getHierarchyName(r)||r.hierarchyLevel&&r.hierarchyLevel.name,s=r.hierarchyLevel&&r.hierarchyLevel.level;return new o(e,t,n,a,s)}e.createActiveSchemaItem=t})(a=t.ActiveSchemaItemFactory||(t.ActiveSchemaItemFactory={}));var o=(function(){function e(e,t,r,i,n){this._schema=e,this._entity=t,this._property=r,this._hierarchy=i,this._hierarchyLevel=n}return Object.defineProperty(e.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"property",{get:function(){return this._property},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hierarchy",{get:function(){return this._hierarchy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hierarchyLevel",{get:function(){return this._hierarchyLevel},enumerable:!0,configurable:!0}),e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new a(e)}var n=e.explore.schemaRewriterUtils;r.createSchemaChangeHandler=i;var a=(function(){function e(e){this.visualPluginService=e}return e.prototype.apply=function(e,r){var i=n.createSchemaChangeRewriters(r),a=new o(i);t.util.traverseExploration(e,a,this.visualPluginService)},e})(),o=(function(e){function t(t){var r=this;return r=e.call(this,new s(t))||this}return __extends(t,e),t})(t.util.DefaultExplorationVisitor),s=(function(e){function t(t){var r=this;return r=e.call(this,t)||this}return __extends(t,e),t.prototype.visitSingleVisualConfig=function(e){e.conversionSourceContext=void 0},t})(t.util.VisualContainerRewriter);r.SchemaChangeVisualContainerRewriter=s})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new i(e,t)}var r={updateUrl:!0,action:e.SectionNavigationAction.Unknown};e.createExplorationNavigationService=t;var i=(function(){function t(e,t){this.eventBridge=t,this.explorationProxy=e}return t.prototype.goto=function(t,i){if(i=i?_.merge(r,i):r,this.currentSection=t,this.raiseEvent(),i.updateUrl){var n={name:t.name,displayName:t.displayName,action:i.action};this.eventBridge.publishToChannel(e.events.sectionChanged,n)}},t.prototype.loadExploration=function(e){this.exploration=e,this.raiseExplorationLoadedEvent(e)},t.prototype.getCurrentSection=function(){return this.currentSection},t.prototype.getAllSections=function(){return this.exploration.sections},t.prototype.getCurrentExploration=function(){return this.exploration},t.prototype.getCurrentExplorationAsync=function(){var e=this,t={id:this.exploration.reportId};return this.explorationProxy.get(t).then((function(t){return e.exploration.report=t.report,t}))},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(e.events.canvasChanged)},t.prototype.raiseExplorationLoadedEvent=function(t){this.eventBridge.publishToChannel(e.events.explorationLoaded,t)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r){return new n(e,t,r)}e.createReportTileService=t;var r=10,i=2,n=(function(){function e(e,t,r){this.promiseFactory=e,this.explorationProxy=t,this.timeout=r,this.explorationJobsQueue=[],this.inProgressJobsQueue=[]}return e.prototype.getExploration=function(e,t){var r=this.promiseFactory.defer();return this.explorationJobsQueue.push({reportId:e,sectionId:t,deferred:r}),this.scheduleLoadExploration(),r.promise},e.prototype.scheduleLoadExploration=function(){var e=this;this.delayTimeout&&this.timeout.cancel(this.delayTimeout),
this.delayTimeout=this.timeout((function(){e.loadExplorations()}),r)},e.prototype.loadExplorations=function(){var e=this,t=this.explorationJobsQueue;if(!_.isEmpty(t)){var r=t.shift();this.inProgressJobsQueue.push(r);var i=this.shouldRequestForAllSection(r.reportId,r.sectionId),n=r.reportId,a=i?null:r.sectionId;i&&(this.inProgressJobsQueue=this.inProgressJobsQueue.concat(_.remove(t,(function(e){return e.reportId===n}))));var o={id:n,sectionId:a,allowCache:!0};this.explorationProxy.get(o).then((function(t){e.processResult(o.id,o.sectionId,t)}),(function(){e.processResult(o.id,o.sectionId,null)})),this.loadExplorations()}},e.prototype.processResult=function(e,t,r){for(var i=[],n=0,a=this.inProgressJobsQueue;n<a.length;n++){var o=a[n];o.reportId!==e||_.isNumber(t)&&t!==o.sectionId?i.push(o):r?o.deferred.resolve(r):o.deferred.reject(r)}this.inProgressJobsQueue=i},e.prototype.shouldRequestForAllSection=function(e,t){if(null==t)return!0;var r=this.explorationJobsQueue;if(_.isEmpty(r))return!1;for(var n=0,a=0,o=r;a<o.length;a++){var s=o[a];if(s.reportId===e){if(null==s.sectionId)return!0;if(s.sectionId!==t&&n++,n>=i)return!0}}return!1},e})();e.ReportTileService=n})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){var n=r.createSelectableVisualContainer(e);t.selectElement(n,i)}function i(e,t){var r=o(t);_.contains(r,e)&&n(_.without(r,e),t)}function n(e,t){var i=_.map(e,(function(e){return r.createSelectableVisualContainer(e)}));t.selectElements(i)}function a(e,t){var r=o(t);return _.contains(r,e)}function o(e){return _.chain(e.getSelectedElements()).map((function(e){return e.visualContainer})).compact().value()}function s(e){return o(e).length>1}function l(e){var t=o(e);if(1===t.length)return t[0]}function u(e){var t=o(e);if(t.length>1)for(var r=t[0].config.singleVisual.visualType,i=1,n=t.length;i<n;i++)if(t[i].config.singleVisual.visualType!==r)return null;return t[0]}e.selectVisualContainer=t,e.unselectVisualContainer=i,e.selectVisualContainers=n,e.isVisualContainerSelected=a,e.getSelectedVisuals=o,e.hasMultipleVisualContainerSelection=s,e.getSelectedVisual=l,e.getDefaultSelectedVisualInSingleOrMultiCase=u})(t=e.selectionUtils||(e.selectionUtils={}));var r;!(function(e){function t(e){return n.createFromVisualContainer(e)}e.createSelectableVisualContainer=t})(r=e.SelectableItemFactory||(e.SelectableItemFactory={}));var i;!(function(e){function t(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(!n.equals(e[r],t[r]))return!1;return!0}e.equals=t})(i=e.SelectableUtils||(e.SelectableUtils={}));var n=(function(){function e(){}return Object.defineProperty(e.prototype,"id",{get:function(){if(this._visualContainer)return this._visualContainer.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visualContainer",{get:function(){return this._visualContainer},enumerable:!0,configurable:!0}),e.createFromVisualContainer=function(t){var r=new e;return r._visualContainer=t,r},e.equals=function(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.id===t.id&&e.visualContainer===t.visualContainer)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n){return new a(e,t,r,i,n)}var i=e.common.contracts.TenantType,n=e.explore.util.VisualContainerUtils;t.createScriptVisualsService=r;var a=(function(){function e(e,t,r,i,n){this.services={visualPlugin:e,featureSwitchService:t,localizationService:r,userInfo:i,embedModeService:n},this.services.embedModeService.isAppTokenEmbed()&&(this.services.featureSwitchService.featureSwitches.rScriptVisualEnabled=!0)}return e.prototype.addScriptVisualId=function(e,t){var r=n.getVisualType(e);this.services.visualPlugin.isScriptVisual(r)&&e.id&&t.push(e.id)},e.prototype.showEnableScriptVisualDialogIfRequired=function(e,t,r){return!1},e.prototype.getScriptVisualErrorDetails=function(){var e,t=this,r=this.services.localizationService,i=this.services.featureSwitchService.featureSwitches;return r.ensureLocalization((function(){if(i.scriptVisualEnabled){var n=t.services.embedModeService.isAnonymousLiveEmbed();if(n)return void(i.scriptVisualAnonymousEmbeddingEnabled||(e=t.buildErrorDetails(r.get("RError_RVisualsNotSupportedInEmbedReports"))));var a=t.getUserInfoForErrorDetails();a&&a.isViralTenant?e=t.buildErrorDetails(r.get("RError_RVisualsNotSupportedForViralTenant")):i.rScriptVisualEnabled===!1?e=t.buildErrorDetails(r.get("RError_RVisualsDisabledByAdmin")):a&&!a.isPremiumUser&&(e=t.buildErrorDetails(r.get("RError_RVisualsIsProFeature")))}else e=t.buildErrorDetails(r.get("RError_RVisualsNotSupported"))})),e},e.prototype.overrideEmbeddedErrorDetails=function(e){var t=this.services.embedModeService.isAppTokenEmbed()||this.services.embedModeService.isSaasEmbed(),r=this.services&&this.services.localizationService;if(t&&e){var i=e,n=[{errorInfoKey:r.get("RError_RVisualsEmbeddedText"),errorInfoValue:r.get("RError_RVisualsErrorInEmbedReports")}];return i.message=r.get("RError_RVisualsEmbeddedText"),i.displayableErrorInfo=n,i.helpLink="",i}},e.prototype.shouldBlockScriptVisual=function(){var e=this.services.featureSwitchService.featureSwitches,t=this.getUserInfoForErrorDetails(),r=this.services.embedModeService.isAnonymousLiveEmbed();return r?!e.scriptVisualAnonymousEmbeddingEnabled||!e.scriptVisualEnabled:!e.scriptVisualEnabled||t&&t.isViralTenant||!e.rScriptVisualEnabled||t&&!t.isPremiumUser},e.prototype.canLaunchExternalIDE=function(){return!1},e.prototype.launchExternalIDE=function(e){return null},e.prototype.openOptionsDialog=function(){return null},e.prototype.refreshRCustomVisuals=function(e){},e.prototype.buildErrorDetails=function(e){return{message:e,displayableErrorInfo:[],helpLink:"https://go.microsoft.com/fwlink/?linkid=829101",errorType:1}},e.prototype.getUserInfoForErrorDetails=function(){var e=this.services.userInfo;if(e&&!Array.isArray(e)){var t=e.userMetadata&&e.userMetadata.tenantMetadata&&e.userMetadata.tenantMetadata.tenantType===i.ViralTenant;return{isViralTenant:t,isPremiumUser:e.isPremiumUser}}},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new i(e)}var r=jsCommon.ArrayExtensions;e.createSelectionService=t;var i=(function(){function t(e){this.eventBridge=e,this.selectedElements=r.createWithId()}return t.prototype.selectElement=function(e,t){this.selectElements([e],t)},t.prototype.selectElements=function(t,r){if(!e.SelectableUtils.equals(t,this.selectedElements)){if(r||this.clearSelectionCore(!1),this.selectedElements.length){for(var i=this.selectedElements.length,n=0;n<i;n++)if(this.selectedElements[n]===t[0]){this.selectedElements.splice(n,1);break}i===this.selectedElements.length&&this.addISelectable(t)}else this.addISelectable(t);this.raiseEvent()}},t.prototype.clearSelection=function(){this.clearSelectionCore(!0)},t.prototype.addISelectable=function(e){this.selectedElements=r.extendWithId(this.selectedElements.concat(e))},t.prototype.clearSelectionCore=function(e){this.selectedElements=r.createWithId(),e&&this.raiseEvent()},t.prototype.getSelectedElements=function(){return this.selectedElements},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(e.events.selectionChanged)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,a,o,s,l,u,c){return new n(e,t,r,i,a,o,s,l,u,c)}r.createEmbedService=i;var n=(function(){function r(e,t,r,i,n,a,o,s,l,u){this.locationService=e,this.promiseFactory=t,this.explorationSerializer=r,this.conceptualSchemaProxy=i,this.visualQueryGenerator=n,this.dataProxy=a,this.visualPlugin=o,this.displayNameService=s,this.filterGenerator=l,this.activeGroupId=u}return r.prototype.createEmbedUri=function(e){switch(e.embedType){case t.contracts.EmbedType.Interactive:return this.createInteractiveEmbedUri(e);default:return this.createStaticEmbedUri(e)}},r.prototype.createSharepointEmbedUri=function(t){var i=this.locationService.host(),n=r.protocol.concat(i),a=this.activeGroupId.activeGroupObjectId,o=r.sharePointEmbedHostPathEncodedReport+t;a&&a!==e.common.constants.myWorkspaceGroupId&&(o=o+r.sharePointEmbedHostPathGroupId+a);var s=jsCommon.Utility.urlCombine(n,o);return s},r.prototype.createInteractiveEmbedUri=function(t){var i=t.snapshotId,n=this.locationService.host(),a=r.protocol.concat(n),o=e.common.ClusterLocationHelper.getClusterIndexForClusterUri(),s="";o&&(s="&c="+o);var l=void 0,u=void 0,c=window.tenantId;if(c&&i){var p={k:i,t:c,c:o};l=btoa(JSON.stringify(p)),u=jsCommon.Utility.urlCombine(a,r.interactiveEmbedHostPathEncodedReport+encodeURIComponent(l))}else u=jsCommon.Utility.urlCombine(a,r.interactiveEmbedHostPath+encodeURIComponent(i)+s);return u},r.prototype.createStaticEmbedUri=function(e){var t={storageHost:e.resourceUri,cultureInfo:e.culture},i=btoa(JSON.stringify(t));if(!e.hostUri){var n=this.locationService.host().split(".");n&&n.length>0&&(e.hostUri=r.protocol.concat(n[0].concat(r.blobHostSuffix)))}var a=jsCommon.Utility.urlCombine(e.hostUri,r.embedHostPath+i);return a},r.prototype.createEmbedCode=function(e){var t=this.createEmbedUri(e);return'<iframe width="'+e.size.width+'" height="'+e.size.height+'" src="'+t+'" frameborder="0" allowFullScreen="true"></iframe>'},r.prototype.createEmbedReportResource=function(t,r,i){var n=this,a=this.promiseFactory.defer();return this.conceptualSchemaProxy.getWithWireContract(t.dataSources).then((function(o){var s=[],l=_.filter(t.sections,(function(e){return _.contains(r,e.id)}));if(l.length!==r.length)return void a.reject(null);for(var u=0,c=l;u<c.length;u++)for(var p=c[u],d=0,f=p.visualContainers;d<f.length;d++){var h=f[d];(!h.cachedData||i&&i.ignoreExistingCache)&&s.push(n.prepareVisualContainer(o.contract,t,p,h))}n.waitForAll(s).then((function(){var s=n.explorationSerializer.serializeExploration(t,{withData:!0});s.sections=_.filter(s.sections,(function(e){return _.contains(r,e.id)}));var l={conceptualSchemaResponse:o.data,exploration:s,clientVersion:e.build,reportSections:r,enableShareLink:i&&i.enableShareLink,dependencyVersions:{jquery:$.fn.jquery,"jquery-ui":$.ui.version,globalize:"0.1.1"}};a.resolve(l)}))})),a.promise},r.prototype.prepareVisualContainer=function(e,r,i,n){var a=this,o={config:n.config.singleVisual,dataSources:r.dataSources,schema:e,additionalFilters:this.filterGenerator.calculateVisualContainerFilter(r,i,n,e)},s=this.visualQueryGenerator.execute(o);return s?this.dataProxy.execute(s.options).then((function(r){var i=r&&r.dataViewSource?r.dataViewSource.data:void 0;n.cachedData=t.util.VisualContainerUtils.createCacheEntry(a.visualPlugin,a.displayNameService,i,s,e,n.config.singleVisual,a.filterGenerator.generateFilterMetadata(n.filters))})):this.promiseFactory.resolve(null)},r.prototype.waitForAll=function(e){var t=null;t=e.length>0?this.waitForBoth(this.promiseFactory.resolve(null),e[0]):this.promiseFactory.resolve(null);for(var r=1;r<e.length;r++)t=this.waitForBoth(t,e[r]);return t},r.prototype.waitForBoth=function(e,t){var r=this.promiseFactory.defer();return e.then((function(){return t.then((function(){return r.resolve(null)}))})),r.promise},r})();n.embedHostPath="embed/snapshotEmbedHost.html?embedId=",n.interactiveEmbedHostPath="view?key=",n.interactiveEmbedHostPathEncodedReport="view?r=",n.sharePointEmbedHostPathEncodedReport="reportEmbed?reportId=",n.sharePointEmbedHostPathGroupId="&groupId=",n.blobHostSuffix=".blob.core.windows.net/",n.protocol="https://",r.EmbedService=n})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,o){return new n(e,r,t,new a(e,i,o))}var i=e.visualHost.visualPluginServiceHelpers.VisualPluginStorage;t.createExplorationVisualPluginService=r;var n=(function(){function t(t,r,n,o){var s=this;this.asyncFeatureSwitchService=t,this.resourceLoader=r,this.promiseFactory=n,this.resourceLoader=r,this.promiseFactory=n,this.trustedConvertibleVisualTypes=[],this.customConvertibleVisualTypes=[],this.storage=new i,this.initBuiltInPlugins=this.asyncFeatureSwitchService.getFeatureSwitches().then((function(r){o=o||new a(t),s.globalConvertibleVisualTypes=s.getConvertibleCoreVisualTypeNames(r);for(var i in e.visuals.plugins)s.storage.loadPlugin(i,o.getPlugin(i))}))}return t.prototype.getConvertibleCoreVisualTypeNames=function(t){var r=[e.visuals.plugins.barChart.name,e.visuals.plugins.columnChart.name,e.visuals.plugins.clusteredBarChart.name,e.visuals.plugins.clusteredColumnChart.name,e.visuals.plugins.hundredPercentStackedBarChart.name,e.visuals.plugins.hundredPercentStackedColumnChart.name,e.visuals.plugins.lineChart.name,e.visuals.plugins.areaChart.name,e.visuals.plugins.stackedAreaChart.name,e.visuals.plugins.lineStackedColumnComboChart.name,e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.waterfallChart.name,e.visuals.plugins.scatterChart.name,e.visuals.plugins.pieChart.name,e.visuals.plugins.treemap.name,e.visuals.plugins.map.name,e.visuals.plugins.table.name,e.visuals.plugins.matrix.name,e.visuals.plugins.filledMap.name,e.visuals.plugins.funnel.name,e.visuals.plugins.gauge.name,e.visuals.plugins.multiRowCard.name,e.visuals.plugins.card.name,e.visuals.plugins.kpi.name,e.visuals.plugins.slicer.name,e.visuals.plugins.donutChart.name];t&&(t.scriptVisualEnabled&&t.scriptVisualAuthoringEnabled&&r.push(e.visuals.plugins.scriptVisual.name),t.dataDotChartEnabled&&(r.push(e.visuals.plugins.dataDotClusteredColumnComboChart.name),r.push(e.visuals.plugins.dataDotStackedColumnComboChart.name)),t.sunburstVisualEnabled&&r.push(e.visuals.plugins.sunburst.name),t.shapeMapVisualEnabled&&r.push(e.visuals.plugins.shapeMap.name),t.pivotTableVisualEnabled&&(r.push(e.visuals.plugins.tableEx.name),r.push(e.visuals.plugins.pivotTable.name)));var i=e.localStorageService.getData("DEVELOPER_MODE_ENABLED");return i&&r.push(e.visuals.plugins.debugVisual.name),r},t.prototype.getVisuals=function(){return this.storage.getLoadedPlugins()},t.prototype.getConvertibleVisuals=function(){for(var e=this,t=[],r=0,i=this.globalConvertibleVisualTypes;r<i.length;r++){var n=i[r];this.storage.hasPlugin(n)&&t.push(n)}for(var a=0,o=this.customConvertibleVisualTypes;a<o.length;a++){var s=o[a];this.storage.hasPlugin(s)&&t.push(s)}for(var l=0,u=this.trustedConvertibleVisualTypes;l<u.length;l++){var c=u[l];this.storage.hasPlugin(c)&&t.push(c)}return t.map((function(t){return e.storage.getLoadedPlugin(t)}))},t.prototype.ensureBuiltInPlugins=function(){return this.initBuiltInPlugins},t.prototype.ensureTrustedVisualPlugins=function(e){i.ensureTrustedVisualPlugins(this.storage,e);for(var t=0,r=e;t<r.length;t++){var n=r[t];this.addTrustedConvertibleVisualType(n.name)}},t.prototype.ensurePlugins=function(e,t){var r=this,i=[];if(e&&e.length)for(var n=function(e){if(0===e.type){var n=a.ensurePlugin(e,t).then((function(){return r.addCustomConvertibleVisualType(e.name)}));i.push(n)}},a=this,o=0,s=e;o<s.length;o++){var l=s[o];n(l)}return this.promiseFactory.allSettled(i)},t.prototype.ensurePlugin=function(e,t){return i.ensurePlugin(this.storage,this.promiseFactory,this.resourceLoader,e,t)},t.prototype.addTrustedConvertibleVisualType=function(e){this.trustedConvertibleVisualTypes.indexOf(e)<0&&this.trustedConvertibleVisualTypes.push(e)},t.prototype.addCustomConvertibleVisualType=function(e){this.customConvertibleVisualTypes.indexOf(e)<0&&this.customConvertibleVisualTypes.push(e)},t.prototype.capabilities=function(e){var t=this.getPlugin(e);return t?t.capabilities:void 0},t.prototype.removeAllCustomVisuals=function(){for(var e=0,t=this.customConvertibleVisualTypes;e<t.length;e++){var r=t[e];this.storage.unloadPlugin(r)}this.customConvertibleVisualTypes=[]},t.prototype.removePlugin=function(e){var t=this.getPlugin(e);t&&(this.storage.unloadPlugin(e),_.remove(this.customConvertibleVisualTypes,(function(t){return t===e})))},t.prototype.getTelemetryHostInformation=function(){return{name:"Exploration"}},t.prototype.isCustomVisual=function(t){return e.visualHost.utils.isCustomVisual(this.getPlugin(t),t)},t.prototype.isScriptVisual=function(t){return e.visualHost.utils.isScriptVisual(this.getPlugin(t))},t.prototype.isScriptVisualQueryable=function(){return e.visualHost.utils.isScriptVisualQueryable(this.asyncFeatureSwitchService.featureSwitches)},t.prototype.isLightWeightRenderingVisual=function(t){return e.visualHost.utils.isLightWeightRenderingVisual(this.getPlugin(t))},t.prototype.getInteractivityOptions=function(){return{overflow:"hidden",isVisualInteractive:!0}},t.prototype.loadPluginByNameIfAny=function(t){if(!this.getPlugin(t))return this.storage.hasPlugin(t)?void this.storage.loadPlugin(t):void(e.visuals.plugins[t]&&this.storage.loadPlugin(t,e.visuals.plugins[t]))},t.prototype.getPlugin=function(e){return this.storage.getLoadedPlugin(e)},t.prototype.getStorage=function(){return this.storage},t})();t.ExplorationVisualPluginService=n;var a=(function(){function t(e,t,r){this.featureSwitchService=e,this.mapControlFactory=t,this.visualSandbox=r}return t.prototype.getPlugin=function(t){var r=this,i=this.featureSwitchService.featureSwitches,n=i&&i.forecastEnabled,a=!!i&&i.numericSlicerEnabled,o=!!i&&i.relativeDateSlicer,s=i&&i.improvedMapLegend;e.visuals.Slicer.NumericSlicerEnabled=a,e.visuals.Slicer.RelativeDateSlicerEnabled=o;var l=i&&i.axisControlImprovements,u=i&&i.donutChartLabelPercentEnabled,c=i&&i.responsiveVisualEnabled,p=i&&i.customFontFamily,d=i&&i.binnedLineSampling;switch(t){case e.visuals.plugins.barChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.barChart,(function(){return new e.visuals.CartesianChart({chartType:6,isScrollable:!0,animator:new e.visuals.WebColumnChartAnimator,tooltipsEnabled:!0,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:l,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c})})}),i);case e.visuals.plugins.card.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.card,(function(){return new e.visuals.Card({isScrollable:!0,animator:new e.visuals.BaseAnimator})}),i);case e.visuals.plugins.clusteredBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.clusteredBarChart,(function(){return new e.visuals.CartesianChart({chartType:5,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:l,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c})})}),i);case e.visuals.plugins.clusteredColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.clusteredColumnChart,(function(){return new e.visuals.CartesianChart({chartType:3,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:l,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c})})}),i);case e.visuals.plugins.columnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.columnChart,(function(){return new e.visuals.CartesianChart({chartType:4,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:l,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c})})}),i);case e.visuals.plugins.dataDotClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.dataDotClusteredColumnComboChart,(function(){return new e.visuals.CartesianChart({chartType:15,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior,new e.visuals.DataDotChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c})})}),i);case e.visuals.plugins.dataDotStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.dataDotStackedColumnComboChart,(function(){return new e.visuals.CartesianChart({chartType:16,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior,new e.visuals.DataDotChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c})})}),i);case e.visuals.plugins.donutChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.donutChart,(function(){return new e.visuals.DonutChart({animator:new e.visuals.WebDonutChartAnimator,isScrollable:!0,tooltipsEnabled:!0,donutChartLabelPercentEnabled:u,behavior:new e.visuals.DonutChartWebBehavior,customFontFamily:p})}),i);case e.visuals.plugins.funnel.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.funnel,(function(){return new e.visuals.FunnelChart({animator:new e.visuals.WebFunnelAnimator,behavior:new e.visuals.FunnelWebBehavior,tooltipsEnabled:!0,axisControlImprovements:l})}),i);case e.visuals.plugins.gauge.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.gauge,(function(){return new e.visuals.Gauge({animator:new e.visuals.BaseAnimator,tooltipsEnabled:!0})}),i);case e.visuals.plugins.hundredPercentStackedBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.hundredPercentStackedBarChart,(function(){return new e.visuals.CartesianChart({chartType:7,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:l,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c})})}),i);case e.visuals.plugins.hundredPercentStackedColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.hundredPercentStackedColumnChart,(function(){return new e.visuals.CartesianChart({chartType:8,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:l,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c})})}),i);case e.visuals.plugins.lineChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineChart,(function(){return new e.visuals.CartesianChart({chartType:0,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.LineChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,forecastEnabled:n,axisControlImprovements:l,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c}),binnedLineSamplingSupported:d})}),i);case e.visuals.plugins.areaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.areaChart,(function(){return new e.visuals.CartesianChart({chartType:1,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.LineChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:l,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c}),binnedLineSamplingSupported:d})}),i);case e.visuals.plugins.stackedAreaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.stackedAreaChart,(function(){return new e.visuals.CartesianChart({chartType:2,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.LineChartWebBehavior]),axisControlImprovements:l,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c}),binnedLineSamplingSupported:d})}),i);case e.visuals.plugins.lineClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineClusteredColumnComboChart,(function(){return new e.visuals.CartesianChart({chartType:13,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior,new e.visuals.LineChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:l,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c})})}),i);case e.visuals.plugins.lineStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineStackedColumnComboChart,(function(){return new e.visuals.CartesianChart({chartType:14,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior,new e.visuals.LineChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:l,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c})})}),i);case e.visuals.plugins.pieChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pieChart,(function(){return new e.visuals.DonutChart({sliceWidthRatio:0,animator:new e.visuals.WebDonutChartAnimator,isScrollable:!0,tooltipsEnabled:!0,donutChartLabelPercentEnabled:u,behavior:new e.visuals.DonutChartWebBehavior,customFontFamily:p})}),i);case e.visuals.plugins.scatterChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.scatterChart,(function(){return new e.visuals.CartesianChart({chartType:9,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ScatterChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,lassoSelectEnabled:i&&i.lassoSelectEnabled,axisControlImprovements:l,responsiveVisualEnabled:c,customFontFamily:p,scatterWithMatrixDV:i&&i.scatterWithMatrixDV,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c})})}),i);case e.visuals.plugins.treemap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.treemap,(function(e){var t=e.module;return new t.Treemap({animator:t.webAnimator(),isScrollable:!0,behavior:t.webBehavior(),tooltipsEnabled:!0,customFontFamily:p})}),i);case e.visuals.plugins.sunburst.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.sunburst,(function(e){var t=e.module;return new t.Sunburst({isScrollable:!0,behavior:t.behavior()})}),i);case e.visuals.plugins.waterfallChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.waterfallChart,(function(){return new e.visuals.CartesianChart({chartType:12,isScrollable:!0,tooltipsEnabled:!0,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.WaterfallChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:l,responsiveVisualEnabled:c,customFontFamily:p,viewModelAdapter:new e.visuals.CartesianViewModelAdapter({responsiveVisualEnabled:c})})}),i);case e.visuals.plugins.map.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.applyImprovedMapLegendMappings(e.visuals.plugins.map,s,!1),(function(){return new e.visuals.Map({behavior:new e.visuals.MapBehavior,tooltipsEnabled:!0,isLegendScrollable:!0,mapControlFactory:r.mapControlFactory,customFontFamily:p})}),i);case e.visuals.plugins.filledMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.applyImprovedMapLegendMappings(e.visuals.plugins.filledMap,s,!0),(function(){return new e.visuals.Map({filledMap:!0,behavior:new e.visuals.MapBehavior,tooltipsEnabled:!0,filledMapDataLabelsEnabled:i&&i.filledMapDataLabelsEnabled,isLegendScrollable:!0,mapControlFactory:r.mapControlFactory,customFontFamily:p})}),i);case e.visuals.plugins.shapeMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.shapeMap,(function(e){var t=e.module;return new t.ShapeMap({behavior:new t.ShapeMapBehavior,tooltipsEnabled:!0,customFontFamily:p})}),i);case e.visuals.plugins.slicer.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.slicer,(function(){return new e.visuals.Slicer({behavior:new e.visuals.SlicerWebBehavior})}),i);case e.visuals.plugins.matrix.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.matrix,(function(){return new e.visuals.Matrix({})}),i);case e.visuals.plugins.table.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.table,(function(){return new e.visuals.Table({})}),i);case e.visuals.plugins.pivotTable.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pivotTable,(function(){return new e.visuals.PivotTable((void 0),i&&i.pivotTableDataBars)}),i);case e.visuals.plugins.tableEx.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.tableEx,(function(){return new e.visuals.TableEx((void 0),i&&i.pivotTableDataBars)}),i);case e.visuals.plugins.scriptVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.scriptVisual,(function(){return new e.visuals.ScriptVisual}),i);case e.visuals.plugins.debugVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.debugVisual,(function(){return new e.visuals.system.DebugVisual(r.visualSandbox)}),i);case e.visuals.plugins.textbox.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.textbox,(function(){return new e.visuals.Textbox({textboxFontColorEnabled:i&&i.textboxFontColorEnabled})}),i);default:
return e.Prototype.inherit(e.visuals.plugins[t])}},t})();t.ExplorationVisualPluginProvider=a})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n,a,o,s,l,u,c,p){return new v(e,t,r,o,s,u,a,i,n,l,c,p)}function i(e,t,r){for(var i=[],n=[],a=l.getExpectedModelExtension(e,t),o=0,s=a.entities;o<s.length;o++)for(var u=s[o],c=0,p=u.measures;c<p.length;c++){var d=p[c];d.references.unrecognizedReferences&&(n.push(d),i.push({context:{schema:a.name,entity:u.name,property:d.name},expression:d.expression}))}if(_.any(i))for(var f=r.getMeasureReferences(e.modelExtensions,i),h=0;h<f.length;h++)n[h].references={unrecognizedReferences:f[h].unrecognizedReferences,measures:f[h].measures}}function n(e,t,r,i,n){var a=n.getMeasureReferences(e.modelExtensions,{context:{schema:t,entity:r,property:i.name},expression:i.expression});i.references={unrecognizedReferences:a.unrecognizedReferences,measures:a.measures}}function a(e,t,r,i){for(var n=[],a=[],o=0,s=e.entities;o<s.length;o++)for(var l=s[o],u=0,c=l.measures;u<c.length;u++){var p=c[u],d=_.findIndex(p.references.measures,t);d!==-1&&(a.push(p),n.push({context:{schema:e.name,entity:l.name,property:p.name},expression:p.expression}),r?p.references.measures[d]=r:p.references.measures.splice(d,1))}if(i)for(var f=i(n),h=0;h<f.length;h++)a[h].expression=f[h]}var o=e.data.dsr,s=e.common.dialog.MessageDialogBuilder,l=e.explore.util.ModelExtensionUtils,u=e.explore.util.FormatUtils,c=e.explore.util.NameValidationError,p=e.data.contracts.SchemaChangeType.ObjectTypeEnum,d=e.data.contracts.primitiveTypeFromDataType,f={changes:[],isSchemaChangeListComplete:!0};t.createModelAuthoringService=r;var h;!(function(e){e.isNew="43dbc3e8-3a1c-4b6f-9923-b49ff7d6691c"})(h||(h={}));var v=(function(){function t(e,t,r,i,n,a,o,s,l,u,c,p){this.promiseFactory=e,this.telemetryService=t,this.modelChangeHandler=r,this.dataSourcesService=i,this.conceptualSchemaProxy=n,this.explorationSerializer=a,this.explorationNavigationService=o,o&&(this.services={cultureService:c,daxParserService:u,localizationService:l,promiseFactory:this.promiseFactory,telemetryService:this.telemetryService,modelAuthoringDialogService:new m(s,p)})}return t.prototype.apply=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.tryApply(t)];case 1:return e=r.sent(),[2]}}))}))},t.prototype.tryApply=function(e){var r=this;return this.lastChange=t.continueTaskUnconditionally(this.lastChange,(function(){return r.tryApplyCore(e)})),this.lastChange},t.prototype.tryApplyCore=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e,i,n,a,o,s,l,u,c=this;return __generator(this,(function(p){switch(p.label){case 0:return this.services?(e=_.map(r.changes,(function(e){return c.getSchemaChangeExecutor(e)})),e=_.filter(e,(function(e){return e&&e.canExecute()})),e.length>0?(i=r.changes[0],n=e[0],this.logTelemetry(i),[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())]):[3,6]):[3,6];case 1:a=p.sent(),o=this.explorationNavigationService.getCurrentExploration(),s=void 0,o.modelExtensions&&(s=this.explorationSerializer.serializeModelExtensions(o.modelExtensions)),this.onBeginModelChange(),l=f,p.label=2;case 2:return p.trys.push([2,4,5,6]),[4,n.execute(this.services,a,o)];case 3:return l=p.sent(),[2,!0];case 4:if(u=p.sent(),o.modelExtensions=s?this.explorationSerializer.deserializeModelExtensions(s):void 0,t.isHandledAuthoringError(u))return[2,!0];throw u;case 5:return this.onEndModelChange(l),[7];case 6:return[2,!1]}}))}))},t.prototype.onBeginModelChange=function(){this.pendingModelChangeDefer=this.promiseFactory.defer(),this.modelChangeHandler.applyChange({change:this.pendingModelChangeDefer.promise})},t.prototype.onEndModelChange=function(e){this.pendingModelChangeDefer.resolve(e),this.pendingModelChangeDefer=null},t.prototype.getSchemaChangeExecutor=function(e){return e.newMeasure?new y(e.newMeasure):e.propertyRename?new C(e.propertyRename):e.itemDelete?new b(e.itemDelete):e.updateCalculation?new S(e.updateCalculation):e.measureMove?new x(e.measureMove):e.setAnnotation?new E(e.setAnnotation):e.itemShowHide?new w(e.itemShowHide):e.setDataType?new F(e.setDataType):e.setFormatting?new P(e.setFormatting):e.toggleThousandsSeparator?new D(e.toggleThousandsSeparator):e.setDecimalPlaces?new V(e.setDecimalPlaces):e.setDateTimeFormatInfo?new R(e.setDateTimeFormatInfo):e.setCurrencyFormatInfo?new T(e.setCurrencyFormatInfo):void 0},t.prototype.logTelemetry=function(t){var r=Object.getOwnPropertyNames(t);this.telemetryService.logEvent(e.telemetry.EXModelChange,r[0])},t.createHandledAuthoringError=function(){var e=new Error;return e.suppressExceptionHandler=!0,e},t.isHandledAuthoringError=function(e){return e.suppressExceptionHandler},t.continueTaskUnconditionally=function(t,r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:if(!t)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t];case 2:return i.sent(),[3,4];case 3:return e=i.sent(),[3,4];case 4:return[4,r()];case 5:return[2,i.sent()]}}))}))},t})();t.ModelAuthoringService=v;var m=(function(){function t(e,t){this.modalDialogService=e,this.uiBlockingService=t}return t.prototype.showDialog=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:this.uiBlockingService.beginAllowModalDialogs(),r.label=1;case 1:return r.trys.push([1,,3,4]),e=new s(this.modalDialogService),[4,e.show("model authoring message",t)];case 2:return[2,r.sent()];case 3:return this.uiBlockingService.endAllowModalDialogs(),[7];case 4:return[2]}}))}))},t})(),g=(function(){function e(e){this.schemaChangeBase=e}return e.prototype.canExecute=function(){return!!this.schemaChangeBase.schema},e.prototype.showMessage=function(e,t,r){var i={okButtonText:e.localizationService.get("OK_ButtonText"),hideCancelButton:!0,titleText:t,messageText:r};return e.modelAuthoringDialogService.showDialog(i)},e})(),y=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,n){return __awaiter(this,void 0,e.Promise,(function(){var a,s,c,p,d,f,v,m,g;return __generator(this,(function(y){if(a=r.schema(o.DefaultSchemaName),!a||!a.capabilities.isExtendable)throw new Error("Attempting to extend a non-existent or non-extendable schema");return s=this.ensureEntityExists(n,this.schemaChange.schema,this.schemaChange.entity),c=e.explore.util.createNameValidator(r,t.localizationService),p=c.makeValidMeasureName(t.localizationService.get("NewMeasureName")),d={name:p,dataType:3,references:{unrecognizedReferences:!1,measures:[]},expression:"",hidden:!1},l.addMeasure(s,d),i(n,this.schemaChange.schema,t.daxParserService),f=new u(t.cultureService.getFormatInfo()),d.formatInformation=f.updateFormatUponDataTypeChange(d.dataType,d.formatInformation),v={schema:this.schemaChange.schema,entity:s.name,property:d.name,annotationName:h.isNew,value:"true"},m=E.setAnnotation(v,t,n),g={schema:this.schemaChange.schema,entity:this.schemaChange.entity,measureDefinition:{name:d.name,expression:d.expression}},[2,{changes:[{newMeasureCreated:g},m],isSchemaChangeListComplete:!1}]}))}))},r.prototype.ensureEntityExists=function(e,t,r){var i=l.getOrCreateModelExtension(e,t,o.DefaultSchemaName);return l.getOrCreateExtendingEntity(i,r)},r})(g),C=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,n){return __awaiter(this,void 0,e.Promise,(function(){var a,o,s;return __generator(this,(function(u){switch(u.label){case 0:return a=l.getExpectedMeasure(n,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.before),o=e.explore.util.createNameValidator(r,t.localizationService),s=o.validateMeasureName(this.schemaChange.after,this.schemaChange.before),s.error===c.None?[3,2]:[4,this.showMessage(t,t.localizationService.get("RenameMeasureErrorTitle"),s.reason)];case 1:throw u.sent(),v.createHandledAuthoringError();case 2:return this.fixupUponMeasureRename(t.daxParserService,n),a.name=this.schemaChange.after,i(n,this.schemaChange.schema,t.daxParserService),[2,{changes:[{propertyRename:this.schemaChange}],isSchemaChangeListComplete:!1}]}}))}))},r.prototype.fixupUponMeasureRename=function(e,t){var r=this,i={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:this.schemaChange.before},n={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:this.schemaChange.after},o=l.getExpectedModelExtension(t,this.schemaChange.schema);debug&&l.getExpectedMeasure(t,i.schema,i.entity,i.name),a(o,i,n,(function(i){return e.renameMeasureReferences(t.modelExtensions,i,r.schemaChange.before,r.schemaChange.after)}))},r})(g),b=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){switch(n.label){case 0:return e=l.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=0,l.getAnnotationValue(e,h.isNew)?[3,2]:[4,this.showDeleteConfirmationDialog(t)];case 1:r=n.sent(),n.label=2;case 2:return 0===r?(l.removeMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),this.fixupMeasureReferences(l.getOptionalModelExtension(i,this.schemaChange.schema)),[2,{changes:[{itemDelete:this.schemaChange}],isSchemaChangeListComplete:!1}]):[2,f]}}))}))},r.prototype.showDeleteConfirmationDialog=function(e){var t={okButtonText:e.localizationService.get("ModalDialogButtonText_Delete"),cancelButtonText:e.localizationService.get("ModalDialogButtonText_Cancel"),titleText:e.localizationService.get("DeleteMeasurePromptTitle"),messageText:e.localizationService.format("DeleteMeasurePrompt",[this.schemaChange.property])};return e.modelAuthoringDialogService.showDialog(t)},r.prototype.fixupMeasureReferences=function(e){if(e){var t={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:this.schemaChange.property};a(e,t,void 0)}},r})(g),S=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var a,o,s,u,c,d,f,v;return __generator(this,(function(m){switch(m.label){case 0:return a=l.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),a.expression=this.schemaChange.expression,a.formulaOverride=this.schemaChange.expressionOverride&&this.schemaChange.expressionOverride.formula,a.errorMessage=this.schemaChange.errorMessage,t.telemetryService.logEvent(e.telemetry.EXMeasures,this.schemaChange.anonymizedExpression||"","ReportModelOperationUpdateMeasure"),a.formulaOverride&&(o={expression:a.formulaOverride,formula:a.formulaOverride}),s={updateExpression:{schema:this.schemaChange.schema,entity:this.schemaChange.entity,property:this.schemaChange.property,expression:this.schemaChange.expression,errorMessage:this.schemaChange.errorMessage,expressionOverride:o}},n(i,this.schemaChange.schema,this.schemaChange.entity,a,t.daxParserService),u=[s],this.schemaChange.newName===this.schemaChange.property?[3,2]:(c={propertyRename:{schema:this.schemaChange.schema,objectType:p.Measure,entity:this.schemaChange.entity,before:this.schemaChange.property,after:this.schemaChange.newName}},d=new C(c.propertyRename),[4,d.execute(t,r,i)]);case 1:f=m.sent(),u.push.apply(u,f.changes),m.label=2;case 2:return v={schema:this.schemaChange.schema,entity:this.schemaChange.entity,property:this.schemaChange.newName,annotationName:h.isNew,value:null},u.push(E.setAnnotation(v,t,i)),[2,{changes:u,isSchemaChangeListComplete:!1}]}}))}))},r})(g),x=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,n){return __awaiter(this,void 0,e.Promise,(function(){var e,r,a;return __generator(this,(function(o){return e=l.getExpectedModelExtension(n,this.schemaChange.schema),r=l.getExpectedMeasure(n,this.schemaChange.schema,this.schemaChange.source,this.schemaChange.property),a=l.getOrCreateExtendingEntity(e,this.schemaChange.destination),this.fixupUponMeasureMove(t.daxParserService,n),l.removeMeasure(n,this.schemaChange.schema,this.schemaChange.source,this.schemaChange.property),l.addMeasure(a,r),i(n,this.schemaChange.schema,t.daxParserService),[2,{changes:[{measureMove:this.schemaChange}],isSchemaChangeListComplete:!1}]}))}))},r.prototype.fixupUponMeasureMove=function(e,t){var r=this,i=l.getExpectedModelExtension(t,this.schemaChange.schema),n={schema:this.schemaChange.schema,entity:this.schemaChange.source,name:this.schemaChange.property},o={schema:this.schemaChange.schema,entity:this.schemaChange.destination,name:this.schemaChange.property};debug&&l.getExpectedMeasure(t,n.schema,n.entity,n.name),a(i,n,o,(function(i){return e.renameMovedMeasureTableReference(t.modelExtensions,i,r.schemaChange.property,r.schemaChange.source,r.schemaChange.destination)}))},r})(g),E=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.setAnnotation=function(e,t,r){var i=l.getExpectedMeasure(r,e.schema,e.entity,e.property);return l.setAnnotation(i,e.annotationName,e.value),{setAnnotation:e}},r.prototype.execute=function(t,i,n){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){return e=r.setAnnotation(this.schemaChange,t,n),[2,{changes:[e],isSchemaChangeListComplete:!0}]}))}))},r})(g),w=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,t,r,n,a,o,s,e;return __generator(this,(function(u){if(this.schemaChange.property)e=l.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),e.hidden=this.schemaChange.makeHidden;else if(t=l.getOptionalModelExtension(i,this.schemaChange.schema))for(r=0,n=t.entities;r<n.length;r++)for(a=n[r],o=0,s=a.measures;o<s.length;o++)e=s[o],e.hidden=this.schemaChange.makeHidden;return[2,{changes:[{itemShowHide:this.schemaChange}],isSchemaChangeListComplete:!0}]}))}))},r})(g),F=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var r,n,a;return __generator(this,(function(o){return r=l.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),n=r.dataType,r.dataType=d(this.schemaChange.dataType),a=new u(t.cultureService.getFormatInfo()),r.formatInformation=a.updateFormatUponDataTypeChange(r.dataType,r.formatInformation),t.telemetryService.logEvent(e.telemetry.EXReportMeasureDataTypeChange,e.PrimitiveTypeStrings[n],e.PrimitiveTypeStrings[r.dataType]),[2,{changes:[{setDataType:this.schemaChange}],isSchemaChangeListComplete:!1}]}))}))},r})(g),P=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=l.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new u(t.cultureService.getFormatInfo()),e.formatInformation=r.changeFormat(e.dataType,e.formatInformation,this.schemaChange.format),[2,{changes:[{setFormatting:this.schemaChange}],isSchemaChangeListComplete:!0}]}))}))},r})(g),D=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=l.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new u(t.cultureService.getFormatInfo()),e.formatInformation=r.toggleThousandsSeparator(e.dataType,e.formatInformation),[2,{changes:[{toggleThousandsSeparator:this.schemaChange}],isSchemaChangeListComplete:!0}]}))}))},r})(g),V=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=l.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new u(t.cultureService.getFormatInfo()),e.formatInformation=r.setAccuracy(e.dataType,e.formatInformation,this.schemaChange.decimalPlaces),[2,{changes:[{setDecimalPlaces:this.schemaChange}],isSchemaChangeListComplete:!0}]}))}))},r})(g),R=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=l.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new u(t.cultureService.getFormatInfo()),e.formatInformation=r.setDateTimeFormat(e.dataType,e.formatInformation,this.schemaChange.formatType,this.schemaChange.dateTimeCustomFormatGroup,this.schemaChange.formatString),[2,{changes:[{setDateTimeFormatInfo:this.schemaChange}],isSchemaChangeListComplete:!0}]}))}))},r})(g),T=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=l.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new u(t.cultureService.getFormatInfo()),e.formatInformation=r.setCurrencyFormat(e.dataType,e.formatInformation,this.schemaChange.formatType,this.schemaChange.lcid,this.schemaChange.displayName,this.schemaChange.currencySymbol,this.schemaChange.positivePattern,this.schemaChange.negativePattern),[2,{changes:[{setCurrencyFormatInfo:this.schemaChange}],isSchemaChangeListComplete:!0}]}))}))},r})(g)})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{getGroupingDesignState:function(e,t){return null}}}e.createGroupingDesignStateService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new s(e)}var n;!(function(e){e[e.None=0]="None",e[e.Basic=1]="Basic",e[e.Binning=2]="Binning",e[e.Clustering=3]="Clustering"})(n=r.GroupMode||(r.GroupMode={}));var a;!(function(e){e[e.Category=0]="Category",e[e.Number=1]="Number",e[e.DateTime=2]="DateTime"})(a=r.GroupDataType||(r.GroupDataType={}));var o;!(function(e){e[e.BySize=0]="BySize",e[e.ByCount=1]="ByCount"})(o=r.BinMode||(r.BinMode={})),r.createDisabledGroupAuthoringService=i;var s=(function(){function e(e){this.visual=new l,this.dialog=new u,this.telemetry=new c(e)}return e})(),l=(function(){function e(){}return e.prototype.canGroup=function(e,t,r){return!1},e.prototype.group=function(e,t,r,i,n){return null},e})(),u=(function(){function e(){}return e.prototype.showDialog=function(e){return null},e})(),c=(function(){function r(e){this.telemetryService=e}return r.prototype.logGroupActionTelemetry=function(e,t,r,i,n){},r.prototype.logBinBySizeActionTelemetry=function(e,t,r,i,n){},r.prototype.logBinByCountActionTelemetry=function(e,t,r,i,n,a){},r.prototype.logGroupsErrorTelemetry=function(e,t,r,i){},r.prototype.logGroupsDeleteTelemetry=function(e,t,r){},r.prototype.logGroupsUsageTelemetry=function(r,i,a,o,s,l){var u=this;r.then((function(r){var c=i.getConceptualProperty(r);if(c){var p=i.getTargetEntity().entity,d=t.utils.GroupUtils.getGroupMode(p,c,null);if(d!==n.None){var f=d===n.Binning?e.telemetry.GroupType.Bin:e.telemetry.GroupType.List;u.telemetryService.logEvent(e.telemetry.EXGroupsUsage,a,o,s,l,f)}}}))},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{getMetadata:function(e){return null}}}e.createClusteringStateService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.canRedo=_.noopFalse,this.canUndo=_.noopFalse,this.undo=_.noop,this.redo=_.noop,this.clear=_.noop,this.getTopUndoFrame=_.noop,this.getReferences=function(){return[]},this.setHandler=_.noop}return e.prototype.register=function(e,t,r){return t()},e})();e.NoOpUndoRedoService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createUIBlockingService=t;var r=(function(){function e(e){this.promiseFactory=e}return e.prototype.waitTillUnblocked=function(){return this.promiseFactory.resolve()},e.prototype.beginBlockUI=function(){},e.prototype.endBlockUI=function(){},e.prototype.beginAllowModalDialogs=function(){},e.prototype.endAllowModalDialogs=function(){},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new o(e,t,r,i)}var i=jsCommon.CircularStack,n=30;t.createUndoRedoService=r;var a=(function(){function e(e){this.frames=e||[]}return e.prototype.addUndoFrame=function(e){this.frames.push(e)},e.prototype.rollbackFrame=function(){var t=_.map(this.frames,(function(e){return e.rollbackFrame()}));return new e(t)},e.prototype.getFrame=function(){return this.frames[0]},e.prototype.getReferences=function(){if(0!==this.frames.length)return 1===this.frames.length?this.frames[0].getReferences():Array.prototype.concat.apply([],_.map(this.frames,(function(e){return e.getReferences()})))},e})(),o=(function(){function r(e,t,r,a){this.registeredResourceReferences=a,this.currentTransaction=void 0,this.loggerService=r,this.rootScope=e,this.eventBridge=t,this.undoStack=new i(n),this.redoStack=new i(n),a.addReferenceSource(this)}return r.prototype.getReferences=function(){return this.addStackReferences(this.undoStack,this.addStackReferences(this.redoStack))},r.prototype.addStackReferences=function(e,t){for(var r=e.length;r-- >0;){var i=e.item(r).getReferences();_.isEmpty(i)||(t||(t=[]),t.push.apply(t,i))}return t},r.prototype.setHandler=function(e){this.handler=e,this.clear()},r.prototype.undo=function(){this.canUndo()&&this.rollbackTop(this.undoStack,this.redoStack)},r.prototype.redo=function(){this.canRedo()&&this.rollbackTop(this.redoStack,this.undoStack)},r.prototype.clear=function(){this.undoStack.clear(),this.redoStack.clear(),this.eventBridge.publishToChannel(t.events.undoRedoStackUpdated)},r.prototype.canRedo=function(){return this.redoStack.length>0},r.prototype.canUndo=function(){return this.undoStack.length>0},r.prototype.getTopUndoFrame=function(){var e=this.undoStack.peek();return e?e.getFrame():void 0},r.prototype.canMergeWithTopFrame=function(e){if(!e)return!1;if(this.canUndo()){var t=this.getTopUndoFrame();if(t&&void 0!==t.recurringActionInfo&&t.recurringActionInfo.equals(e))return!0}return!1},r.prototype.undoRedoPostProcessing=function(r){this.rootScope.$emit(e.common.constants.onReportChangedEventName,!0),this.eventBridge.publishToChannel(t.events.undoRedoStackUpdated),this.loggerService.addUserAction({message:r,type:"UndoRedo"}),this.rootScope.$evalAsync(_.noop)},r.prototype.register=function(e,t,r){var i=this,n=this.captureUndoFrame(this.handler);n.recurringActionInfo=r;var a=this.canMergeWithTopFrame(r),o=this.startTransaction(n),s=t(),l=s;return this.isIPromise(l)?l.then((function(){return i.endTransaction(o,a)}),(function(){return i.cancelTransaction(o)})):_.isBoolean(s)&&!s?this.cancelTransaction(o):this.endTransaction(o,a),this.undoRedoPostProcessing(e),s},r.prototype.rollbackTop=function(r,i){var n=this;this.rootScope.$evalAsync((function(){var a=r.pop(),o=a.rollbackFrame();n.validTransactionCheck(o),i.push(o),n.rootScope.$emit(e.common.constants.onReportChangedEventName,!0),n.eventBridge.publishToChannel(t.events.undoRedoStackUpdated)}))},r.prototype.isIPromise=function(e){return e&&e.finally},r.prototype.startTransaction=function(e){var t=new a;return this.currentTransaction||(this.currentTransaction=t,this.currentTransaction.addUndoFrame(e)),this.currentTransaction},r.prototype.endTransaction=function(e,t){t||(this.redoStack.clear(),this.validTransactionCheck(this.currentTransaction),this.undoStack.push(this.currentTransaction)),this.currentTransaction=void 0},r.prototype.cancelTransaction=function(e){this.currentTransaction=void 0},r.prototype.captureUndoFrame=function(e){return new s(e)},r.prototype.validTransactionCheck=function(t){e.contract.checkValue(t,"null or undefined transaction values cannot be put on undo or redo stack.")},r})(),s=(function(){function e(e,t){this.handler=e,this.snapshot=this.handler.takeSnapshot(t)}return e.prototype.rollbackFrame=function(){var t=new e(this.handler,this.snapshot);return this.handler.rollback(this.snapshot),t},e.prototype.getReferences=function(){return this.snapshot.getReferences&&this.snapshot.getReferences()},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i){return new x(e,t,r,i)}var n=e.data.DataViewObjectDefinitions,a=e.data.DataViewObjectDescriptors,o=e.explore.util.DrillUtils,s=e.data.FieldExprPattern,l=e.visuals.GradientUtils,u=t.util.HierarchyUtils,c=jsCommon.JsonComparer,p=e.data.QueryProjectionCollection,d=e.data.QueryProjectionsByRole,f=e.data.ScopeIdentityExtractor,h=e.data.SemanticQuery,v=t.contracts.SingleVisualConfig,m=e.data.SQExpr,g=e.data.SQExprBuilder,y=e.data.SQExprConverter,C=e.data.SQExprUtils,b=e.data.SQHierarchyExprUtils,S=t.contracts.VisualQuery;r.createVisualAuthoringCore=i;var x=(function(){function i(e,t,r,i){this.visualPluginService=e,this.geoTaggingService=t,this.aggrOps=r,this.featureSwitchService=i}return i.prototype.create=function(e){var t=this.visualPluginService.capabilities(e.visualType),i=r.createVisualCapabilitiesHelper(t,this.geoTaggingService);if(i){var n=e.query||new S(h.create(),{}),a={visualType:e.visualType,query:n};for(var o in a.query.projections)this.ensureDependentObjectDefn(i.objectDescs,o,a);if(_.isEmpty(e.expr)||this.tryAdd(i,a,e))return{singleVisual:a}}},i.prototype.add=function(e,t){var n=t.singleVisual;if(!n)return!1;var a=this.visualPluginService.capabilities(n.visualType),o=r.createVisualCapabilitiesHelper(a,this.geoTaggingService);return!!o&&(n.query||(n.query=new S(h.create(),{})),!!this.tryAdd(o,n,e)&&(i.clearConversionSourceContext(n),!0))},i.prototype.remove=function(e,t){var r=t.singleVisual;return!!r&&(!!this.tryRemove(r.query,e)&&(i.clearConversionSourceContext(r),!0))},i.prototype.replace=function(e,t){var r=t.singleVisual;if(!r)return!1;if(e.sourceRole===e.targetRole&&!e.replacementExpressions)return!!r.query.moveProjection(e.targetRole,e.sourceIndex,e.targetIndex,e.sourceCount)&&(i.clearConversionSourceContext(r),!0);for(var n=[],a=0;a<e.sourceCount;a++)if(n[a]=r.query.tryGetExpr(e.sourceRole,e.sourceIndex+a),!n[a])return!1;return this.replaceProjectionCore(t,n,e.sourceRole,e.targetRole,e.sourceIndex,e.targetIndex,e.replacementExpressions,e.schema,e.allowPartialReplace)},i.prototype.convert=function(e){var t=e.source;if(!t||t.visualType===e.target)return!1;var i=t.conversionSourceContext;i||(i=t.conversionSourceContext=this.createConversionSourceContext(t.query,t.visualType));var n=this.visualPluginService.capabilities(i.visualType),a=this.visualPluginService.capabilities(e.target);if(!n||!a||_.isEmpty(a.dataRoles))return!1;if(c.equals(n,a))return t.query=i.query,t.visualType=e.target,!0;var s=e.schema,l=this.convertDrillableRoles(i.query,n,a,s),u=l.query,p=o.getDrillableRoles(a),f=i.query.getUniqueQueryRefs();f=_.difference(f,l.drillableRoleProjectionQueryRefs);var h=i.query.defn.select(),v=_.map(f,(function(e){return h.withName(e).expr})),m=r.createVisualCapabilitiesHelper(a,this.geoTaggingService),g=r.createVisualCapabilitiesHelper(n,this.geoTaggingService);m.orderByRolePreferences(s,v);var y=d.clone(u.projections),C=this.getExpressionRoleMappings(t.query,v),b=this.getConversionExprRoleList(C,g,m,s,y,p);if(_.isEmpty(b)&&_.isEmpty(u.projections))return!1;for(var S=0,x=b;S<x.length;S++){var E=x[S];u.add(E.expr,E.roleName),this.ensureDependentObjectDefn(m.objectDescs,E.roleName,t)}var w,F,P=o.getDrillableRoles(this.visualPluginService.capabilities(t.visualType));_.isEmpty(P)?(w=o.getDrillableRoles(n),F=i.query):(w=P,F=t.query);for(var D=0,V=p;D<V.length;D++){var R=V[D];if(u.projections[R]){u.ensureActiveItems(R);for(var T=0,I=w;T<I.length;T++){var N=I[T];F.projections[N]&&(u.projections[R].activeProjectionRefs=F.projections[N].activeProjectionRefs)}}}return this.updateTargetShowAllInfo(i,u,m),u.removeUnusedOrderBy(),t.query=u,t.visualType=e.target,!0},i.prototype.setAggregate=function(e,t){var r=t.singleVisual.query.setAggregate(e.role,e.index,e.newAggregate,e.schema);return!!r&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.removeAggregate=function(e,t){var r=t.singleVisual.query.removeAggregate(e.role,e.index,e.schema);return!!r&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.setPercentOfGrandTotal=function(e,t){return!!t.singleVisual.query.setPercentOfGrandTotal(e.role,e.index,e.schema)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.removePercentOfGrandTotal=function(e,t){return!!t.singleVisual.query.removePercentOfGrandTotal(e.role,e.index,e.schema)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.setPercentOfRoleTotal=function(e,t){return!!t.singleVisual.query.setPercentOfRoleTotal(e.roleRefs,e.role,e.index,e.schema)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.removePercentOfRoleTotal=function(e,t){return!!t.singleVisual.query.removePercentOfRoleTotal(e.role,e.index,e.schema)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.toggleShowAll=function(e,t){t.singleVisual.query.toggleShowAll(e),i.clearConversionSourceContext(t.singleVisual)},i.prototype.changeActiveProjection=function(e,t,r){var n=t.query.projections[e];if(n){var a=n.all(),o=_.findIndex(a,(function(e){return!_.isEmpty(n.activeProjectionRefs)&&e.queryRef===n.activeProjectionRefs[n.activeProjectionRefs.length-1]}));if(!(o<0)){i.clearConversionSourceContext(t);var s=1!==r?o+1:o-1,l=n.all()[s],u=l&&l.queryRef,c=2===r||1===r&&n.activeProjectionRefs.length>1;if(u){if(c)return n.activeProjectionRefs=_.map(n.all(),(function(e){return e.queryRef})),n.activeProjectionRefs.splice(s+1,n.activeProjectionRefs.length-(s+1)),n.activeProjectionRefs;if(!_.any(n.activeProjectionRefs,(function(e){return u===e})))return n.activeProjectionRefs=[u],n.activeProjectionRefs}}}},i.prototype.addDrillFilter=function(e,t,r,i,n){this.addFilters(e,t,r,i,n,2,!0)},i.prototype.addDrillToDetailsFilter=function(e,t,r,i,n){this.addFilters(e,t,r,i,n,0,!1)},Object.defineProperty(i.prototype,"featureSwitches",{get:function(){return this.featureSwitchService.featureSwitches},enumerable:!0,configurable:!0}),i.prototype.addFilters=function(r,i,n,a,o,s,l){if(i&&n&&!_.isEmpty(a)&&o)for(var u=function(a){for(var u=n.defn.select().withName(a).expr,c=o.expr,p=f.getInExpr(c),d=[],h=[],v=_.first(p.values),y=u.getKeyColumns(r),b=0;b<p.args.length;b++){var S=p.args[b];S&&v&&C.indexOfExpr(y,S)!==-1&&(d.push(S),h.push(v[b]))}if(!_.isEmpty(d)&&!_.isEmpty(h)){var x=e.DataViewScopeIdentity.filterFromIdentity([{kind:1,expr:g.inValues(d,[h]),key:o.key}]),E=_.filter(i,(function(e){return m.equals(u,e.expression);
})),w=void 0;if(l&&(w=_.find(E,(function(e){return e.howCreated===s}))),w=w||_.find(E,(function(e){return!e.filter&&2!==e.howCreated})))w.filter=x,w.howCreated=s,w.precedence=0;else{var F={name:null,expression:u,filter:x,type:t.contracts.FilterType.Categorical,howCreated:s,precedence:0};i.push(F)}}},c=0,p=a;c<p.length;c++){var d=p[c];u(d)}},i.prototype.removeDrillFilter=function(e,t){if(e){for(var r,i=0,n=e.length;i<n;i++){var a=e[i];if(m.equals(t,a.expression)&&2===a.howCreated){r=i;break}}void 0!==r&&e.splice(r,1)}},i.prototype.replaceProjectionCore=function(e,t,o,s,l,u,c,p,d){var f=e.singleVisual;if(!f||!f.query)return!1;for(var h=v.clone(f),m=h.query.defn.orderBy(),g=0;g<t.length;g++)if(!this.tryRemove(h.query,{role:o,index:l}))return!1;m.length>0&&h.query.orderBy(m);var y=this.visualPluginService.capabilities(f.visualType),C=r.createVisualCapabilitiesHelper(y,this.geoTaggingService);if(!C)return!1;var b=C.roles.withName(s);if(!b)return!1;for(var S=c||t,g=0;g<S.length;g++){S[g]=this.aggregateIfNecessary(S[g],b,p);var x={expr:S[g],schema:p,targetRole:s,targetIndex:u+g};if(!this.tryAdd(C,h,x)){if(g>0&&d)break;return!1}if(f.query.projections[o].showAll){var E=S[g].getMetadata(p);this.isShowAllRole(b.kind)&&E&&1!==E.kind&&(h.query.projections[s].showAll=!0)}}if(e.singleVisual=h,i.clearConversionSourceContext(e.singleVisual),e.singleVisual.objects){var w=a.findFilterOutput(C.objectDescs);w&&n.deleteProperty(e.singleVisual.objects,w.objectName,null,w.propertyName)}return!0},i.prototype.aggregateIfNecessary=function(t,r,i){var n=s.getAggregate(t);return null!=n||r.kind!==e.VisualDataRoleKind.Measure||C.discourageAggregation(t,i)?r.kind===e.VisualDataRoleKind.Grouping?g.removeAggregate(t):t:this.aggrOps.createExprWithAggregate(t,i,!0,r.requiredTypes)},i.clearConversionSourceContext=function(e){e.conversionSourceContext=null},i.prototype.getConversionExprRoleList=function(e,t,r,i,n,a){var o=this,s=this.getCompatRolesForExprs(e,t,r,i,!1,n,a);if(_.isEmpty(s)){var l=_.map(e,(function(e){var t=e.expr;return{expr:C.isMeasure(t)?t:o.aggrOps.createExprWithAggregate(t,i,!0,null)}}));s=this.getCompatRolesForExprs(l,t,r,i,!0,n,a)}if(_.isEmpty(s)){var u=_.map(e,(function(e){var t=e.expr;return{expr:C.isMeasure(t)?g.removeAggregate(t):t}}));s=this.getCompatRolesForExprs(u,t,r,i,!0,n,a)}return s},i.prototype.getCompatRolesForExprs=function(e,t,r,i,n,a,o){for(var s=[],l=a?a:{},c=new E(u.hierarchyLevelComparer),p=0,d=e;p<d.length;p++){var f=d[p],h=this.getTargetRoleForConversion(f,t,r),v=r.findCompatibleRole({queryProjections:l,schema:i,expr:f.expr,targetRole:h,preferDrillableRoles:!1,roleToExprMap:c,useStrict:!0});if(v){this.updateProjections(l,v.name,o);var m=r.getNumberRangesForRoles(l),g=m[v.name];if(this.shouldUseVariation(f.expr,i,v.name,o,g)){var y=b.getSourceVariationExpr(f.expr);return s.push({expr:y,roleName:v.name}),s}if(s.push({expr:f.expr,roleName:v.name}),n)return s}}return s},i.prototype.shouldUseVariation=function(e,t,r,i,n){if(!_.contains(i,r)&&n&&1===n.max){var a=y.asFieldPattern(e,t);if(a&&a.columnHierarchyLevelVariation)return!0}return!1},i.prototype.getExpressionRoleMappings=function(e,t){return _.map(t,(function(t){return{expr:t,roleName:e.getRoleNameForExpr(t)}}))},i.prototype.getTargetRoleForConversion=function(e,t,r){var i=t.roles.withName(e.roleName),n=r.roles.withName(e.roleName);if(i&&n){var a=this.getDataViewMappingConditions(t.capabilities),o=this.getDataViewMappingConditions(r.capabilities),s=e.roleName,l=a&&o&&_.isEqual(a[s],o[s])||!a&&!o;return!r.hasPreferredTypes()&&l&&_.isEqual(i.kind,n.kind)?s:void 0}},i.prototype.getDataViewMappingConditions=function(e){var t=e.dataViewMappings&&e.dataViewMappings[0];return t&&t.conditions},i.prototype.updateProjections=function(e,t,r){var i={queryRef:t},n=d.getRole(e,t);n||(e[t]=n=new p([]));var a=n.all();a.push(i),_.contains(r,t)&&n.addActiveQueryReference(a[0].queryRef)},i.prototype.createConversionSourceContext=function(e,t){return{query:e,visualType:t}},i.prototype.convertDrillableRoles=function(e,t,r,i){var n=new S(e.defn.select([]),{}),a=o.getDrillableRoles(t);if(_.isEmpty(a))return{query:n,drillableRoleProjectionQueryRefs:[]};var s=this.populateQueryForDrillableProjections(r,e,i,a,n);return{query:n,drillableRoleProjectionQueryRefs:s}},i.prototype.populateQueryForDrillableProjections=function(e,t,r,i,n){for(var a=o.getDrillableRoles(e),s=t.projections,l=t.defn.select(),u=[],c=0,p=i;c<p.length;c++){var d=p[c],f=s[d];if(f){var h=_.map(f.all(),(function(e){return e.queryRef})),v=_.map(h,(function(e){return l.withName(e)}));if(this.convertDrillableExprs(v,r,e,n),u=_.union(u,h),_.isEmpty(a))break}}return n.ensureDrillableRoles(a),u},i.prototype.convertDrillableExprs=function(e,t,i,n){for(var a=r.createVisualCapabilitiesHelper(i,this.geoTaggingService),s=a.getNumberRangesForRoles(n),l=o.getDrillableRoles(i),c=_.isEmpty(l),p=new E(u.hierarchyLevelComparer),d=0,f=e;d<f.length;d++){var h=f[d],v=h.expr,m=h.name,g=a.findCompatibleRole({queryProjections:n.projections,schema:t,expr:v,preferDrillableRoles:!0,roleToExprMap:p,useStrict:!0});if(g){var y=g.name,C=s[y];if(this.shouldUseVariation(h.expr,t,g.name,l,C)){var S=b.getSourceVariationExpr(h.expr);return void n.add(S,y,{exprName:m})}if(n.add(v,y,{exprName:m}),c){var x=n.projections[y].all().length;if(C&&C.max&&C.max<=x)return}}}},i.prototype.tryRemove=function(e,t){var r=t;if(r&&r.expr){if(_.isArray(r.expr)){for(var i=!1,n=0,a=r.expr;n<a.length;n++){var o=a[n];i=e.removeExpr(o,!!r.ignoreAggregates)||i}return i}return e.removeExpr(r.expr,!!r.ignoreAggregates)}var s=t;return!!(s&&s.role&&$.isNumeric(s.index))&&e.removeProjection(s.role,s.index)},i.prototype.tryAdd=function(e,t,r){var i=r.expr,n=new E(u.hierarchyLevelComparer),a=!1,s=r.targetIndex;if(_.isArray(i))for(var l=0,c=i;l<c.length;l++){var p=c[l];a=null!=this.tryAddQuery(e,t,r,p,s,n)||a,null!=s&&s++}else if(null==this.tryAddQuery(e,t,r,i,s,n))return!1;var d=o.getDrillableRoles(e.capabilities);return t.query.ensureDrillableRoles(d),!_.isArray(i)||a},i.prototype.tryAddQuery=function(e,t,r,i,n,a){var o=e.findCompatibleRole({queryProjections:t.query.projections,schema:r.schema,expr:i,preferDrillableRoles:!1,roleToExprMap:a,targetRole:r.targetRole});if(o){var s=o.name,l=t.query.add(i,s,{index:n});return this.ensureDependentObjectDefn(e.objectDescs,s,t),a.add(i,o),l}},i.prototype.ensureDependentObjectDefn=function(e,t,r){if(e)for(var i in e){var a=e[i];for(var o in a.properties){var s=a.properties[o];if(s.rule&&s.rule.inputRole===t){var l=r.objects;l||(l=r.objects={});var u=n.ensure(l,i,null);u.properties[o]||(u.properties[o]=this.createDefaultDefinition(s.type))}}}},i.prototype.createDefaultDefinition=function(e){if(e.fillRule){var t=l.getDefaultFillRuleDefinition();return t}},i.prototype.getSourceShowAllInfo=function(e){for(var t={},r=0,i=_.values(e);r<i.length;r++)for(var n=i[r],a=n.showAll,o=0,s=n.all();o<s.length;o++){var l=s[o];t[l.queryRef]=a}return t},i.prototype.updateTargetShowAllInfo=function(e,t,r){for(var i=this.getSourceShowAllInfo(e.query.projections),n=0,a=_.keys(t.projections);n<a.length;n++){var o=a[n],s=r.roles.withName(o).kind;if(this.isShowAllRole(s))for(var l=0,u=t.projections[o].all();l<u.length;l++){var c=u[l],p=i[c.queryRef];p&&(t.projections[o].showAll=p)}}},i.prototype.isShowAllRole=function(t){return t===e.VisualDataRoleKind.Grouping||t===e.VisualDataRoleKind.GroupingOrMeasure},i})(),E=(function(){function e(e){this.key=[],this.value=[],this.comparer=e}return e.prototype.add=function(e,t){this.key.push(e),this.value.push(t)},e.prototype.get=function(e){if(m.isHierarchyLevel(e))for(var t=0;t<this.key.length;t++)if(this.comparer(this.key[t],e))return this.value[t]},e})();r.SQExprToRoleDictionary=E})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r){return new u(e,t,r)}var n=e.DataViewMapping,a=e.data.QueryProjectionsByRole,o=e.data.SQExpr,s=e.explore.util.VisualContainerUtils,l=t.contracts.VisualQuery;r.createSortService=i;var u=(function(){function r(e,t,r){this.displayNameService=e,this.featureSwitches=t,this.visualPluginService=r}return r.prototype.getSortableFields=function(t){var r=t.visualType,i=t.query,n=i.projections,a=t.schema,o=this.visualPluginService.capabilities(r);if(o&&this.isVisualSortable(o)){if(o.sorting){var s=this.visualPluginService.getPlugin(r);if(s&&s.getSortableRoles){var l={mappings:o.dataViewMappings,queryDefn:i.defn,queryProjections:n,schema:a,objectDescriptors:o.objects,objectDefinitions:t.objectDefns,roles:o.dataRoles},u=e.data.compileDataView(l),c={dataViewMappings:u};return this.getSortableFieldsFromAllowedRoles(n,i,a,o,s.getSortableRoles(c))}return this.getDefaultSortableFields(n,i,a,o)}return this.getDefaultSortableFields(n,i,a,o)}return[]},r.prototype.addSort=function(e,t){e&&e.defn&&t&&(e.defn=e.defn.orderBy(t))},r.prototype.removeSort=function(e,t){if(e&&e.defn&&t)for(var r=0,i=t;r<i.length;r++){var n=i[r];e.defn=e.defn.removeOrderBy(n.expr)}},r.prototype.resetSort=function(e){if(e&&e.defn){var t=e.defn.orderBy();this.removeSort(e,t)}},r.prototype.applyImplicitSort=function(e,t){if(!t)return e;var r=e.defn;if(!r)return e;for(var i=t.clauses,n=r.select(),o=[],s=0,u=i;s<u.length;s++){var c=u[s],p=a.getRole(e.projections,c.role);if(p){var d=c.direction;o.push.apply(o,_.map(p.all(),(function(e){return{expr:n.withName(e.queryRef).expr,direction:d}})))}}return new l(r.orderBy(o),e.projections)},r.prototype.ensureValidSorting=function(e){var t=_.chain(this.getSortableFields(e)).map((function(e){return e.exprs})).flatten().map((function(e){return e.name})).value(),r=e.query,i=r.defn;if(!i)return r;for(var n=i.orderBy(),a=!1,o=n.length-1;o>=0;o--){var s=i.selectNameOf(n[o].expr);_.contains(t,s)||(n.splice(o,1),a=!0)}return a?new l(i.orderBy(n),r.projections):r},r.prototype.isVisualSortable=function(t){return _.some(t.dataRoles,(function(t){return t.kind!==e.VisualDataRoleKind.Measure}))},r.prototype.getDefaultSortableFields=function(e,t,r,i){var n=this.getSortableFieldsFromProjections(e,t,r,i);return n},r.prototype.getSortableFieldsFromAllowedRoles=function(e,t,r,i,n){if(!n||0===n.length)return[];var a=this.getSortableFieldsFromProjections(e,t,r,i,n);return a},r.prototype.findSortExpressionIndex=function(e,r){if(e&&r)for(var i=0,n=r.length;i<n;i++)if(o.equals(e,r[i].expr))return i;return t.constants.invalidSortExprIndex},r.prototype.getSortableFieldsFromProjections=function(r,i,o,l,u){var c=[],p=i.defn.select(),d=i.defn.orderBy();if(l.dataRoles)for(var f=0,h=l.dataRoles;f<h.length;f++){var v=h[f];if(!(u&&_.indexOf(u,v.name)<0)){var m=a.getRole(r,v.name);if(m){var g=m.activeProjectionRefs;if(_.isEmpty(g))for(var y=0,C=m.all();y<C.length;y++){var b=C[y],S=p.withName(b.queryRef),x=S&&S.expr;if(x){var E=b.displayName||this.displayNameService.getDisplayName(x,o,l),w=this.findSortExpressionIndex(x,d),F=w!==t.constants.invalidSortExprIndex;c.push({displayName:E,exprs:[{name:b.queryRef,expr:x}],active:F,sortDirection:F?d[w].direction:void 0})}}else{var P=s.createRoleKindByQueryRef(i),D=e.DataViewAnalysis.chooseDataViewMappings(r,l.dataViewMappings,P),V=n.targetDataViewKinds(D.supportedMappings),R=0!==(1&V);c.push.apply(c,this.getSortableFieldsFromActiveProjections(o,p,g,d,l,R))}}}}return c},r.prototype.getSortableFieldsFromActiveProjections=function(e,r,i,n,a,o){for(var s,l=!1,u=[],c=[],p=0,d=i;p<d.length;p++){var f=d[p],h=r.withName(f),v=h&&h.expr;if(v){var m=this.findSortExpressionIndex(v,n);if(o)l=l||m!==t.constants.invalidSortExprIndex,l&&!s&&(s=n[m].direction),c.push({name:f,expr:v});else{l=m!==t.constants.invalidSortExprIndex,s=l?n[m].direction:void 0;var g=this.getDisplayNameFromQueryRef(e,r,f,a);u.push({displayName:g,exprs:[h],active:l,sortDirection:s})}}}if(o){var g=this.concatDisplayNamesForActiveItems(e,r,i,a);return[{displayName:g,exprs:c,active:l,sortDirection:l?s:void 0}]}return u},r.prototype.concatDisplayNamesForActiveItems=function(e,t,r,i){var n=this,a=_.map(r,(function(r){return n.getDisplayNameFromQueryRef(e,t,r,i)}));return a.join(" ")},r.prototype.getDisplayNameFromQueryRef=function(e,t,r,i){var n=t.withName(r),a=n&&n.expr;return a?this.displayNameService.getDisplayName(a,e,i):""},r})();r.SortService=u})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){if(e&&!_.isEmpty(e.dataRoles)){for(var r=e.dataViewMappings,i=new h(e.dataRoles),n=[],a=0,o=r;a<o.length;a++){var l=o[a],u=l.conditions;if(_.isEmpty(u))n.push(new f(i,t,s.getDrillableRoles(e)));else for(var c=0,p=u;c<p.length;c++){var v=p[c];n.push(new f(i,t,s.getDrillableRoles(e),v))}}return new d(e,i,e.objects,n)}}function n(e){return new h(e)}function a(e){return e&&e.geography&&(e.geography.latitude||e.geography.longitude)}var o=jsCommon.ArrayExtensions,s=e.explore.util.DrillUtils,l=jsCommon.MathExtensions,u=e.data.SQExpr,c=e.data.SQExprConverter,p=t.contracts.VisualQuery;r.createVisualCapabilitiesHelper=i,r.createDataRoleWrapper=n,r.isValueTypeDescriptorLatLong=a;var d=(function(){function t(e,t,r,i){this.capabilities=e,this.roles=t,this.objectDescs=r,this.roleMappings=i,this.drillableRoles=s.getDrillableRoles(e)}return t.prototype.findCompatibleRole=function(e){var t=e.expr,r=e.roleToExprMap,i=e.targetRole,n=e.preferDrillableRoles;if(u.isHierarchyLevel(t)){n=!0;var a=this.getExistingTargetRoleForHierarchyLevelIfAny(t,r);if(a){if(i&&i!==a.name)return;i=a.name}}var o,s=c.asFieldPattern(t);s&&(o=s.column||s.columnAggr||s.groupingColumn||s.groupingColumnAggr||s.measure);var l,p={projections:e.queryProjections,metadata:t.getMetadata(e.schema),columnName:o?o.name:void 0,preferDrillableRoles:!1,targetRole:i,useStrict:e.useStrict};return n||(l=this.findRole(p)),l||(p.preferDrillableRoles=!0,l=this.findRole(p)),l&&r&&r.add(t,l),l},t.prototype.findRole=function(e){var t=this.roleMappings;if(!_.isEmpty(t))for(var r=t[0].getValueType(e.metadata?e.metadata.type:void 0,e.columnName),i=this.roles.allRolesWithPreference(r?r.extendedType:void 0,e.useStrict),n=e.targetRole?[e.targetRole]:i,a=0,o=n;a<o.length;a++)for(var s=o[a],l=0,u=t;l<u.length;l++){var c=u[l],p=c.checkRoleCompatibility(e,s,i);if(p)return p}},t.prototype.getExistingTargetRoleForHierarchyLevelIfAny=function(e,t){var r=t.get(e);return r},t.prototype.orderByRolePreferences=function(t,r){for(var i=this.roles.defns,n=0,a=r.length,o=0,s=i.length;o<s;o++){var l=i[o].preferredTypes;if(!_.isEmpty(l))for(var u=n;u<a;u++){var c=r[u],p=c.getMetadata(t);if(p){var d=p.type;if(d)for(var f=0,h=l.length;f<h;f++)if(d.extendedType===e.ValueType.fromDescriptor(l[f]).extendedType){r.splice(u,1),r.splice(n,0,c),n++;break}}}}},t.prototype.getNumberRangesForRoles=function(e){var t,r=_.map(this.roles.defns,(function(e){return e.name}));t=e instanceof p?e.projections:e;for(var i={},n=0,a=r;n<a.length;n++){var o=a[n];i[o]={min:1/0,max:0}}for(var s=_.filter(this.roleMappings,(function(e){return e.projectionsAreCompatible({projections:t,roleNames:r,preferDrillableRoles:!0,ignoreMin:!0})})),u=0,c=s;u<c.length;u++)for(var d=c[u],f=d.getCondition(),h=0,v=r;h<v.length;h++){var o=v[h],m=f&&f[o],g=void 0;g=m?{min:l.max(m.min,0),max:l.min(m.max,1/0)}:{min:0,max:1/0};var y=i[o];y.min=Math.min(g.min,y.min),y.max=Math.max(g.max,y.max)}for(var C=0,b=_.values(i);C<b.length;C++){var y=b[C];y.min=Math.min(y.min,y.max)}return i},t.prototype.getNonLatLongCategoricalRoles=function(){for(var t=this.capabilities,r=t.dataViewMappings,i=[],n=0,a=r;n<a.length;n++){var o=a[n];o.categorical&&e.DataViewMapping.visitCategoricalCategories(o.categorical.categories,{visitRole:function(e){i.push(e)}})}var s=this.getLatLongRoleNames(),l=_.filter(i,(function(e){return!_.contains(s,e)}));return l},t.prototype.getLatLongRoleNames=function(){var e=this.capabilities;return _.chain(e.dataRoles).filter((function(e){if(!_.isEmpty(e.preferredTypes))return _.some(e.preferredTypes,(function(e){return a(e)}))})).map((function(e){return e.name})).value()},t.prototype.hasPreferredTypes=function(){return _.any(this.capabilities.dataRoles,(function(e){return!_.isEmpty(e.preferredTypes)}))},t})(),f=(function(){function t(e,t,r,i){this.roles=e,this.geoTaggingService=t,this.condition=i,this.drillableRoles=r}return t.prototype.getCondition=function(){return this.condition},t.prototype.checkRoleCompatibility=function(t,r,i){if(t.metadata){var n=this.roles.withName(r);if(n&&this.exprIsCompatible(n,t.metadata,e.DataViewAnalysis.getPropertyCount(r,t.projections)+1,t.preferDrillableRoles)){if(!this.projectionsAreCompatible({projections:t.projections,roleNames:_.without(i,r),preferDrillableRoles:t.preferDrillableRoles,ignoreMin:!1}))return;return n}}},t.prototype.getValueType=function(t,r){if(t&&null==t.categoryString){var i=r&&this.geoTaggingService.getFieldType(r);null!=i&&(t=e.ValueType.fromPrimitiveTypeAndCategory(t.primitiveType,i))}return t},t.prototype.projectionsAreCompatible=function(t){for(var r=0,i=t.roleNames;r<i.length;r++){var n=i[r],a=this.roles.withName(n);if(!a)return!1;var o=e.DataViewAnalysis.getPropertyCount(n,t.projections);if(!this.isCardinalityValid({count:o,roleName:a.name,preferDrillableRoles:t.preferDrillableRoles,ignoreMin:t.ignoreMin}))return!1}return!0},t.prototype.exprIsCompatible=function(t,r,i,n){if(!this.isCardinalityValid({count:i,roleName:t.name,preferDrillableRoles:n,ignoreMin:!1}))return!1;var a=t.kind;if(1===r.kind){if(a===e.VisualDataRoleKind.Grouping)return!1}else if(a===e.VisualDataRoleKind.Measure)return!1;var o=t.requiredTypes;return!(o&&!e.ValueType.isCompatibleTo(r.type,o))},t.prototype.isRoleDrillable=function(e){return _.contains(this.drillableRoles,e)&&(!this.condition[e]||void 0===this.condition[e].max||1===this.condition[e].max)},t.prototype.isCardinalityValid=function(t){if(this.condition&&(!t.preferDrillableRoles||!this.isRoleDrillable(t.roleName))){var r=this.condition[t.roleName];return!r||null==e.DataViewAnalysis.validateRange(t.count,r,t.ignoreMin)}return!0},t})(),h=(function(){function t(e){this.defns=e}return t.prototype.withName=function(e){return o.findItemWithName(this.defns,e)},t.prototype.getWeightForRole=function(r,i){for(var n=t.penalize,a=0,o=i.length;a<o;a++){var s=e.ValueType.fromDescriptor(i[a]).extendedType;if(r===s){n=t.promote;break}}return n},t.prototype.allRolesWithPreference=function(e,r){for(var i=_.map(this.defns,(function(e){return e.name})),n=i.slice(),a=0,o=i.length;a<o;a++){var s=this.withName(i[a]),l=s.preferredTypes;if(null!=l){var u=this.getWeightForRole(e,l),c=n.splice(n.indexOf(i[a]),1)[0];u!==t.penalize||r?u===t.promote&&n.splice(0,0,c):n.push(c)}}return n},t})();h.penalize=-1,h.promote=1})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new j(e.dataReaders,e.displayNameService,e.plugin,e.pluginOps,e.sortService,e.filterGenerator,e.aggrOps,e.featureSwitchService,e.transformPluginService,e.telemetryService)}function n(e,t){if(_.isEmpty(t))return{queryForTransformActions:e,internalToPublicSelectNameMappingsByRole:{}};for(var r=e.clone(),i=0,n=t;i<n.length;i++){var a=n[i];if(a.selectExprAdded){var o=r.defn.select(),s=a.selectExprAdded;o[s.selectIndex]=s.namedSQExpr,r.defn=r.defn.select(o)}else if(a.projectionQueryRefChanged){var s=a.projectionQueryRefChanged,l=r.projections[s.role];l.replaceQueryRef(s.oldQueryRef,s.newInternalQueryRef)}else a.aggregatesAdded}var u=_.reduce(t,(function(e,t){var r=t.projectionQueryRefChanged;if(r){var i=e[r.role];i||(i={},e[r.role]=i),i[r.newInternalQueryRef]=r.oldQueryRef}return e}),{});return{queryForTransformActions:r,internalToPublicSelectNameMappingsByRole:u}}function a(e,t,r,i,a,c,p,d,h,v,m,g,y){var C={};p&&(C.objects=p),d&&(C.splits=d);var b={options:e,transforms:C,warnings:v},S=n(r,h),x=S.queryForTransformActions,E=S.internalToPublicSelectNameMappingsByRole,w=x.defn.select(),F=x.defn.orderBy(),P=x.projections;if(y){var D=y.where();if(_.any(D,(function(e){return e.condition&&!_.isEmpty(e.condition.validate(t,a))})))return b.error=new O("Broken_Filters"),b}if(P){var V=[],R={},I=void 0;for(var N in P){var M=R[N]=[],j=P[N];_.isEmpty(j.activeProjectionRefs)||(I||(I={}),I[N]=_.map(j.activeProjectionRefs,(function(e){return{queryRef:e}})));for(var A=0,q=j.all();A<q.length;A++){var z=q[A],U=f.indexWithName(w,z.queryRef);V.push({queryRef:z.queryRef,format:z.format,queryIndex:U,roleName:N,displayName:z.displayName}),M.push(U)}}C.selects=[];for(var L,B=[],k=x.defn.transforms(),G=!_.isEmpty(k),Q=function(e,r){var n=s(V,e),o=w[e],u=void 0,p=g&&g[o.name];if(!G||p){if(p&&(o=p),!_.isEmpty(o.expr.validate(t,a)))return B.push(o.expr),"continue";var d=o.expr.getMetadata(t);u={type:d.type,expr:o.expr};var f=T.getKpiMetadata(o.expr,t);f&&(u.kpi=f);var h=_.find(n,(function(e){return e.queryRef===o.name&&e.displayName}));u.displayName=h?h.displayName:i.getDisplayName(o.expr,t,c);var v=n[0];if(v){var m=v.format||d.format;m&&(u.format=m)}}else u={expr:o.expr,displayName:o.name};u.roles||(u.roles={});for(var y=0,b=n;y<b.length;y++){var S=b[y];S&&S.roleName&&(u.roles[S.roleName]=!0)}L=o.name,u.queryName=_.chain(Object.keys(u.roles)).map((function(e){return E[e]&&E[e][L]})).filter(_.isString).value()[0]||L;var x=l(F,o.expr);if(x!==-1){var P=F[x];u.sort=P.direction,u.sortOrder=x}var D=T.getDefaultValue(o.expr,t);if(D){u.defaultValue={value:D};var R=o.expr.getKeyColumns(t);u.defaultValue.identityFieldsValues=T.getDefaultValues(R,t)}var I=T.getAggregateBehavior(o.expr,t);1===I&&(u.discourageAggregationAcrossGroups=!0),C.selects.push(u)},H=0,W=w.length;H<W;H++)Q(H,W);if(h)for(var K=0,J=h;K<J.length;K++){var X=J[K];X.aggregatesAdded&&u(C.selects,X.aggregatesAdded)}C.roles={ordering:R},I&&(C.roles.activeItems=I,o(C,m)),b.error=O.create(B,t)}return b}function o(e,t){var r=e&&e.roles,i=r&&r.activeItems;if(i)for(var n in i)for(var a=i[n],o=0,s=a;o<s.length;o++){var l=s[o];l.suppressConcat=_.contains(t,l.queryRef)}}function s(e,t){return _.chain(e).compact().filter((function(e){return e.queryIndex===t})).value()}function l(e,t){return _.findIndex(e,(function(e){return D.equals(e.expr,t)}))}function u(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(n.queryName===t.originalQueryRef){var a={},o=t.aggregates;o.min&&(a.min=c(o.min)),o.max&&(a.max=c(o.max)),n.aggregateSources=a;break}}var s=t.aggregates;p(e,s.min),p(e,s.max)}function c(e){return{index:e.index}}function p(e,t){if(t){var r=t.index;e[r]||(e[r]={displayName:"",queryName:t.queryName,expr:t.expr})}}function d(t,r){var i,n=[];switch(t.name){case e.visuals.plugins.map.name:var a=_.filter(r,(function(e){return"Category"===e.roleName&&e.code===C.conditionRangeTooLarge})),o=_.filter(r,(function(e){return"X"===e.roleName&&e.code===C.conditionKindExpectedGrouping})),s=_.filter(r,(function(e){return"Y"===e.roleName&&e.code===C.conditionKindExpectedGrouping}));_.isEmpty(a)?_.isEmpty(o)&&_.isEmpty(s)||(i="DataViewMappingError_LatLongAggregateWithNoLocation"):i="DataViewMappingError_LocationAndLatLongGroup"}if(!i&&1===_.size(r)){var l=r[0];switch(l.code){case C.conditionRangeTooLarge:i="DataViewMappingError_ConditionRangeTooLarge";break;case C.conditionRangeTooSmall:i="DataViewMappingError_ConditionRangeTooSmall";break;case C.conditionKindExpectedMeasure:i="DataViewMappingError_ConditionKindExpectedMeasure";break;case C.conditionKindExpectedGrouping:i="DataViewMappingError_ConditionKindExpectedGrouping"}n=[l.roleName]}if(i){var u=e.common.localize.format(i,n);return{code:i,getDetails:function(){return{displayableErrorInfo:[],message:u}}}}}var f=jsCommon.ArrayExtensions,h=e.ClientErrorStrings,v=e.data.CompiledDataViewMapping,m=e.data.DataBoundObjectQueryExtender,g=e.data.DataReaderUtils,y=e.explore.contracts.DataSource,C=e.DataViewAnalysis.DataViewMappingMatchErrorCode,b=e.data.DataViewObjectDefinitions,S=e.data.DataViewObjectDescriptors,x=e.data.services.DataViewObjectSerializer,E=e.data.DataViewRoleWildcard,w=e.data.FieldExprPattern,F=e.data.ScalarKeyUtils,P=e.data.SemanticQuery,D=e.data.SQExpr,V=e.data.SQExprBuilder,R=e.data.SQExprConverter,T=e.data.SQExprUtils,I=jsCommon.StringExtensions,N=t.util.VisualContainerUtils;r.createVisualQueryGenerator=i;var M,j=(function(){function r(e,t,r,i,n,a,o,s,l,u){this.dataReaders=e,this.displayNames=t,this.visualPluginService=r,this.pluginOps=i,this.sortService=n,this.filterGenerator=a,this.aggrOps=o,this.featureSwitchService=s,this.transformPluginService=l,this.telemetryService=u}return r.prototype.shouldExecute=function(e,t){if(!e||_.isEmpty(t))return!1;var r=e.visualType,i=this.visualPluginService.capabilities(r);if(!i)return!1;var n=this.getQueryGenerator(t,e);return!!n&&(null==e.query?m.needsToExtend(P.create(),i.objects,e.objects):this.pluginOps.isQueryVisual(r))},r.prototype.execute=function(e){var t=e.config,i=e.dataSources;if(!_.isEmpty(i)){var n=g.findTypes(i,t.query&&t.query.defn);if(!_.isEmpty(n)){var o=this.dataReaders.queryGenerator(n),s=this.getCompileMappingsResult(t,t&&t.visualType,e.schema,o,e.additionalFilters,e.dataViewMappingsOverride),l=this.dataReaders.queryExtensionLookup(i);if(s){if(s.error)return{options:null,error:s.error};var u=s.compiled;if(u){var c;if(u.query&&u.query.defn&&!_.isEmpty(u.query.defn.select())&&!_.isEmpty(u.query.defn.transforms())){c={};for(var p=0,d=u.query.defn.select();p<d.length;p++){var f=d[p];D.isTransformOutputRoleRef(f.expr)||(c[f.name]=f)}}var h=this.getVisualCapabilities(e.config.visualType),v=r.compileFilters(e.additionalFilters,h),m=this.generateQuery(o,e.schema,u,h.dataRoles,h.filterMappings,v.dataFilter,v.highlightFilter,e.restartToken,e.dataWindow,null,l),C=m.result,b=m.query,S=e.additionalFilters?e.additionalFilters.queryRefsForSingleItemDrillFilters:void 0,x=this.dataReaders.readerType(n);if(x){var E=y.queried(e.dataSources,b.defn),w={type:x,query:{dataSources:y.dataReaderDataSources(E),command:C.command,cacheResponseOnServer:e.cacheResponseOnServer,allowCache:e.allowCache,allowClientSideFilters:this.getAllowClientSideFiltersOrDefault(e,h),ignoreViewportForCache:e.ignoreViewportForCache},perfId:e.config.visualType};return a(w,e.schema,b,this.displayNames,this.aggrOps,h,u.objectDefinitions,C.splits,C.queryRewrites,s.warnings,S,c,v.dataFilter)}}}}}},r.prototype.executeForFlattenedQuery=function(e,t){var i=e.config,n=this.getQueryGenerator(e.dataSources,i);if(n){var a=this.getCompileMappingsResult(i,i&&i.visualType,e.schema,n,e.additionalFilters,e.dataViewMappingsOverride);if(a&&!a.error){var o=a.compiled;if(o){var s=this.getVisualCapabilities(e.config.visualType),l=r.compileFilters(e.additionalFilters,s);return this.generateFlattenedQuery(n,e.schema,o,s.dataRoles,s.filterMappings,l.dataFilter,l.highlightFilter,e.restartToken,e.dataWindow,t)}}}},r.prototype.getQueryGenerator=function(e,t){if(!_.isEmpty(e)){var r=t.query,i=g.findTypes(e,r&&r.defn);if(i)return this.dataReaders.queryGenerator(i)}},r.prototype.getVisualCapabilities=function(e){if(e){var t=this.visualPluginService.getPlugin(e);return t&&t.capabilities}},r.prototype.getCompileMappingsResult=function(t,r,i,n,a,o){if(t&&r&&i){var s=this.visualPluginService.getPlugin(r);if(s){var l,u=this.getVisualCapabilities(r),c=o||u.dataViewMappings,p=t.query,f=u.sorting?u.sorting.implicit:null,h=p?N.createRoleKindByQueryRef(p):{};if(c&&p){var v=e.DataViewAnalysis.chooseDataViewMappings(p.projections,c,h,u.objects,t.objects);if(!v.supportedMappings){var m=d(s,v.mappingErrors);if(m)return{error:m,compiled:null};var g=e.data.QueryProjectionsByRole.clone(p.projections);for(var y in g){var C=g[y];C.activeProjectionRefs=_.map(C.activeProjectionRefs,(function(t){return"select"+e.obfuscate(t)}));for(var b=0,S=C.all();b<S.length;b++)S[b]?S[b]={queryRef:"select"+e.obfuscate(S[b].queryRef)}:S[b]=null}var x=new O("ClientError_NoSupportedDataViewMappingFound");return x.addDebugInfo("VisualType",r),x.addDebugInfo("QueryProjectionsByRole",JSON.stringify(g)),this.telemetryService.logEvent(e.telemetry.EXVisualQueryGeneratorError,r,JSON.stringify(x.getDetails(e.common.localize).debugErrorInfo)),{error:x,compiled:null}}l=this.compileMappingsWithProperties(r,i,p,v.supportedMappings,h,u.dataRoles,u,t.objects,s.customizeQuery,f,n,a)}else l=this.compileNoMappingsWithProperties(i,p,h,c,u.dataRoles,u.objects,t.objects);var E=[];if(l){E.push.apply(E,A.validateAndAdjustRolesIfNecessary(l.mappings,l.query,i,this.displayNames,u)||[]),E.push.apply(E,q.validateAndAdjustHighlightIfNecessary(a)||[]);for(var w=0,F=E;w<F.length;w++){var P=F[w];this.telemetryService.logEvent(e.telemetry.EXVisualQueryGeneratorWarning,P.code)}}return{compiled:l,warnings:E}}}},r.compileFilters=function(e,t){var r,i;return e&&(i=e.dataFilter,r=e.highlightFilter),{dataFilter:i,highlightFilter:r}},r.prototype.getAllowClientSideFiltersOrDefault=function(e,t){if(_.isBoolean(e.allowClientSideFilters))return e.allowClientSideFilters;var r=!!S.findSelfFilter(t.objects);return r},r.prototype.compileMappingsWithProperties=function(r,i,n,a,o,s,l,u,c,p,d,f){_.isEmpty(n.defn.transforms())&&(n=t.TransformGeneratorUtils.addTransforms(u,a,n,this.transformPluginService,l));var h=e.data.compileDataView({mappings:a,queryDefn:n.defn,queryProjections:n.projections,schema:i,objectDescriptors:l.objects,objectDefinitions:u,roles:s});if(c){var v=this.getSorts(h);c({dataViewMappings:h,preferHigherDataVolume:this.featureSwitchService.featureSwitches.preferHigherDataVolume});var g=this.getSorts(h);n=this.updateSorts(n,v,g)}n=t.TransformGeneratorUtils.removeUnsupportedTransforms(this.transformPluginService,n,h),n=this.sortService.applyImplicitSort(n,p),n=this.sortService.ensureValidSorting({query:n,schema:i,visualType:r,objectDefns:u});var y=M.setProperties(i,h,n,u,l.objects),C=y.modifiedObjectDefinitions,b=y.addedScalarKeys;C=this.setFilteredToUniqueValueProperties(f,d,i,h,n,C,l.objects);var S,x,E=this.getQueryRefsByRole(n,s),w=m.extend(n.defn,i,l.objects,C,E,n.projections,o);if(w){S=new t.contracts.VisualQuery(w.queryDefn,n.projections),x=w.additionalProjections;for(var F=0,P=b;F<P.length;F++){var D=P[F],V=S.defn.selectNameOf(D.expr);D.roleItem.scalarKeyInfo||(D.roleItem.scalarKeyInfo={}),D.roleItem.scalarKeyInfo.scalarKeyQueryName=V}}return{query:S||n,mappings:h,additionalProjections:x,objectDefinitions:C}},r.prototype.getSorts=function(e){for(var t=[],r=0,i=e;r<i.length;r++){for(var n=i[r],a=[],o=0,s=n.metadata.columns;o<s.length;o++){var l=s[o];l.sort&&a.push({queryName:l.queryName,sort:l.sort,sortOrder:l.sortOrder})}t.push(a)}return t},r.prototype.updateSorts=function(e,r,i){if(_.isEqual(r,i))return e;for(var n=[],a=e.defn.select(),o=0,s=i;o<s.length;o++)for(var l=s[o],u=_.sortBy(l,(function(e){return e.sortOrder})),c=0,p=u;c<p.length;c++){var d=p[c],f=a.withName(d.queryName);n.push({direction:d.sort,expr:f.expr})}return new t.contracts.VisualQuery(e.defn.orderBy(n),e.projections)},r.prototype.getQueryRefsByRole=function(e,t){var r={};if(_.isEmpty(t))return r;for(var i=0,n=t;i<n.length;i++){var a=n[i],o=e.tryGetExprs(a.name);r[a.name]=_.map(o,(function(t){return e.defn.selectNameOf(t)}))}return r},r.prototype.setFilteredToUniqueValueProperties=function(e,t,r,i,n,a,o){var s=this;if(!e||!e.dataFilter)return a;for(var l,u=n.defn.select(),c=e.dataFilter.where(),p=e.queryRefsForSingleItemDrillFilters,d=0,f=i;d<f.length;d++){var h=f[d];h&&h.categorical&&h.categorical.categories&&v.visitCategoricalCategories(h.categorical.categories,{visitRole:function(e,i){if(!_.isEmpty(e.items))for(var n=0,o=e.items;n<o.length;n++){var d=o[n],f=d.queryName;if(d.filteredToUniqueValueProperty&&_.contains(p,f)){var h=u.withName(f),v=s.isFilteredToUniqueValues(h.expr,c,r,t);v&&(l||(l=a?b.clone(a):{}),s.setFilteredToUniqueValueProperty(v,d,l))}}}})}return l||a},r.prototype.isFilteredToUniqueValues=function(e,r,i,n){if(!n||!n.hasAmbiguousEqualitySemantics)return!0;for(var a=e.getKeyColumns(i),o=!1,s=0,l=a;s<l.length;s++){var u=l[s],c=t.FilterUtils.getFiltersForColumn(r,u);if(!_.isEmpty(c)){o=!0;for(var p=0,d=c;p<d.length;p++){var f=d[p],h=_.flatten(t.FilterUtils.getFilterValues(f,u));if(_.any(h,(function(e){return!D.isConstant(e)||n.hasAmbiguousEqualitySemantics(e);
})))return!1}}}return o},r.prototype.setFilteredToUniqueValueProperty=function(e,t,r){var i=t.filteredToUniqueValueProperty,n=V.boolean(e),a={metadata:t.queryName};b.setValue(r,i,a,n)},r.prototype.compileNoMappingsWithProperties=function(r,i,n,a,o,s,l){if(!i&&_.isEmpty(a)){i=new t.contracts.VisualQuery(P.create(),{});var u=this.getQueryRefsByRole(i,o),c=m.extend(i.defn,r,s,l,u,i.projections,n);if(c){var p=new t.contracts.VisualQuery(c.queryDefn,i.projections),d=c.additionalProjections,f=e.data.compileDataView({mappings:[{table:{rows:{for:{in:"*"}}}}],queryDefn:i.defn,queryProjections:i.projections,schema:r,objectDescriptors:s,objectDefinitions:l,roles:o});return{query:p||i,mappings:f,additionalProjections:d,objectDefinitions:l}}}},r.prototype.generateQuery=function(e,t,r,i,n,a,o,s,l,u,c){var p=this.getQueryGeneratorOptions(t,r,i,n,a,o,s,l,u,c),d=e.execute(p);return{result:d,query:r.query}},r.prototype.generateFlattenedQuery=function(e,t,r,i,n,a,o,s,l,u){var c=this.getQueryGeneratorOptions(t,r,i,n,a,o,s,l,u);return e.executeForQueryOnly?e.executeForQueryOnly(c):c.query},r.prototype.getQueryGeneratorOptions=function(e,r,i,n,a,o,s,l,u,c){var p=r.query,d=t.TransformGeneratorUtils.rewriteTransform(this.transformPluginService,p,i,this.getQueryRefsByRole(r.query,i),r.additionalProjections,r.mappings),f=this.filterGenerator.resolveFilterTargets(e,d,i,n,a),h=u?u(f):f;return{query:h,queryExtensionLookup:c,mappings:r.mappings,additionalProjections:r.additionalProjections,highlightFilter:o,restartToken:s,dataWindow:l,highVolumeOverride:this.featureSwitchService&&this.featureSwitchService.featureSwitches.highVolume}},r})();!(function(t){function r(e,t,r,n,a){for(var o,s=[],l=0,u=t;l<u.length;l++){var c=u[l];v.visitMapping(c,{visitRole:function(t,l){if(t.items)for(var u=0,c=t.items;u<c.length;u++){var p=c[u];if(p.scalarKeyInfo&&p.scalarKeyInfo.scalarKeyMinProperty){if(!o)if(n){var d=x.serializeObjects(n,a);o=x.deserializeObjects(d,a)}else o={};s.push(i(e,r,t,p,o))}}}})}return{modifiedObjectDefinitions:o||n,addedScalarKeys:s}}function i(t,r,i,n,a){var o=n.scalarKeyInfo.scalarKeyMinProperty;e.contract.check(n.scalarKeyInfo.hasScalarKey,"Scalar key requested when not available");var s=r.defn.select().withName(n.queryName).expr,l=V.aggregate(F.getScalarKeyExpr(s,t),3),u={data:[E.fromRoles([i.role])]};return b.setValue(a,o,u,l),{roleItem:n,expr:l}}t.setProperties=r})(M||(M={})),r.getDataViewMappingErrorFromFailures=d;var A,O=(function(){function t(t,r){this.messageId="VisualContainer_FailedToLoadVisual",this.displayableErrorInfo=[{errorInfoKey:"",errorInfoValue:""}],this.errorCode=t,"Missing_References"===t?(this.displayableErrorInfo[0].errorInfoKey="Missing_References_Details_Title",this.displayableErrorInfo[0].errorInfoValue=r,this.detailsMessageFormat="Missing_References_Details_Message",this.messageId="Missing_References_Message"):"Broken_Filters"===t?(this.displayableErrorInfo[0].errorInfoKey="ServiceError_CannotLoadVisual",this.displayableErrorInfo[0].errorInfoValue=e.common.localize.get("Broken_Filters_Details_Message"),this.messageId="Broken_Filters_Message"):"ClientError_NoSupportedDataViewMappingFound"===t&&(this.displayableErrorInfo[0].errorInfoKey="VisualDisplayError_Title",this.displayableErrorInfo[0].errorInfoValue=e.common.localize.get("ClientError_NoSupportedDataViewMappingFound_Message"),this.messageId="ClientError_NoSupportedDataViewMappingFound_Message")}return t.create=function(e,r){if(!_.isEmpty(e)){for(var i=[],n=0,a=e;n<a.length;n++){var o=a[n],s=R.asFieldPattern(o),l=w.toFieldExprEntityItemPattern(s),u=w.getPropertyName(s);s.hierarchy&&(u=s.hierarchy.name),s.hierarchyLevel&&(u=s.hierarchyLevel.name+"."+s.hierarchyLevel.level);var c="("+l.entity+") "+u,p=r.schema(l.schema),d=p&&p.findProperty(l.entity,u);d&&d.errorMessage&&(c+=": "+d.errorMessage),i.push(c)}return new t("Missing_References",i.join(", "))}},Object.defineProperty(t.prototype,"code",{get:function(){return this.errorCode},enumerable:!0,configurable:!0}),t.prototype.addDebugInfo=function(e,t){this.debugErrorInfo||(this.debugErrorInfo=[]),this.debugErrorInfo.push({errorInfoKey:e,errorInfoValue:t})},t.prototype.getDetails=function(e){var t=e.get(this.displayableErrorInfo[0].errorInfoKey),r=this.displayableErrorInfo[0].errorInfoValue;this.detailsMessageFormat&&(r=I.format(e.get(this.detailsMessageFormat),r));var i={message:e.get(this.messageId),displayableErrorInfo:[{errorInfoKey:t,errorInfoValue:r}],debugErrorInfo:(n=[{errorInfoKey:h.ClientErrorCode,errorInfoValue:this.code}]).concat.apply(n,this.debugErrorInfo)};return i;var n},t})();!(function(e){function t(e,t,i,n,a){for(var o=new r(t.defn,i,n,a),s=0,l=e;s<l.length;s++){var u=l[s];v.visitMapping(u,o)}return o.warnings}e.validateAndAdjustRolesIfNecessary=t;var r=(function(){function e(e,t,r,i){this.displayNameService=r,this.incompatibleExprInfo=[];for(var n=0,a=e.select();n<a.length;n++){var o=a[n],s=R.asFieldPattern(o.expr);s&&s.percentOfGrandTotal&&this.incompatibleExprInfo.push({basePropertyName:w.getPropertyName(s),fieldDisplayName:this.displayNameService.getQualifiedDisplayName(o.expr,t,i)})}this.warnings=[]}return e.prototype.visitRole=function(e){e.showAll&&this.incompatibleExprInfo.length>0&&(e.showAll=!1,this.warnings.push(new i(e.role,this.incompatibleExprInfo)))},e})(),i=(function(){function e(e,t){this.roleName=e,this.errorInfos=t}return Object.defineProperty(e.prototype,"code",{get:function(){return"ShowAllDiabledWarning"},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){var t=e.get("ShowAllDisabledWarning_Value"),r=_.map(this.errorInfos,(function(e){return e.fieldDisplayName})).join(", "),i={message:e.get("ShowAllDisabledWarning_Message"),displayableErrorInfo:[{errorInfoKey:e.get("ShowAllDiabledWarning_ErrorInfoKey"),errorInfoValue:I.format(t,r)}]};return i},e})()})(A||(A={}));var q;!(function(t){function r(t){if(t&&t.highlightFilter){var r=_.find(t.highlightFilter.where(),(function(t){return 3===e.data.FilterKindDetector.run(t.condition)}));if(r)return t.highlightFilter=void 0,[new i]}}t.validateAndAdjustHighlightIfNecessary=r;var i=(function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"HighlightWithTOPNDisabledWarning"},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){var t={message:e.get("HighlightWithTOPNDisabledWarning_Message"),displayableErrorInfo:[{errorInfoKey:e.get("HighlightWithTOPNDisabledWarning_ErrorInfoKey"),errorInfoValue:e.get("HighlightWithTOPNDisabledWarning_Value")}]};return t},e})()})(q||(q={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){return new a(e,t)}var n=t.util.VisualContainerUtils;r.createVisualRelationshipService=i;var a=(function(){function t(e,t){this.visualPluginService=e,this.pluginOps=t}return t.prototype.relationship=function(e,t,r){var i=_.filter(e.relationships,(function(e){return e.source===t&&e.target===r}));if(i)return i[0]},t.prototype.relationshipFilterAction=function(t,r,i,n){var a=this.relationship(t,r,i);if(a&&this.supportsFilterActionTarget(r,i,a.type))return a.type;if(i&&i.config&&i.config.singleVisual){var o=i.config.singleVisual,s=o.visualType,l=this.visualPluginService.capabilities(s),u=o.query;if(l&&u){var c=this.visualPluginService.getPlugin(s);if(c&&c.isCrossFilteredByDefault){var p=o.objects,d={mappings:l.dataViewMappings,queryDefn:u.defn,queryProjections:u.projections,schema:n,objectDescriptors:l.objects,objectDefinitions:p,roles:l.dataRoles},f=e.data.compileDataView(d),h={dataViewMappings:f};if(c.isCrossFilteredByDefault(h))return 3}}}return 0},t.prototype.supportsFilterActionTarget=function(t,r,i){var a=n.getVisualType(r),o=n.getVisualType(t);if(!_.isEmpty(o)&&!_.isEmpty(a)){var s=this.visualPluginService.capabilities(a),l=this.pluginOps.isQueryVisual(a),u=!s||s.supportsHighlight;switch(i){case 1:return l;case 2:return u&&o!==e.visuals.plugins.slicer.name;case 3:return l||u}}return!1},t.prototype.supportsAnyFilterAction=function(e){var t=n.getVisualType(e);if(_.isEmpty(t)||!this.pluginOps.isQueryVisual(t))return!1;var r=this.visualPluginService.capabilities(t);return!r||r.supportsSelection!==!1},t.prototype.defaultFilterAction=function(e,t){return this.supportsFilterActionTarget(e,t,2)?2:this.supportsFilterActionTarget(e,t,1)?1:void 0},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new s(e,t,r,i)}var i=e.data.SemanticFilter,n=e.data.SemanticQuery,a=e.data.services.SemanticQuerySerializer,o=e.data.SQExprBuilder;t.createHostFiltersService=r;var s=(function(){function e(e,t,r,i){this.conceptualSchemaProxy=e,this.dataProxyFactory=t,this.promiseFactory=r,this.eventBridge=i,this.filtersDictionary={}}return e.prototype.getHostAvailableCategories=function(e,t){var r=this;return this.conceptualSchemaProxy.get(e).then((function(e){var i=_.filter(e.schemas,(function(e){return!e.isExtensionSchema})),n=_.flatten(_.map(i,(function(e){return e.entities}))),a=_.flatten(_.map(n,(function(e){return e.properties}))),o=_.filter(t,(function(e){return 1===r.typeWithinSchemaCount(a,e)}));if(o.length>0){var s={categories:o};return s}return{categories:[]}}))},e.prototype.typeWithinSchemaCount=function(e,t){var r=_.filter(e,(function(e){return e.type.extendedType===t.extendedType}));return r.length},e.prototype.addOrUpdateHostFilters=function(e,t,r){var i=this;return this.conceptualSchemaProxy.get(t).then((function(n){return i.promiseFactory.all(_.map(e,(function(e){return i.addOrUpdateHostFilter(t,n,e,r)})))}))},e.prototype.removeHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];void 0!==this.filtersDictionary[i]&&delete this.filtersDictionary[i]}},e.prototype.selectHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this.filtersDictionary[i];n&&(n.selected=!0)}},e.prototype.deselectHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this.filtersDictionary[i];n&&(this.filtersDictionary[i].selected=!1)}},e.prototype.applySelectedHostFilters=function(){this.eventBridge.publishToChannel(t.events.visualContainerChanged,{affectContainer:function(){return!0},allowCache:!0})},e.prototype.getSelectedHostFilters=function(){var e=[];for(var t in this.filtersDictionary){var r=this.filtersDictionary[t];r.selected&&e.push(r.filterContainer)}return{filters:e}},e.prototype.addOrUpdateHostFilter=function(e,t,r,a){if(r.type&&r.value){for(var s=r.value.toString(),l={hostFilterValue:{value:s,type:r.type},filterValue:s,filterKey:r.type.categoryString,filterCanExecute:!1,filterReturnNonEmptyResults:!1},u=[],c=_.filter(t.schemas,(function(e){return!e.isExtensionSchema})),p=0,d=c;p<d.length;p++)for(var f=d[p],h=0,v=f.entities;h<v.length;h++)for(var m=v[h],g=0,y=m.properties;g<y.length;g++){var C=y[g];C.type.extendedType===r.type.extendedType&&u.push({schema:f,entity:m,property:C})}if(1===u.length){var b=u[0].schema,S=u[0].entity,x=u[0].property,E=o.entity(b.name,S.name),w=o.columnRef(E,x.name),F=r.alternativeValues?r.alternativeValues.concat(r.value):[r.value],P=o.inValues([w],_.map(F,(function(e){return[o.typedConstant(e,r.type)]}))),D=i.fromSQExpr(P),V={name:l.filterKey,expression:E,filter:D};if(l.filterCanExecute=!0,this.filtersDictionary[l.filterKey]={filterContainer:V,selected:!1},a){var R=n.create().addSelect(w).addSemanticFilter(D);if(R)return this.testHostFilterForNonEmptyResults(e,l,R)}}return this.promiseFactory.resolve(l)}},e.prototype.testHostFilterForNonEmptyResults=function(e,t,r){if(t.filterCanExecute&&r&&e){var i=_.compact(_.map(e,(function(e){return e.dsr}))),n={type:"dsr",query:{dataSources:i,command:{Commands:[{SemanticQueryDataShapeCommand:{Query:a.serializeQuery(r)}}]},allowCache:!0,cacheResponseOnServer:!0}},o=this.dataProxyFactory.create();return o.execute(n).then((function(e){return e.dataReaderResult.dataView.table.rows.length>0&&(t.filterReturnNonEmptyResults=!0),t}),(function(){return t}))}this.promiseFactory.reject()},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{translate:_.noop}}e.createDaxTranslator=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return{getTemplates:_.noop}}e.createDaxTemplateService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){var r=new o(e,t);return r}var i=e.data.SemanticFilter,n=e.data.SQExprConverter,a=e.data.SQExprUtils;t.createAnalyzedFilter=r;var o=(function(){function t(e,t){this.filter=e.filter,this.isNotFilter=!1,this.analyze(e,t)}return t.prototype.analyze=function(t,r){if(!i.isAnyFilter(this.filter)){var o=t.fieldSQExprs,s=i.isDefaultFilter(this.filter);if(this.filter&&!s){var l=n.asScopeIdsContainer(this.filter,o);l&&(this.isNotFilter=l.isNot,this.selectedIdentities=l.scopeIds)}if(this.defaultValue=this.getDataViewDefaultValue(t.dataView,t.defaultValuePropertyId),this.defaultValue&&!r&&(this.filter||(this.filter=i.getDefaultValueFilter(o),s=!0),s)){var u=e.data.createDataViewScopeIdentity(a.getDataViewScopeIdentityComparisonExpr(o,this.defaultValue.identityFieldsValues));this.isNotFilter=!1,this.selectedIdentities=[u]}}},t.prototype.getDataViewDefaultValue=function(t,r){if(t&&t.metadata&&!_.isEmpty(t.metadata.columns))return e.DataViewObjects.getValue(t.metadata.columns[0].objects,r)},t})();t.FilterAnalyzer=o})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.data.FilterKindDetector,i=e.data.SQScopedEvalExpr,n=(function(){function t(e){this.options=e}return t.prototype.resolveSemanticQuery=function(e){return e?e.where(this.resolveFilters(e.where()),e.from()):null},t.prototype.resolveFilters=function(e){var t=this;return e?_.map(e,(function(e){return t.resolveFilter(e)})):null},t.prototype.resolveFilter=function(e){if(!e)return null;if(e.target)return e;if(e.condition){var t=r.run(e.condition);switch(t){case 0:return this.resolveColumnFilter(e);case 2:return this.resolveExistsFilter(e);case 1:return this.resolveMeasureFilter(e);case 3:return this.resolveTopNFilter(e);default:return}}},t.prototype.resolveColumnFilter=function(e){return{condition:e.condition}},t.prototype.resolveMeasureFilter=function(e){var t=null;this.options.mappings&&this.options.mappings.measureFilter&&(t=this.options.mappings.measureFilter.targetRoles),t||(t=this.getDefaultMeasureFilterTargetRoles());var r,i,n=e.condition;if(t){for(var o=0,s=t;o<s.length;o++){var l=s[o],u=this.options.queryProjections[l];if(u)for(var c=0,p=u.all();c<p.length;c++){var d=p[c],f=this.options.select.filter((function(e){return e.name===d.queryRef})),h=f[0].expr,v=f[0].name,m=h.getMetadata(this.options.schema),g=r&&r[v];m&&1!==m.kind&&!g&&(i||(i=[],r={}),i.push(h),r[v]=!0)}}n=a.rewrite(n,t)}return{target:i,condition:n}},t.prototype.resolveExistsFilter=function(e){return e},t.prototype.resolveTopNFilter=function(e){return{condition:e.condition}},t.prototype.getDefaultMeasureFilterTargetRoles=function(){var t=this.options.dataRoles?this.options.dataRoles.filter((function(t){return t.kind===e.VisualDataRoleKind.Grouping||t.kind===e.VisualDataRoleKind.GroupingOrMeasure})):[];return t.map((function(e){return e.name}))},t})();t.VisualFilterMappingResolver=n;var a=(function(t){function r(e){var r=t.call(this)||this;return r.filterTargetRoles=e,r}return __extends(r,t),r.rewrite=function(e,t){var i=new r(t);return e.accept(i)},r.prototype.visitScopedEval=function(t){var r=this,n=_.filter(t.scope,(function(t){return!e.data.SQExpr.isRoleRef(t)||_.contains(r.filterTargetRoles,t.role)}));return n.length===t.scope.length?t:new i(t.expression,n)},r})(e.data.SQExprRewriter)})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r){var i=t.capabilities(e);return!(!i||!r.isQueryVisual(e))&&(!i.disableVisualDetails&&_.any(i.dataViewMappings,(function(e){return e.categorical||e.matrix||e.table||e.tree})))}function r(t,r){var i,n,a=r||1;return 1===a?(i=t.width-2*e.DetailVisualBorder,n=t.height-e.DetailVisualBorder):(i=t.width-e.DetailVisualBorder,n=t.height-2*e.DetailVisualBorder),{width:Math.max(i,0),height:Math.max(n,0),scale:t.scale}}e.DetailVisualBorder=10,e.supportsVisualDetails=t,e.getDetailVisualViewport=r})(t=e.DetailVisualUtils||(e.DetailVisualUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(t,r,i,n,o){if(!t)return i;var s=[],l=o.objects,u=function(e){var r=l[e],n=function(n){if(r.properties[n].type.queryTransform){var o=_.filter(t[e],(function(e){return a(e,i)}));s.push.apply(s,_.map(o,(function(t){return{objectName:e,propertyName:n,object:t}})))}};for(var o in r.properties)n(o)};for(var c in l)u(c);if(_.isEmpty(s))return i;for(var p=i.clone(),d=0,v=s;d<v.length;d++){var m=v[d],g=f.getValue(t,{objectName:m.objectName,propertyName:m.propertyName},m.object.selector);if(!g)return i;if(g.algorithm!==h.name||_.any(r,e.DataViewMapping.isForecastDefined)){var y=n.getTransformPlugin(g.algorithm);p.addTransform(y,g.parameters,o)}}return p}function n(t,r,i){var n=r.defn.transforms();if(_.isEmpty(n))return r;for(var a=r.clone(),o=0,s=n;o<s.length;o++){var l=s[o];if(l.algorithm===e.data.transforms.plugins.Forecast.name&&!_.any(i,e.DataViewMapping.isForecastDefined)){var u=t.getTransformPlugin(l.algorithm);a.removeTransform(u,l.name)}}return a}function a(e,t){if(!e.selector||!_.isString(e.selector.metadata))return!0;var r=t.projections;if(!r)return!1;for(var i in r){var n=r[i];if(n){var a=n.all();if(a)for(var o=0,s=a;o<s.length;o++){var l=s[o];if(l.queryRef===e.selector.metadata)return!0}}}return!1}function o(e,t,r,i,n,a){var o=t.defn.transforms();if(_.isEmpty(o))return t;var c=t.defn.select();if(_.isEmpty(c))return t;for(var p=u(t,r,i,n),d=p.transformSelects,f=p.topLevelSelects,h=[],g=0;g<o.length;g++){var y=o[g],b=e.getTransformPlugin(y.algorithm),S="input"+g,x="output"+g,E={algorithm:y.algorithm,name:y.name,input:{parameters:y.input.parameters,table:{name:S,columns:s(d,i,r,b,a)}},output:{table:{name:x,columns:l(d,S,t.projections)}}};d=_.map(E.output.table.columns,(function(e){var t=m.columnRef(m.transformTableRef(x),e.expression.name);return{name:e.expression.name,expr:t}})),h.push(E)}var w,F=_.last(h),P=t.defn.orderBy();F&&!_.isEmpty(P)&&(w=_.map(P,(function(e){var t=_.find(c,(function(t){return v.equals(t.expr,e.expr)})),r=m.columnRef(m.transformTableRef(F.output.table.name),t.name);return{direction:e.direction,expr:r}})));var D=t.defn.transforms(h);if(!_.isEmpty(f))for(var V=function(e){var t=_.findIndex(c,(function(t){return t.name===e.name}));d.splice(t,0,e)},R=0,T=f;R<T.length;R++){var I=T[R];V(I)}return D=D.select(d),w&&(D=D.orderBy(w)),new C(D,t.projections)}function s(e,t,r,i,n){var a=_.filter(e,(function(e){return!v.isTransformOutputRoleRef(e.expr)})),o=c(n),s=Object.keys(t);return _.map(a,(function(e){var n=_.find(s,(function(r){return _.contains(t[r],e.name)}));if(!n)return{role:"X",expression:e};var a=_.find(r,(function(e){return e.name===n}));return{role:o&&0===a.cartesianKind?void 0:p(e.expr,i,a),expression:e}}))}function l(e,t,r){for(var i={},n=0,a=e;n<a.length;n++){var o=a[n];v.isTransformOutputRoleRef(o.expr)||(i[o.name]=!0)}return _.map(e,(function(e){var n,a,o;if(v.isTransformOutputRoleRef(e.expr)){var s=void 0;for(var l in r){var u=r[l].all();_.any(u,(function(t){return t.queryRef===e.name}))&&(s=l)}n=s,a=e.expr,o=y.findUniqueName(i,e.name)}else a=m.columnRef(m.transformTableRef(t),e.name),o=e.name;return{role:n,expression:{name:o,expr:a}}}))}function u(e,t,r,i){for(var n=[],a=[],o=e.defn.select(),s=0;s<o.length;s++)if(v.isTransformOutputRoleRef(o[s].expr))n.push(o[s]);else{var l=Object.keys(r),u=_.filter(l,(function(e){return _.contains(r[e],o[s].name)}));if(_.isEmpty(u)){if(!_.isEmpty(i)){var c=_.find(i,(function(e){return e.queryName===o[s].name}));c&&c.selector&&c.selector.data?n.push(o[s]):a.push(o[s])}}else{for(var p=!1,d=0,f=u;d<f.length;d++){var h=f[d];if(!e.projections[h].activeProjectionRefs||_.contains(e.projections[h].activeProjectionRefs,o[s].name)){n.push(o[s]),p=!0;break}}p||a.push(o[s])}}return{transformSelects:n,topLevelSelects:a}}function c(e){for(var t=!1,r=0,i=e;r<i.length;r++){var n=i[r],a=n.categorical;if(a){var o=n.categorical.categories;_.isEmpty(o)||d.visitCategoricalCategories(o,{visitRole:function(e){_.any(e.items,(function(e){return e.scalarKeyInfo&&e.scalarKeyInfo.scalarKeyMinProperty}))&&(t=!0)}})}if(t)break}return t}function p(e,t,r){var i=_.find(t.inputRoles,(function(t){var i=t.visualDataRoleMatching;return!i||(void 0===i.cartesianKind||i.cartesianKind===r.cartesianKind)&&((void 0===i.matchGrouping||i.matchGrouping!==g.isMeasure(e))&&((void 0===i.matchMeasure||i.matchMeasure===g.isMeasure(e))&&(!i.skipJoinPredicateNone||0!==r.joinPredicate)))}));if(i)return i.name}var d=e.data.CompiledDataViewMapping,f=e.data.DataViewObjectDefinitions,h=e.data.transforms.plugins.Forecast,v=e.data.SQExpr,m=e.data.SQExprBuilder,g=e.data.SQExprUtils,y=jsCommon.StringExtensions,C=t.contracts.VisualQuery;r.addTransforms=i,r.removeUnsupportedTransforms=n,r.rewriteTransform=o})(r=t.TransformGeneratorUtils||(t.TransformGeneratorUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.invalidSortExprIndex=-1,e.DefaultSchemaName=void 0,e.ExplorationSchemaName="extension";var t;!(function(e){function t(){return{color:e.DefaultCanvasBackgroundColor,transparency:e.DefaultCanvasBackgroundTransparency}}e.DefaultCanvasWidth=960,e.DefaultCanvasHeight=720,e.DefaultCanvasBackgroundColor="#FFFFFF",e.DefaultCanvasBackgroundTransparency=0,e.DefaultWidescreenWidth=1280,e.DefaultWidescreenHeight=720,e.DefaultCortanaWidth=296,e.DefaultCortanaHeight=592,e.DefaultLetterWidth=816,e.DefaultLetterHeight=1056,e.getDefaultCanvasBackground=t})(t=e.ExploreCanvasConstants||(e.ExploreCanvasConstants={}))})(t=e.constants||(e.constants={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),define("Explore/services/explorationState",["require","exports"],(function(e,t){"use strict";function r(e){return new d(e)}function i(e){switch(e){case 1:return"maximize"}}function n(e){switch(e){case"maximize":return 1}}var a=powerbi,o=a.data,s=a.explore,l=(s.services,jsCommon.ArrayExtensions),u=o.DataViewObjectDefinitions,c=o.DataViewObjectDescriptors,p=o.services.DataViewObjectSerializer;t.create=r;var d=(function(){function e(e){this.plugins=e}return e.prototype.capture=function(e){var t=e.sections[e.activeSectionIndex],r={version:"0.0.0-demo",activeSection:t.name,filters:this.captureFilters(e.filters),sections:(i={},i[t.name]=this.captureSection(t),i)};return{data:r};var i},e.prototype.captureFilters=function(e){return{}},e.prototype.captureSection=function(e){var t={filters:this.captureFilters(e.filters),visualContainers:this.captureVisualContainers(e.visualContainers)};return t},e.prototype.captureVisualContainers=function(e){for(var t={},r=0,n=e;r<n.length;r++){var a=n[r],o=a.config.singleVisual;if(o){var s={filters:this.captureFilters(a.filters),singleVisual:{objects:this.captureVisualObjects(o.visualType,o.objects)}},l=i(a.popOutMode);null!=l&&(s.visibility=l),t[a.name]=s}}return t},e.prototype.captureVisualObjects=function(e,t){var r=this.plugins.capabilities(e);if(!r||!r.objects)return{};var i,n,a=o.DataViewObjectDescriptors.findFilterOutput(r.objects);if(a){var s=null,l=u.getValue(t,a,s);l?u.setValue(i||(i={}),a,s,l):(n||(n=[])).push({object:a.objectName,property:a.propertyName,selector:s})}var c={};return i&&(c.merge=p.serializeObjects(i,r.objects)),n&&(c.remove=n),c},e.prototype.apply=function(e,t){var r={visualContainers:[]},i=e.data;this.applyActiveSection(i.activeSection,t,r),this.applyFilters(i.filters,t);for(var n in i.sections){var a=l.findItemWithName(t.sections,n);if(a){var o=i.sections[n];this.applySection(o,a,r)}}return r},e.prototype.applyActiveSection=function(e,t,r){if(e!==t.sections[t.activeSectionIndex].name){var i=l.indexWithName(t.sections,e);i>=0&&(t.activeSectionIndex=i,r.activeSection=!0)}},e.prototype.applyFilters=function(e,t){return!1},e.prototype.applySection=function(e,t,r){this.applyFilters(e.filters,t)&&(f=r.visualContainers).push.apply(f,t.visualContainers);for(var i in e.visualContainers){var a=l.findItemWithName(t.visualContainers,i);if(a){var o=e.visualContainers[i],s=!1;s=this.applyFilters(o.filters,a)||s;var u=o.singleVisual,c=this.plugins.capabilities(a.config.singleVisual.visualType),p=u.objects;p&&c&&c.objects&&(s=this.applyObjects(a.config.singleVisual,p,c.objects,r)||s);var d=n(o.visibility);null!=d&&(r.visibility={visual:a,mode:d}),s&&!_.contains(r.visualContainers,a)&&r.visualContainers.push(a)}}var f},e.prototype.applyObjects=function(e,t,r,i){var n,a=e.objects||{},o=c.findFilterOutput(r);if(!_.isEmpty(t.merge)){var s=p.deserializeObjects(t.merge,r);for(var l in s)for(var d=0,f=s[l];d<f.length;d++){var h=f[d],v=u.ensure(a,l,h.selector);for(var m in h.properties){var g=h.properties[m];u.propertiesAreEqual(v.properties[m],g)||(v.properties[m]=g,n=!0,e.objects||(e.objects=a),o&&o.objectName===l&&o.propertyName===m&&(i.filterScope=1))}}}if(!_.isEmpty(t.remove))for(var y=0,C=t.remove;y<C.length;y++){var b=C[y],S=p.deserializeSelector(b.selector),l=b.object,m=b.property;u.deleteProperty(a,l,S,m)&&(n=!0,o&&o.objectName===l&&o.propertyName===m&&(i.filterScope=1))}return n},e})()}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new o(e)}var n=e.data.DataViewObjectDescriptors,a=t.util.VisualContainerUtils;r.createVisualPluginOps=i;var o=(function(){function t(e){this.plugins=e}return t.prototype.canEdit=function(t,r){var i=this.plugins.capabilities(t),n=i&&i.advancedEditModeSupport;switch(n){case 1:return!0;case 2:return r;default:return t===e.visualHost.EsriVisual||t===e.visualHost.SandDanceVisual}},t.prototype.dataViewKinds=function(t,r){if(t){var i=this.plugins.capabilities(t);if(i){var n=i.dataViewMappings,o=e.DataViewMapping.targetDataViewKinds(n);if(r){var s=a.createRoleKindByQueryRef(r),l=e.DataViewAnalysis.chooseDataViewMappings(r.projections,n,s);o=e.DataViewMapping.targetDataViewKinds(l.supportedMappings)}return o?(1&o&&(o|=2),o):void 0}}},t.prototype.supportsFocusMode=function(e){var t=this.plugins.capabilities(e);return t&&t.dataViewMappings&&!t.disableFocusMode},t.prototype.isSupportedVisual=function(e){var t=a.getVisualType(e);return!!t&&!!this.plugins.getPlugin(t)},t.prototype.canConvertVisual=function(e){if(!e)return!1;var t=a.getVisualType(e);return!!t&&(this.isQueryVisual(t)&&!a.hasGroupByItemsInQuery(e))},t.prototype.canFormatVisual=function(e){return!!e&&!a.hasGroupByItemsInQuery(e)},t.prototype.isQueryVisualContainer=function(e){var t=a.getVisualType(e);return t&&this.isQueryVisual(t)},t.prototype.isQueryVisual=function(t){if(e.visualHost.utils.shouldDisableVisual(t,e.common.localize.shouldDisableMap()))return!1;var r=this.plugins.capabilities(t);return!r||(e.ScriptResultUtil.findScriptResultMapping(r.dataViewMappings)?this.plugins.isScriptVisualQueryable():null!=r.dataViewMappings)},t.prototype.supportVisualSearch=function(e){var t=this.plugins.capabilities(e);return!(!t||!this.isQueryVisual(e))&&!!n.findSelfFilter(t.objects)},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));;var __extends=this&&this.__extends||(function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}})(),__assign=this&&this.__assign||Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},__awaiter=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(o,n){function a(e){try{l(r.next(e))}catch(e){n(e)}}function s(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return r([e,t])}}function r(i){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(a=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{o=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,n,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return{next:i(0),throw:i(1),return:i(2)}},powerbi;!(function(e){var t;!(function(t){function i(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f,m,y,w,C,S){void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=void 0),void 0===h&&(h=void 0),void 0===g&&(g=void 0),void 0===f&&(f=void 0),void 0===m&&(m=!1),void 0===y&&(y=!1),void 0===w&&(w=void 0),void 0===C&&(C=!1),void 0===S&&(S=!1);var b={reportGuid:t,originalReportGuid:i,appGuid:r,isDirectQuery:o,isCancelled1:n,isOnPrem:a,source:s,isUsageMetrics:l,groupObjectId:c,parentId:u,isError:p,errorSource:d,errorCode:v,errorMessage:h,activityName:g,activityId:f,isDebug:m,isCancelled:y,pingLatency:w,isAppInactive:C,isInCapacity:S},x={name:"PBI.EX.OpenExploration",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({reportGuid:b.reportGuid,originalReportGuid:b.originalReportGuid,appGuid:b.appGuid,isDirectQuery:b.isDirectQuery,isCancelled1:b.isCancelled1,isOnPrem:b.isOnPrem,source:e.telemetry.OpenExplorationSource[b.source],groupObjectId:b.groupObjectId,parentId:b.parentId},{isUsageMetrics:b.isUsageMetrics,isError:b.isError,errorSource:e.telemetry.ErrorSource[b.errorSource],errorCode:b.errorCode,errorMessage:b.errorMessage,activityName:b.activityName,activityId:b.activityId,isDebug:b.isDebug,isCancelled:b.isCancelled,pingLatency:b.pingLatency,isAppInactive:b.isAppInactive,isInCapacity:b.isInCapacity})},info:b,loggers:e.telemetry.EXOpenExplorationLoggers};return x}function r(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={reportGuid:t,sectionIndex:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.RefreshReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({reportGuid:g.reportGuid,sectionIndex:g.sectionIndex,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXRefreshReportLoggers};return f}function o(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={isSaveAs:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.SaveExploration",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({isSaveAs:h.isSaveAs,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXSaveExplorationLoggers};return g}function n(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={sourceVisualType:t,targetVisualType:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.InteractionVisualConversion",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({sourceVisualType:g.sourceVisualType,targetVisualType:g.targetVisualType,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXInteractionVisualConversionLoggers};return f}function a(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={sourceVisualType:t,isInlineHierarchyEnabled:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.InteractionExpand",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({sourceVisualType:g.sourceVisualType,isInlineHierarchyEnabled:g.isInlineHierarchyEnabled,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXInteractionExpandLoggers};return f}function s(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={sourceVisualType:t,isDrillDown:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.InteractionDrill",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({sourceVisualType:g.sourceVisualType,isDrillDown:g.isDrillDown,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXInteractionDrillLoggers};return f}function l(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={sourceVisualType:t,targetExprKind:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.DrillToDetails",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({sourceVisualType:g.sourceVisualType,targetExprKind:e.telemetry.FieldKind[g.targetExprKind],parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXDrillToDetailsLoggers};return f}function c(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f){void 0===a&&(a=!1),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1),void 0===h&&(h=void 0),void 0===g&&(g=!1),void 0===f&&(f=!1);var m={filterType:t,filterScopeType:i,fieldKind:r,drillToDetailsMode:o,parentId:n,isError:a,errorSource:s,errorCode:l,errorMessage:c,activityName:u,activityId:p,isDebug:d,isCancelled:v,pingLatency:h,isAppInactive:g,isInCapacity:f},y={name:"PBI.EX.AddFilter",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({filterType:e.telemetry.FilterType[m.filterType],filterScopeType:e.telemetry.FilterScopeType[m.filterScopeType],fieldKind:e.telemetry.FieldKind[m.fieldKind],drillToDetailsMode:m.drillToDetailsMode,parentId:m.parentId},{isError:m.isError,errorSource:e.telemetry.ErrorSource[m.errorSource],errorCode:m.errorCode,errorMessage:m.errorMessage,activityName:m.activityName,activityId:m.activityId,isDebug:m.isDebug,isCancelled:m.isCancelled,pingLatency:m.pingLatency,isAppInactive:m.isAppInactive,isInCapacity:m.isInCapacity})},info:m,loggers:e.telemetry.EXAddFilterLoggers};return y}function u(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={isVisualFilter:t,filterType:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.FilterPaneAdvancedFilterApplied",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({isVisualFilter:g.isVisualFilter,filterType:g.filterType,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXFilterPaneAdvancedFilterAppliedLoggers};return f}function p(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.FilterPaneClearAdvancedFilter",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXFilterPaneClearAdvancedFilterLoggers};return h}function d(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f){void 0===a&&(a=!1),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1),void 0===h&&(h=void 0),void 0===g&&(g=!1),void 0===f&&(f=!1);var m={isTop:t,itemCount:i,atGrain:r,onVisualMeasure:o,parentId:n,isError:a,errorSource:s,errorCode:l,errorMessage:c,activityName:u,activityId:p,isDebug:d,isCancelled:v,pingLatency:h,isAppInactive:g,isInCapacity:f},y={name:"PBI.EX.FilterPaneTopNFilterApplied",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({isTop:m.isTop,itemCount:m.itemCount,atGrain:m.atGrain,onVisualMeasure:m.onVisualMeasure,parentId:m.parentId},{isError:m.isError,errorSource:e.telemetry.ErrorSource[m.errorSource],errorCode:m.errorCode,errorMessage:m.errorMessage,activityName:m.activityName,activityId:m.activityId,isDebug:m.isDebug,isCancelled:m.isCancelled,pingLatency:m.pingLatency,isAppInactive:m.isAppInactive,isInCapacity:m.isInCapacity})},info:m,loggers:e.telemetry.EXFilterPaneTopNFilterAppliedLoggers};return y}function v(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={isExpanded:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.FilterPaneExpandCollapseFilter",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({isExpanded:h.isExpanded,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXFilterPaneExpandCollapseFilterLoggers};return g}function h(t){var i={message:t},r={name:"PBI.EX.LoadFilterError",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({message:i.message},{})},info:i,loggers:e.telemetry.EXLoadFilterErrorLoggers};return r}function g(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={source:t,visualType:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.CreateVisual",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({source:e.telemetry.HowVisualWasCreated[g.source],visualType:g.visualType,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXCreateVisualLoggers};return f}function f(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f,m,y){void 0===l&&(l=!1),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=void 0),void 0===d&&(d=void 0),void 0===v&&(v=void 0),void 0===h&&(h=!1),void 0===g&&(g=!1),void 0===f&&(f=void 0),void 0===m&&(m=!1),void 0===y&&(y=!1);var w={source:t,targetVisualType:i,fieldKind:r,drillToDetailsMode:o,success:n,quickMeasureTemplateName:a,parentId:s,isError:l,errorSource:c,errorCode:u,errorMessage:p,activityName:d,activityId:v,isDebug:h,isCancelled:g,pingLatency:f,isAppInactive:m,isInCapacity:y},C={name:"PBI.EX.AddField",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({source:e.telemetry.HowFieldWasAddedToVisual[w.source],targetVisualType:w.targetVisualType,fieldKind:e.telemetry.FieldKind[w.fieldKind],drillToDetailsMode:w.drillToDetailsMode,success:w.success,quickMeasureTemplateName:w.quickMeasureTemplateName,parentId:w.parentId},{isError:w.isError,errorSource:e.telemetry.ErrorSource[w.errorSource],errorCode:w.errorCode,errorMessage:w.errorMessage,activityName:w.activityName,activityId:w.activityId,isDebug:w.isDebug,isCancelled:w.isCancelled,pingLatency:w.pingLatency,isAppInactive:w.isAppInactive,isInCapacity:w.isInCapacity})},info:w,loggers:e.telemetry.EXAddFieldLoggers};return C}function m(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={sourceBucketRole:t,targetBucketRole:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.ChangeFieldWell",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({sourceBucketRole:g.sourceBucketRole,targetBucketRole:g.targetBucketRole,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXChangeFieldWellLoggers};return f}function y(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f){void 0===a&&(a=!1),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1),void 0===h&&(h=void 0),void 0===g&&(g=!1),void 0===f&&(f=!1);var m={loadType:t,onPrem:i,loadTypeWarnings:r,whereVisualIsLoaded:o,parentId:n,isError:a,errorSource:s,errorCode:l,errorMessage:c,activityName:u,activityId:p,isDebug:d,isCancelled:v,pingLatency:h,isAppInactive:g,isInCapacity:f},y={name:"PBI.EX.VisualFirstLoad",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({loadType:e.telemetry.VisualInitialLoadType[m.loadType],onPrem:m.onPrem,loadTypeWarnings:e.telemetry.VisualInitialLoadTypeWarning[m.loadTypeWarnings],whereVisualIsLoaded:m.whereVisualIsLoaded,parentId:m.parentId},{isError:m.isError,errorSource:e.telemetry.ErrorSource[m.errorSource],errorCode:m.errorCode,errorMessage:m.errorMessage,activityName:m.activityName,activityId:m.activityId,isDebug:m.isDebug,isCancelled:m.isCancelled,pingLatency:m.pingLatency,isAppInactive:m.isAppInactive,isInCapacity:m.isInCapacity})},info:m,loggers:e.telemetry.EXVisualFirstLoadLoggers};return y}function w(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={original:t,target:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.ChangeAggregation",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({original:g.original,target:g.target,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXChangeAggregationLoggers};return f}function C(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={original:t,target:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.ChangeQuickCalc",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({original:g.original,target:g.target,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXChangeQuickCalcLoggers};return f}function S(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1),void 0===v&&(v=void 0),void 0===h&&(h=!1),void 0===g&&(g=!1);var f={visualType:t,diverging:i,userValueSpecified:r,parentId:o,isError:n,errorSource:a,errorCode:s,errorMessage:l,activityName:c,activityId:u,isDebug:p,isCancelled:d,pingLatency:v,isAppInactive:h,isInCapacity:g},m={name:"PBI.EX.SetConditionalFormatting",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({visualType:f.visualType,diverging:f.diverging,userValueSpecified:f.userValueSpecified,parentId:f.parentId},{isError:f.isError,errorSource:e.telemetry.ErrorSource[f.errorSource],errorCode:f.errorCode,errorMessage:f.errorMessage,activityName:f.activityName,activityId:f.activityId,isDebug:f.isDebug,isCancelled:f.isCancelled,pingLatency:f.pingLatency,isAppInactive:f.isAppInactive,isInCapacity:f.isInCapacity})},info:f,loggers:e.telemetry.EXSetConditionalFormattingLoggers};return m}function b(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={visualType:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.RemoveConditionalFormatting",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({visualType:h.visualType,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXRemoveConditionalFormattingLoggers};return g}function x(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1),void 0===v&&(v=void 0),void 0===h&&(h=!1),void 0===g&&(g=!1);var f={visualType:t,userValueSpecified:i,fromPropertyPane:r,parentId:o,isError:n,errorSource:a,errorCode:s,errorMessage:l,activityName:c,activityId:u,isDebug:p,isCancelled:d,pingLatency:v,isAppInactive:h,isInCapacity:g},m={name:"PBI.EX.SetDataBars",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({visualType:f.visualType,userValueSpecified:f.userValueSpecified,fromPropertyPane:f.fromPropertyPane,parentId:f.parentId},{isError:f.isError,errorSource:e.telemetry.ErrorSource[f.errorSource],errorCode:f.errorCode,errorMessage:f.errorMessage,activityName:f.activityName,activityId:f.activityId,isDebug:f.isDebug,isCancelled:f.isCancelled,pingLatency:f.pingLatency,isAppInactive:f.isAppInactive,isInCapacity:f.isInCapacity})},info:f,loggers:e.telemetry.EXSetDataBarsLoggers};return m}function M(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={visualType:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.RemoveDataBars",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({visualType:h.visualType,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXRemoveDataBarsLoggers};return g}function E(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f){void 0===a&&(a=!1),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1),void 0===h&&(h=void 0),void 0===g&&(g=!1),void 0===f&&(f=!1);var m={totalVisuals:t,numberOfScriptVisuals:i,visualIds:r,userLicense:o,parentId:n,isError:a,errorSource:s,errorCode:l,errorMessage:c,activityName:u,activityId:p,isDebug:d,isCancelled:v,pingLatency:h,isAppInactive:g,isInCapacity:f},y={name:"PBI.EX.ExplorationRefresh",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({totalVisuals:m.totalVisuals,numberOfScriptVisuals:m.numberOfScriptVisuals,visualIds:m.visualIds,userLicense:m.userLicense,parentId:m.parentId},{isError:m.isError,errorSource:e.telemetry.ErrorSource[m.errorSource],errorCode:m.errorCode,errorMessage:m.errorMessage,activityName:m.activityName,activityId:m.activityId,isDebug:m.isDebug,isCancelled:m.isCancelled,pingLatency:m.pingLatency,isAppInactive:m.isAppInactive,isInCapacity:m.isInCapacity})},info:m,loggers:e.telemetry.EXExplorationRefreshLoggers};return y}function D(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.SnapshotEmbedCreate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXSnapshotEmbedCreateLoggers};return h}function F(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.PublicEmbedCreate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXPublicEmbedCreateLoggers};return h}function V(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.SnapshotEmbedRefresh",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXSnapshotEmbedRefreshLoggers};return h}function I(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.SnapshotEmbedDelete",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,
isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXSnapshotEmbedDeleteLoggers};return h}function P(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.SnapshotEmbedUpdate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXSnapshotEmbedUpdateLoggers};return h}function A(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1),void 0===v&&(v=void 0),void 0===h&&(h=!1),void 0===g&&(g=!1);var f={fileName:t,resourcePackageId:i,resourcePackageName:r,parentId:o,isError:n,errorSource:a,errorCode:s,errorMessage:l,activityName:c,activityId:u,isDebug:p,isCancelled:d,pingLatency:v,isAppInactive:h,isInCapacity:g},m={name:"PBI.EX.ImportCustomViz",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({fileName:f.fileName,resourcePackageId:f.resourcePackageId,resourcePackageName:f.resourcePackageName,parentId:f.parentId},{isError:f.isError,errorSource:e.telemetry.ErrorSource[f.errorSource],errorCode:f.errorCode,errorMessage:f.errorMessage,activityName:f.activityName,activityId:f.activityId,isDebug:f.isDebug,isCancelled:f.isCancelled,pingLatency:f.pingLatency,isAppInactive:f.isAppInactive,isInCapacity:f.isInCapacity})},info:f,loggers:e.telemetry.EXImportCustomVizLoggers};return m}function T(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={customVisualName:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.DeleteCustomViz",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({customVisualName:h.customVisualName,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXDeleteCustomVizLoggers};return g}function L(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={whereReportIsLoaded:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.LoadReportWithCustomViz",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({whereReportIsLoaded:h.whereReportIsLoaded,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXLoadReportWithCustomVizLoggers};return g}function k(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={whereVisualIsLoaded:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.EnableCustomViz",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({whereVisualIsLoaded:h.whereVisualIsLoaded,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXEnableCustomVizLoggers};return g}function R(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1),void 0===v&&(v=void 0),void 0===h&&(h=!1),void 0===g&&(g=!1);var f={sourceVisualType:t,targetVisualType:i,filterAction:r,parentId:o,isError:n,errorSource:a,errorCode:s,errorMessage:l,activityName:c,activityId:u,isDebug:p,isCancelled:d,pingLatency:v,isAppInactive:h,isInCapacity:g},m={name:"PBI.EX.VisualRelationshipOverride",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({sourceVisualType:f.sourceVisualType,targetVisualType:f.targetVisualType,filterAction:f.filterAction,parentId:f.parentId},{isError:f.isError,errorSource:e.telemetry.ErrorSource[f.errorSource],errorCode:f.errorCode,errorMessage:f.errorMessage,activityName:f.activityName,activityId:f.activityId,isDebug:f.isDebug,isCancelled:f.isCancelled,pingLatency:f.pingLatency,isAppInactive:f.isAppInactive,isInCapacity:f.isInCapacity})},info:f,loggers:e.telemetry.EXVisualRelationshipOverrideLoggers};return m}function O(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.SavedExplorationWithVisualRelationships",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXSavedExplorationWithVisualRelationshipsLoggers};return h}function _(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={isEnabled:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.FieldWellEnableDisableShowAll",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({isEnabled:h.isEnabled,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXFieldWellEnableDisableShowAllLoggers};return g}function N(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.SavedExplorationWithShowAllEnabled",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXSavedExplorationWithShowAllEnabledLoggers};return h}function z(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.CodePaneUserRunScript",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXCodePaneUserRunScriptLoggers};return h}function B(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.CodePaneUserEditScriptWithExternalIDE",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXCodePaneUserEditScriptWithExternalIDELoggers};return h}function H(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.CodePaneUserOpenOptionsDialog",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXCodePaneUserOpenOptionsDialogLoggers};return h}function G(t,i){var r={launchExternalIDEFailureType:t,message:i},o={name:"PBI.EX.CodePaneLaunchExternalIDEFailed",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({launchExternalIDEFailureType:e.telemetry.LaunchExternalIDEFailureType[r.launchExternalIDEFailureType],message:r.message},{})},info:r,loggers:e.telemetry.EXCodePaneLaunchExternalIDEFailedLoggers};return o}function U(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.CodePaneLaunchExternalIDESucceeded",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXCodePaneLaunchExternalIDESucceededLoggers};return h}function $(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1),void 0===v&&(v=void 0),void 0===h&&(h=!1),void 0===g&&(g=!1);var f={newSize:t,wasMinimized:i,isMinimized:r,parentId:o,isError:n,errorSource:a,errorCode:s,errorMessage:l,activityName:c,activityId:u,isDebug:p,isCancelled:d,pingLatency:v,isAppInactive:h,isInCapacity:g},m={name:"PBI.EX.CodePaneResize",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({newSize:f.newSize,wasMinimized:f.wasMinimized,isMinimized:f.isMinimized,parentId:f.parentId},{isError:f.isError,errorSource:e.telemetry.ErrorSource[f.errorSource],errorCode:f.errorCode,errorMessage:f.errorMessage,activityName:f.activityName,activityId:f.activityId,isDebug:f.isDebug,isCancelled:f.isCancelled,pingLatency:f.pingLatency,isAppInactive:f.isAppInactive,isInCapacity:f.isInCapacity})},info:f,loggers:e.telemetry.EXCodePaneResizeLoggers};return m}function j(t,i){var r={warningKey:t,message:i},o={name:"PBI.EX.CodePaneShowWarning",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({warningKey:r.warningKey,message:r.message},{})},info:r,loggers:e.telemetry.EXCodePaneShowWarningLoggers};return o}function Q(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.CodePaneUserCloseWarning",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXCodePaneUserCloseWarningLoggers};return h}function W(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f,m,y,w){void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=void 0),void 0===d&&(d=void 0),void 0===v&&(v=void 0),void 0===h&&(h=void 0),void 0===g&&(g=!1),void 0===f&&(f=!1),void 0===m&&(m=void 0),void 0===y&&(y=!1),void 0===w&&(w=!1);var C={visualType:t,source:i,isPartialResult:r,dest:o,isPremiumUser:n,isDrillToDetailsMode:a,dataType:s,parentId:l,isError:c,errorSource:u,errorCode:p,errorMessage:d,activityName:v,activityId:h,isDebug:g,isCancelled:f,pingLatency:m,isAppInactive:y,isInCapacity:w},S={name:"PBI.EX.ExportVisualData",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({visualType:C.visualType,source:e.telemetry.ExportVisualSource[C.source],isPartialResult:C.isPartialResult,dest:C.dest,isPremiumUser:C.isPremiumUser,isDrillToDetailsMode:C.isDrillToDetailsMode,dataType:C.dataType,parentId:C.parentId},{isError:C.isError,errorSource:e.telemetry.ErrorSource[C.errorSource],errorCode:C.errorCode,errorMessage:C.errorMessage,activityName:C.activityName,activityId:C.activityId,isDebug:C.isDebug,isCancelled:C.isCancelled,pingLatency:C.pingLatency,isAppInactive:C.isAppInactive,isInCapacity:C.isInCapacity})},info:C,loggers:e.telemetry.EXExportVisualDataLoggers};return S}function q(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.ExportVisualDataDialogShown",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXExportVisualDataDialogShownLoggers};return h}function X(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.ExportVisualDataDialogFromVisualIsShown",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXExportVisualDataDialogFromVisualIsShownLoggers};return h}function K(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={visualType:t,reason:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.SeeDataNoMatrixData",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({visualType:g.visualType,reason:g.reason,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXSeeDataNoMatrixDataLoggers};return f}function J(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f){void 0===a&&(a=!1),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1),void 0===h&&(h=void 0),void 0===g&&(g=!1),void 0===f&&(f=!1);var m={countTotalVisuals:t,countScriptVisuals:i,visualIds:r,userLicense:o,parentId:n,isError:a,errorSource:s,errorCode:l,errorMessage:c,activityName:u,activityId:p,isDebug:d,isCancelled:v,pingLatency:h,isAppInactive:g,isInCapacity:f},y={name:"PBI.EX.LoadReportWithScriptVis",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({countTotalVisuals:m.countTotalVisuals,countScriptVisuals:m.countScriptVisuals,visualIds:m.visualIds,userLicense:m.userLicense,parentId:m.parentId},{isError:m.isError,errorSource:e.telemetry.ErrorSource[m.errorSource],errorCode:m.errorCode,errorMessage:m.errorMessage,activityName:m.activityName,activityId:m.activityId,isDebug:m.isDebug,isCancelled:m.isCancelled,pingLatency:m.pingLatency,isAppInactive:m.isAppInactive,isInCapacity:m.isInCapacity})},info:m,loggers:e.telemetry.EXLoadReportWithScriptVisLoggers};return y}function Y(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f,m){void 0===s&&(s=!1),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=void 0),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1),void 0===g&&(g=void 0),void 0===f&&(f=!1),void 0===m&&(m=!1);var y={reportId:t,reportGuid:i,sectionIndex:r,sectionGuid:o,groupObjectId:n,parentId:a,isError:s,errorSource:l,errorCode:c,errorMessage:u,activityName:p,activityId:d,isDebug:v,isCancelled:h,pingLatency:g,isAppInactive:f,isInCapacity:m},w={name:"PBI.ExploreHost.ChangeReportPage",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({reportId:y.reportId,reportGuid:y.reportGuid,sectionIndex:y.sectionIndex,groupObjectId:y.groupObjectId,parentId:y.parentId},{sectionGuid:y.sectionGuid,isError:y.isError,errorSource:e.telemetry.ErrorSource[y.errorSource],errorCode:y.errorCode,errorMessage:y.errorMessage,activityName:y.activityName,activityId:y.activityId,isDebug:y.isDebug,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isAppInactive:y.isAppInactive,isInCapacity:y.isInCapacity})},info:y,loggers:e.telemetry.ExploreHostChangeReportPageLoggers};return w}function Z(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={reportId:t,numberOfVisualsRemoved:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.RemoveMobileCanvasVisuals",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({reportId:g.reportId,numberOfVisualsRemoved:g.numberOfVisualsRemoved,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXRemoveMobileCanvasVisualsLoggers};return f}function ee(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={hasContent:t,visualType:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.AnalyticsPane.Open",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({hasContent:g.hasContent,visualType:g.visualType,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXAnalyticsPaneOpenLoggers};return f}function te(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={reportGuid:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.LoadReportContainer",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({reportGuid:h.reportGuid,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXLoadReportContainerLoggers};return g}function ie(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1),void 0===v&&(v=void 0),void 0===h&&(h=!1),void 0===g&&(g=!1);var f={reportGuid:t,isDirectQuery:i,isOnPrem:r,parentId:o,isError:n,errorSource:a,errorCode:s,errorMessage:l,activityName:c,activityId:u,isDebug:p,isCancelled:d,pingLatency:v,isAppInactive:h,isInCapacity:g},m={name:"PBI.EX.InitExploration",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({reportGuid:f.reportGuid,isDirectQuery:f.isDirectQuery,isOnPrem:f.isOnPrem,parentId:f.parentId},{isError:f.isError,errorSource:e.telemetry.ErrorSource[f.errorSource],errorCode:f.errorCode,errorMessage:f.errorMessage,activityName:f.activityName,activityId:f.activityId,isDebug:f.isDebug,isCancelled:f.isCancelled,pingLatency:f.pingLatency,isAppInactive:f.isAppInactive,isInCapacity:f.isInCapacity})},info:f,loggers:e.telemetry.EXInitExplorationLoggers};return m}function re(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.LoadExplorationVisuals",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXLoadExplorationVisualsLoggers};return h}function oe(t,i,r,o,n,a,s,l,c,u,p,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:p,isInCapacity:d},h={name:"PBI.EX.LoadExplorationSchema",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({parentId:v.parentId},{isError:v.isError,errorSource:e.telemetry.ErrorSource[v.errorSource],errorCode:v.errorCode,errorMessage:v.errorMessage,activityName:v.activityName,activityId:v.activityId,isDebug:v.isDebug,isCancelled:v.isCancelled,pingLatency:v.pingLatency,isAppInactive:v.isAppInactive,isInCapacity:v.isInCapacity})},info:v,loggers:e.telemetry.EXLoadExplorationSchemaLoggers};return h}function ne(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={visualType:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.RenderExplorationVisual",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({visualType:h.visualType,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXRenderExplorationVisualLoggers};return g}function ae(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={reportGuid:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.FetchExploration",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({reportGuid:h.reportGuid,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXFetchExplorationLoggers};return g}function se(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),
void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={objectName:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.AnalyticsPane.AddInstance",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({objectName:h.objectName,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXAnalyticsPaneAddInstanceLoggers};return g}function le(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={objectName:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.AnalyticsPane.RemoveInstance",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({objectName:h.objectName,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXAnalyticsPaneRemoveInstanceLoggers};return g}function ce(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={seasonality:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.AnalyticsPane.ForecastParameterUpdated",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({seasonality:h.seasonality,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXAnalyticsPaneForecastParameterUpdatedLoggers};return g}function ue(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=!1),void 0===d&&(d=!1),void 0===v&&(v=void 0),void 0===h&&(h=!1),void 0===g&&(g=!1);var f={sourceLayout:t,targetLayout:i,viewMode:r,parentId:o,isError:n,errorSource:a,errorCode:s,errorMessage:l,activityName:c,activityId:u,isDebug:p,isCancelled:d,pingLatency:v,isAppInactive:h,isInCapacity:g},m={name:"PBI.EX.ChangeCanvasLayout",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({sourceLayout:e.telemetry.CanvasLayout[f.sourceLayout],targetLayout:e.telemetry.CanvasLayout[f.targetLayout],viewMode:e.telemetry.ViewMode[f.viewMode],parentId:f.parentId},{isError:f.isError,errorSource:e.telemetry.ErrorSource[f.errorSource],errorCode:f.errorCode,errorMessage:f.errorMessage,activityName:f.activityName,activityId:f.activityId,isDebug:f.isDebug,isCancelled:f.isCancelled,pingLatency:f.pingLatency,isAppInactive:f.isAppInactive,isInCapacity:f.isInCapacity})},info:f,loggers:e.telemetry.EXChangeCanvasLayoutLoggers};return m}function pe(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f,m){void 0===s&&(s=!1),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=void 0),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1),void 0===g&&(g=void 0),void 0===f&&(f=!1),void 0===m&&(m=!1);var y={numberOfClusters:t,visualType:i,numberOfMeasures:r,numberOfDimensions:o,numberOfFilters:n,parentId:a,isError:s,errorSource:l,errorCode:c,errorMessage:u,activityName:p,activityId:d,isDebug:v,isCancelled:h,pingLatency:g,isAppInactive:f,isInCapacity:m},w={name:"PBI.EX.Clustering.AddClustering",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({numberOfClusters:y.numberOfClusters,visualType:y.visualType,numberOfMeasures:y.numberOfMeasures,numberOfDimensions:y.numberOfDimensions,numberOfFilters:y.numberOfFilters,parentId:y.parentId},{isError:y.isError,errorSource:e.telemetry.ErrorSource[y.errorSource],errorCode:y.errorCode,errorMessage:y.errorMessage,activityName:y.activityName,activityId:y.activityId,isDebug:y.isDebug,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isAppInactive:y.isAppInactive,isInCapacity:y.isInCapacity})},info:y,loggers:e.telemetry.EXClusteringAddClusteringLoggers};return w}function de(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={code:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.Clustering.Warning",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({code:h.code,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXClusteringWarningLoggers};return g}function ve(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f,m){void 0===s&&(s=!1),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===p&&(p=void 0),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1),void 0===g&&(g=void 0),void 0===f&&(f=!1),void 0===m&&(m=!1);var y={updatedName:t,updatedDescription:i,updatedClusterNames:r,updatedNumberOfClusters:o,newNumberOfClusters:n,parentId:a,isError:s,errorSource:l,errorCode:c,errorMessage:u,activityName:p,activityId:d,isDebug:v,isCancelled:h,pingLatency:g,isAppInactive:f,isInCapacity:m},w={name:"PBI.EX.Clustering.EditClustering",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({updatedName:y.updatedName,updatedDescription:y.updatedDescription,updatedClusterNames:y.updatedClusterNames,updatedNumberOfClusters:y.updatedNumberOfClusters,newNumberOfClusters:y.newNumberOfClusters,parentId:y.parentId},{isError:y.isError,errorSource:e.telemetry.ErrorSource[y.errorSource],errorCode:y.errorCode,errorMessage:y.errorMessage,activityName:y.activityName,activityId:y.activityId,isDebug:y.isDebug,isCancelled:y.isCancelled,pingLatency:y.pingLatency,isAppInactive:y.isAppInactive,isInCapacity:y.isInCapacity})},info:y,loggers:e.telemetry.EXClusteringEditClusteringLoggers};return w}function he(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={entryPoint:t,numberOfSelects:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.QuickMeasures.OpenDialog",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({entryPoint:e.telemetry.QuickMeasureEntryPoint[g.entryPoint],numberOfSelects:g.numberOfSelects,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXQuickMeasuresOpenDialogLoggers};return f}function ge(t,i,r,o,n,a,s,l,c,u,p,d,v){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===p&&(p=void 0),void 0===d&&(d=!1),void 0===v&&(v=!1);var h={selectedQuickMeasure:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u,pingLatency:p,isAppInactive:d,isInCapacity:v},g={name:"PBI.EX.QuickMeasures.DialogResult",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({selectedQuickMeasure:h.selectedQuickMeasure,parentId:h.parentId},{isError:h.isError,errorSource:e.telemetry.ErrorSource[h.errorSource],errorCode:h.errorCode,errorMessage:h.errorMessage,activityName:h.activityName,activityId:h.activityId,isDebug:h.isDebug,isCancelled:h.isCancelled,pingLatency:h.pingLatency,isAppInactive:h.isAppInactive,isInCapacity:h.isInCapacity})},info:h,loggers:e.telemetry.EXQuickMeasuresDialogResultLoggers};return g}function fe(t,i,r,o,n,a,s,l,c,u,p,d,v,h){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===p&&(p=!1),void 0===d&&(d=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var g={selectedQuickMeasure:t,isLast:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:p,pingLatency:d,isAppInactive:v,isInCapacity:h},f={name:"PBI.EX.QuickMeasures.OnMeasureChange",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ye.generateGuid(),formatted:function(){return e.mergeFormattedEventInfo({selectedQuickMeasure:g.selectedQuickMeasure,isLast:g.isLast,parentId:g.parentId},{isError:g.isError,errorSource:e.telemetry.ErrorSource[g.errorSource],errorCode:g.errorCode,errorMessage:g.errorMessage,activityName:g.activityName,activityId:g.activityId,isDebug:g.isDebug,isCancelled:g.isCancelled,pingLatency:g.pingLatency,isAppInactive:g.isAppInactive,isInCapacity:g.isInCapacity})},info:g,loggers:e.telemetry.EXQuickMeasuresOnMeasureChangeLoggers};return f}var me,ye=jsCommon.Utility;!(function(e){e[e.Dashboard=0]="Dashboard",e[e.Report=1]="Report"})(me=t.ExportVisualSource||(t.ExportVisualSource={}));var we;!(function(e){e[e.Entity=0]="Entity",e[e.ColumnRef=1]="ColumnRef",e[e.MeasureRef=2]="MeasureRef",e[e.Aggregation=3]="Aggregation",e[e.PropertyVariationSource=4]="PropertyVariationSource",e[e.Hierarchy=5]="Hierarchy",e[e.HierarchyLevel=6]="HierarchyLevel",e[e.Other=7]="Other"})(we=t.FieldKind||(t.FieldKind={}));var Ce;!(function(e){e[e.Visual=0]="Visual",e[e.Section=1]="Section",e[e.Exploration=2]="Exploration"})(Ce=t.FilterScopeType||(t.FilterScopeType={}));var Se;!(function(e){e[e.Categorical=0]="Categorical",e[e.Range=1]="Range",e[e.Advanced=2]="Advanced",e[e.Passthrough=3]="Passthrough",e[e.Visual=4]="Visual",e[e.TopN=5]="TopN",e[e.Include=6]="Include",e[e.Exclude=7]="Exclude"})(Se=t.FilterType||(t.FilterType={}));var be;!(function(e){e[e.CheckboxTickedInFieldList=0]="CheckboxTickedInFieldList",e[e.DraggedToCanvas=1]="DraggedToCanvas",e[e.VisualTypeIconClicked=2]="VisualTypeIconClicked",e[e.DraggedToFieldWell=3]="DraggedToFieldWell",e[e.InsertVisualButton=4]="InsertVisualButton"})(be=t.HowVisualWasCreated||(t.HowVisualWasCreated={}));var xe;!(function(e){e[e.CheckboxTickedInFieldList=0]="CheckboxTickedInFieldList",e[e.DraggedToVisual=1]="DraggedToVisual",e[e.DraggedToFieldWell=2]="DraggedToFieldWell"})(xe=t.HowFieldWasAddedToVisual||(t.HowFieldWasAddedToVisual={}));var Me;!(function(e){e[e.NoCache=0]="NoCache",e[e.Cache=1]="Cache",e[e.StaleCache=2]="StaleCache"})(Me=t.VisualInitialLoadType||(t.VisualInitialLoadType={}));var Ee;!(function(e){e[e.None=0]="None",e[e.CacheMissing=1]="CacheMissing",e[e.JsonParseFailed=2]="JsonParseFailed",e[e.DsrReadFailed=3]="DsrReadFailed",e[e.DataObjectNull=4]="DataObjectNull",e[e.DsrHasOdataError=5]="DsrHasOdataError",e[e.DataTransformsMissing=6]="DataTransformsMissing"})(Ee=t.VisualInitialLoadTypeWarning||(t.VisualInitialLoadTypeWarning={}));var De;!(function(e){e[e.LaunchIDEFail=0]="LaunchIDEFail",e[e.GenerateQueryFail=1]="GenerateQueryFail"})(De=t.LaunchExternalIDEFailureType||(t.LaunchExternalIDEFailureType={}));var Fe;!(function(e){e[e.View=0]="View",e[e.Edit=1]="Edit"})(Fe=t.ViewMode||(t.ViewMode={}));var Ve;!(function(e){e[e.Normal=0]="Normal",e[e.EmailSubscription=1]="EmailSubscription"})(Ve=t.OpenExplorationSource||(t.OpenExplorationSource={}));var Ie;!(function(e){e[e.FieldWell=0]="FieldWell",e[e.FieldList=1]="FieldList"})(Ie=t.QuickMeasureEntryPoint||(t.QuickMeasureEntryPoint={})),t.EXOpenExploration=i,t.EXRefreshReport=r,t.EXSaveExploration=o,t.EXInteractionVisualConversion=n,t.EXInteractionExpand=a,t.EXInteractionDrill=s,t.EXDrillToDetails=l,t.EXAddFilter=c,t.EXFilterPaneAdvancedFilterApplied=u,t.EXFilterPaneClearAdvancedFilter=p,t.EXFilterPaneTopNFilterApplied=d,t.EXFilterPaneExpandCollapseFilter=v,t.EXLoadFilterError=h,t.EXCreateVisual=g,t.EXAddField=f,t.EXChangeFieldWell=m,t.EXVisualFirstLoad=y,t.EXChangeAggregation=w,t.EXChangeQuickCalc=C,t.EXSetConditionalFormatting=S,t.EXRemoveConditionalFormatting=b,t.EXSetDataBars=x,t.EXRemoveDataBars=M,t.EXExplorationRefresh=E,t.EXSnapshotEmbedCreate=D,t.EXPublicEmbedCreate=F,t.EXSnapshotEmbedRefresh=V,t.EXSnapshotEmbedDelete=I,t.EXSnapshotEmbedUpdate=P,t.EXImportCustomViz=A,t.EXDeleteCustomViz=T,t.EXLoadReportWithCustomViz=L,t.EXEnableCustomViz=k,t.EXVisualRelationshipOverride=R,t.EXSavedExplorationWithVisualRelationships=O,t.EXFieldWellEnableDisableShowAll=_,t.EXSavedExplorationWithShowAllEnabled=N,t.EXCodePaneUserRunScript=z,t.EXCodePaneUserEditScriptWithExternalIDE=B,t.EXCodePaneUserOpenOptionsDialog=H,t.EXCodePaneLaunchExternalIDEFailed=G,t.EXCodePaneLaunchExternalIDESucceeded=U,t.EXCodePaneResize=$,t.EXCodePaneShowWarning=j,t.EXCodePaneUserCloseWarning=Q,t.EXExportVisualData=W,t.EXExportVisualDataDialogShown=q,t.EXExportVisualDataDialogFromVisualIsShown=X,t.EXSeeDataNoMatrixData=K,t.EXLoadReportWithScriptVis=J,t.ExploreHostChangeReportPage=Y,t.EXRemoveMobileCanvasVisuals=Z,t.EXAnalyticsPaneOpen=ee,t.EXLoadReportContainer=te,t.EXInitExploration=ie,t.EXLoadExplorationVisuals=re,t.EXLoadExplorationSchema=oe,t.EXRenderExplorationVisual=ne,t.EXFetchExploration=ae,t.EXAnalyticsPaneAddInstance=se,t.EXAnalyticsPaneRemoveInstance=le,t.EXAnalyticsPaneForecastParameterUpdated=ce,t.EXChangeCanvasLayout=ue,t.EXClusteringAddClustering=pe,t.EXClusteringWarning=de,t.EXClusteringEditClustering=ve,t.EXQuickMeasuresOpenDialog=he,t.EXQuickMeasuresDialogResult=ge,t.EXQuickMeasuresOnMeasureChange=fe})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=jsCommon.DateExtensions,r=(function(){function e(e,t,i){this.op=e,this.onOperatorChanged(),this.isCalendarShown=!1,this.value=new o(t,i)}return Object.defineProperty(e.prototype,"operator",{get:function(){return this.op},set:function(e){this.op!==e&&(this.op=e,this.onOperatorChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valueRequired",{get:function(){return this.valRequired},enumerable:!0,configurable:!0}),e.prototype.accept=function(e){return e.visit(this)},e.empty=function(){return new e(0)},e.equals=function(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.operator===t.operator&&o.equals(e.value,t.value))},e.prototype.onOperatorChanged=function(){this.valRequired=t.OperatorHelper.getValueRequired(this.operator),this.valRequired||(this.value=void 0)},e})();t.Condition=r;var o=(function(){function e(e,t){null!=e&&(e instanceof Date&&(this.dateValue=e),this.value=e,this.formatter=t,this.stringValue=this.formatter?this.formatter.format(this.value):this.value.toString()),this.initialTime=this.dateValue,this.dateValue||(this.initialTime=new Date,this.initialTime.setHours(0,0,0,0))}return Object.defineProperty(e.prototype,"isDate",{get:function(){return null!=this.dateValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasValue",{get:function(){return null!=this.dateValue||!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(this.stringValue)},enumerable:!0,configurable:!0}),e.prototype.isValidDate=function(){return this.isDate&&(!_.isString(this.value)||null!==i.parseIsoDate(this.value))},Object.defineProperty(e.prototype,"timePickerValue",{get:function(){return this.dateValue||this.initialTime},set:function(e){this.dateValue=e},enumerable:!0,configurable:!0}),e.equals=function(t,i){return t=t||null,i=i||null,t===i||!t==!i&&(e.compareDateTimeValue(t,i)&&t.stringValue===i.stringValue)},e.compareDateTimeValue=function(e,t){var i=e.dateValue?e.dateValue.valueOf():0,r=t.dateValue?t.dateValue.valueOf():0;return i===r},e})();t.ConditionValue=o;var n=(function(){function i(e){this.field=e,this.conditions=[],this.operators=[],this.logicalOperator=2,this.logicalAndOperator=0,this.logicalOrOperator=1}return i.prototype.toSQExpr=function(e){var i=this.field,r=i.getMetadata(e);if(r){var o=r.type;return t.FilterCardConverter.toSQExpr(i,o,this.conditions,this.logicalOperator)}},i.prototype.getRestatement=function(e){return t.RestatementHelper.fromCondition(this.conditions,this.logicalOperator,e)},i.prototype.areConditionsValid=function(e){var i=this.conditions;if(_.isEmpty(i))return!1;for(var r=0,o=i.length;r<o;r++){var n=i[r];if(null!=n.operator&&0!==n.operator){if(n.value&&n.value.hasValue){if(t.OperatorHelper.getValueRequired(n.operator)&&n.value&&!n.value.hasValue)return!1;if(e&&!this.isConditionValid(e,n))return!1}}else if(r<o-1)return!1}return!0},i.prototype.loadOperators=function(e,i){var r=this.field;if(_.isEmpty(r.validate(e,i))){var o=r.getMetadata(e);this.operators=t.OperatorHelper.getFilterOperators(o.type)}},i.prototype.ensureConditions=function(){var e=this.operators;this.conditions||(this.conditions=[]);var t=this.conditions;for(_.isEmpty(this.conditions)&&!_.isEmpty(e)&&t.push(new r(e[0].value));t.length<2;)this.logicalOperator=0,t.push(r.empty())},i.prototype.isConditionValid=function(i,r){if(!i)return!1;var o=r.value;if(o&&o.isDate&&!o.isValidDate())return!1;var n=this.field,a=e.FilterUtils.getValueType(n,i);return!!a&&t.FilterCardConverter.isConditionValid(n,a,r)},i})();t.AdvFilterCard=n})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=jsCommon.Lazy,o=e.data.SQAndExpr,n=e.data.SQCompareExpr,a=e.data.SQConstantExpr,s=e.data.SQContainsExpr,l=e.data.SQDateSpanExpr,c=e.data.SQExpr,u=e.data.SQExprBuilder,p=e.data.SQNotExpr,d=e.data.SQOrExpr,v=e.data.SQStartsWithExpr,h=jsCommon.StringExtensions,g=/[0-9]*\.?[0-9]+%/;!(function(e){function t(e,t,i){return e.accept(new y(t,i))}function i(e,t,i,r){void 0===r&&(r=0);for(var o,n=new w(e,t,r),a=0,s=i;a<s.length;a++){var l=s[a];null!=l.operator&&0!==l.operator&&(o=l.accept(n))}return o}function r(e,t,i){var r=new w(e,t,(void 0)),o=i.accept(r);return null!=o}e.createAdvFilter=t,e.toSQExpr=i,e.isConditionValid=r})(i=t.FilterCardConverter||(t.FilterCardConverter={}));var f;!(function(i){function r(e,t,i){for(var r,o=new C(t,i),n=0,a=e;n<a.length;n++){var s=a[n];null!=s.operator&&0!==s.operator&&(r=s.accept(o))}return r}function o(t,i,r){var o,n=t.length;if(n>0){for(var a=[],s=0,c=t;s<c.length;s++){var u=c[s];a.push(l(u))}o=e.visuals.valueFormatter.formatListOr(a),o=i?h.format(e.common.localize.get("FilterRestatement_NotEqual"),o):h.format(e.common.localize.get("FilterRestatement_Equal"),o)}return o}function n(e,i,r){for(var n=[],a=0,s=e;a<s.length;a++){var l=s[a];n.push(t.RestatementHelper.getLabelFromScopeId(l,r))}return o(n,i)}function a(t,i){var r=e.data.SQExprConverter.getFirstComparandValue(t);return i?i.format(r):r}function s(t){if(null!=t)return h.format(e.common.localize.get("FilterRestatement_IsDefault"),l(t))}function l(e){return null===e?null:_.isString(e)?e:e.displayName?e.displayName:"DisplayNameIdentityPair"!=typeof e?e:void 0}i.fromCondition=r,i.fromLabels=o,i.fromDataViewScopeIdentities=n,i.getLabelFromScopeId=a,i.fromDefault=s})(f=t.RestatementHelper||(t.RestatementHelper={}));var m;!(function(t){function i(e){return 11!==e&&12!==e&&0!==e}function o(e){return e.text?a.getValue():e.integer||e.numeric?s.getValue():e.dateTime?n.getValue():void 0}var n=new r(function(){var t=[];return t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:3,label:e.common.localize.get("FilterOperator_GreaterThan_DT")}),t.push({value:4,label:e.common.localize.get("FilterOperator_GreaterThanOrEqual_DT")}),t.push({value:1,label:e.common.localize.get("FilterOperator_LessThan_DT")}),t.push({value:2,label:e.common.localize.get("FilterOperator_LessThanOrEqual_DT")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t}),a=new r(function(){var t=[];return t.push({value:5,label:e.common.localize.get("FilterOperator_Contains")}),t.push({value:6,label:e.common.localize.get("FilterOperator_DoesNotContain")}),t.push({value:7,label:e.common.localize.get("FilterOperator_StartsWith")}),t.push({value:8,label:e.common.localize.get("FilterOperator_DoesNotStartWith")}),t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t}),s=new r(function(){var t=[];return t.push({value:1,label:e.common.localize.get("FilterOperator_LessThan")}),t.push({value:2,label:e.common.localize.get("FilterOperator_LessThanOrEqual")}),t.push({value:3,label:e.common.localize.get("FilterOperator_GreaterThan")}),t.push({value:4,label:e.common.localize.get("FilterOperator_GreaterThanOrEqual")}),t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t});t.getValueRequired=i,t.getFilterOperators=o})(m=t.OperatorHelper||(t.OperatorHelper={}));var y=(function(e){function i(t,i){var r=e.call(this)||this;return r.context={isNegative:!1,allowNot:!0,logicalOperator:2},r.formatter=t,r.field=i,r}return __extends(i,e),i.prototype.visitColumnRef=function(e){if(null==this.field||c.equals(this.field,e))return this.createFilterCard(e)},i.prototype.visitGroupRef=function(e){if(null==this.field||c.equals(this.field,e))return this.createFilterCard(e)},i.prototype.visitMeasureRef=function(e){return this.createFilterCard(e)},i.prototype.visitAggr=function(e){return this.createFilterCard(e)},i.prototype.visitArithmetic=function(e){return this.createFilterCard(e)},i.prototype.visitHierarchyLevel=function(e){return this.createFilterCard(e)},i.prototype.visitEntity=function(e){return this.createFilterCard(e)},i.prototype.visitAnd=function(e){var t=this.context,i=t.isNegative?1:0;if(2===t.logicalOperator)t.logicalOperator=i;else if(t.logicalOperator!==i)return;if(e.left.accept(this)&&e.right.accept(this))return this.filter},i.prototype.visitOr=function(e){var t=this.context,i=t.isNegative?0:1;if(2===t.logicalOperator)t.logicalOperator=i;else if(t.logicalOperator!==i)return;if(e.left.accept(this)&&e.right.accept(this))return this.filter},i.prototype.visitCompare=function(e){var i=this.context,r=this.getFilterOperator(e,i.isNegative);if(void 0!==r&&0!==r){i.condition=new t.Condition(this.getFilterOperator(e,i.isNegative));var o=i.allowNot;if(i.allowNot=!1,e.left.accept(this)&&e.right.accept(this)&&(e.right instanceof a||e.right instanceof l)){var n=this.filter;return n.conditions.push(this.context.condition),n.conditions.length>1&&2===n.logicalOperator&&(n.logicalOperator=0),i.allowNot=o,i.condition=null,n}}},i.prototype.visitNot=function(e){var t=this.context,i=e.arg;if((i instanceof n||t.allowNot&&(i instanceof o||i instanceof d||i instanceof s||i instanceof v||i instanceof p))&&(t.isNegative=!t.isNegative,e.arg.accept(this)))return t.isNegative=!t.isNegative,this.filter},i.prototype.visitConstant=function(e){if(this.context.condition){var i=this.context.condition;return 0!==e.type.primitiveType&&(i.value=new t.ConditionValue(e.value,this.formatter)),this.filter}},i.prototype.visitDateSpan=function(e){if(5===e.unit){var t=this.context,i=t.allowNot;t.allowNot=!1;var r=e.arg.accept(this);return t.allowNot=i,r}},i.prototype.visitContains=function(e){var i=this.context;i.condition=new t.Condition(i.isNegative?6:5);var r=i.allowNot;if(i.allowNot=!1,e.left.accept(this)&&e.right.accept(this)){var o=this.filter;return o.conditions.push(this.context.condition),i.allowNot=r,o}},i.prototype.visitStartsWith=function(e){var i=this.context;i.condition=new t.Condition(i.isNegative?8:7);var r=i.allowNot;if(i.allowNot=!1,e.left.accept(this)&&e.right.accept(this)){var o=this.filter;return o.conditions.push(this.context.condition),i.allowNot=r,o}},i.prototype.getFilterOperator=function(e,t){switch(e.comparison){case 3:return t?3:1;case 4:return t?4:2;case 1:return t?1:3;case 2:return t?2:4;case 0:return e.right instanceof a&&0===e.right.type.primitiveType?t?12:11:t?10:9}},i.prototype.createFilterCard=function(e){return this.filter||(this.filter=new t.AdvFilterCard(e),this.filter.logicalOperator=this.context.logicalOperator),this.filter},i})(e.data.DefaultSQExprVisitor),w=(function(){function t(e,t,i){this.propertyExpr=e,this.dataType=t,this.logicalOperator=i}return t.prototype.visit=function(e){var t=this.expandExpr(e);return t&&(this.result?0===this.logicalOperator?this.result=u.and(this.result,t):1===this.logicalOperator&&(this.result=u.or(this.result,t)):this.result=t),this.result},t.prototype.expandExpr=function(e){var t,i=11!==e.operator&&12!==e.operator;if(i&&(t=this.getValueExpr(e)),t||!i)switch(e.operator){case 9:return u.compare(0,this.propertyExpr,t);case 10:return u.not(u.compare(0,this.propertyExpr,t));case 11:return u.compare(0,this.propertyExpr,u.nullConstant());case 12:return u.not(u.compare(0,this.propertyExpr,u.nullConstant()));case 5:return u.contains(this.propertyExpr,t);case 6:return u.not(u.contains(this.propertyExpr,t));case 7:return u.startsWith(this.propertyExpr,t);case 8:return u.not(u.startsWith(this.propertyExpr,t));case 3:return u.compare(1,this.propertyExpr,t);case 4:return u.compare(2,this.propertyExpr,t);case 1:return u.compare(3,this.propertyExpr,t);case 2:return u.compare(4,this.propertyExpr,t)}},t.prototype.getValueExpr=function(t){var i=this.dataType;if(t.value){var r=t.value.stringValue;if((i.integer||i.numeric)&&r){var o=e.formattingService.parseFloat(r);if(isNaN(o))return;return r.match(g)&&(o/=100),2===i.primitiveType?u.decimal(o):u.double(o)}if(i.text&&r)return u.text(r);if(i.dateTime){var n=t.value.dateValue;if(n)return u.dateSpan(5,u.dateTime(n))}}},t})(),C=(function(){function t(t,i){0===t?this.logicalOperatorResourceId=e.common.localize.get("FilterRestatement_CompoundAnd"):1===t&&(this.logicalOperatorResourceId=e.common.localize.get("FilterRestatement_CompoundOr")),this.formatter=i}return t.prototype.visit=function(e){var t=this.conditionToString(e);if(t)return _.isEmpty(this.result)?this.result=t:this.result=h.format(this.logicalOperatorResourceId,this.result,t),this.result},t.prototype.conditionToString=function(t){var i=t.value;if(!m.getValueRequired(t.operator)||i&&i.hasValue){var r;switch(i&&(r=this.formatter?this.formatter.format(i.value||i.stringValue):i.stringValue),t.operator){case 9:return h.format(e.common.localize.get("FilterRestatement_Equal"),r);case 10:return h.format(e.common.localize.get("FilterRestatement_NotEqual"),r);case 3:return i.isDate?h.format(e.common.localize.get("FilterRestatement_GreaterThan_DT"),r):h.format(e.common.localize.get("FilterRestatement_GreaterThan"),r);case 4:return i.isDate?h.format(e.common.localize.get("FilterRestatement_GreaterThanOrEqual_DT"),r):h.format(e.common.localize.get("FilterRestatement_GreaterThanOrEqual"),r);case 1:return i.isDate?h.format(e.common.localize.get("FilterRestatement_LessThan_DT"),r):h.format(e.common.localize.get("FilterRestatement_LessThan"),r);case 2:return i.isDate?h.format(e.common.localize.get("FilterRestatement_LessThanOrEqual_DT"),r):h.format(e.common.localize.get("FilterRestatement_LessThanOrEqual"),r);case 5:return h.format(e.common.localize.get("FilterRestatement_Contains"),r);case 6:return h.format(e.common.localize.get("FilterRestatement_DoesNotContain"),r);case 7:return h.format(e.common.localize.get("FilterRestatement_StartWith"),r);case 8:return h.format(e.common.localize.get("FilterRestatement_DoesNotStartWith"),r);case 11:return e.common.localize.get("FilterOperator_IsBlank");case 12:return e.common.localize.get("FilterOperator_IsNotBlank");default:return""}}},t})()})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.common.utils.ColorUtility,o=e.explore.contracts,n=jsCommon.CssConstants.createClassAndSelector,a=jsCommon.CssConstants,s=e.data.DataViewObjectDefinitions,l=e.data.DataViewObjectEvaluator,c=e.explore.constants.ExploreCanvasConstants,u=e.visualHost.ResourcePackageReferenceResolver;!(function(t){function i(e,i,r,o){var n=(e.outerViewport.width-e.canvasOptions.scrollbarOffset)/e.viewModel.width;i.scrollTop(0).scrollLeft(0);var s=i.find(t.DisplayAreaNameSelector.selector),l=e.viewModel.width*n,u=n<c.DisplayAreaHeightAdditionMinimumScale?n+c.DisplayAreaHeightScaleAddtion:n,p=e.viewModel.height*u+o,d="",v="";if(e.canvasViewStyle=0,p>=e.outerViewport.height?(e.canvasViewStyle|=1,i.css(a.overflowXProperty,a.hiddenValue).css(a.overflowYProperty,a.autoValue)):(e.canvasViewStyle|=2,d=-(l/2)+"px",v=-(p/2)+"px",i.css(a.overflowXProperty,a.hiddenValue).css(a.overflowYProperty,a.hiddenValue)),e.adjustScaleForLayout){var h=e.adjustScaleForLayout({x:n,y:n});if(h.x!==n||h.y!==n){var f=Math.min(h.x,h.y),m=f/n;l*=m,p=(p-o)*m+o,n=f}}r.setCanvasScaleFactor(n),g(e,l,p),s.attr("class",t.DisplayAreaNameSelector.class+" "+w(e)),s.css({marginLeft:d,marginTop:v,width:l+"px",height:p+"px"})}function p(e,i,r,o,n){var s=i.find(t.DisplayAreaNameSelector.selector),l=(e.outerViewport.width-e.canvasOptions.scrollbarOffset)/e.viewModel.width,c=o.getConfig(),u=c.displayOptions.hideTileMenu?e.outerViewport.height:e.outerViewport.height-n,p=u/e.viewModel.height,d=Math.min(l,p);if(e.adjustScaleForLayout){var v=e.adjustScaleForLayout({x:d,y:d});v.x===d&&v.y===d||(d=Math.min(v.x,v.y))}i.scrollTop(0).scrollLeft(0);var h=e.viewModel.width*d,f=e.viewModel.height*d+n;e.canvasViewStyle=0,e.canvasViewStyle|=4,i.css(a.overflowXProperty,a.hiddenValue).css(a.overflowYProperty,a.hiddenValue),
r.setCanvasScaleFactor(d),g(e,h,f),s.attr("class",t.DisplayAreaNameSelector.class+" "+w(e)),s.css({marginLeft:-(h/2)+"px",marginTop:-(f/2)+"px",width:h+"px",height:f+"px"})}function d(e,i,r,o){var n=i.find(t.DisplayAreaNameSelector.selector);n.removeAttr(a.styleAttribute),e.canvasViewStyle=8,r.setCanvasScaleFactor(1),g(e,e.outerViewport.width,e.outerViewport.height),i.css(a.overflowXProperty,a.hiddenValue).css(a.overflowYProperty,a.hiddenValue),n.attr("class",t.DisplayAreaNameSelector.class+" "+w(e))}function v(e,i,r,o){var n=i.find(t.DisplayAreaNameSelector.selector),s=i.find(F.selector),l=s&&s.length>0;e.canvasViewStyle=0;var u="",p="",d=e.viewModel.width,v=e.viewModel.height+o,h=l?c.PhoneAuthoringViewportWidth:d,f=l?c.PhoneAuthoringViewportHeight:v;h>e.outerViewport.width?(e.canvasViewStyle|=512,i.css(a.overflowXProperty,a.autoValue)):(e.canvasViewStyle|=256,u=-1*(h/2)+"px",i.css(a.overflowXProperty,a.hiddenValue)),f>e.outerViewport.height?(e.canvasViewStyle|=128,i.css(a.overflowYProperty,a.autoValue)):(e.canvasViewStyle|=64,p=-1*(f/2)+"px",i.css(a.overflowYProperty,a.hiddenValue)),u.length>0&&p.length>0?e.canvasViewStyle|=32:e.canvasViewStyle|=16,n.css({width:h+"px",height:f+"px",top:"",left:"",marginTop:p,marginLeft:u}),r.setCanvasScaleFactor(1),g(e,d,v);var m=w(e);n.attr("class",t.DisplayAreaNameSelector.class+" "+m),l&&s.attr("class",F.class+" "+m)}function h(e,i,r,o){var n=i.find(t.DisplayAreaNameSelector.selector);e.canvasViewStyle=0,e.canvasViewStyle|=512,e.canvasViewStyle|=128,e.canvasViewStyle|=16,e.viewModel.width>=e.outerViewport.width?i.css(a.overflowXProperty,a.autoValue):i.css(a.overflowXProperty,a.hiddenValue),e.viewModel.height>=e.outerViewport.height?i.css(a.overflowYProperty,a.autoValue):i.css(a.overflowYProperty,a.hiddenValue),r.setCanvasScaleFactor(1);var s=e.viewModel.width,l=e.viewModel.height+o;n.css({width:s+"px",height:l+"px"}),g(e,s,l),n.attr("class",t.DisplayAreaNameSelector.class+" "+w(e))}function g(e,t,i){var r={width:t,height:i};r.width>0&&r.height>0&&(e.forceSyncSizeUpdates?e.size=r:e.$evalAsync((function(){return e.size=r})))}function f(t,i,n,a,u,p,d,v,h,g){if(v.getCurrentLayoutCapabilities().canShowCanvasBackground()){var f=s.getObjectDefinition(n,"background",null);if(t.background&&f||(t.background=c.getDefaultCanvasBackground()),t.hasPopOut)t.background.color=c.DefaultCanvasBackgroundColor,t.background.transparency=0,t.background.image=null;else if(f){var w=l.run(e.data.createStaticEvalContext(),o.Section.objectDescriptors.background,f.properties);w&&null!==w.color||(t.background.color=c.DefaultCanvasBackgroundColor,t.background.image=null),w&&(t.background.color=e.DataViewObject.getFillColorByPropertyName(w,"color",c.DefaultCanvasBackgroundColor),t.background.transparency=e.DataViewObject.getValue(w,"transparency",c.DefaultCanvasBackgroundTransparency),t.background.image=w.image)}var C=t.background.image,S=f?f.properties.image:null,b=S&&e.data.SQExpr.isResourcePackageItem(S.url);b?y(t,C,S.url,f,u,p,d,g):m(t,t.background,C,C?C.url:"",t.hasPopOut,g)}else{var x=c.getDefaultCanvasBackground();t.background=x,m(t,x,null,"",t.hasPopOut,g)}h&&h.getConfig().displayOptions.extendBackgroundToWholeCanvas?i.css({"background-color":r.hexToRGBString(t.background.color,(100-t.background.transparency)/100)}):i.css({"background-color":""})}function m(t,i,o,n,a,s){var l=o&&o.scaling;t.imageFitClass=l,t.imageSource=o&&n,t.imageStyle=l===e.visuals.imageScalingType.normal?{transform:"scale("+s.getCanvasScaleFactor()+")"}:{},t.backgroundStyle={opacity:a?1:(100-i.transparency)/100,"background-color":r.hexToRGBString(i.color)}}function y(t,i,r,o,n,a,s,l){var c=a.getCurrentExploration();if(c){var p=t.viewModel.contract;u.loadAndResolveFromSQExpr(r,c.resourcePackages,n,s).then((function(n){var a=o.properties.image;p===t.viewModel.contract&&a&&e.data.SQExpr.equals(a.url,r)&&m(t,t.background,i,n.value||"",t.hasPopOut,l)}))}}function w(e){var t="";return e.useResponsiveLayout&&(t+=" responsive"),e.disableAnimations&&(t+=" disableAnimations"),8===(8&e.canvasViewStyle)&&(t+=" fitToScreen"),4===(4&e.canvasViewStyle)&&(t+=" fitToPage"),1===(1&e.canvasViewStyle)&&(t+=" fitToWidthOrigin"),2===(2&e.canvasViewStyle)&&(t+=" fitToWidthCentered"),256===(256&e.canvasViewStyle)&&(t+=" actualSizeAlignCenter"),512===(512&e.canvasViewStyle)&&(t+=" actualSizeAlignLeft"),64===(64&e.canvasViewStyle)&&(t+=" actualSizeAlignMiddle"),128===(128&e.canvasViewStyle)&&(t+=" actualSizeAlignTop"),32===(32&e.canvasViewStyle)&&(t+=" actualSizeCentered"),16===(16&e.canvasViewStyle)&&(t+=" actualSizeOrigin"),t.trim()}function C(e){return e&&e.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()?0:c.AutoLayoutVisualVCHeader}function S(e,t,r){if(e.viewModel&&e.viewModel.contract){var o=r.canvasScale.getDisplayOption(),n=C(r.formFactor);switch(o){case 2:i(e,t,r.canvasScale,n);break;case 1:p(e,t,r.canvasScale,r.viewModeState,n);break;case 3:v(e,t,r.canvasScale,n);break;case 4:h(e,t,r.canvasScale,n);break;case 0:d(e,t,r.canvasScale,n);break;default:d(e,t,r.canvasScale,n)}}}function b(e,t){V=e.css(a.overflowXProperty),I=e.css(a.overflowYProperty),e.css(a.overflowXProperty,t),e.css(a.overflowYProperty,t)}function x(e){e.css(a.overflowXProperty,V),e.css(a.overflowYProperty,I)}function M(e){return{left:e.x,top:e.y,width:e.width,height:e.height}}function E(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}function D(e){return e.width===c.DefaultCortanaWidth&&e.height===c.DefaultCortanaHeight}t.DisplayAreaNameSelector=n("displayArea"),t.VisualContainerHostSelector=n("visualContainerHost"),t.VisualBackgroundContainerSelector=n("visualBackgroundContainer"),t.VisualBackgroundImageSelector=n("visualBackgroundImage"),t.DefaultVisualPosition={x:100,y:100,width:300,height:300};var F=n("canvasBackdrop"),V="",I="";t.fitToWidth=i,t.fitToPage=p,t.fitToScreen=d,t.displayInActualSize=v,t.displayInActualSizeTopLeft=h,t.updateCanvasSize=g,t.updateAndApplyCanvasBackground=f,t.convertDisplayOptionToStyle=w,t.getAutoLayoutVisualVCHeader=C,t.applyFitOption=S,t.storeOverflowValuesAndChange=b,t.restoreOverflowValues=x,t.visualPositionToRect=M,t.rectToVisualPosition=E,t.isCortanaPageSize=D})(i=t.CanvasDisplayUtility||(t.CanvasDisplayUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=jsCommon.ArrayExtensions,n=e.explore.services.RegisteredResourceReferences;!(function(r){function a(e,t){return _.filter(e.visualContainers,(function(e){return e.isSelected}))}function s(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i];if(o.contract===t)return o}}function l(e,t){for(var i=[],r=t.getSelectedElements(),o=0,n=r;o<n.length;o++){var a=n[o];a.visualContainer&&i.push(e.serializeVisualContainer(a.visualContainer))}return i}function c(e,t){for(var i=[],r=e.getSelectedElements(),o=0,a=r;o<a.length;o++){var s=a[o],l=s.visualContainer&&s.visualContainer.config&&s.visualContainer.config.singleVisual&&s.visualContainer.config.singleVisual.objects;n.addObjectsReferences(l,t,i)}return i}function u(e,t,i){e=Math.max(0,e-t/2);var r=e+t-i;return r>0&&(e-=r),e}function p(e,r,n,a,s,l,c){if(e){for(var u=[],p=0,d=e.length;p<d;++p){var v=a.deserializeVisualContainer(e[p],!0,i.VisualContainerUtils.uniqueName(r.contract.visualContainers)),g=c.getCurrentLayout(),f=v.layouts.withId(g);v.layouts=o.extendWithId([f]);for(var m=f.position;h(m,r);){m.x+=10,m.y+=10;var y=0;if(m.x+m.width>r.width&&(m.x=Math.max(r.width-m.width,0),y++),m.y+m.height>r.height&&(m.y=Math.max(r.height-m.height,0),y++),2===y)break}r.contract.visualContainers.push(v);var w=t.viewModels.ViewModelFactory.convertVisualContainer(n,r.contract,v,g);w&&(r.visualContainers.push(w),u.push(v))}t.services.selectionUtils.selectVisualContainers(u,s);for(var C=0,S=u;C<S.length;C++){var v=S[C];l.applyFilterOutput(v)}}}function d(t,r,o,n,a){if(t.expr)n.addVisualContainer({expr:t.expr,visualType:t.visualType,targetRole:t.targetRole,dataSources:o,allowAggregate:!0},r).then((function(r){a.logEvent(e.telemetry.EXCreateVisual,v(t.telemetrySource),i.VisualContainerUtils.getVisualType(r))}));else{var s=n.addEmptyVisualContainer(r,t.visualType);a.logEvent(e.telemetry.EXCreateVisual,v(t.telemetrySource),i.VisualContainerUtils.getVisualType(s))}}function v(t){switch(t){case 0:return e.telemetry.HowVisualWasCreated.CheckboxTickedInFieldList;case 3:return e.telemetry.HowVisualWasCreated.DraggedToFieldWell;case 1:return e.telemetry.HowVisualWasCreated.DraggedToCanvas;case 2:return e.telemetry.HowVisualWasCreated.VisualTypeIconClicked;case 4:return e.telemetry.HowVisualWasCreated.InsertVisualButton}}function h(e,t){return _.any(t.visualContainers,(function(t){return t.position.x===e.x&&t.position.y===e.y}))}function g(e,i,r){var o=e.visualContainers.slice().sort(m),n=t.services.selectionUtils.getSelectedVisual(i);if(n){var a=s(e.visualContainers,n);if(a){var l=_.indexOf(o,a);switch(r){case 1:o.push(o.splice(l,1)[0]);break;case 2:o.unshift(o.splice(l,1)[0]);break;case 3:l<o.length-1&&jsCommon.ArrayExtensions.swap(o,l+1,l);break;case 4:l>0&&jsCommon.ArrayExtensions.swap(o,l-1,l)}}}for(var c=0,u=o.length;c<u;c++){var p=o[c];p.position.z=c,p.updateViewState()}}function f(e,i){var r=t.services.selectionUtils.getSelectedVisual(i);if(r)for(var o=_.max(e,(function(e){return e.position.z})),n=o instanceof t.viewModels.VisualContainer?(o.position.z||0)+1:1,a=s(e,r),l=0,c=e;l<c.length;l++){var u=c[l];u.zIndexOverride=u===a?n:null,u.updateViewState()}else for(var p=0,d=e;p<d.length;p++){var u=d[p];u.zIndexOverride=null,u.updateViewState()}}function m(e,t){var i=e.position.z||0,r=t.position.z||0;return i<r?-1:i>r?1:0}function y(e,t,i){var r={x:e.x*t.x,y:e.y*t.y,z:e.z,width:e.width*t.x,height:e.height*t.y,angle:e.angle};if(i===!0){var o=Math.round(r.x),n=Math.round(r.y),a=Math.round(r.x+r.width),s=Math.round(r.y+r.height),l={x:o,y:n,z:r.z,width:a-o,height:s-n,angle:e.angle};r=l}return r}function w(e,t){return{x:e.x/t.x,y:e.y/t.y,z:e.z,width:e.width/t.x,height:e.height/t.y,angle:e.angle}}function C(e,t){return{left:e.left*t.x,top:e.top*t.y,width:e.width*t.x,height:e.height*t.y}}function S(e,t){return{left:e.left/t.x,top:e.top/t.y,width:e.width/t.x,height:e.height/t.y}}function b(e){if(!e||_.isEmpty(e.visualContainers))return 0;var t=_.chain(e.visualContainers).map((function(e){return e.position&&e.position.z||0})).max().value();return t+1}r.getSelectedCanvasVisualContainers=a,r.findVisualContainerViewModel=s,r.serializeSelection=l,r.getSelectionResources=c,r.checkBoundaryForCharts=u,r.duplicateVisuals=p,r.addVisualContainerToCanvas=d,r.rearrangeVisualsOrder=g,r.moveSelectedItemToFront=f,r.convertToScaledPosition=y,r.convertFromScaledPosition=w,r.convertToScaledRect=C,r.convertFromScaledRect=S,r.getZIndexForNewVisual=b})(r=i.CanvasVisualsUtility||(i.CanvasVisualsUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.data.DataViewObjectDefinitions,o=e.visuals.GradientUtils,n=e.data.SQExprBuilder;!(function(t){function i(e,t){var i=p(e.objects,t);if(i&&i.solid&&i.solid.color){var r=i.solid.color;if(r&&r.rule){var n=r.rule;return o.getGradientSettings(n)}}}function a(e,t){var i=t&&p(e,t);return void 0!==i}function s(e){var t=o.getDefaultFillRuleDefinition();return{solid:{color:n.fillRule(e,t)}}}function l(t,i,r){var o,a={color:n.text(i.minColor)},s=i.minValue;null!=s&&(o=d(s,r));var l,c;if(i.diverging){l={color:n.text(i.midColor)};var u=i.midValue;null!=u&&(c=d(u,r))}var p,v={color:n.text(i.maxColor)},h=i.maxValue;null!=h&&(p=d(h,r));var g,f=i.nullStrategy,m=i.nullColor,y={};return g=i.diverging?y.linearGradient3={min:a,mid:l,max:v}:y.linearGradient2={min:a,max:v},o&&(g.min.value=o),c&&(g.mid.value=c),p&&(g.max.value=p),f&&(g.nullColoringStrategy={strategy:n.text(f)},f===e.NullStrategy.specificColor&&m&&(g.nullColoringStrategy.color=n.text(m))),{solid:{color:n.fillRule(t,y)}}}function c(e,t,i){return _.find(i,(function(i){if(i.selector.metadata===e){var r=u(i);if(r){var o=t.objects[r.objectName];if(o){var n=o.properties[r.propertyName];if(n)return n.type.fill}}}}))}function u(e){for(var t in e.objects){var i=e.objects[t],r=_.first(i.formattingProperties);if(_.isEmpty(r))return;return{objectName:t,propertyName:r}}}function p(e,t){if(e){var i=t.selector,o=u(t);if(o)return r.getValue(e,o,i)}}function d(e,t){if(t.integer){var i=Math.round(e);return n.integer(i)}return 2===t.primitiveType?n.decimal(e):n.double(e)}t.getGradientSettings=i,t.isConditionalFormattingApplied=a,t.createDefaultFillDefinition=s,t.createFillDefinition=l,t.findObjectRepetition=c,t.getFirstFormatPropertyPropertyId=u})(i=t.ConditionalFormattingUtil||(t.ConditionalFormattingUtil={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.data.DataViewObjectDefinitions,o=e.data.SQExprBuilder;!(function(t){function i(e,t,i){var r=u(e.objects,t,i);if(!r)return d;var o,n=r.minValue;n&&(o=n.value);var a,s=r.maxValue;s&&(a=s.value);var l={solid:{color:r.positiveColor.solid.color.value}},c={solid:{color:r.negativeColor.solid.color.value}},p={solid:{color:r.axisColor.solid.color.value}};return{minValue:o,maxValue:a,positiveColor:l,negativeColor:c,axisColor:p,reverseDirection:r.reverseDirection.value,hideText:r.hideText.value}}function n(){return a(d,e.ValueType.fromPrimitiveTypeAndCategory(12))}function a(t,i){var r;void 0!==t.minValue&&(r=p(t.minValue,i));var n;return void 0!==t.maxValue&&(n=p(t.maxValue,i)),{minValue:r,maxValue:n,positiveColor:e.fillDefinitionHelpers.createSolidFillDefinition(t.positiveColor.solid.color),negativeColor:e.fillDefinitionHelpers.createSolidFillDefinition(t.negativeColor.solid.color),axisColor:e.fillDefinitionHelpers.createSolidFillDefinition(t.axisColor.solid.color),reverseDirection:o.boolean(t.reverseDirection),hideText:o.boolean(t.hideText)}}function s(e,t,i){return void 0!==u(e,t,i)}function l(e,t,i){return _.find(i,(function(i){if(i.selector.metadata===e){var r=c(i);if(r){var o=t.objects[r.objectName];if(o){var n=o.properties[r.propertyName];if(n)return n.type.dataBars}}}}))}function c(e){var t=Object.keys(e.objects)[0],i=_.first(e.objects[t].formattingProperties);if(!_.isEmpty(i))return{objectName:t,propertyName:i}}function u(e,t,i){if(e)return r.getValue(e,t,i)}function p(e,t){if(t.integer){var i=Math.round(e);return o.integer(i)}return 2===t.primitiveType?o.decimal(e):o.double(e)}var d={positiveColor:{solid:{color:"#01B8AA"}},negativeColor:{solid:{color:"#FD625E"}},axisColor:{solid:{color:"#333333"}},reverseDirection:!1,hideText:!1};t.getDataBarsSettings=i,t.createDefaultDataBarsDefinition=n,t.createDataBarsDefinition=a,t.isDataBarsApplied=s,t.findObjectRepetition=l,t.getDataBarsPropertyId=c})(i=t.DataBarsUtil||(t.DataBarsUtil={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.Field="field",e.Sections="sections",e.VisualContainerThumbnail="visual-container-thumbnail"})(t=e.DragDropTypes||(e.DragDropTypes={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){if(!e)return!1;var t=e.displayableErrorInfo;return!_.isEmpty(t)&&(!_.isEmpty(t[0].errorInfoKey)&&!_.isEmpty(t[0].errorInfoValue))}function i(e){return e in r?r[e]:0}var r={BlockedCustomVisual:1,ScriptVisualsNotEnabled:1};e.hasAdditionalErrorInfo=t,e.getErrorOverlayType=i})(t=e.ErrorDetailsUtility||(e.ErrorDetailsUtility={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.handled=function(e){if(e){var t=e;e.originalEvent&&(t=e.originalEvent);var i=t.handled;return void 0!==i&&i===!0}},e.markAsHandled=function(e){if(e){var t=e;e.originalEvent&&(t=e.originalEvent),t.handled=!0}},e})();e.EventBubblingUtility=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){return!!i.isTrustedVisual(e)&&_.any(t.sections,(function(t){return _.any(t.visualContainers,(function(t){return t.config.singleVisual.visualType===e}))}))}function i(e,t){for(var i=[],r=0,o=e.sections;r<o.length;r++)for(var n=o[r],a=0,s=n.visualContainers;a<s.length;a++){var l=s[a],c=l.config.singleVisual.visualType;c&&t.isTrustedVisual(c)&&i.push(c)}return t.getConsentAndLoadVisuals(i)}e.explorationContainsTrustedVisual=t,e.acquireTrustedVisuals=i})(t=e.ExplorationTrustedVisualUtil||(e.ExplorationTrustedVisualUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.explore.services.FormatPainter;!(function(e){function i(e,i,o,n,a,s,l,c){return{deleteSelection:function(){e.exploration&&e.exploration.exploreCanvas&&n.deleteSelectedVisuals(e.exploration.exploreCanvas)},deserializeAndDuplicateData:function(r){e.exploration&&e.exploration.exploreCanvas&&t.CanvasVisualsUtility.duplicateVisuals(r,e.exploration.exploreCanvas,e.exploration.contract,i,o,s,l)},serializeSelection:function(){return t.CanvasVisualsUtility.serializeSelection(i,o)},getSelectionResources:function(){return t.CanvasVisualsUtility.getSelectionResources(o,e.exploration.contract.resourcePackages)},deserializeVisualContainer:function(e){return i.deserializeVisualContainer(e,!0)},copyVisualFormat:function(){return r.copyFormatVisualConfig(o,a)},pasteVisualFormat:function(e){var t=r.pasteFormatVisualConfig(o,a,c,e);t&&n.raiseVisualContainerChanged(t)}}}e.createClipboardHandler=i})(i=t.ExploreClipboardHandlerUtility||(t.ExploreClipboardHandlerUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){this._scope=e,this._eventBridge=t}return t.prototype.addColumn=function(e){this.raiseFieldListActionEvent(10,e)},t.prototype.addMeasure=function(e){this.raiseFieldListActionEvent(7,e)},t.prototype.addHierarchy=function(e){this.raiseFieldListActionEvent(8,e)},t.prototype.addHierarchyLevel=function(e,t,i){var r={action:9,fieldExpr:e,newHierarchyLevel:{hierarchy:t,index:i}};this.raiseEvent(r)},t.prototype.setGroups=function(e){this.raiseEvent({action:11,property:e})},t.prototype.editGroups=function(e){this.raiseEvent({action:12,property:e})},t.prototype.editClustering=function(e){this.raiseEvent({action:13,fieldExpr:e})},t.prototype.newQuickCalc=function(e){this.raiseEvent({action:14,fieldExpr:e})},t.prototype.collapseAll=function(){this.raiseFieldListActionEvent(15)},t.prototype.delete=function(e){this.raiseFieldListActionEvent(4,e)},t.prototype.moveUp=function(e){this.raiseFieldListActionEvent(5,e)},t.prototype.moveDown=function(e){this.raiseFieldListActionEvent(6,e)},t.prototype.expandAll=function(){this.raiseFieldListActionEvent(16)},t.prototype.select=function(e){this.raiseFieldListActionEvent(3,e)},t.prototype.toggleHidden=function(e){this.raiseFieldListActionEvent(0,e)},t.prototype.unHideAll=function(){this.raiseFieldListActionEvent(2)},t.prototype.viewHidden=function(){this.raiseFieldListActionEvent(1)},t.prototype.raiseFieldListActionEvent=function(e,t){var i={action:e,fieldExpr:t};this.raiseEvent(i)},t.prototype.raiseEvent=function(t){this._eventBridge.publishBubbling(this._scope,e.viewModels.FieldListEvents.fieldListAction,t)},t})();t.FieldListActionEventPublisher=i})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t){switch(e){case 1:return new a;case 2:return new s;default:return new n(t)}}var o=e.data.SQExprBuilder;i.createFieldListExprGenerator=r;var n=(function(){function e(e){this.groupingDesignStateService=e}return e.prototype.fieldExpr=function(e){if(void 0!==e.kind){if(0===e.kind){if(t.utils.GroupUtils.isGroupOrClusteringColumn(e.entity.name,e.contract,this.groupingDesignStateService)){var i=o.entity(e.entity.contractSchema.name,e.entity.name),r=t.utils.GroupUtils.getGroupedColumnsFromMetadata(e.contract.column.groupingMetadata,i);return o.fieldExpr({groupingColumn:{schema:e.schema.name,entity:e.entity.name,name:e.name,groupedColumns:r}})}return o.fieldExpr({column:{schema:e.schema.name,entity:e.entity.name,name:e.name}})}if(1===e.kind)return o.fieldExpr({measure:{schema:e.schema.name,entity:e.entity.name,name:e.name}})}},e})(),a=(function(){function e(){}return e.prototype.fieldExpr=function(e){return o.fieldExpr({hierarchy:{name:e.name,schema:e.entity.contractSchema.name,entity:e.entity.name}})},e})(),s=(function(){function e(){}return e.prototype.fieldExpr=function(e){return o.fieldExpr({hierarchyLevel:{schema:e.entity.contractSchema.name,entity:e.entity.name,name:e.parent.name,level:e.name}})},e})()})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(){}return t.getDefaultVisualPlugin=function(){return e.visuals.plugins.table},t})();t.FieldWellUtility=i})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=jsCommon.ArrayExtensions,n=t.viewModels.FilterCardConverter,a=e.data.SemanticFilter,s=e.data.SQExpr,l=e.data.SQExprBuilder,c=e.data.SQExprUtils,u=e.data.TopNFilterPattern;!(function(e){function i(e,t){if(e){var i=e.from(),n=e.conditions();if(!_.isEmpty(n)){for(var a,s=new d,c=[],v=0,h=n;v<h.length;v++){var g=h[v],f=u.extractParametersFromCondition(e.from(),g);if(f)o(c,f.fieldBeingFiltered,i,g,t);else{var m=g.accept(s);if(m)a=a?p.merge(a,m):m;else{var y=r(g);if(!y)return;o(c,y,i,g,t)}}}if(a)for(var w=0,C=a;w<C.length;w++){var S=C[w],b=_.map(S.values,(function(e){return[e]})),x=l.inValues([S.fieldExpr],b),M=S.isNot?l.not(x):x;o(c,S.fieldExpr,i,M,t)}return c}}}function r(e){var t=n.createAdvFilter(e);if(t)return t.field}function o(e,i,r,o,n){e.push({expression:i,filter:a.fromSQFromAndSQExpr(r,o),name:null,type:t.FilterUtils.getDefaultFilterType(i,n),howCreated:0,expanded:!1})}e.fromSemanticFilter=i})(r=i.FilterContainerBuilder||(i.FilterContainerBuilder={}));var p;!(function(e){function t(e,t){for(var i=[],r=function(r,o){var n=_.map(e.values,(function(e){return e[r]}));i.push({fieldExpr:e.args[r],isNot:t,values:c.concatUnique([],n)})},o=0,n=e.args.length;o<n;o++)r(o,n);return i}function i(e,t){for(var i,r=o.copy(e),n=0,a=t;n<a.length;n++){i=a[n];var l=_.findIndex(r,(function(e){return s.equals(e.fieldExpr,i.fieldExpr)}));if(l!==-1){var u=r[l];u.values=c.concatUnique(u.values,i.values)}else r.push(i)}return r}e.fromInExpr=t,e.merge=i})(p||(p={}));var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.visitIn=function(e){return p.fromInExpr(e)},t.prototype.visitNot=function(t){return t&&t.arg&&10===t.arg.kind?p.fromInExpr(t.arg,!0):e.prototype.visitNot.call(this,t,void 0)},t.prototype.visitAnd=function(e){var t=e.left.accept(this),i=e.right.accept(this);if(t&&i)return p.merge(t,i)},t})(e.data.DefaultSQExprVisitor)})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){var t=$(document.activeElement);return t.is(e)||t.closest(e).length>0}e.isFocusInTree=t})(t=e.FocusUtility||(e.FocusUtility={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.explore.util.CanvasDisplayUtility,n=t.constants.ExploreCanvasConstants;e.explore.contracts;!(function(i){function r(t){for(var i=[],r=0,o=t;r<o.length;r++){var n=o[r];i.push({value:n.value.toString(),displayName:e.explore.viewModels.ViewModelFactory.getDisplayName(n.displayName)})}return i}function a(){for(var t=e.visuals.valueFormatter.getDisplayUnits(e.DisplayUnitSystemType.DataLabels),i=[],r=0,o=t;r<o.length;r++){var n=o[r];i.push({displayName:n.title,value:n.value.toString()})}return i}function s(e,r){if(0===e.displayOption)return i.PageSizeTypes.Dynamic;if(e.width===t.constants.ExploreCanvasConstants.DefaultCanvasWidth&&e.height===n.DefaultCanvasHeight)return i.PageSizeTypes.Standard;if(e.width===t.constants.ExploreCanvasConstants.DefaultWidescreenWidth&&e.height===n.DefaultWidescreenHeight)return i.PageSizeTypes.Widescreen;if(o.isCortanaPageSize(e)){var a=r.getCurrentExploration(),s=r.getCurrentSection(),l=t.PodUtils.findPodIndexForSectionName(a,s.name);return l!==-1&&a.pods[l].cortanaEnabled?i.PageSizeTypes.Cortana:i.PageSizeTypes.Custom}return e.width===t.constants.ExploreCanvasConstants.DefaultLetterWidth&&e.height===n.DefaultLetterHeight?i.PageSizeTypes.Letter:i.PageSizeTypes.Custom}i.PageSizeTypes={Dynamic:"Dynamic",Standard:"Standard",Widescreen:"Widescreen",Cortana:"Cortana",Letter:"Letter",Custom:"Custom"},i.getDisplayNames=r,i.getDisplayUnits=a,i.getPageSizeType=s})(r=i.PropertyPaneUtils||(i.PropertyPaneUtils={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.container=e,this.context={pendingGeocodingCount:0}}return e.prototype.newQuery=function(){this.context={pendingGeocodingCount:0}},e.prototype.hasPendingGeocoding=function(){return this.context.pendingGeocodingCount>0},e.prototype.wrapGeocoder=function(e){return{geocode:this.wrapAsyncGeocoderMethod(e,e.geocode),geocodeBoundary:this.wrapAsyncGeocoderMethod(e,e.geocodeBoundary),geocodePoint:this.wrapAsyncGeocoderMethod(e,e.geocodePoint),tryGeocodeImmediate:function(t,i){return e.tryGeocodeImmediate(t,i)},tryGeocodeBoundaryImmediate:function(t,i,r,o,n,a){return e.tryGeocodeBoundaryImmediate(t,i,r,o,n,a)}}},e.prototype.wrapAsyncGeocoderMethod=function(e,t){var i=this;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var n=i.context,a=t.apply(e,r);return 1===++n.pendingGeocodingCount&&i.container.onStartGeocoding(),a.then((function(){n===i.context&&0===--n.pendingGeocodingCount&&i.container.onStopGeocoding()}),(function(){n===i.context&&0===--n.pendingGeocodingCount&&i.container.onStopGeocoding()})),a}},e})();e.QueryGeocodingTracker=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return o(e,"themeName")}function i(e,t,i){return e?i.get(e):t.reject()}function r(e,t){Object.defineProperty(e,"dataSources",{get:function(){return t.get()},set:function(e){return t.set(e)}})}function o(e,t){for(var i,r=e;r&&!(i=r[t]);)r=r.$parent;return i}e.findThemeName=t,e.getSchemaPromise=i,e.defineDataSourcesOnScopeLegacy=r})(t=e.ScopeUtils||(e.ScopeUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f,m){return new O(e,t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f,m)}function o(e,t,i){var r=e.getMetadata(t);if(r.type.geography)return S.name;var o=D.asFieldPattern(e);if(i&&o){var n=o.column||o.groupingColumn,s=n&&n.name,l=o.hierarchyLevel&&o.hierarchyLevel||o.columnHierarchyLevelVariation&&o.columnHierarchyLevelVariation.level;if(l){var c=l.level;if(i.isGeographic(c))return S.name;var u=I.getConceptualHierarchyLevel(t,l.schema,l.entity,l.name,c);s=u&&u.column&&u.column.name}if(s&&i.isGeographic(s))return S.name}return a(e,r,t)?d.name:A.name}function n(e,t){var i=e.getMetadata(t);if(a(e,i,t))return 2}function a(e,t,i){return 1===t.kind||t.type.numeric&&!V.discourageAggregation(e,i)}function s(t){switch(t.kind){case 0:return e.telemetry.FieldKind.Entity;case 2:return e.telemetry.FieldKind.ColumnRef;case 3:return e.telemetry.FieldKind.MeasureRef;case 4:return e.telemetry.FieldKind.Aggregation;case 5:return e.telemetry.FieldKind.PropertyVariationSource;case 6:return e.telemetry.FieldKind.Hierarchy;case 7:return e.telemetry.FieldKind.HierarchyLevel;default:return e.telemetry.FieldKind.Other}}function l(t){switch(t){case w.Advanced:return e.telemetry.FilterType.Advanced;case w.Categorical:return e.telemetry.FilterType.Categorical;case w.Passthrough:return e.telemetry.FilterType.Passthrough;case w.Range:return e.telemetry.FilterType.Range;case w.Visual:return e.telemetry.FilterType.Visual}}function c(t){switch(t){case 2:return e.telemetry.FilterScopeType.Exploration;case 1:return e.telemetry.FilterScopeType.Section;case 0:return e.telemetry.FilterScopeType.Visual}}var u=jsCommon.ArrayExtensions,p=e.visuals.plugins.basicShape,d=e.visuals.plugins.clusteredColumnChart,v=e.explore.constants,h=e.data.DataViewObjectDefinitions,g=e.data.DataViewObjectDescriptors,f=e.data.DataViewRoleWildcard,m=e.explore.util.DrillUtils,y=t.services.events,w=t.contracts.FilterType,C=e.explore.util.HierarchyUtils,S=e.visuals.plugins.map,b=t.services.selectionUtils,x=e.data.SemanticFilter,M=e.data.SQExpr,E=e.data.SQExprBuilder,D=e.data.SQExprConverter,F=e.data.SQExprHierarchyToHierarchyLevelConverter,V=e.data.SQExprUtils,I=e.data.SQHierarchyExprUtils,P=e.data.SQScopedEvalExpr,A=e.visuals.plugins.table,T=e.explore.contracts.VisualContainer,L=e.explore.util.VisualContainerUtils,k=t.contracts.VisualQuery,R=t.services.isValueTypeDescriptorLatLong;i.createVisualAuthoringOperations=r;var O=(function(){function r(e,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f,m,y){this.visualPluginService=e,this.pluginOps=i,this.displayNameService=r,this.telemetry=o,this.explorationNavigationService=n,this.selectionService=a,this.geotaggingAnalyzerService=s,this.explorationSerializer=l,this.eventBridge=c,this.featureSwitchService=u,this.sortService=p,this.visualRelationshipService=d,this.drill=v,this.filterGenerator=h,this.aggrOps=g,this.resourceRegistration=f,this.formFactorProvider=m,this.localizationService=y,this.core=t.services.createVisualAuthoringCore(e,s,g,u)}return r.prototype.addFieldToVisual=function(t,i,r,o){if(!r)return!1;var n=r.config.singleVisual,a=n.query,l=this.visualPluginService.capabilities(n.visualType),c=this.addHierarchyLevelToExistingHierarchiesInVisual(t,l,r.config,i)||this.addExpressionToVisualWithoutAggregation(t,r,l,i)||this.addExpressionToVisualForcingAggregation(t,r,l,i)||this.addExpressionToVisual(t,r,l,i),u=i.getConceptualProperty(t),p=u&&u.measure&&u.measure.template&&u.measure.template.name;return c?(this.ensureValidDrillMode(r),this.ensureDefaultFilterAndRaiseEvent(t,r,!1),void 0!==o&&this.telemetry.logEvent(e.telemetry.EXAddField,o,L.getVisualType(r),s(i),L.hasGroupByItemsInQuery(r),!0,p),!0):(r.config.singleVisual.query=a,void 0!==o&&this.telemetry.logEvent(e.telemetry.EXAddField,o,L.getVisualType(r),s(i),L.hasGroupByItemsInQuery(r),!1,p),!1)},r.prototype.addFieldInRole=function(t,i,r,o,n){var a=this.getVisualDataRole(o,r);if(!a)return!1;var l;this.shouldPreferGroupToAggregate(t,i,o,a)||(i=this.createExprWithAggregate(i,t,!0,a),l=!0);var c=this.canHierarchyLevelJoinExistingGroup(t,o.config.singleVisual.query,r,i,n),u=this.getTargetRoleAndExpressionsForAdd(t,o,i,r),p=l||c?i:u&&u.expressions,d={expr:p,schema:t,targetRole:r,targetIndex:n},v=i.getConceptualProperty(t),h=v&&v.measure&&v.measure.template&&v.measure.template.name;return this.core.add(d,o.config)?(this.ensureValidDrillMode(o),this.ensureDefaultFilterAndRaiseEvent(t,o,!1),this.telemetry.logEvent(e.telemetry.EXAddField,e.telemetry.HowFieldWasAddedToVisual.DraggedToFieldWell,L.getVisualType(o),s(i),L.hasGroupByItemsInQuery(o),!0,h),!0):(this.telemetry.logEvent(e.telemetry.EXAddField,e.telemetry.HowFieldWasAddedToVisual.DraggedToFieldWell,L.getVisualType(o),s(i),L.hasGroupByItemsInQuery(o),!1,h),!1)},r.prototype.expandHierarchy=function(e,t,i,r,o){var n=(t.config.singleVisual.query.tryGetExprs(i)||[]).slice(r,r+o);if(_.isEmpty(n))return!1;
var a=n[0];if(M.isHierarchyLevel(a)){var s=a.arg,l=I.expandExpr(e,s);if(_.isArray(l)){var c=l.length;if(o<c){for(var u=t.config.singleVisual.query,p=!1,d=0;d<c;d++)if(!M.equals(u.tryGetExpr(i,r+d),l[d])){if(!this.core.add({expr:l[d],schema:e,targetRole:i,targetIndex:r+d},t.config))break;p=!0}return p&&this.raiseVisualContainerChanged(t),p}}}return!1},r.prototype.removeField=function(e,t){var i=b.getSelectedVisuals(this.selectionService),r=I.expandExpr(t,e,!0);if(_.isArray(r)){var o=!1;return o=this.removeFieldImpl(r,i),o=this.removeFieldImpl(e,i)||o}return this.removeFieldImpl(e,i)},r.prototype.removeProjection=function(e){var t=b.getSelectedVisual(this.selectionService);return!!t&&this.invokeRemoveOnSelectedVisuals(e,[t])},r.prototype.removeInvalidExpressions=function(e,t){var i=t.config.singleVisual;if(!i||!i.query)return!1;for(var r=[],o=0,n=i.query.defn.select();o<n.length;o++){var a=n[o],s=a.expr;_.isEmpty(s.validate(e,this.aggrOps))||r.push(s)}for(var l=0,c=r;l<c.length;l++){var u=c[l];this.removeFiltersWithExpr(u,t)}return this.removeFieldImpl(r,[t]),!0},r.prototype.moveProjection=function(e,t,i,r,o,n){var a=b.getSelectedVisual(this.selectionService);if(!a)return!1;var s;if(t!==i){var l=this.getVisualDataRole(a,i),c=C.getHierarchyReplacementExpressions(a.config,t,r,n,l);if(_.isEmpty(c))return!1;s=c}var u={sourceRole:t,targetRole:i,sourceIndex:r,targetIndex:o,sourceCount:n,replacementExpressions:s,schema:e,allowPartialReplace:!0},p=a.config.singleVisual.query,d=m.getDrillFilterRemovalInfoList(p,u,1);if(this.core.replace(u,a.config)){this.ensureValidDrillState(a,d),this.raiseVisualContainerChanged(a);var v=a.config.singleVisual.query,h=v.tryGetExpr(i,o);return this.logReportMeasureMoveTelemetry(e,a,t,i,h),!0}return!1},r.prototype.drillDownLevel=function(t,i,r){if(i){var o=L.getVisualType(i),n=this.telemetry.startEvent(e.telemetry.EXInteractionExpand,o,2===r),a=i.config.singleVisual,s=this.visualPluginService.capabilities(a.visualType),l=m.getDrillableRoles(s),c=_.isEmpty(t)?_.first(l):t;if(c){var u=this.core.changeActiveProjection(c,a,r);if(u)return this.raiseVisualContainerChanged(i),void n.resolve()}n.reject()}},r.prototype.replaceProjection=function(e,t,i,r,o){var n=b.getSelectedVisual(this.selectionService);if(!n)return!1;var a={sourceRole:i,targetRole:i,sourceIndex:r,targetIndex:r,sourceCount:1,replacementExpressions:[t],schema:e};return!!this.core.replace(a,n.config)&&(this.ensureValidDrillMode(o),this.resetSearchProperties(o),this.ensureDefaultFilterAndRaiseEvent(e,o,!1),!0)},r.prototype.drillDown=function(t,i,o,n){var a=L.getVisualType(o),s=this.telemetry.startEvent(e.telemetry.EXInteractionDrill,a,!0);this.filterGenerator.clearCrossHighlight(this.explorationNavigationService.getCurrentSection());var l=o.config.singleVisual;if(l.clearSelectedDataPoints(),_.isEmpty(i)||_.isEmpty(i[0].dataMap))return!1;o.filters||(o.filters=[]);var c=i[0].dataMap,u=l.query,p=this.visualPluginService.capabilities(l.visualType),d=n||_.first(m.getDrillableRoles(p)),v=u.projections[d].activeProjectionRefs,h=_.filter(c,(function(e,t){return _.contains(v,t)}));if(!_.isEmpty(h)){var g=u.currentDrillMode(d)||2,f=this.core.changeActiveProjection(d,l,g),y=u.projections[d],w=y.activeProjectionRefs;if(f&&_.isEqual(f,w)){for(var C=0,S=h;C<S.length;C++){var b=S[C];this.core.addDrillFilter(t,o.filters,u,v,r.chooseRepetitionSelectorForDrill(b))}return this.raiseVisualContainerChanged(o),s.resolve(),!0}}return s.reject(),!1},r.chooseRepetitionSelectorForDrill=function(e){if(e=u.ensureArray(e),1===e.length)return e[0];for(var t,i=0,r=e;i<r.length;i++){var o=r[i];t||(t=o),o.key.length>t.key.length&&(t=o)}return t},r.prototype.drillUp=function(t,i){if(i){var r=L.getVisualType(i),o=this.telemetry.startEvent(e.telemetry.EXInteractionDrill,r,!1),n=i.config.singleVisual,a=n.query,s=this.visualPluginService.capabilities(i.config.singleVisual.visualType),l=m.getDrillableRoles(s),c=_.isEmpty(t)?_.first(l):t;if(c){var u=this.core.changeActiveProjection(c,n,1);if(!_.isEmpty(u)){var p=_.last(u),d=a.defn.select().withName(p).expr;return this.core.removeDrillFilter(i.filters,d),this.raiseVisualContainerChanged(i),void o.resolve()}}o.reject()}},r.prototype.drillToDetails=function(t,i,r,o,n){var a=T.clone(n,this.explorationSerializer);this.addDrillToDetailsFilters(i,a,o);var l={name:t,config:{singleVisual:a.config.singleVisual},layouts:n.layouts,filters:a.filters};if(l.config.singleVisual.visualType!==e.visuals.plugins.table.name){var c=this.convert(i,l,e.visuals.plugins.table.name);if(!c)return}var u=l.config.singleVisual.query;this.handleAggregatesAndMeasuresForDetailTable(i,l);var p=r.getTargetEntity();this.addDetailTableColumns(i,p,l),u.defn=u.defn.addGroupBy(p);var d={expr:E.removeAggregate(r),direction:2};this.sortService.addSort(u,[d]);var v=L.getVisualType(n);return this.telemetry.logEvent(e.telemetry.EXDrillToDetails,v,s(r)),l},r.prototype.handleAggregatesAndMeasuresForDetailTable=function(e,t){for(var i=t.config.singleVisual.query,r=i.defn.select(),o=0,n=r;o<n.length;o++){var a=n[o],s=a.expr;if(V.isMeasure(s)){var l=i.getRoleNameForExpr(s),c=u.indexWithName(i.defn.select(),a.name);i.removeAggregate(l,c,e)}M.isMeasure(s)&&i.removeExpr(s,!1)}},r.prototype.addDetailTableColumns=function(e,t,i){for(var r=i.config.singleVisual.query,o=V.getConceptualEntity(t,e),n=r.defn.select(),a=0,s=n;a<s.length;a++){var l=s[a],c=l.expr,u=c.getTargetEntity();if(!_.isEqual(t,u)){var p=V.isRelatedOneToOne(e,t,u);if(!p){var d=V.isRelatedToMany(e,u,t);d||r.removeExpr(c,!1)}}}for(var v=o.properties,h=0,g=v;h<g.length;h++){var f=g[h];if(!f.hidden&&1!==f.kind&&!f.type.integer&&!f.type.numeric&&(!f.type.dateTime||!f.column||_.isEmpty(f.column.variations))){var m=E.columnRef(t,f.name),y=r.defn.selectNameOf(m);y||this.addFieldToVisual(e,m,i)}}},r.prototype.setAggregate=function(e,t,i,r,o){var n={role:t,index:i,newAggregate:r,schema:e};return!!this.core.setAggregate(n,o.config)&&(this.raiseVisualContainerChanged(o),!0)},r.prototype.removeAggregate=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.removeAggregate(o,r.config)&&(this.raiseVisualContainerChanged(r),!0)},r.prototype.setPercentOfGrandTotal=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.setPercentOfGrandTotal(o,r.config)&&(this.ensureValidDrillMode(r),this.raiseVisualContainerChanged(r),!0)},r.prototype.removePercentOfGrandTotal=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.removePercentOfGrandTotal(o,r.config)&&(this.raiseVisualContainerChanged(r),!0)},r.prototype.setPercentOfRoleTotal=function(e,t,i,r,o){var n={roleRefs:t,role:i,index:r,schema:e};return!!this.core.setPercentOfRoleTotal(n,o.config)&&(this.ensureValidDrillMode(o),this.raiseVisualContainerChanged(o),!0)},r.prototype.removePercentOfRoleTotal=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.removePercentOfRoleTotal(o,r.config)&&(this.raiseVisualContainerChanged(r),!0)},r.prototype.setVariation=function(e,t,i,r,o,n){if(n=n||1,o<0)return!1;for(var a=[],s=0;s<n;s++)if(a[s]=t.config.singleVisual.query.tryGetExpr(r,o+s),!a[s])return!1;var l=[i];if(M.isHierarchy(i)&&(l=F.convert(i,e),!l))return!1;var c=this.getVisualDataRole(t,r),u=C.getHierarchyReplacementExpressions(t.config,r,o,n,c,l);if(_.isEmpty(u))return!1;var p=u,d={sourceRole:r,targetRole:r,sourceIndex:o,targetIndex:o,sourceCount:a.length,replacementExpressions:p,schema:e,allowPartialReplace:!0},v=this.core.replace(d,t.config);return v&&this.raiseVisualContainerChanged(t),v},r.prototype.toggleShowAll=function(e,t){t&&(this.core.toggleShowAll(e,t.config),this.raiseVisualContainerChanged(t))},r.prototype.createVisualContainerConfig=function(e,t){return this.createVisualContainerConfigCore(t,e)},Object.defineProperty(r.prototype,"featureSwitches",{get:function(){return this.featureSwitchService.featureSwitches},enumerable:!0,configurable:!0}),r.prototype.addDrillToDetailsFilters=function(e,t,i){if(!_.isEmpty(i)&&i[0]&&!_.isEmpty(i[0].dataMap)){var o=L.getVisualQuery(t);if(o){var n=[];if(o.projections)for(var a in o.projections)_.isEmpty(o.projections[a].activeProjectionRefs)||n.push(o.projections[a].activeProjectionRefs);var s=i[0].dataMap;t.filters=t.filters||[];var l;for(l in s){var c=_.find(n,(function(e){return _.contains(e,l)}));this.core.addDrillToDetailsFilter(e,t.filters,o,c||[l],r.chooseRepetitionSelectorForDrill(s[l]))}}}},r.prototype.findCompatibleRole=function(r,o,n){var a=o.config.singleVisual,s=a.query||new k(e.data.SemanticQuery.create(),{}),l=this.visualPluginService.capabilities(a.visualType),c=s&&s.projections;if(l&&c){var u=t.services.createVisualCapabilitiesHelper(l,this.geotaggingAnalyzerService);return u&&u.findCompatibleRole({queryProjections:c,schema:r,expr:n,roleToExprMap:new t.services.SQExprToRoleDictionary(i.HierarchyUtils.hierarchyLevelComparer),preferDrillableRoles:!1})}},r.prototype.getMaxNumberOfExpressionsAllowedInRole=function(i,r,o){var n=r.config.singleVisual,a=n.query||new k(e.data.SemanticQuery.create(),{}),s=this.visualPluginService.capabilities(n.visualType),l=a&&a.projections;if(s&&l){var c=t.services.createVisualCapabilitiesHelper(s,this.geotaggingAnalyzerService),u=m.getDrillableRoles(s);if(_.contains(u,o))return Number.MAX_VALUE;var p=c.getNumberRangesForRoles(a),d=p[o];if(d&&d.max)return d.max}return 0},r.prototype.getTargetRoleAndExpressionsForAdd=function(e,t,i,r){var o=i;if(I.isHierarchyOrVariation(e,i)&&(o=I.expandExpr(e,i),_.isArray(o))){var n=o;if(!r){var a=this.findCompatibleRole(e,t,n[0]);a&&(r=a.name)}if(r){var s=this.getMaxNumberOfExpressionsAllowedInRole(e,t,r);s!==Number.MAX_VALUE&&(o=1===s&&M.isColumn(i)?i:M.isHierarchy(i)||M.isColumn(i)?n.slice(0,s):n.slice(n.length-s,n.length))}}return{targetRole:r,expressions:o}},r.prototype.addExpressionToVisualWithoutAggregation=function(t,i,r,o){var n=r&&e.ScriptResultUtil.findScriptResultMapping(r.dataViewMappings),a=this.getTargetRoleAndExpressionsForAdd(t,i,o);return a.targetRole&&r.dataRoles[a.targetRole]!==e.VisualDataRoleKind.Measure||(a.expressions instanceof Array&&(a.expressions=o),n||this.shouldPreferGroupToAggregate(t,o,i)||(a.expressions=this.createExprWithAggregate(a.expressions,t,!1))),this.core.add({expr:a.expressions,schema:t,targetRole:a.targetRole},i.config)},r.prototype.addExpressionToVisualForcingAggregation=function(e,t,i,r){var o=this.createExprWithAggregate(r,e,!0);return this.core.add({expr:o,schema:e},t.config)},r.prototype.addExpressionToVisual=function(e,t,i,r){return this.core.add({expr:r,schema:e},t.config)},r.prototype.createVisualContainerConfigCore=function(e,t){var i,r=e.expr,a=r instanceof Array;!e.allowAggregate||a||this.shouldPreferGroupToAggregate(t,r)||(r=this.createExprWithAggregate(r,t,!1));var s=a?r[0]:r,l=e.visualType||o(s,t,this.geotaggingAnalyzerService),c=n(s,t),u={expr:i?e.expr:r,schema:t,visualType:l},p=this.core.create(u);return null!=c&&p&&this.sortService.addSort(p.singleVisual.query,[{expr:s,direction:c}]),p},r.prototype.addVisualContainerImage=function(e,t,i,o,n,a){a=r.getPositionForAddedVisual(e,a);var s="data:image/png;base64,"+t,l=this.resourceRegistration.add(n,100,s),c={singleVisual:{visualType:"image",objects:{general:[{properties:{imageUrl:l}}]}}};this.createVisualFromConfig(e,c,a)},r.prototype.addVisualContainerBasicShape=function(t,i,o){o=r.getPositionForAddedVisual(t,o);var n={singleVisual:{visualType:p.name,objects:{general:[{properties:{shapeType:E.text(i)}}]}}},a=this.createVisualFromConfig(t,n,o);this.telemetry.logEvent(e.telemetry.EXCreateVisual,e.telemetry.HowVisualWasCreated.InsertVisualButton,L.getVisualType(a))},r.prototype.addVisualContainer=function(e,t,i,o){o=r.getPositionForAddedVisual(i,o),t.expr=I.expandExpr(e,t.expr);var n=this.createVisualContainerConfig(e,t);if(n)return this.createVisualFromConfig(i,n,o)},r.prototype.addEmptyVisualContainer=function(e,t,i){i=r.getPositionForAddedVisual(e,i);var o={singleVisual:{visualType:t}};return this.createVisualFromConfig(e,o,i)},r.prototype.createVisualFilters=function(e,i,r){for(var o=t.viewModels.ViewModelFactory.createVisualFilters(e,r,this.displayNameService,this.visualPluginService,this.pluginOps,this.filterGenerator,this.aggrOps,this.localizationService),n=0,a=o;n<a.length;n++){var s=a[n];s.updateFilterProperties(r,this.visualPluginService,this.aggrOps),s.canVisualize()&&(s.isInvalid()||this.createFilterVisualContainerConfig(s.contract,i,r))}return o},r.prototype.addFilter=function(i,r,o,n){if(!t.FilterUtils.canAdd(r,i,o,this.pluginOps,this.filterGenerator))return!1;var a=t.FilterUtils.getDefaultFilterType(r,i),u={name:t.FilterUtils.getNextFilterName(o.container.filters),expression:r,type:a,expanded:!0,howCreated:1};e.data.SQExprUtils.isMeasure(r)||this.createFilterVisualContainerConfig(u,n,i),t.FilterUtils.add(o.container,u);var p={filter:u,changeType:1,scope:o};this.eventBridge.publishToChannel(y.filterContainerChanged,p);var d=b.getSelectedVisual(this.selectionService);return V.isMeasure(r)&&this.telemetry.logEvent(e.telemetry.EXAddFilter,l(a),c(o.scopeType),s(r),L.hasGroupByItemsInQuery(d)),!0},r.prototype.removeFilter=function(e,t){return this.removeFilterImpl(e,t)},r.prototype.createFilterVisualContainerConfig=function(t,i,r){var o=t.expression;if(!M.isTransformOutputRoleRef(o)){var n=V.discourageAggregation(o,r),a=D.asFieldPattern(o),s=a.column||a.groupingColumn||a.hierarchyLevel,l={expr:o,dataSources:i,allowAggregate:!1,visualType:e.visuals.plugins.slicer.name};if(!V.isMeasure(o)){var c=this.createVisualContainerConfigCore(l,r);if(c){var u=c.singleVisual.objects;u||(c.singleVisual.objects=u={});var p=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,d=e.visuals.slicerProps.selection.singleSelect,g=e.visuals.slicerProps.header.show,m=e.visuals.slicerProps.data.mode;h.setValue(u,m,null,E.text(e.visuals.slicerMode.basic)),h.setValue(u,p,null,E.boolean(!0)),h.setValue(u,d,null,E.boolean(!1)),h.setValue(u,g,null,E.boolean(!1));var y=e.visuals.slicerProps.items.textSize;if(h.setValue(u,y,null,E.integer(v.smallFontSizeInPoint)),!n&&s){var w=E.entity(s.schema,s.entity,s.entityVar),C=E.aggregate(w,2),S=e.visuals.slicerProps.general.count,b=c.singleVisual.query.getRoleNameForExpr(o),F={data:[f.fromRoles([b])]};h.setValue(u,S,F,C)}var I=0===t.howCreated&&!x.isDefaultFilter(t.filter);if(this.ensureDefaultFilterApplied(r,c.singleVisual,I)&&null==t.filter){var P=a.column||a.groupingColumn?o.getKeyColumns(r):[o];t.filter=x.getDefaultValueFilter(P)}t.config=c}}}},r.prototype.raiseVisualContainerChanged=function(e,i,r){var o=this.explorationNavigationService.getCurrentSection();this.eventBridge.publishToChannel(t.services.events.visualContainerChanged,{affectContainer:i?L.filterAffects(e,o,this.visualRelationshipService,r):L.contractEqualityComparator(e)})},r.prototype.convert=function(i,r,o){var n=L.getVisualType(r),a=this.telemetry.startEvent(e.telemetry.EXInteractionVisualConversion,n,o),s=r.config.singleVisual.query;if(s){this.resetSearchProperties(r);var l=t.contracts.SingleVisualConfig.clone(r.config.singleVisual),c=this.core.convert({schema:i,source:l,target:o});if(!c)return a.reject();r.config.singleVisual=l,a.resolve();var u=this.visualPluginService.capabilities(n),p=this.filterGenerator.tryGetFilterPropertyIdentifier(u);if(!p){var d=this.visualPluginService.capabilities(o);p=this.filterGenerator.tryGetFilterPropertyIdentifier(d)}this.ensureValidDrillMode(r),this.ensurePercentRoleTotal(r,o),this.ensureDefaultFilterAndRaiseEvent(i,r,!1,p);var v=r.filters;return _.isEmpty(v)||t.FilterUtils.supportsVisualFilters(r,this.pluginOps,this.filterGenerator)||(r.filters=[]),c}return r.config.singleVisual.visualType=o,a.resolve(),this.raiseVisualContainerChanged(r),!0},r.prototype.setOrderBy=function(e,t){e.config.singleVisual.query.orderBy(t),this.raiseVisualContainerChanged(e)},r.prototype.removeOrderBy=function(e,t){for(var i=0,r=t;i<r.length;i++){var o=r[i];e.config.singleVisual.query.removeOrderBy(o)}this.raiseVisualContainerChanged(e)},r.prototype.deleteVisualRelationships=function(e,t){_.remove(e.relationships,(function(e){return e.source===t||e.target===t}))},r.prototype.addConditionalFormatting=function(e,t,r){var o=e.config.singleVisual,n=o.objects;n||(o.objects=n={});var a=t.selector,s=i.ConditionalFormattingUtil.getFirstFormatPropertyPropertyId(t);h.setValue(n,s,a,r)},r.prototype.removeConditionalFormatting=function(e,t){var r=e.config.singleVisual.objects,o=t.selector,n=i.ConditionalFormattingUtil.getFirstFormatPropertyPropertyId(t);h.deleteProperty(r,n.objectName,o,n.propertyName)},r.prototype.addDataBars=function(e,t,i,r){var o=e.config.singleVisual,n=o.objects;n||(o.objects=n={}),h.setValue(n,t,i,r)},r.prototype.removeDataBars=function(e,t,i){var r=e.config.singleVisual.objects;h.deleteProperty(r,t.objectName,i,t.propertyName)},r.prototype.setVisualRelationship=function(e,t,i,r){if(t!==i){e.relationships=e.relationships||[];var o=this.visualRelationshipService.relationship(e,t,i);if(o)o.type=r;else{var n=(_.contains(e.visualContainers,t),_.contains(e.visualContainers,i),{source:t,target:i,type:r});e.relationships.push(n)}}},r.prototype.ensureValidDrillState=function(e,t){for(var i=0,r=t;i<r.length;i++){var o=r[i];this.core.removeDrillFilter(e.filters,o.expr);var n=e.config.singleVisual.query,a=n.projections[o.roleName];if(o.isActiveProjection&&a&&a.activeProjectionRefs){var s=a.all(),l=s[o.index-1],c=s[o.index],u=a.activeProjectionRefs.length>1;if(l)u?a.activeProjectionRefs=_.chain(s).take(o.index).map((function(e){return e.queryRef})).value():a.activeProjectionRefs=[l.queryRef];else if(c)u?a.activeProjectionRefs=_.chain(s).take(o.index+1).map((function(e){return e.queryRef})).value():a.activeProjectionRefs=[c.queryRef];else if(s.length>1)if(u)a.activeProjectionRefs=_.map(s,(function(e){return e.queryRef}));else{var p=_.last(s);a.activeProjectionRefs=[p.queryRef]}else a.activeProjectionRefs=[]}}this.ensureValidDrillMode(e)},r.prototype.ensureValidDrillMode=function(e){var t=e.drillMode;(1===t&&0===this.drill.getSupportedDrillDirections(e)||2===t&&!this.drill.canDrillToDetails(e))&&this.drill.setDrillMode(e,0)},r.prototype.ensurePercentRoleTotal=function(e,r){var o=this.visualPluginService.capabilities(r);if(!o.dataRoleTotals){var n=new N,a=new t.schemaRewriterUtils.VisualQueryExprRewriter(n),s=new i.VisualContainerRewriter([a]);i.traverseVisualContainer(e,s,this.visualPluginService)}},r.prototype.getVisualDataRole=function(e,t){var i=L.getDataRolesForVisual(e,this.visualPluginService);if(!_.isEmpty(i))return u.findItemWithName(i,t)},r.prototype.removeFieldImpl=function(e,t){return this.invokeRemoveOnSelectedVisuals({expr:e,ignoreAggregates:!0},t)},r.prototype.removeFilterImpl=function(e,t){if(!t||!t.container||!t.container.filters)return!1;for(var i={filter:e,changeType:0,scope:t},r=0;r<t.container.filters.length;r++)if(t.container.filters[r]===e)return t.container.filters.splice(r,1),this.eventBridge.publishToChannel(y.filterContainerChanged,i),!0;return!1},r.prototype.removeFiltersWithExpr=function(e,t){var i=t.filters;if(!i)return!1;for(var r,o=i.length-1;o>=0;o--){var n=i[o];M.equals(n.expression,e)&&(r=this.removeFilterImpl(n,{scopeType:0,container:t}))}return r},r.prototype.invokeRemoveOnSelectedVisuals=function(e,t){for(var i=!1,r=t.length-1;r>-1;r--){var o=t[r],n=o.config.singleVisual.query,a=m.getDrillFilterRemovalInfoList(n,e,0);this.removeExpressionsFromVisual(e,o.config)&&(this.ensureValidDrillState(o,a),this.raiseVisualContainerChanged(o),i=!0)}return i},r.prototype.removeExpressionsFromVisual=function(e,t){for(var i=e.count||1,r=0;r<i;r++)if(!this.core.remove(e,t))return!1;return!0},r.prototype.createVisualFromConfig=function(e,i,r){var o=this.formFactorProvider.getCurrentLayout(),n={name:L.uniqueName(e.contract.visualContainers),config:i,filters:[],layouts:jsCommon.ArrayExtensions.extendWithId([{id:o,position:r}])};e.contract.visualContainers.push(n);var a=this.explorationNavigationService.getCurrentExploration(),s=t.viewModels.ViewModelFactory.convertVisualContainer(a,e.contract,n,o);if(s)return e.visualContainers.push(s),b.selectVisualContainer(n,this.selectionService),n},r.prototype.createExprWithAggregate=function(e,t,i,r){if(V.discourageAggregation(e,t))return e;var o=this.getPreferredAggregate(t,e,r);return this.aggrOps.createExprWithAggregate(e,t,i,r?r.requiredTypes:null,o)},r.getPositionForAddedVisual=function(e,t){if(!t)return r.getDefaultVisualContainerPosition(e);if(null!=t.z)return t;var o=_.cloneDeep(t);return o.z=i.CanvasVisualsUtility.getZIndexForNewVisual(e),o},r.getDefaultVisualContainerPosition=function(e){return{height:0,width:0,x:0,y:0,z:i.CanvasVisualsUtility.getZIndexForNewVisual(e)}},r.prototype.shouldPreferGroupToAggregate=function(i,r,o,n){if(this.isRoleTypeLatLong(i,r,n)){if(o){var a=L.getVisualQuery(o);if(a&&a.projections)for(var s=this.visualPluginService.capabilities(o.config.singleVisual.visualType),l=t.services.createVisualCapabilitiesHelper(s,this.geotaggingAnalyzerService),c=l.getNonLatLongCategoricalRoles(),u=0,p=c;u<p.length;u++){var d=p[u];if(a.projections[d])return!1}}return!0}return n&&n.kind!==e.VisualDataRoleKind.Measure},r.prototype.getPreferredAggregate=function(e,t,i){if(this.isRoleTypeLatLong(e,t,i))return 1},r.prototype.isRoleTypeLatLong=function(t,i,r){if(r){var o=r.preferredTypes,n=_.isEmpty(o)?void 0:o[0];if(R(n))return!0}var a=i.getMetadata(t),s=a?a.type:void 0;if(R(s))return!0;if(s){var l=D.asFieldPattern(i),c=l.column||l.columnAggr||l.groupingColumnAggr||l.groupingColumnAggr||l.measure;if(c){var u=c&&this.geotaggingAnalyzerService.getFieldType(c.name);if(null!=u){var p=e.ValueType.fromPrimitiveTypeAndCategory(s.primitiveType,u);if(R(p))return!0}}}return!1},r.prototype.canHierarchyLevelJoinExistingGroup=function(e,t,i,r,o){var n=t&&t.projections[i];if(M.isHierarchyLevel(r)&&n&&n.all().length>0){var a=r,s=n.all(),l=I.expandExpr(e,a.arg),c=_.isNumber(o)?o-1:s.length-1;if(c>=0&&I.areHierarchyLevelsOrdered(l,t.tryGetExpr(i,c),a))return!0;if(_.isNumber(o)&&o<s.length&&I.areHierarchyLevelsOrdered(l,a,t.tryGetExpr(i,o)))return!0}return!1},r.prototype.addHierarchyLevelToExistingHierarchiesInVisual=function(e,t,i,r){var o=!1,n=C.getOptionsToAddHierarchyLevelToExistingHierarchies(e,t,i.singleVisual.query,r);if(n)for(var a=0,s=n;a<s.length;a++){var l=s[a];o=this.core.add(l,i)||o}return o},r.prototype.ensureDefaultFilterAndRaiseEvent=function(e,t,i,r){var o=t.config.singleVisual;if(this.ensureDefaultFilterApplied(e,o,i))this.eventBridge.publishToChannel(y.visualContainerChanged,{affectContainer:function(e){return!0}});else{var n=void 0;if(r&&o.objects){var a=r&&h.getValue(o.objects,r,null);n=null!=a}this.raiseVisualContainerChanged(t,n,e)}},r.prototype.ensureDefaultFilterApplied=function(e,t,i){var r=t.query.getUniqueQueryRefs();if(0===r.length)return!1;var o=t.query.defn.select().withName(r[0]).expr,n=V.getDefaultValue(o,e),a=this.visualPluginService.capabilities(t.visualType),s=a?a.objects:null;if(!n)return this.clearDefaultValueAndFilter(t,o,s),!1;var l=g.findDefaultValue(s);if(!l)return this.clearDefaultValueAndFilter(t,o,s),!1;if(i)return!1;t.objects||(t.objects={});var c,u=D.asFieldPattern(o);c=u.column||u.groupingColumn?o.getKeyColumns(e):o;var p=g.findFilterOutput(s),d=x.getDefaultValueFilter(c);return h.setValue(t.objects,p,null,d),!0},r.prototype.clearDefaultValueAndFilter=function(e,t,i){if(e.objects){var r=g.findFilterOutput(i);if(r){var o=h.getValue(e.objects,r,null);x.isDefaultFilter(o)&&h.deleteProperty(e.objects,r.objectName,null,r.propertyName)}}},r.prototype.resetSearchProperties=function(e){var t=L.getObjectDefinitions(e);if(t){var i=L.getVisualCapabilities(e,this.visualPluginService),r=this.filterGenerator.tryGetSelfFilterEnabledProperty(i);r&&h.deleteProperty(t,r.objectName,null,r.propertyName);var o=this.filterGenerator.tryGetSelfFilterProperty(i);o&&h.deleteProperty(t,o.objectName,null,o.propertyName)}},r.prototype.logReportMeasureMoveTelemetry=function(t,i,r,o,n){if(r!==o){var a=n&&n.getTargetEntity();if(a&&a.schema===v.ExplorationSchemaName){var s=n.getConceptualProperty(t);if(s){var l=this.getVisualDataRole(i,r),c=this.getVisualDataRole(i,o),u=JSON.stringify(l.requiredTypes),p=JSON.stringify(c.requiredTypes);u!==p&&this.telemetry.logEvent(e.telemetry.EXReportMeasureMoveRoleKind,e.PrimitiveTypeStrings[s.type.primitiveType],u,p)}}}},r})(),N=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.visitScopedEval=function(e){return new P(e.expression,[])},t})(e.data.SQExprRewriter);i.getVisualDefaultType=o,i.getVisualDefaultSort=n})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{deleteVisualRelationships:_.noop,getFilters:function(){return{dataFilter:null}},getVisualRelationshipFilterAction:function(){return 0},selectDataPoint:_.noop,setVisualRelationshipFilterAction:_.noop,clearHighlight:_.noop}}e.createQueryVisualHostServices=t})(t=e.VisualHostServicesUtil||(e.VisualHostServicesUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(t){var i=[{name:"AdvancedFilter",blockType:1,consumerHostFlags:299},{name:"BoxGrid",blockType:2,consumerHostFlags:3},{name:"CanvasLayout",blockType:1,consumerHostFlags:299},{name:"CanvasLayoutItem",blockType:1,consumerHostFlags:299},{name:"CanvasVisualError",blockType:1,consumerHostFlags:299},{name:"CanvasVisualErrorOverlay",blockType:2,consumerHostFlags:299},{name:"CanvasVisualHeaderIcon",blockType:1,consumerHostFlags:299},{name:"Carousel",blockType:1,consumerHostFlags:299},{name:"ClusteringDialog",blockType:2,consumerHostFlags:513},{name:"CodePaneContainer",blockType:1,consumerHostFlags:299},{name:"ConditionalFormattingDialog",blockType:2,consumerHostFlags:811},{name:"DatabarsDialog",blockType:2,consumerHostFlags:811},{name:"DateTimePicker",blockType:2,consumerHostFlags:11},{name:"DeleteVisualWarningDialog",blockType:1,consumerHostFlags:299},{name:"DetailVisual",blockType:1,consumerHostFlags:299},{name:"DisplayOptionFilter",dependencies:["localizationService"],blockType:4,consumerHostFlags:299},{name:"DotGrid",blockType:2,consumerHostFlags:11},{name:"EmbedModalDialog",blockType:1,consumerHostFlags:299},{name:"EsriConsentDialog",blockType:1,consumerHostFlags:299},{name:"Exploration",blockType:1,consumerHostFlags:299},{name:"ExplorationAppBar",blockType:1,consumerHostFlags:299},{name:"ExplorationFooter",blockType:2,consumerHostFlags:299},{name:"ExplorationHost",blockType:1,consumerHostFlags:299},{name:"ExplorationNavigationTab",dependencies:["platformCapabilities"],blockType:1,consumerHostFlags:299},{name:"ExplorationPaginator",blockType:1,consumerHostFlags:299},{name:"ExplorationStatusBar",blockType:1,consumerHostFlags:299},{name:"ExploreCanvas",dependencies:["telemetryService","overlayService","visualHostTooltip"],blockType:1,consumerHostFlags:299},{name:"FieldList",blockType:1,consumerHostFlags:811},{name:"FieldListEntity",blockType:1,consumerHostFlags:811},{name:"FieldListProperty",blockType:1,consumerHostFlags:811},{name:"FieldPicker",blockType:2,consumerHostFlags:523},{name:"Filter",blockType:1,consumerHostFlags:299},{name:"FilterPane",blockType:1,consumerHostFlags:299},{name:"FilterVisual",blockType:1,consumerHostFlags:299},{name:"FocusGroup",dependencies:["focus"],blockType:1,consumerHostFlags:811},{name:"IncludeExcludeFilter",blockType:2,consumerHostFlags:299},{name:"InstancePicker",blockType:2,consumerHostFlags:513},{name:"MobileVisualizationPane",blockType:2,consumerHostFlags:33},{name:"ImportVisualErrorDialog",blockType:1,consumerHostFlags:299},{name:"ImportVisualWarningDialog",blockType:1,consumerHostFlags:299},{name:"ModelingContextChanger",blockType:1,consumerHostFlags:299},{name:"PbiValidate",blockType:1,consumerHostFlags:299},{name:"PenAnnotation",blockType:2,consumerHostFlags:299},{name:"PropertyPaneTextBox",dependencies:["localizationService"],blockType:1,consumerHostFlags:811},{name:"SelectionBox",blockType:1,consumerHostFlags:299},{name:"TableViewDialog",blockType:2,consumerHostFlags:523},{name:"TaskPane",blockType:1,consumerHostFlags:299},{name:"TopNFilter",blockType:2,consumerHostFlags:299},{name:"VirtualList",blockType:1,consumerHostFlags:299},{name:"VisualContainer",blockType:1,consumerHostFlags:299},{name:"VisualContainerContextMenu",blockType:1,consumerHostFlags:299},{name:"VisualContainerDrill",blockType:2,consumerHostFlags:299},{name:"VisualContainerDrillToggle",blockType:2,consumerHostFlags:299},{name:"VisualContainerRelationshipFilters",blockType:2,consumerHostFlags:299},{name:"VisualContainerHeader",blockType:2,consumerHostFlags:299},{name:"VisualContainerOptionsMenu",blockType:2,consumerHostFlags:299},{name:"VisualContainerPinButton",blockType:2,consumerHostFlags:299},{name:"VisualContainerPopOutBar",blockType:1,consumerHostFlags:299},{name:"VisualContainerThumbnail",blockType:2,consumerHostFlags:1},{name:"VisualizationPane",blockType:1,consumerHostFlags:299},{name:"VisualWatermark",dependencies:["$templateCache","visualPlugin"],blockType:1,consumerHostFlags:299}];e.common.registerBuildingBlocksForHost(t,i,{componentsTarget:"powerbi.explore.components",componentsMap:e.explore.components,directivesTarget:"powerbi.explore.directives",directivesMap:e.explore.directives,filtersTarget:"powerbi.explore.filters",filtersMap:e.explore.filters})}var r=e.explore.services;angular.module("powerbi.explore.controllers",[]),angular.module("powerbi.explore.directives",[]),angular.module("powerbi.explore.components",[]),angular.module("powerbi.explore.filters",[]);var o=["powerbi.common","powerbi.explore.controllers","powerbi.explore.directives","powerbi.explore.components","powerbi.explore.filters","powerbi.visualHost"];angular.module("powerbi.explore",o).config(["dataReaderProviderProvider",function(t){t.registerExplorationDataReaderExtension=e.explore.dataReaderPlugins.registerExplorationDataReaderExtension}]).factory("displayNameService",["aggrOps",function(t){var i=e.common.localize,r={aggregateDisplayNames:{Sum:i.get("DisplayName_Sum"),Avg:i.get("DisplayName_Avg"),Count:i.get("DisplayName_Count"),Min:i.get("DisplayName_Min"),Max:i.get("DisplayName_Max"),CountNonNull:i.get("DisplayName_CountNonNull"),Median:i.get("DisplayName_Median"),StandardDeviation:i.get("DisplayName_StandardDeviation"),Variance:i.get("DisplayName_Variance"),DateMin:i.get("DisplayName_DateMin"),DateMax:i.get("DisplayName_DateMax"),StringMin:i.get("DisplayName_StringMin"),StringMax:i.get("DisplayName_StringMax")},showValueAsDisplayNames:{PercentOfGrandTotal:i.get("DisplayName_QuickCalc_PercentOfGrandTotal"),PercentOfGrandTotalTooltip:i.get("DisplayName_QuickCalc_PercentOfGrandTotalTooltip"),PercentileExclusive:i.get("DisplayName_QuickCalc_PercentileExclusive"),PercentileInclusive:i.get("DisplayName_QuickCalc_PercentileInclusive")},qualifiedDisplayNameTemplate:i.get("Field_Tooltip"),stringResourceProvider:i};return e.explore.services.createDisplayNameService(r,t)}]).factory("linguisticSchemaProxy",["promiseFactory",function(t){return e.explore.proxies.createLinguisticSchemaProxy(t,e.common.httpService)}]).factory("visualPlugin",["asyncFeatureSwitchService","mapControlFactory","promiseFactory","resourceLoader","visualSandbox",function(t,i,r,o,n){return e.explore.services.createExplorationVisualPluginService(t,r,o,i,n)}]).factory("transformPluginService",[function(){return e.data.transforms.createTransformPluginService()}]).factory("explorationSerializer",["visualPlugin","featureSwitchService","telemetryService",function(t,i,r){return e.explore.services.createExplorationSerializer(t,r)}]).factory("reportTileService",["promiseFactory","explorationProxy","$timeout",function(t,i,r){return e.explore.services.createReportTileService(t,i,r)}]).factory("explorationProxy",["promiseFactory","explorationSerializer","telemetryService","featureSwitchService",function(t,i,r,o){return e.explore.proxies.createExplorationProxy(t,e.common.httpService,i,r,o);
}]).factory("layoutInsertionHelper",(function(){return e.explore.services.createLayoutInsertionHelper()})).factory("federatedSchemaValidator",["localizationService",function(t){return e.explore.services.createFederatedSchemaValidator(t)}]).factory("geoTaggingAnalyzerService",["localizationService",function(t){return e.createGeoTaggingAnalyzerService((function(e){return t.get(e)}))}]).factory("daxParserService",(function(){return e.explore.services.createDaxParserService()})).factory("cultureService",(function(){return e.explore.services.createCultureService()})).factory("uiBlockingService",["promiseFactory",function(t){return e.explore.services.createUIBlockingService(t)}]).factory("embedProxy",["promiseFactory","localizationService",function(i,r){return t.proxies.createEmbedProxy(e.common.httpService,i,r)}]).factory("networkAvailability",[function(){return e.common.createNetworkAvailabilityService()}]).factory("visualStylePreset",(function(){return e.visualHost.services.createVisualStylePresetService()})).factory("visualHostTooltip",["$timeout",function(t){return e.explore.services.createVisualHostTooltipService(t)}]).directive("datepickerPopup",(function(){return{restrict:"EAC",require:"ngModel",link:function(e,t,i,r){r.$formatters.shift()}}})).factory("loadProgressNotificationService",["$timeout",function(t){return e.common.createLoadProgressNotificationService(t,(function(){}))}]).factory("subscription",["taskPaneSliderService","userInfo","localizationService",function(t,i,r){return e.explore.services.createSubscriptionPaneService(t,i,r)}]).factory("loadProgressNotificationService",["$timeout",function(t){return e.common.createLoadProgressNotificationService(t,(function(){}))}]).factory("visualConsent",["promiseFactory","telemetryService",function(t,i){return e.visualHost.createVisualConsentService(t,i)}]).factory("trustedVisual",["promiseFactory","telemetryService","visualConsent","approvedResourceService","visualSandbox","resourceLoader",function(t,i,r,o,n,a){return e.visualHost.createTrustedVisualService(t,i,r,o,n,a)}]).factory("focus",["$rootElement",function(t){return e.explore.services.createFocusService(t)}]).run(["lazyScopedFactories",function(e){e.clusteringAuthoring={source:{javascript:"ExploreUI/services/clusteringAuthoring"},ng:["conceptualSchemaProxy","promiseFactory","localizationService","transformPluginService"],scoped:["modelAuthoring","explorationNavigation","visualQueryGenerator","filterGenerator"],fn:function(e,t,i,r,o,n,a,s,l){return e.create(t,i,r,o,n,a,s,l)}},e.clustering={source:{javascript:"ExploreUI/services/clustering"},ng:["conceptualSchemaProxy","errorService","explorationSerializer","localizationService","modalDialogService","promiseFactory","telemetryService"],scoped:["clusteringState","groupingDesignStateService","modelChangeHandler","visualAuthoring","visualPlugin"],scopedModular:["clusteringAuthoring"],fn:function(e,t,i,r,o,n,a,s,l,c,u,p,d,v){return e.create(t,v,l,c,p,d,i,o,u,n,a,s,r)}}}]).run(["scopedProvider",function(i){i.register("dataSources",{fn:function(){return r.createDataSourcesService()}}).register("canvasScale",{scopedServices:["explorationNavigation","formFactor","popOut","viewModeState"],fn:function(e,t,i,o){return r.createCanvasScaleService(e,t,i,o)}}).register("uiComponent",{services:["$compile","promiseFactory","moduleLoader"],fn:function(t,i,r){return e.explore.services.createUIComponentService(t,r,i)}}).register("eventBridge",{fn:function(){return e.common.createEventBridge()}}).register("includeExcludeService",{services:["localizationService","telemetryService"],scopedServices:["eventBridge","undoRedo"],fn:function(e,i,r,o){return t.services.createIncludeExcludeService(r,e,o,i)}}).register("explorationNavigation",{services:["explorationProxy"],scopedServices:["eventBridge"],fn:function(t,i){return e.explore.services.createExplorationNavigationService(t,i)}}).register("servicePauser",{fn:function(){return e.explore.services.createServicePauser()}}).register("formFactor",{services:["$timeout","telemetryService"],scopedServices:["eventBridge","selection","servicePauser","viewModeState"],fn:function(e,t,i,o,n,a){return r.createFormFactorProvider(i,o,n,e,a,t)}}).register("viewModeState",{fn:function(){return e.explore.services.createViewModeState()}}).register("colorPicker",{fn:function(){return e.common.createColorPickerService()}}).register("drill",{scopedServices:["eventBridge","visualPlugin","visualPluginOps"],fn:function(e,t,i){return r.createDrillService(e,t,i)}}).register("drillToDetails",{services:["aggrOps","conceptualSchemaProxy","displayNameService","explorationSerializer","geoTaggingAnalyzerService","featureSwitchService","localizationService","$rootScope","$timeout","telemetryService"],scopedServices:["drill","eventBridge","explorationNavigation","filterGenerator","popOut","resourceRegistration","selection","sort","undoRedo","visualPlugin","visualPluginOps","visualRelationship","formFactor"],fn:function(e,t,i,o,n,a,s,l,c,u,p,d,v,h,g,f,m,y,w,C,S,b,x){return r.createDrillToDetailsService(t,o,C,S,n,w,a,m,v,g,l,c,d,i,u,y,b,p,h,e,f,s,x)}}).register("groupAuthoring",{services:["telemetryService"],fn:function(t){return e.explore.services.createDisabledGroupAuthoringService(t)}}).register("selection",{scopedServices:["eventBridge"],fn:function(t){return e.explore.services.createSelectionService(t)}}).register("popOut",{services:["telemetryService"],scopedServices:["eventBridge","selection"],fn:function(t,i,r){return e.explore.services.createPopOutService(t,i,r)}}).register("deleteVisual",{services:["$rootScope","telemetryService"],scopedServices:["eventBridge","visualPlugin","undoRedo"],fn:function(t,i,r,o,n){return e.exploreui.services.createDeleteVisualService(r,t,i,o,n)}}).register("importVisual",{services:["$rootScope","errorService","localFileService","localizationService","modalDialogService","notificationToast","promiseFactory","telemetryService","upload"],scopedServices:["eventBridge","visualPlugin"],fn:function(t,i,r,o,n,a,s,l,c,u,p){return e.exploreui.services.createImportVisualService(t,i,r,o,n,a,s,l,c,u,p)}}).register("visualRelationship",{scopedServices:["visualPlugin","visualPluginOps"],fn:function(t,i){return e.explore.services.createVisualRelationshipService(t,i)}}).register("visualPluginOps",{scopedServices:["visualPlugin"],fn:function(t){return e.explore.services.createVisualPluginOps(t)}}).register("undoRedo",{services:["$rootScope","logger"],scopedServices:["eventBridge","registeredResourceReferences"],fn:function(t,i,r,o){return e.explore.services.createUndoRedoService(t,r,i,o)}}).register("clipboard",{services:["visualStylePreset","$rootScope","promiseFactory"],scopedServices:["eventBridge","popOut","undoRedo","servicePauser","registeredResourceReferences"],fn:function(t,i,r,o,n,a,s,l){return s.register(e.explore.services.createClipboardService(o,n,a,t,i,l,r))}}).register("hostFiltersService",{services:["conceptualSchemaProxy","singleExecutableDataProxyFactory","promiseFactory"],scopedServices:["eventBridge"],fn:function(t,i,r,o){return e.explore.services.createHostFiltersService(t,i,r,o)}}).register("visualPlugin",{services:["asyncFeatureSwitchService","mapControlFactory","promiseFactory","visualSandbox"],scopedServices:["resourceLoader"],fn:function(t,i,r,o,n){return e.explore.services.createExplorationVisualPluginService(t,r,n,i,o)}}).register("sort",{services:["displayNameService","featureSwitches"],scopedServices:["visualPlugin"],fn:function(t,i,r){return e.explore.services.createSortService(t,i,r)}}).register("scriptVisuals",{services:["featureSwitchService","localizationService","userInfo","embedModeService"],scopedServices:["visualPlugin"],fn:function(t,i,r,o,n){return e.explore.services.createScriptVisualsService(n,t,i,r,o)}}).register("filterGenerator",{services:["aggrOps","telemetryService"],scopedServices:["eventBridge","hostFiltersService","visualPlugin","visualRelationship","scriptVisuals"],fn:function(t,i,r,o,n,a,s){return e.explore.services.createFilterGenerator(r,n,t,a,o,i,s)}}).register("visualQueryGenerator",{services:["aggrOps","dataReaderProvider","displayNameService","featureSwitchService","transformPluginService","telemetryService"],scopedServices:["filterGenerator","visualPlugin","visualPluginOps","sort"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createVisualQueryGenerator({dataReaders:i,displayNameService:r,featureSwitchService:o,plugin:l,pluginOps:c,sortService:u,aggrOps:t,filterGenerator:s,transformPluginService:n,telemetryService:a})}}).register("visualAuthoring",{services:["conceptualSchemaProxy","displayNameService","explorationSerializer","telemetryService","promiseFactory","geoTaggingAnalyzerService","featureSwitchService","aggrOps","visualHostTooltip","localizationService"],scopedServices:["drill","eventBridge","undoRedo","explorationNavigation","resourceRegistration","selection","sort","visualPlugin","visualPluginOps","visualRelationship","filterGenerator","formFactor"],fn:function(t,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f,m,y,w,C,S,b){return e.explore.services.createVisualAuthoring(y,w,t,i,o,h,f,a,r,d,n,v,s,m,C,p,S,l,c,g,b,u)}}).register("layoutAuthoring",{services:["explorationSerializer","telemetryService"],scopedServices:["eventBridge","explorationNavigation","formFactor","undoRedo","selection"],fn:function(t,i,r,o,n,a,s){return e.explore.services.createLayoutAuthoring(t,i,r,a,o,n,s)}}).register("canvasKeyHandler",{services:["explorationSerializer"],scopedServices:["selection","clipboard","undoRedo","viewModeState","visualAuthoring","eventBridge","popOut","formFactor","layoutAuthoring"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createCanvasKeyHandlerService(r,i,t,n,o,a,s,l,c,u)}}).register("modelChangeHandler",{services:["conceptualSchemaProxy","dataProxy","promiseFactory"],scopedServices:["$scope","dataSources","eventBridge","undoRedo","visualPlugin"],fn:function(t,i,r,o,n,a,s,l){return e.explore.services.createModelChangeHandler(t,i,o,n,a,s,l,r)}}).register("modelAuthoring",{services:["promiseFactory","telemetryService","modalDialogService","localizationService","daxParserService","explorationSerializer","cultureService","uiBlockingService"],scopedServices:["modelChangeHandler","explorationNavigation"],fn:function(t,i,r,o,n,a,s,l,c,u,p,d){return e.explore.services.createModelAuthoringService(t,i,c,r,o,u,p,d,n,a,s,l)}}).register("clusteringState",{fn:function(){return e.explore.services.createClusteringStateService()}}).register("groupingDesignStateService",{fn:function(){return e.explore.services.createGroupingDesignStateService()}}).register("groupQueryService",{services:["conceptualSchemaProxy","promiseFactory","singleExecutableDataProxyFactory"],scopedServices:["filterGenerator","visualQueryGenerator"],fn:function(e,i,r,o,n){return t.services.createGroupQueryService(r,o,e,n,i)}}).register("schemaItemActivation",{scopedServices:["eventBridge"],fn:function(t){return e.explore.services.createSchemaItemActivationService(t)}}).register("shell",{fn:function(){return e.explore.services.createShellService()}}).register("pinVisual",{services:["conceptualSchemaProxy","displayNameService","singleExecutableDataProxyFactory","featureSwitchService","resourcePackagesService"],scopedServices:["visualQueryGenerator","visualPlugin"],fn:function(t,i,r,o,n,a,s){return e.explore.services.createPinVisualService(t,i,r.create(),o,n,a,s)}}).register("explorationCapabilities",{fn:function(){return e.explore.services.createExplorationCapabilitiesService()}}).register("embed",{services:["$location","promiseFactory","explorationSerializer","conceptualSchemaProxy","dataProxy","displayNameService","activeGroupId"],scopedServices:["visualQueryGenerator","visualPlugin","filterGenerator"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createEmbedService(t,i,r,o,l,n,c,a,u,s)}}).register("exportVisualData",{services:["aggrOps","conceptualSchemaProxy","singleExecutableDataProxyFactory","geoTaggingAnalyzerService","featureSwitchService","promiseFactory","displayNameService","localizationService"],scopedServices:["visualPlugin","visualQueryGenerator"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createExportVisualDataService(c,u,r.create(),i,t,o,n,a,s,l)}}).register("resourcePublishing",{fn:function(t){return e.explore.services.createResourcePublishingService()}}).register("resourceRegistration",{scopedServices:["explorationNavigation","resourcePublishing"],fn:function(t,i){return e.explore.services.createResourceRegistrationService(t,i)}}).register("registeredResourceReferences",{services:["promiseFactory","explorationSerializer"],scopedServices:["resourceLoader","explorationNavigation","resourceRegistration"],fn:function(e,t,i,o,n){return r.createRegisteredResourceReferenceService(e,i,o,t,n)}}).register("filterRestatement",{services:["conceptualSchemaProxy","promiseFactory","dataProxy"],scopedServices:["filterGenerator","visualQueryGenerator"],fn:function(t,i,r,o,n){return e.explore.services.createFilterRestatementService(t,o,i,r,n)}}).register("daxTranslator",{fn:function(){return e.explore.services.createDaxTranslator()}}).register("daxTemplateService",{services:["conceptualSchemaProxy","displayNameService","localizationService"],scopedServices:["daxTranslator","dataSources"],fn:function(t,i,r,o,n){return e.explore.services.createDaxTemplateService({daxTranslator:o,conceptualSchemaProxy:t,dataSources:n,displayNameService:i,localizationService:r})}}).register("quickCalcService",{services:["aggrOps","conceptualSchemaProxy","modalDialogService","promiseFactory","telemetryService"],scopedServices:["dataSources","modelAuthoring","modelChangeHandler","daxTemplateService","visualAuthoring"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createQuickCalcService(t,i,a,r,s,l,o,c,u,n)}}).register("showValueAsService",{services:["localizationService","promiseFactory","telemetryService"],scopedServices:["undoRedo","visualAuthoring","visualPlugin"],fn:function(t,i,r,o,n,a){return e.explore.services.createShowValueAsService(t,i,r,o,n,a)}}).register("visualContainerContextMenuFactory",{services:["conceptualSchemaProxy","dropdown","featureSwitchService","localizationService","promiseFactory"],scopedServices:["dataSources","drill","drillToDetails","groupAuthoring","includeExcludeService","popOut","visualAuthoring"],fn:function(t,i,r,o,n,a,s,l,c,u,p,d){return e.explore.services.createVisualContainerContextMenuFactoryService(t,a,s,l,i,r,c,u,o,p,n,d)}})}]),t.registerBuildingBlocksForHost=i})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.TransformElementResizeStartEventName="TransformElementResizeStart",e.TransformElementResizeMoveEventName="TransformElementResizeMove",e.TransformElementResizeEndEventName="TransformElementResizeEnd",e.TransformElementDragStartEventName="TransformElementDragStart",e.TransformElementDragMoveEventName="TransformElementDragMove",e.TransformElementDragEndEventName="TransformElementDragEnd",e.TransformElementNudgeEventName="TransformElementNudge",e.scrollCarouselToEndEventName="scrollCarouselToEnd",e.explorationLoadedEventName="explorationLoaded",e.explorationClearedEventName="explorationCleared",e.pinVisualContainerEventName="pinVisualContainer",e.invalidVisualContainerId=-1,e.explorationNextPageEvent="explorationNextPage",e.explorationPreviousPageEvent="explorationPreviousPage",e.insertSectionEvent="insertSectionEvent",e.renameSectionEvent="renameSectionEvent",e.deleteSectionEvent="deleteSectionEvent",e.switchSectionEvent="switchSectionEvent",e.exploreCanvasVisualRendered="exploreCanvasVisualRendered",e.ConnectionSetupLimit=4,e.smallFontSizeInPoint=9;var t;!(function(e){e.AutoLayoutVisualPadding=10,e.AutoLayoutVisualVCHeader=20,e.AutoLayoutVisualSkittlesRightPadding=30,e.AutoLayoutMaxSpaceHeight=300,e.AutoLayoutMaxSpaceWidth=300,e.ResponsiveLayoutMaxWidthBreakpoint=500,e.ScrollbarOffset=15,e.DisplayAreaHeightAdditionMinimumScale=.9,e.DisplayAreaHeightScaleAddtion=.02,e.ExploreCanvasPadding=8,e.PhoneAuthoringViewportHeight=558,e.PhoneAuthoringViewportWidth=324,e.PhonePortraitRowCount=20,e.PhonePortraitCanvasHeight=1200})(t=e.ExploreCanvasConstants||(e.ExploreCanvasConstants={}))})(t=e.constants||(e.constants={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t="exploreUIShell",i="powerbi.exploreUIShell";e.ExploreUIShellModule={name:i,namespace:i,dependency:{javascript:t,css:[t]}}})(t=e.modules||(e.modules={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t,i=jsCommon.EnumExtensions;!(function(e){e[e.Rectangle=0]="Rectangle",e[e.Oval=1]="Oval",e[e.Line=2]="Line",e[e.Triangle=3]="Triangle",e[e.Arrow=4]="Arrow"})(t=e.Shape||(e.Shape={}));var r;!(function(e){function r(e,t,i,r){var o=[{text:e.get("ReportAppBar_ViewFitToPage"),description:e.get("ReportAppBar_ViewFitToPageDescription"),action:12,itemClass:"pbi-glyph-fittopage2",type:DropDownMenuItemType.Item,disabled:!1,selected:1===r},{text:e.get("ReportAppBar_ViewFitToWidth"),description:e.get("ReportAppBar_ViewFitToWidthDescription"),action:11,itemClass:"pbi-glyph-fittowidth",type:DropDownMenuItemType.Item,disabled:!1,selected:2===r},{text:e.get("ReportAppBar_ViewActualSize"),description:e.get("ReportAppBar_ViewActualSizeDescription"),action:10,itemClass:"pbi-glyph-actualsize",type:DropDownMenuItemType.Item,disabled:!1,selected:3===r}];return i&&(o.push({action:null,type:DropDownMenuItemType.Separator}),o.push({text:e.get("ReportAppBar_ShowGrid"),description:e.get("ReportAppBar_ShowGridDescription"),action:13,itemClass:"pbi-glyph-showgrid",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:t.getShowGridlines()}),o.push({text:e.get("ReportAppBar_SnapToGrid"),description:e.get("ReportAppBar_SnapToGridDescription"),action:14,itemClass:"pbi-glyph-snaptogrid",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:t.getSnapToGrid()})),o}function o(e,t){return[{text:e.get("ReportAppBar_EditReportInWebApp"),description:e.get("ReportAppBar_EditReportInWebAppDescription"),action:15,itemClass:"pbi-glyph-powerbi-service",type:DropDownMenuItemType.Item,tooltip:e.get("ReportAppBar_EditReportInWebAppDescription")},{text:e.get("ReportAppBar_EditReportInDesktop"),description:e.get("ReportAppBar_EditReportInDesktopDescription"),action:16,itemClass:"pbi-glyph-powerbi",type:DropDownMenuItemType.Item,disabled:!t,tooltip:t?e.get("ReportAppBar_EditReportInDesktopDescription"):e.get("ReportAppBar_DisabledEditReportInDesktopTooltip")}]}function n(e){var t=e.localizationService;return[{text:t.get("ReportAppBar_SaveToDashboard"),description:t.get("ReportAppBar_SaveToDashboardDescription"),action:0,itemClass:"pbi-glyph-save",show:e.showSave,tooltip:t.get("ReportAppBar_SaveToDashboardDescription")},{text:t.get("ReportAppBar_SaveAs"),description:t.get("ReportAppBar_SaveAsDescription"),action:1,itemClass:"pbi-glyph-saveas",show:e.showSaveAs,tooltip:t.get("ReportAppBar_SaveAsDescription")},{text:t.get("ReportAppBar_Print"),description:t.get("ReportAppBar_PrintDescription"),action:5,itemClass:"pbi-glyph-print",show:e.showPrint,tooltip:t.get("ReportAppBar_PrintDescription")},{text:t.get("ReportAppBar_SnapshotEmbed"),description:t.get("ReportAppBar_SnapshotEmbedDescription"),action:2,itemClass:"pbi-glyph-publishtoweb",show:e.showEmbed,tooltip:t.get("ReportAppBar_SnapshotEmbedDescription")},{text:t.get("ReportAppBar_SharePointEmbed"),description:t.get("ReportAppBar_SharePointEmbedDescription"),action:3,itemClass:"pbi-glyph-sharepoint",show:e.showSharepointEmbed},{text:t.get("ReportAppBar_Diagnostics"),description:t.get("ReportAppBar_DiagnosticsDescription"),action:6,itemClass:"pbi-glyph-code",show:e.showDiagnostics,tooltip:t.get("ReportAppBar_DiagnosticsDescription")},{text:t.get("ReportAppBar_PowerPoint"),description:t.get("ReportAppBar_PowerPointDescription"),action:7,itemClass:"pbi-glyph-powerpoint",show:e.showPowerPoint,tooltip:t.get("ReportAppBar_PowerPointDescription")},{text:t.get("ReportAppBar_DownloadReport"),description:t.get("ReportAppBar_DownloadReportDescription"),action:8,itemClass:"pbi-glyph-download2",show:e.showDownloadReport,disabled:!e.canDownloadReport,tooltip:e.canDownloadReport?t.get("ReportAppBar_DownloadReportDescription"):t.get("ReportAppBar_DisabledDownloadReportTooltip")}]}function a(e){return[{text:e.get("VisualContainer_SeeData_Enable"),action:17,itemClass:"pbi-glyph-seedata",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillDownLevel"),description:e.get("DrillDownLevel_ToolTip"),action:18,itemClass:"pbi-glyph-expand",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillDownLevelGrouped"),description:e.get("DrillDownLevelGrouped_ToolTip"),action:19,itemClass:"pbi-glyph-inline-drill",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillUp"),description:e.get("DrillUp_ToolTip"),action:20,itemClass:"pbi-glyph-drillup",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillDown"),description:e.get("DrillDown_ToolTip"),action:21,itemClass:"pbi-glyph-drilldowndisabled",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillToDetails"),description:e.get("DrillToDetails_ToolTip"),action:22,itemClass:"pbi-glyph-drilltodetail",type:DropDownMenuItemType.Item,disabled:!0,selected:!1}]}function s(e){return[l(e.get("ReportAppBar_ShapeRectangle"),e.get("ReportAppBar_ShapeRectangleDescription"),"shapeRectangle",t.Rectangle),l(e.get("ReportAppBar_ShapeOval"),e.get("ReportAppBar_ShapeOvalDescription"),"shapeOval",t.Oval),l(e.get("ReportAppBar_ShapeLine"),e.get("ReportAppBar_ShapeLineDescription"),"shapeLine",t.Line),l(e.get("ReportAppBar_ShapeTriangle"),e.get("ReportAppBar_ShapeTriangleDescription"),"shapeTriangle",t.Triangle),l(e.get("ReportAppBar_ShapeArrow"),e.get("ReportAppBar_ShapeArrowDescription"),"shapeArrow",t.Arrow)]}function l(e,r,o,n){return{text:e,description:r,action:23,itemClass:"displayOption "+o,type:DropDownMenuItemType.Item,param:i.toString(t,n).toLowerCase()}}function c(e){return[{text:e.get("ReportAppBar_Left"),description:e.get("Align_Left"),action:24,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Center"),description:e.get("Align_Center"),action:25,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Right"),description:e.get("Align_Right"),action:26,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Top"),description:e.get("Align_Top"),action:27,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Middle"),description:e.get("Align_Middle"),action:28,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Bottom"),description:e.get("Align_Bottom"),action:29,itemClass:"alignAction",type:DropDownMenuItemType.Item}]}function u(e){return[{text:e.get("ReportAppBar_Horizontal"),description:e.get("ReportAppBar_HorizontalDescription"),action:30,itemClass:"distributeAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Vertical"),description:e.get("ReportAppBar_VerticalDescription"),action:31,itemClass:"distributeAction",type:DropDownMenuItemType.Item}]}function p(e,t,i,r,o){var n=[];return o&&n.push({text:e.get("Report_GenerateQRCode"),action:34,type:DropDownMenuItemType.Item}),t.isAnalyzeInExcelSupported(i,r)&&n.push({text:e.get("ReportAppBar_AnalyzeInExcelMenuItem_Text"),action:32,type:DropDownMenuItemType.Item}),i.featureSwitches.staticExportReportEnabled&&n.push({text:e.get("ReportAppBar_ExportAsImage"),action:33,type:DropDownMenuItemType.Item}),n}e.createViewMenuActions=r,e.createEditReportMenuActions=o,e.createFileMenuActions=n,e.createExploreMenuActions=a,e.createShapeMenuActions=s,e.createAlignmentMenuActions=c,e.createDistributeMenuActions=u,e.createReportMoreOptionsMenuItems=p})(r=e.ExplorationAppBarViewModelFactory||(e.ExplorationAppBarViewModelFactory={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=.5,i=-1,r=(function(){function e(e){this.scope=e}return e.prototype.getRows=function(){var e=this.viewModel&&this.viewModel.rowCount;if(e)return this.rows&&this.rows.length===e||(this.rows=_.range(e)),this.rows},e.prototype.getColumns=function(){var e=this.viewModel&&this.viewModel.columnCount;if(e)return this.columns&&this.columns.length===e||(this.columns=_.range(e)),this.columns},e.getSvgSize=function(e,t){return e&&t?2*e.margin+t*(e.size+e.gutter)-e.gutter:0},e.getBoxLocation=function(e,i){return e?e.margin+i*(e.size+e.gutter)+t:0},e.getBoxSize=function(e){return e?e.size+i:0},e.prototype.getSvgWidth=function(){return this.viewModel?e.getSvgSize(this.viewModel.layout&&this.viewModel.layout.horizontal,this.viewModel.columnCount):0},e.prototype.getSvgHeight=function(){return this.viewModel?e.getSvgSize(this.viewModel.layout&&this.viewModel.layout.vertical,this.viewModel.rowCount):0},e.prototype.getBoxX=function(t){return this.viewModel?e.getBoxLocation(this.viewModel.layout&&this.viewModel.layout.horizontal,t):0},e.prototype.getBoxWidth=function(){return this.viewModel?e.getBoxSize(this.viewModel.layout&&this.viewModel.layout.horizontal):0},e.prototype.getBoxY=function(t){return this.viewModel?e.getBoxLocation(this.viewModel.layout&&this.viewModel.layout.vertical,t):0},e.prototype.getBoxHeight=function(){return this.viewModel?e.getBoxSize(this.viewModel.layout&&this.viewModel.layout.vertical):0},e})();e.BoxGridController=r})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.BoxGrid={templateUrl:"components/boxGrid/boxGrid.html",bindings:{viewModel:"<"},controller:e.common.createController(t.controllers.BoxGridController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.common.ArrowPosition,r=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["$timeout","localizationService","modalDialogService"]}},e.prototype.$onInit=function(){var e=function(e){return 1===e.clusterIds.length&&!_.isNumber(e.clusterIds[0])},t=this.args.partitions;t&&(this.partitionsExtended=_.map(t,(function(t,i){return{uniqueId:i,isBlank:e(t),name:t.name,clusterIds:t.clusterIds,numberOfItems:t.numberOfItems}}))),this.viewModel=this.createViewModel(this.args,this.partitionsExtended)},e.prototype.isGroupingColumnNameEmpty=function(){return!this.viewModel||_.isEmpty(this.viewModel.groupingColumnName)||0===this.viewModel.groupingColumnName.trim().length},e.prototype.canCommit=function(){var e=!this.isGroupingColumnNameEmpty(),t=!!this.viewModel&&!this.viewModel.hasDuplicatePartitionNames,i=!this.clusteringParametersForm||this.clusteringParametersForm.$valid;return e&&t&&i},e.prototype.commit=function(){var e={groupingColumnName:this.viewModel.groupingColumnName.trim(),description:this.viewModel.description,partitions:this.convertToPartitionsInfo(this.viewModel.partitions),numberOfClusters:Number(this.viewModel.numberOfClusters)};this.services.modalDialogService.close(e)},e.prototype.cancel=function(){this.services.modalDialogService.close()},e.prototype.startEditName=function(e,t){e.isEditingName=!0,t.stopPropagation()},e.prototype.cancelEditName=function(e){this.abandonRename(e),event.stopPropagation()},e.prototype.rename=function(e,t){var i=this,r=t?t.trim():"";if(_.isEmpty(r))return void this.abandonRename(e);e.displayName=r;var o=_.filter(this.viewModel.partitions,(function(t){return t!==e&&t.hasNameCollision})),n=[e].concat(o);n.forEach((function(e){var t=i.isNameExisting(e,e.displayName);e.hasNameCollision=t,e.isEditingName=t})),this.setPartitionNameDuplicationStatus()},e.prototype.abandonRename=function(e){var t=this.isNameExisting(e,e.displayName);e.hasNameCollision=t,this.setPartitionNameDuplicationStatus(),e.isEditingName=!1,t&&this.services.$timeout((function(){return e.isEditingName=!0}))},e.prototype.setPartitionNameDuplicationStatus=function(){this.viewModel&&(this.viewModel.hasDuplicatePartitionNames=_.any(this.viewModel.partitions,(function(e){return e.hasNameCollision})))},e.prototype.isNameExisting=function(e,t){return _.any(this.viewModel.partitions,(function(i){return i!==e&&i.displayName===t}))},e.prototype.getTooltipConfig=function(e){return e.isNameEditable?{tooltipDisable:!0}:{tooltipDelay:100,tooltipLocalizeTitle:"ClusteringDialog_NullClusterTooltip",isTooltipForModalDialog:!0,tooltipArrowPosition:i.arrowTopLeft}},e.prototype.createViewModel=function(e,t){return{groupingColumnName:this.args.groupingColumnName,sourcePropertyName:this.args.sourcePropertyName,description:this.args.description,partitions:this.convertToPartitionNodes(t),numberOfClusters:this.args.numberOfClusters||void 0,errorMessage:this.args.errorMessage}},e.prototype.convertToPartitionNodes=function(e){var t=this;if(e){var i=function(e){return e.isBlank},r=function(e){return!e.isBlank},o=function(e){return _.min(e.clusterIds)},n=function(e){return{uniqueId:e.uniqueId,displayName:e.isBlank?t.services.localizationService.get("NullValue"):e.name,numberOfItems:t.services.localizationService.format("ClusteringDialog_NumberOfItems",[e.numberOfItems]),isEditingName:!1,isNameEditable:!e.isBlank}},a=_.chain(e).filter(r).sortBy(o).map(n),s=_.find(e,i);return s&&(a=a.concat(n(s))),a.value()}},e.prototype.convertToPartitionsInfo=function(e){var t=this;if(e)return _.map(e,(function(e){var i=_.find(t.partitionsExtended,(function(t){return t.uniqueId===e.uniqueId}));return{name:i.isBlank?null:e.displayName,clusterIds:i.clusterIds}}))},e})();t.ClusteringDialogController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.ClusteringDialog={templateUrl:"components/clusteringDialog/clusteringDialog.html",bindings:{args:"<"},controller:e.common.createController(t.controllers.ClusteringDialogController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.visuals.GradientUtils,r=(function(){function e(e,t){var i=this;this.services=t,this.updateGradientNullColor=function(e){i.viewModel.gradientSettings.nullColor=e},this.updateGradientMinColor=function(e){i.viewModel.gradientSettings.minColor=e,i.updateGradientBar()},this.updateGradientMaxColor=function(e){i.viewModel.gradientSettings.maxColor=e,i.updateGradientBar()},this.updateGradientMidColor=function(e){i.viewModel.gradientSettings.midColor=e,i.updateGradientBar()}}return e.createOptions=function(){return{additionalServices:["modalDialogService"]}},e.prototype.selectedOptionsChange=function(e){var t=this.viewModel.gradientSettings,i=e.id;switch(i){case 0:break;case 1:t.minValue=void 0;break;case 3:t.midValue=void 0;break;case 2:t.maxValue=void 0}},e.prototype.updateGradientBar=function(){this.viewModel.gradientBarValue=i.getGradientBarColors(this.viewModel.gradientSettings)},e.prototype.updateDiverging=function(){this.viewModel.gradientSettings.diverging=!this.viewModel.gradientSettings.diverging,this.updateGradientBar()},e.prototype.apply=function(){this.viewModel.gradientSettings.nullStrategy=this.viewModel.nullStrategyOption.stringValue;var e={gradientSettings:this.viewModel.gradientSettings,minimumSelectedId:this.viewModel.minimumSelectedOption&&this.viewModel.minimumSelectedOption.id,centerSelectedId:this.viewModel.centerSelectedOption&&this.viewModel.centerSelectedOption.id,maximumSelectedId:this.viewModel.maximumSelectedOption&&this.viewModel.maximumSelectedOption.id};this.services.modalDialogService.close(e)},e.prototype.cancel=function(){this.services.modalDialogService.close()},e})();t.ConditionalFormattingDialogController=r})(i=t.controllers||(t.controllers={}));
})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.ConditionalFormattingDialog={templateUrl:"components/conditionalFormattingDialog/conditionalFormattingDialog.html",bindings:{viewModel:"<"},controller:e.common.createController(t.controllers.ConditionalFormattingDialogController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=t.util.ConditionalFormattingUtil,n=e.visuals.GradientUtils;!(function(t){function i(e,t,i,o,n){var a={viewModel:r(e,t,i,n)};return{dialogName:"ConditionalFormattingDialog",definitionTemplateCachePath:"components/conditionalFormattingDialog/conditionalFormattingDialogDefinition.html",bindings:a,dialogCssClass:"conditionalFormattingDialog"}}function r(t,i,r,p){var d=o.getGradientSettings(i.config.singleVisual,p)||e.visuals.GradientUtils.getDefaultGradientSettings(),v=n.getGradientBarColors(d),h={baseExprDisplayName:r,gradientSettings:d,gradientBarValue:v,colorPickerType:{fill:{solid:{color:!0}}},minimumSelectOptions:c(t),centerSelectOptions:l(t),maximumSelectOptions:s(t),nullStrategyOptions:u(t)};return a(h),h}function a(t){switch(void 0!==t.gradientSettings.minValue?t.minimumSelectedOption=t.minimumSelectOptions[1]:t.minimumSelectedOption=t.minimumSelectOptions[0],void 0!==t.gradientSettings.maxValue?t.maximumSelectedOption=t.maximumSelectOptions[1]:t.maximumSelectedOption=t.maximumSelectOptions[0],void 0!==t.gradientSettings.midValue?t.centerSelectedOption=t.centerSelectOptions[1]:t.centerSelectedOption=t.centerSelectOptions[0],t.gradientSettings.nullStrategy){case e.NullStrategy.noColor:t.nullStrategyOption=t.nullStrategyOptions[0];break;case e.NullStrategy.specificColor:t.nullStrategyOption=t.nullStrategyOptions[2];break;default:t.nullStrategyOption=t.nullStrategyOptions[1]}}function s(e){return[{id:2,value:e.get("ConditionalFormattingDialog_HighestValue"),disableInput:!0},p(e)]}function l(e){return[{id:3,value:e.get("ConditionalFormattingDialog_MiddleValue"),disableInput:!0},p(e)]}function c(e){return[{id:1,value:e.get("ConditionalFormattingDialog_LowestValue"),disableInput:!0},p(e)]}function u(t){return[{id:0,value:t.get("ConditionalFormattingDialog_FormatNull_NoFormat"),disableInput:!0,stringValue:e.NullStrategy.noColor},{id:1,value:t.get("ConditionalFormattingDialog_FormatNull_AsZero"),disableInput:!0,stringValue:e.NullStrategy.asZero},{id:2,value:t.get("ConditionalFormattingDialog_FormatNull_SpecificColor"),disableInput:!1,stringValue:e.NullStrategy.specificColor}]}function p(e){return{id:0,value:e.get("ConditionalFormattingDialog_Number"),disableInput:!1}}t.createDialog=i,t.createConditionalFormattingDialogViewModel=r})(r=i.ConditionalFormattingDialogViewModelFactory||(i.ConditionalFormattingDialogViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.viewModels.ConditionalFormattingDialogViewModelFactory,o=t.util.ConditionalFormattingUtil,n=e.data.SQExprBuilder,a=t.util.VisualContainerUtils,s=(function(){function t(e,t,i,r,o){this.localizationService=e,this.modalDialogService=t,this.promiseFactory=i,this.telemetryService=r,this.visualAuthoring=o}return t.prototype.show=function(t,i,r,o,n){var a=this,s={exprDisplayName:i,expr:r,objectRepetition:n,schema:o,selectName:t.config.singleVisual.query.defn.selectNameOf(r),visual:t},l=this.createDialogDefinition(s),c=this.promiseFactory.defer(),u=this.modalDialogService.showHostModalDialog(l);return c.promise.catch((function(){return u.reject()})),u.then((function(e){e&&a.setConditionalFormatting(s,e),c.resolve(null)})),e.RejectablePromise(c)},t.prototype.createDialogDefinition=function(e){var t={viewModel:r.createConditionalFormattingDialogViewModel(this.localizationService,e.visual,e.exprDisplayName,e.objectRepetition)};return{dialogName:"ConditionalFormattingDialog",definitionTemplateCachePath:"components/conditionalFormattingDialog/conditionalFormattingDialogDefinition.html",bindings:t}},t.prototype.setConditionalFormatting=function(t,i){var r=i.gradientSettings,s=t.expr,l=n.selectRef(t.selectName),c=s.getMetadata(t.schema).type,u=o.createFillDefinition(l,r,c);this.visualAuthoring.addConditionalFormatting(t.visual,t.objectRepetition,u);var p=0===i.minimumSelectedId||0===i.centerSelectedId||0===i.maximumSelectedId;this.telemetryService.logEvent(e.telemetry.EXSetConditionalFormatting,a.getVisualType(t.visual),r.diverging,p)},t})();i.ConditionalFormattingDialogBuilder=s})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){var i=this;this.services=t,this.updatePositiveColor=function(e){i.viewModel.positiveColor.solid.color=e},this.updateNegativeColor=function(e){i.viewModel.negativeColor.solid.color=e},this.updateAxisColor=function(e){i.viewModel.axisColor.solid.color=e}}return e.createOptions=function(){return{additionalServices:["modalDialogService"]}},e.prototype.getDataBarsSettings=function(){return{axisColor:this.viewModel.axisColor,hideText:this.viewModel.hideText,maxValue:0===this.viewModel.maximumSelectedOption.id?this.viewModel.maxValue:void 0,minValue:0===this.viewModel.minimumSelectedOption.id?this.viewModel.minValue:void 0,positiveColor:this.viewModel.positiveColor,negativeColor:this.viewModel.negativeColor,reverseDirection:1===this.viewModel.barDirectionOption.id}},e.prototype.apply=function(){var e={dataBars:this.getDataBarsSettings()};this.services.modalDialogService.close(e)},e.prototype.cancel=function(){this.services.modalDialogService.close()},e})();e.DataBarsDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.DatabarsDialog={templateUrl:"components/dataBarsDialog/dataBarsDialog.html",bindings:{viewModel:"<"},controller:e.common.createController(t.controllers.DataBarsDialogController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i,r=e.util.DataBarsUtil;!(function(e){function t(e,t,s,c,u){var p=r.getDataBarsSettings(t.config.singleVisual,c,u),d={fieldDisplayName:s,colorPickerType:{fill:{solid:{color:!0}}},minimumSelectOptions:a(e),maximumSelectOptions:n(e),barDirectionOptions:l(e),axisColor:p.axisColor,hideText:p.hideText,maxValue:p.maxValue,minValue:p.minValue,positiveColor:p.positiveColor,negativeColor:p.negativeColor,reverseDirection:p.reverseDirection};return i(p,d),o(p,d),d}function i(e,t){void 0!==e.minValue?t.minimumSelectedOption=t.minimumSelectOptions[1]:t.minimumSelectedOption=t.minimumSelectOptions[0],void 0!==e.maxValue?t.maximumSelectedOption=t.maximumSelectOptions[1]:t.maximumSelectedOption=t.maximumSelectOptions[0]}function o(e,t){e.reverseDirection?t.barDirectionOption=t.barDirectionOptions[1]:t.barDirectionOption=t.barDirectionOptions[0]}function n(e){return[{id:2,value:e.get("ConditionalFormattingDialog_HighestValue"),disableInput:!0},s(e)]}function a(e){return[{id:1,value:e.get("ConditionalFormattingDialog_LowestValue"),disableInput:!0},s(e)]}function s(e){return{id:0,value:e.get("ConditionalFormattingDialog_Number"),disableInput:!1}}function l(e){return[{id:0,value:e.get("DataBarsDialog_BarDirection_LeftToRight")},{id:1,value:e.get("DataBarsDialog_BarDirection_RightToLeft")}]}e.createDataBarsDialogViewModel=t})(i=t.DataBarsDialogViewModelFactory||(t.DataBarsDialogViewModelFactory={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.viewModels.DataBarsDialogViewModelFactory,o=t.util.DataBarsUtil,n=t.util.VisualContainerUtils,a=(function(){function t(e,t,i,r,o){this.localizationService=e,this.modalDialogService=t,this.promiseFactory=i,this.telemetryService=r,this.visualAuthoring=o}return t.prototype.show=function(t,i,r,o,n,a,s){var l=this,c={fieldDisplayName:i,fieldExpr:r,propertyId:n,selector:a,schema:o,visual:t,fromPropertyPane:s},u=this.createDialogDefinition(c),p=this.promiseFactory.defer(),d=this.modalDialogService.showHostModalDialog(u);return p.promise.catch((function(){return d.reject()})),d.then((function(e){e&&l.setDataBars(c,e),p.resolve(null)})),e.RejectablePromise(p)},t.prototype.createDialogDefinition=function(e){var t={viewModel:r.createDataBarsDialogViewModel(this.localizationService,e.visual,e.fieldDisplayName,e.propertyId,e.selector)};return{dialogName:"DataBarsDialog",definitionTemplateCachePath:"components/dataBarsDialog/dataBarsDialogDefinition.html",bindings:t}},t.prototype.setDataBars=function(t,i){var r=t.fieldExpr.getMetadata(t.schema).type,a=o.createDataBarsDefinition(i.dataBars,r);this.visualAuthoring.addDataBars(t.visual,t.propertyId,t.selector,a),this.telemetryService.logEvent(e.telemetry.EXSetDataBars,n.getVisualType(t.visual),void 0!==i.dataBars.minValue||void 0!==i.dataBars.maxValue,t.fromPropertyPane)},t})();i.DataBarsDialogBuilder=a})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.moduleConfig={name:"ui.bootstrap",dependency:{javascript:"angular-ui-datetimepicker"}},this.services=t}return e.createOptions=function(){return{additionalServices:["overlayService"]}},e.prototype.$onInit=function(){var e=this;this.ngModel.$render=function(){if(_.isNumber(e.ngModel.$viewValue)){var t=new Date(e.ngModel.$viewValue);"Invalid Date"!==t.toString()?e.ngModel.$setViewValue(t):e.ngModel.$setViewValue(void 0)}else void 0===e.ngModel.$viewValue?(e.textVal=void 0,e.dateVal=void 0,e.inputInvalid=!1):e.inputInvalid||(e.dateVal=e.ngModel.$viewValue,e.textVal=e.ngModel.$viewValue.toLocaleDateString()+" "+e.ngModel.$viewValue.toLocaleTimeString())}},e.prototype.$onChanges=function(e){e&&e.validators&&void 0!==this.textVal&&this.validateTextInput()},e.prototype.dateSelected=function(){this.inputInvalid=!1,this.textVal=this.dateVal.toLocaleDateString()+" "+this.dateVal.toLocaleTimeString(),this.ngModel.$setViewValue(this.dateVal),this.services.overlayService.hideAllDropdowns()},e.prototype.dateTextUpdated=function(){this.validateTextInput(),this.inputInvalid||this.ngModel.$setViewValue(this.dateVal)},e.prototype.validateTextInput=function(){if(this.textVal){var e=new Date(this.textVal);this.inputInvalid="Invalid Date"===e.toString()||e<this.validators.min||e>this.validators.max,this.inputInvalid||(this.dateVal=e)}else this.textVal=void 0,this.dateVal=void 0,this.inputInvalid=!1},e})();e.DateTimePickerController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.DateTimePicker={templateUrl:"components/dateTimePicker/dateTimePicker.html",bindings:{placeholder:"<",validators:"<"},require:{ngModel:"ngModel"},controller:e.common.createController(t.controllers.DateTimePickerController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.DotGrid={templateUrl:"components/dotGrid/dotGrid.html",bindings:{viewModel:"<"},controller:["$scope","$element",function(t,i){return new e.DotGridController(t,i)}]};var t;!(function(e){function t(e,t){return e===t||e&&t&&e.UnitLength===t.UnitLength&&e.UnitDivisions===t.UnitDivisions}function i(t,i){var r=$("<canvas></canvas>").attr({width:t.UnitLength,height:i.UnitLength}).get(0),o=r.getContext("2d");o.fillStyle=e.dotColor;for(var n=0;n<t.UnitDivisions;++n){var a=Math.round(n*t.UnitLength/t.UnitDivisions);o.fillRect(a,0,1,1)}for(var n=1;n<i.UnitDivisions;++n){var s=Math.round(n*i.UnitLength/i.UnitDivisions);o.fillRect(0,s,1,1)}return r}function r(t,i){var r=t/(i/e.CanvasLayout.UnitLength);r=Math.floor(r);var o=_.find(a,(function(t){return 1===t||r/t>=e.MinimumUnitDivisionLength}));return{UnitLength:r,UnitDivisions:o}}function o(e,t){return{x:n(e.x,t.width),y:n(e.y,t.height)}}function n(t,i){var r=e.getLayoutForScreen(t*i,i),o=r.UnitLength/e.CanvasLayout.UnitLength,n=e.getLayoutForScreen(o*i,i),a=n.UnitLength/e.CanvasLayout.UnitLength;return a}e.sameLayout=t,e.dotColor="#333",e.drawGridUnit=i,e.CanvasLayout={UnitLength:96,UnitDivisions:12};var a=[12,6,4,3,2,1];e.MinimumUnitDivisionLength=8,e.getLayoutForScreen=r,e.adjustScaleForGrid=o})(t=e.DotGridComponent||(e.DotGridComponent={}))})(t=e.components||(e.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.components.DotGridComponent,r=(function(){function e(e,t){this.background=t.find(".background")}return e.prototype.$onInit=function(){this.viewModel&&this.onViewModelChange()},e.prototype.$onChanges=function(e){e.viewModel&&this.onViewModelChange()},e.prototype.onViewModelChange=function(){var e=i.drawGridUnit(this.viewModel.layoutX,this.viewModel.layoutY),t=e.toDataURL("image/png");this.background.css("background-image","url("+t+")")},e})();t.DotGridController=r})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=e.services.events,r=(function(){function t(e,t){var r=this;this.services=t,this.services.eventBridge.createChannelSubscriptionManager().subscribe(i.renameSection,(function(e,t){return r.renameSection(t)}))}return t.createOptions=function(){return{additionalServices:["linguisticSchemaProxy"],scopedDependencies:["eventBridge","formFactor","undoRedo","viewModeState"]}},t.prototype.createSection=function(){this.services.eventBridge.publishToChannel(i.createSection)},t.prototype.isEditMode=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canAddRemoveSections()},t.prototype.getModeString=function(){return this.isEditMode()?"editing":0===this.services.viewModeState.getMode()?"reading":void 0},t.prototype.renameSection=function(t){var r=this,o=this.viewModel.exploration.contract;this.services.undoRedo.register("RenameNavigationTab",(function(){var n=o.sections[t.sectionIndex].name;e.SectionUtils.renameSection(r.viewModel,t.sectionNewName,t.sectionIndex),e.PodUtils.updateLinguisticPrimaryName(o,n,t.sectionNewName,r.services.linguisticSchemaProxy).then((function(){var e={sectionName:t.sectionNewName,sectionIndex:t.sectionIndex};r.services.eventBridge.publishToChannel(i.sectionNameChanged,e)}))}))},t})();t.ExplorationFooterController=r})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.ExplorationFooter={templateUrl:"components/explorationFooter/explorationFooter.html",bindings:{viewModel:"<"},controller:e.common.createController(e.explore.controllers.ExplorationFooterController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.util.DragDropTypes,o=e.data.FieldExprPattern,n=e.data.SQExpr,a=e.data.SQHierarchyExprUtils,s=(function(){function i(e,t){this.displayNameOptions={includeDefaultAggregate:!0,includeVariationSource:!0},this.services=t}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","displayNameService","dragDataService","dropdown","localizationService","promiseFactory"],scopedDependencies:["dataSources"]}},i.prototype.$onInit=function(){var e=this;this.dropConfig={accept:r.Field,greedy:!1},this.ngModel.$render=function(){e.ngModel.$viewValue?e.updateExpression(e.ngModel.$viewValue):e.updateExpression(void 0)}},i.prototype.getDropAction=function(){var e=this,t=this.services.promiseFactory.defer(),i=this.services.dragDataService.getDragContext();if(i&&i.field){var r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var o=i.field;o?(o=e.ensureAggregate(o,r),t.resolve(e.validateInput(o,r)?1:0)):t.resolve(0)}))}else t.resolve(0);return t.promise},i.prototype.drop=function(){var e=this,t=this.services.dragDataService.getDragContext();if(t&&t.field){var i=t.field;if(i){var r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(t){i=e.ensureAggregate(i,t);var r=e.validateInput(i,t);r&&e.updateExpression(i)}))}}},i.prototype.showMenu=function(e){var t=this;e.stopPropagation(),this.services.dropdown.showContextMenu({items:this.menuItems},{x:e.pageX,y:e.pageY},(function(e){return t.onMenuItemSelected(e)}),!1)},i.prototype.deleteField=function(){this.updateExpression(null)},i.prototype.updateMenuItems=function(){var e=this,t=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(t).then((function(t){if(e.shouldAggregate(e.ngModel.$viewValue,t))return void(e.menuItems=e.createAggregateMenuItems(t));var i=e.getVariations(t);_.isEmpty(i)?e.menuItems=[]:e.menuItems=e.createVariationsMenuItems(i,t)}))},i.prototype.createAggregateMenuItems=function(i){if(!this.ngModel.$viewValue)return[];var r=t.viewModels.MenuItemFactory.createAggregateMenuItems(this.ngModel.$viewValue,i,this.services.aggrOps,!1,e.VisualDataRoleKind.Measure,this.getValidationType());return this.updateAggregateMenuCheckedItem(r),r},i.prototype.updateAggregateMenuCheckedItem=function(e){for(var t=o.getAggregate(this.ngModel.$viewValue),i=0,r=e;i<r.length;i++){var n=r[i];n.checked=n.key.aggregate===t}},i.prototype.createVariationsMenuItems=function(e,t){for(var i=[],r=0,o=e;r<o.length;r++){var n=o[r];i.push({type:0,key:n,text:this.services.displayNameService.getDisplayName(n,t,null)})}return this.updateVariationsMenuCheckedItem(i),i},i.prototype.updateVariationsMenuCheckedItem=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];r.checked=n.equals(this.ngModel.$viewValue,r.key)}},i.prototype.onMenuItemSelected=function(e){e instanceof n?(this.updateExpression(e),this.updateVariationsMenuCheckedItem(this.menuItems)):(this.updateAggregate(e),this.updateAggregateMenuCheckedItem(this.menuItems))},i.prototype.updateExpression=function(e){var t=this;if(e){var i=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(i).then((function(i){t.expressionDisplayName=t.services.displayNameService.getDisplayName(e,i,null,t.displayNameOptions),t.tooltip=t.services.displayNameService.getQualifiedDisplayName(e,i,null,t.displayNameOptions),t.ngModel.$setViewValue(e),t.updateMenuItems()}))}else this.expressionDisplayName=this.services.localizationService.get("FieldDropZone_Watermark"),this.tooltip=this.services.localizationService.get("FieldDropZone_Watermark"),this.ngModel.$setViewValue(null),this.updateMenuItems()},i.prototype.updateAggregate=function(t){var i=e.data.SQExprBuilder.setAggregate(this.ngModel.$viewValue,t.aggregate);this.updateExpression(i)},i.prototype.ensureAggregate=function(e,t){return this.shouldAggregate(e,t)?this.services.aggrOps.createExprWithAggregate(e,t,!0,this.getValidationType()):e},i.prototype.shouldAggregate=function(t,i){if(t&&i)return 1===this.getValidationKind()&&!e.data.SQExprUtils.discourageAggregation(t,i)},i.prototype.getVariations=function(e){if(0!==this.getValidationKind())return[];var t=this.ngModel.$viewValue;if(!t)return[];var i=t;if(n.isHierarchyLevel(t)&&(i=a.getSourceVariationExpr(t),!i))return[];var r=a.expandExpr(e,i);if(!_.isArray(r)&&n.equals(r,i))return[];var o=_.isArray(r)?r:[r],s=[];this.validateInput(i,e)&&s.push(i);for(var l=0,c=o;l<c.length;l++){var u=c[l];this.validateInput(u,e)&&s.push(u)}return s.length<=1&&n.equals(s[0],this.ngModel.$viewValue)?[]:s},i.prototype.validateInput=function(t,i){var r=t.getConceptualProperty(i);if(r&&r.kpiValue)return!1;var o=t.getMetadata(i);return o&&o.kind===this.getValidationKind()&&(_.isEmpty(this.getValidationType())||e.ValueType.isCompatibleTo(o.type,this.getValidationType(),!0))},i.prototype.getValidationType=function(){var e=this.validators&&this.validators.field&&this.validators.field.type;if(e)return e.variant||[e]},i.prototype.getValidationKind=function(){return this.validators&&this.validators.field&&this.validators.field.kind},i})();i.FieldPickerController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.FieldPicker={templateUrl:"components/fieldPicker/fieldPicker.html",bindings:{validators:"<"},require:{ngModel:"ngModel"},controller:e.common.createController(t.controllers.FieldPickerController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.data.segmentation.DataViewMerger,n=t.services,a=e.data.SemanticQuery,s=e.data.SQExpr,l=e.data.SQExprBuilder,c=t.util.VisualContainerUtils,u=t.contracts.VisualQuery,p=e.visuals.services,d=(function(){function i(i,r){var o=this;this.slicerWidth=146,this.slicerHeight=28,this.scope=i,this.services=r,this.visualHostServices=e.Prototype.inherit(n.createVisualHostServices(this.services.promiseFactory,this.services.moduleLoader,p.createGeolocation(),this.services.geocoder),(function(e){e.persistProperties=function(e){return o.persistProperties(e)},e.loadMoreData=function(){return o.loadMoreData()},e.analyzeFilter=function(e){return n.createAnalyzedFilter(e,!1)},e.getLocalizedString=function(e){return o.getLocalizedString(e)}})),this.dataProxy=n.createExploreVisualDataProxyService(this.services.singleExecutableDataProxyFactory.create(),this.services.filterGenerator),this.queryVisualHostServices=t.util.VisualHostServicesUtil.createQueryVisualHostServices()}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","geocoder","localizationService","moduleLoader","promiseFactory","singleExecutableDataProxyFactory"],scopedDependencies:["dataSources","filterGenerator","visualPlugin","visualQueryGenerator"]}},i.prototype.$onInit=function(){var e=this;this.createVisualDefinition(),this.ngModel.$render=function(){e.updateVisual(!1)},this.fieldWatcherUnsubscribe=this.scope.$watch("$ctrl.ngModel.$viewValue.field",(function(t,i){s.equals(t,i)||e.onFieldChange()}))},i.prototype.$onDestroy=function(){this.fieldWatcherUnsubscribe()},i.prototype.onFieldChange=function(){this.ngModel.$setViewValue({field:this.ngModel.$viewValue.field,filter:void 0}),this.updateVisual(!1)},i.prototype.updateVisual=function(e){var t=this;this.ngModel.$viewValue.field&&this.loadData(e).then((function(e){t.visual.data=e;var i=_.clone(t.dataProxy.lastExecutedQuery().transforms);i.objects=t.visual.dataTransforms.objects,t.visual.dataTransforms=i}))},i.prototype.createVisualDefinition=function(){var i={},o=e.visuals.slicerProps.data.mode,n=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,a=e.visuals.slicerProps.selection.singleSelect,s=e.visuals.slicerProps.header.show,c=e.visuals.slicerProps.items.textSize;r.setValue(i,o,null,l.text(this.mode)),r.setValue(i,n,null,l.boolean(!1)),r.setValue(i,a,null,l.boolean(!0)),r.setValue(i,s,null,l.boolean(!1)),r.setValue(i,c,null,l.integer(t.constants.smallFontSizeInPoint)),this.visual={viewport:{width:this.slicerWidth,height:this.slicerHeight,scale:1},type:e.visuals.plugins.slicer.name,dataTransforms:{objects:i},hostServices:this.visualHostServices,interactivityOptions:{dragDataPoint:!1,selection:!0},visualPlugin:this.services.visualPlugin}},i.prototype.persistProperties=function(t){var i,o=this,n=this.services.filterGenerator.tryGetFilterPropertyIdentifier(e.visuals.plugins.slicer.capabilities),a=this.visual.dataTransforms.objects;t&&!_.isEmpty(t.merge)&&(i=t.merge[0].properties[n.propertyName]),i?r.setValue(a,n,null,i):r.deleteProperty(a,n.objectName,null,n.propertyName),this.services.timeout((function(){var e=_.clone(o.visual.data);o.visual.data=e})),this.ngModel.$setViewValue({field:this.ngModel.$viewValue.field,filter:i})},i.prototype.loadData=function(t){var i=this,r=this.services.promiseFactory.defer(),n=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(n).then((function(r){var o=new u(a.create(),{});return o.add(i.ngModel.$viewValue.field,e.visuals.slicerRoles.value),i.dataProxy.runQuery({dataSources:n,schema:r,config:{visualType:e.visuals.plugins.slicer.name,query:o,objects:i.visual.dataTransforms.objects},hostServices:i.queryVisualHostServices,visualQueryGenerator:i.services.visualQueryGenerator,isLoadMore:t,preferCurrentData:!t,isInitialLoad:!t})})).then((function(e){var n,a=i.visual.data&&i.visual.data.dataView,s=i.visual.data&&i.visual.data.dataViewSource;if(e&&e.dataReaderResult&&e.dataReaderResult.dataView&&e.dataViewSource&&i.visual)if(t){var l=e.dataReaderResult.dataView;if(l){var u=i.visual.data.dataView;o.mergeDataViews(u,l),a=u}s=e.dataViewSource,n=!1}else a=e.dataReaderResult.dataView,s=e.dataViewSource,n=c.isSegment(a);r.resolve({dataView:a,dataViewSource:s,isFirstSegment:n})})),r.promise},i.prototype.loadMoreData=function(){this.dataProxy.canLoadMore()&&this.updateVisual(!0)},i.prototype.getLocalizedString=function(e){return"Slicer_Restatement_All"===e?this.services.localizationService.get("InstancePicker_Slicer_Restatement_All"):this.services.localizationService.get(e)},i})();i.InstancePickerController=d})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.InstancePicker={templateUrl:"components/instancePicker/instancePicker.html",bindings:{mode:"<"},require:{ngModel:"ngModel"},controller:e.common.createController(t.controllers.InstancePickerController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.services.events,r=e.common.dialog.MessageDialogBuilder,o=(function(){function e(e,t){this.services=t,this.messageDialogBuilder=new r(t.modalDialogService)}return e.createOptions=function(){return{additionalServices:["modalDialogService","localizationService"],scopedDependencies:["eventBridge","explorationNavigation","formFactor","layoutAuthoring"]}},e.prototype.$onInit=function(){var e=this;this.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.viewport={width:106,height:106},this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(i.canvasChanged,(function(){return e.updateVisuals()})).subscribe(i.formFactorChanged,(function(){return e.updateVisuals()})),this.updateVisuals()},e.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},e.prototype.clearAllVisualsFromCanvasPressed=function(){var e=this;return this.messageDialogBuilder.show("ClearAllVisualsConfirmDialog",{titleText:this.services.localizationService.get("RemoveAllVisuals_Title"),messageText:this.services.localizationService.get("RemoveAllVisuals_MessageContent"),okButtonText:this.services.localizationService.get("RemoveAllVisuals_OKText"),cancelButtonText:this.services.localizationService.get("RemoveAllVisuals_CancelText")}).then((function(t){if(0===t){var i=e.services.explorationNavigation.getCurrentSection(),r=e.services.explorationNavigation.getCurrentExploration();e.services.layoutAuthoring.removeLayoutFromSection(i,1,r)}}))},e.prototype.updateVisuals=function(){var e=this.services.explorationNavigation.getCurrentSection(),t=this.services.formFactor.getCurrentLayout();this.visuals=e.visualContainers.filter((function(e){return!e.layouts.withId(t)}))},e})();t.MobileVisualizationPaneController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.MobileVisualizationPane={templateUrl:"components/mobileVisualizationPane/mobileVisualizationPane.html",bindings:{},controller:e.common.createController(t.controllers.MobileVisualizationPaneController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=jsCommon.EnumExtensions,r=e.explore.services.events,o=(function(){function e(e,t){var i=this;this.isExpanded=!1,this.services=t,this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)})),this.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1}}return e.createOptions=function(){return{scopedDependencies:["includeExcludeService","eventBridge","visualAuthoring"]}},e.prototype.$onInit=function(){this.updateViewModel()},e.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},e.prototype.expand=function(){this.isExpanded=!this.isExpanded},e.prototype.deleteFilter=function(e){var t=this.filterViewModel.getFilterContainerScope();this.services.visualAuthoring.removeFilter(this.filterViewModel.contract,t),e.stopPropagation()},e.prototype.delete=function(e,t,i){return 1===this.viewModel.points.length?void this.deleteFilter(e):(this.viewModel.points.splice(i,1),this.services.includeExcludeService.updateFilterContainer(this.filterViewModel,this.viewModel),void e.stopPropagation())},e.prototype.updateViewModel=function(){var e=this.filterViewModel.contract;this.viewModel=this.services.includeExcludeService.buildViewModel(e.filter,e.type)},e.prototype.onFilterContainerChanged=function(e){e.filter===this.filterViewModel.contract&&i.hasFlag(e.changeType,2)&&this.updateViewModel()},e})();t.IncludeExcludeFilterController=o})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.IncludeExcludeFilter={templateUrl:"components/includeExcludeFilter/includeExcludeFilter.html",controller:e.common.createController(t.IncludeExcludeFilterController),bindings:{filterViewModel:"<"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.annotations=e}return e.prototype.clear=function(){this.annotations=[]},e.prototype.length=function(){return this.annotations.length},e.prototype.removeAt=function(e){this.annotations.splice(e,1)},e.prototype.getAnnotation=function(e){return this.annotations[e]},e.prototype.takeAll=function(){return _.take(this.annotations,this.annotations.length)},e.prototype.push=function(e){this.annotations.push(e)},e.prototype.eraseAnnotations=function(e,t){var i=this.annotations.length;return _.remove(this.annotations,(function(i){return i.polygon.lineIntersectionPoint(e,t)})),i-this.annotations.length},e})();e.AnnotationsList=t})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.viewModels.AnnotationsList,r=e.explore.services.events,o=e.visuals.shapes.Polygon,n="pen",a=5,s=10,l=(function(){function e(e,t){var i=this;this.services=t,this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.sectionChanged,(function(){return i.invalidateAnnotations()})).subscribe(r.clearAnnotations,(function(){return i.clearAnnotations()})),this.pensAnnotationsDataHelper=new c,this.penAnnotationDrawer=new u(this.services.$element);var o=function(e){i.onPointerDown(e)},n=function(e){i.onPointerMove(e)},a=function(e){i.onPointerUp(e)};interact.on("pointerdown",o),interact.on("pointermove",n),interact.on("pointerup",a),e.$on("$destroy",(function(){interact.off("pointerdown",o),interact.off("pointermove",n),interact.off("pointerup",a),i.clearAnnotationsFromExploration()})),this.resetViewModel()}return e.createOptions=function(){return{scopedDependencies:["eventBridge","explorationNavigation","layoutAuthoring","viewModeState"],additionalServices:["$element"]
}},e.prototype.eraseAnnotations=function(e,t){this.viewModel.annotationsList.eraseAnnotations(t,e)>0&&(this.penAnnotationDrawer.redrawAnnotations(this.viewModel),this.persistOnSection(this.viewModel.annotationsList.takeAll()))},e.prototype.onPointerDown=function(e){if(e.pointerType===n){this.penAnnotationDrawer.validateRectPos(this.viewModel.annotationsList.length());var t=this.penAnnotationDrawer.convertToCanvasPosition(e.pageX,e.pageY),i=this.isEraseEvent(e)?2:1;switch(this.pensAnnotationsDataHelper.createPenAnnotationData(e.pointerId,i),i){case 1:this.pensAnnotationsDataHelper.addPoint(e.pointerId,t),this.viewModel.currentAnnotations[e.pointerId]=this.createPenAnnotationCurve(e.pointerId);break;case 2:this.erasePrevPoint=t,this.eraseAnnotations(t,this.erasePrevPoint)}}},e.prototype.onPointerMove=function(e){if(e.pointerType===n){var t=this.penAnnotationDrawer.convertToCanvasPosition(e.pageX,e.pageY),i=this.pensAnnotationsDataHelper.getAnnotationMode(e.pointerId);switch(i){case 1:this.pensAnnotationsDataHelper.addPoint(e.pointerId,t);var r=this.viewModel.currentAnnotations[e.pointerId];r&&(r.polygon=this.createPolygon(e.pointerId)),this.drawAnnotationAddedPoints(r);break;case 2:this.eraseAnnotations(t,this.erasePrevPoint),this.erasePrevPoint=t}}},e.prototype.onPointerUp=function(e){if(e.pointerType===n){var t=this.pensAnnotationsDataHelper.getAnnotationMode(e.pointerId);switch(t){case 1:var i=this.viewModel.currentAnnotations[e.pointerId];i&&(i.polygon.polygonPoints.length>=s&&(this.viewModel.annotationsList.push(i),this.persistOnSection(this.viewModel.annotationsList.takeAll())),delete this.viewModel.currentAnnotations[e.pointerId])}this.pensAnnotationsDataHelper.remove(e.pointerId)}},e.prototype.drawAnnotationAddedPoints=function(e){var t=e.polygon.polygonPoints,i=t.length;i<s||(i===s?this.penAnnotationDrawer.drawAnnotation(e):this.penAnnotationDrawer.drawLine(t[i-2],t[i-1]))},e.prototype.resetViewModel=function(e){void 0===e&&(e=[]),this.viewModel={currentAnnotations:[],annotationsList:new i(e)},this.pensAnnotationsDataHelper.clear()},e.prototype.clearAnnotationsFromExploration=function(){for(var e=this.services.explorationNavigation.getCurrentExploration(),t=0,i=e.sections;t<i.length;t++){var r=i[t];this.services.layoutAuthoring.updateSectionPenAnnotations(r,[])}},e.prototype.isEraseEvent=function(e){return e.button===a||!e.isPrimary&&0===e.pressure},e.prototype.persistOnSection=function(e){var t=this.services.explorationNavigation.getCurrentSection();this.services.layoutAuthoring.updateSectionPenAnnotations(t,e)},e.prototype.getAnnotationsFromSection=function(){var e=this.services.explorationNavigation.getCurrentSection();return e.penAnnotations||[]},e.prototype.clearAnnotations=function(){this.persistOnSection([]),this.invalidateAnnotations()},e.prototype.invalidateAnnotations=function(){var e=this.getAnnotationsFromSection();this.resetViewModel(e),this.penAnnotationDrawer.redrawAnnotations(this.viewModel)},e.prototype.createPenAnnotationCurve=function(e){var t=this.services.viewModeState.getConfig();return{polygon:this.createPolygon(e),lineWidth:t.penProperties.lineWidth,strokeStyle:t.penProperties.strokeStyle,opacity:t.penProperties.opacity}},e.prototype.createPolygon=function(e){for(var t=[],i=0,r=this.pensAnnotationsDataHelper.getPoints(e);i<r.length;i++){var n=r[i];t.push(n.x),t.push(n.y)}return new o(new Float64Array(t))},e})();t.PenAnnotationController=l;var c=(function(){function e(){this.pensAnnotationsData=[]}return e.prototype.getAnnotationMode=function(e){return this.pensAnnotationsData[e]?this.pensAnnotationsData[e].penAnnotationMode:0},e.prototype.createPenAnnotationData=function(e,t){this.pensAnnotationsData[e]={pointerId:e,penAnnotationMode:t,points:[]}},e.prototype.addPoint=function(e,t){this.pensAnnotationsData[e]&&this.pensAnnotationsData[e].points.push(t)},e.prototype.remove=function(e){delete this.pensAnnotationsData[e]},e.prototype.getPoints=function(e){return this.pensAnnotationsData[e]?this.pensAnnotationsData[e].points:[]},e.prototype.clear=function(){this.pensAnnotationsData=[]},e})(),u=(function(){function e(e){this.rect=e.children(0)[0],this.rectContext=this.rect.getContext("2d")}return e.prototype.validateRectPos=function(e){this.loadCanvasClientRects(),0!==e||this.rect.width===Math.floor(this.rectPosition.width)&&this.rect.height===Math.floor(this.rectPosition.height)||(this.rect.width=this.rectPosition.width,this.rect.height=this.rectPosition.height)},e.prototype.drawLine=function(e,t){this.rectContext.moveTo(e.x,e.y),this.rectContext.lineTo(t.x,t.y),this.rectContext.stroke()},e.prototype.loadCanvasClientRects=function(){this.rectPosition=this.rect.getBoundingClientRect(),this.canvasLeft=this.rectPosition.left,this.canvasTop=this.rectPosition.top},e.prototype.redrawAnnotations=function(e){this.loadCanvasClientRects(),this.rectContext.clearRect(0,0,this.rectPosition.width,this.rectPosition.height);for(var t=0,i=this.getAnnotations(e);t<i.length;t++){var r=i[t];this.drawAnnotation(r)}},e.prototype.getAnnotations=function(e){var t=e.annotationsList.takeAll(),i=[];for(var r in e.currentAnnotations)i.push(e.currentAnnotations[r]);return t.concat(i)},e.prototype.drawAnnotation=function(e){this.rectContext.beginPath(),this.setupNewPath(e);var t=e.polygon.polygonPoints;this.rectContext.moveTo(t[0].x,t[0].y);for(var i=1;i<t.length;i++)this.rectContext.lineTo(t[i].x,t[i].y);this.rectContext.stroke()},e.prototype.setupNewPath=function(e){this.rectContext.lineWidth=e.lineWidth,this.rectContext.strokeStyle=e.strokeStyle,this.rectContext.globalAlpha=e.opacity,this.rectContext.lineCap="round",this.rectContext.lineJoin="round"},e.prototype.convertToCanvasPosition=function(e,t){return{x:e-this.canvasLeft,y:t-this.canvasTop}},e})()})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PenAnnotation={templateUrl:"components/penAnnotation/penAnnotation.html",controller:e.common.createController(t.controllers.PenAnnotationController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.Background="background",e.Border="border",e.CategoryAxis="categoryAxis",e.General="general",e.Gradient="gradient",e.Labels="labels",e.LockAspect="lockAspect",e.StylePreset="stylePresetName",e.Title="title",e.ValueAxis="valueAxis"})(t=e.PropertyCardNames||(e.PropertyCardNames={}));var i;!(function(e){e.Position="position",e.RevertToDefault="revertToDefault",e.SecPosition="secPosition",e.Slider="slider",e.Show="show",e.StylePresetName="name",e.TextArea="textarea"})(i=e.PropertySliceNames||(e.PropertySliceNames={}));var r;!(function(e){e.X="x",e.Y="y",e.Width="width",e.Height="height",e.AltText="altText"})(r=e.GeneralPropertyNames||(e.GeneralPropertyNames={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["modalDialogService"]}},e.prototype.close=function(){this.services.modalDialogService.close()},e})();e.TableViewDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.TableViewDialog={templateUrl:"components/tableViewDialog/tableViewDialog.html",bindings:{titleKey:"<",columnNames:"<",tableValues:"<"},controller:e.common.createController(t.controllers.TableViewDialogController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.modalDialogService=e}return e.prototype.show=function(e,t,i){var r={columnNames:t,tableValues:i,titleKey:e},o={dialogName:"TableViewDialog",definitionTemplateCachePath:"components/tableViewDialog/tableViewDialogDefinition.html",bindings:r};return this.modalDialogService.showHostModalDialog(o)},e})();e.TableViewDialogBuilder=t})(t=e.dialogs||(e.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=270,i=(function(){function e(e,t){this.services=t,this.showErrorMessage=!0}return e.createOptions=function(){return{}},e.prototype.$onInit=function(){this.updateErrorOverlayVisibility(this.viewport),this.isFixButtonVisible=1===this.viewMode&&0!==this.errorInfo.fixableError||0===this.viewMode&&3===this.errorInfo.fixableError},e.prototype.$onChanges=function(e){e.viewport&&this.updateErrorOverlayVisibility(this.viewport)},e.prototype.updateErrorOverlayVisibility=function(e){e&&(this.showErrorMessage=e.width>=t)},e})();e.CanvasVisualErrorOverlayController=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.CanvasVisualErrorOverlay={templateUrl:"components/canvasVisualErrorOverlay/canvasVisualErrorOverlay.html",bindings:{errorInfo:"<",viewMode:"<",viewport:"<",showErrorDetails:"&",fixErrors:"&"},controller:e.common.createController(t.controllers.CanvasVisualErrorOverlayController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.util.DragDropTypes,o=e.data.FieldExprPattern,n=t.contracts.FilterType,a=e.data.SQExprBuilder,s=e.data.SQExprConverter,l=e.data.SQExprUtils,c=e.data.TopNFilterPattern,u=e.explore.util.VisualContainerUtils,p=(function(){function p(t,i){var o=this;this.scope=t,this.services=i,this.dropConfig={accept:r.Field},this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(e.explore.services.events.filterContainerChanged,(function(e,t){return o.onFilterContainerChanged(t)}))}return p.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","displayNameService","dragDataService","dropdown","localizationService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","undoRedo","visualAuthoring","visualPlugin"]}},p.prototype.$onInit=function(){this.initializeViewModel(this.viewModel.contract),this.checkDisabled()},p.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},p.prototype.applyFilter=function(){var r=this;if(this.canApplyFilter()){this.viewModel.contract.type=n.TopN;var o,a,s=this.viewModel.contract.expression,l=this.vm.orderByField,p=this.viewModel.visualContainer;if(p){var d=u.getVisualQuery(p);if(d){var v=d.defn.select();o=_.any(v,(function(t){return e.data.SQExpr.equals(t.expr,s,!0,!0)})),a=_.any(v,(function(t){return e.data.SQExpr.equals(t.expr,l,!0,!0)}))}}var h=this.vm.targetType.type===i.TopNFilterType.Top,g=this.vm.itemCount,f=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneTopNFilterApplied,h,g,o,a),m=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(m).then((function(e){r.services.undoRedo.register("ApplyTopNFilter",(function(){var e=c.buildFilterFromParameters({fieldBeingFiltered:s,isTop:h,itemCount:g,orderByField:l,aggregate:r.vm.selectedAggregate});r.services.visualAuthoring.updateFilter(r.viewModel.getFilterContainerScope().container,r.viewModel.contract,e);var i={filter:r.viewModel.contract,changeType:2,scope:r.viewModel.getFilterContainerScope()};return r.viewModel.useDefaultFilter=!1,r.updateRestatement(),r.topNFilterForm.$setPristine(),r.services.eventBridge.publishBubbling(r.scope,t.viewModels.FilterEvents.filterChanged,i),f.resolve(),!0}))}))}},p.prototype.canApplyFilter=function(){return this.checkDisabled(),!this.viewModel.cardType.invalid&&this.vm&&this.vm.itemCount>0&&null!=this.vm.orderByField&&this.topNFilterForm.$dirty&&this.topNFilterForm.$valid},p.prototype.dropFilterTarget=function(){var e=this,t=this.services.dragDataService.getDragContext();if(t&&t.field){var r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var o=t.field,n=l.isMeasure(o)?o:a.aggregate(o,e.services.aggrOps.defaultAggregate(o,r,!0));e.isValidOrderByExpr(n)&&i.TopNFilterViewModelFactory.updateOrderByField(e.vm,n,r,e.services.displayNameService,e.services.localizationService,e.services.aggrOps)&&e.topNFilterForm.$setDirty()}))}},p.prototype.getDropAction=function(){var e=this.services.promiseFactory.defer(),t=0;if(!this.viewModel.cardType.invalid){var i=this.services.dragDataService.getDragContext();if(i&&i.field){var r=i.field;this.isValidOrderByExpr(r)&&(t=1)}}return e.resolve(t),e.promise},p.prototype.removeOrderBy=function(){i.TopNFilterViewModelFactory.removeOrderByField(this.vm),this.topNFilterForm.$setDirty()},p.prototype.selectAggregate=function(e){var t=this;if(e!==this.vm.selectedAggregate){var r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){i.TopNFilterViewModelFactory.updateAggregate(t.vm,e,r,t.services.displayNameService,t.services.localizationService)&&t.topNFilterForm.$setDirty()}))}},p.prototype.showContextMenu=function(e){var t=this;this.services.dropdown.showContextMenu(this.vm.availableAggregates,{x:e.pageX,y:e.pageY},(function(e){return t.selectAggregate(e.aggregate)}),!1)},p.prototype.checkDisabled=function(){var t=this,i=this.viewModel.getFilterContainerScope().container;this.viewModel.cardType.invalid=_.any(i.filters,(function(i){return i!==t.viewModel.contract&&e.data.TopNFilterPattern.extractParametersFromFilter(i.filter)}))},p.prototype.isValidOrderByExpr=function(e){var t=s.asFieldPattern(e);return!!(l.isMeasure(e)||o.getProperty(t)||t.hierarchyLevel)},p.prototype.onFilterContainerChanged=function(e){e.filter===this.viewModel.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,10)&&this.initializeViewModel(e.filter),this.checkDisabled()},p.prototype.initializeViewModel=function(e){var t=this,r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var o=e&&e.filter&&c.extractParametersFromFilter(e.filter);t.vm=i.TopNFilterViewModelFactory.createViewModel(o,r,t.services.localizationService,t.services.displayNameService,t.services.aggrOps),t.updateRestatement(),t.viewModel.updateFilterProperties(r,t.services.visualPlugin,t.services.aggrOps),t.viewModel.updateViewState()}))},p.prototype.updateRestatement=function(){this.viewModel.setRestatement(this.vm.getRestatement(this.services.localizationService))},p})();i.TopNFilterController=p})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.TopNFilter={templateUrl:"components/topNFilter/topNFilter.html",controller:e.common.createController(t.TopNFilterController),bindings:{viewModel:"<"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=jsCommon.StringExtensions,o=e.visuals.valueFormatter;!(function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom"})(i=t.TopNFilterType||(t.TopNFilterType={}));var n=(function(){function e(e,t,i){this.filterTypes=e,this.targetType=t,this.itemCount=i}return e.prototype.getRestatement=function(e){if(null!=this.itemCount){var t=o.format(this.itemCount,"#,###"),n=this.orderByDisplayName,a=this.targetType.type===i.Top;return n?r.format(e.get(a?"FilterRestatement_TopNBy":"FilterRestatement_BottomNBy"),t,n):r.format(e.get(a?"FilterRestatement_TopN":"FilterRestatement_BottomN"),t)}},e})();t.TopNFilterViewModel=n})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.SQExpr,n=e.data.SQExprBuilder,a=e.data.TopNFilterPattern;!(function(r){function s(e,t,i,r,o){var n=a.extractParametersFromFilter(e);if(n)return l(n,t,i,r,o)}function l(e,t,r,o,n){var a=!e||e.isTop?i.TopNFilterType.Top:i.TopNFilterType.Bottom,s=h(r),l=new i.TopNFilterViewModel(s,_.find(s,(function(e){return e.type===a})),e&&e.itemCount);return e&&u(l,e.orderByField,t,o,r,n),l}function c(e){e.orderByField=null,e.availableAggregates=null,e.selectedAggregate=null,e.orderByDisplayName=null}function u(e,t,i,r,n,a){return!o.equals(t,e.orderByField)&&(e.orderByField=t,e.availableAggregates=v(t,i,a,n),e.orderByDisplayName=r.getDisplayName(e.orderByField,i,null,{includeVariationSource:!0}),e.selectedAggregate=o.isAggregation(t)?t.func:null,d(e),!0)}function p(e,t,i,r,o){return e.selectedAggregate!==t&&(e.orderByField=n.setAggregate(e.orderByField,t),e.selectedAggregate=t,d(e),e.orderByDisplayName=r.getDisplayName(e.orderByField,i,null,{includeVariationSource:!0}),!0)}function d(e){for(var t=0,i=e.availableAggregates.items;t<i.length;t++){var r=i[t];r.checked=r.key.aggregate===e.selectedAggregate}}function v(i,r,o,n){return{items:t.viewModels.MenuItemFactory.createAggregateMenuItems(i,r,o,!1,e.VisualDataRoleKind.Measure,[])}}function h(e){return[{type:i.TopNFilterType.Top,text:e.get("TopNFilter_Top")},{type:i.TopNFilterType.Bottom,text:e.get("TopNFilter_Bottom")}]}r.createViewModelFromSemanticFilter=s,r.createViewModel=l,r.removeOrderByField=c,r.updateOrderByField=u,r.updateAggregate=p,r.getAvailableAggregates=v})(r=i.TopNFilterViewModelFactory||(i.TopNFilterViewModelFactory={}))})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function t(e,t,i,r,o,n,a,s,l,c,u,p){this.conceptualSchemaProxy=e,this.dataSources=t,this.drill=i,this.drillToDetailsService=r,this.dropdown=o,this.featureSwitchService=n,this.groupAuthoring=a,this.includeExcludeService=s,this.localizationService=l,this.popOut=c,this.promiseFactory=u,this.visualAuthoring=p,this.updateItemsCallId=0}return t.prototype.create=function(e,t,i,r){var o=this;this.setProperties(e,t,i),this.getItems().then((function(e){o.dropdown.showContextMenu(e,r,o.select.bind(o),!1)}))},t.prototype.setProperties=function(e,t,i){this.visualContainer=e,this.selectors=t,this.roles=i},t.prototype.getItems=function(){var e=this;this.updateItemsCallId++;var t=this.updateItemsCallId,i=this.drill.getSupportedDrillDirections(this.visualContainer,_.first(this.roles)),r=this.drill.canDrillToDetails(this.visualContainer,this.selectors),o=this.visualContainer&&2!==this.visualContainer.popOutMode&&this.drill.canSeeData(this.visualContainer),n=!1,a=!1,s=this.dataSources.get(),l={canDrillToDetails:r,canSeeData:o,drillDirections:i,enableGroupAuthoring:n,enableIncludeExclude:a};return s?this.conceptualSchemaProxy.get(s).then((function(i){if(e.isLastUpdateItemsCall(t)){if(e.featureSwitchService.featureSwitches.includeExcludeEnabled&&!_.isEmpty(e.selectors)&&null!=e.selectors[0].dataMap){var r=e.featureSwitchService.featureSwitches;l.enableIncludeExclude=e.includeExcludeService.isIncludeExcludeSupported(e.visualContainer,i,r.negatedTuplesFiltering&&r.tuplesFiltering)}return e.featureSwitchService.featureSwitches.enableGroupAuthoring&&!e.pendingGroupOperation&&(l.enableGroupAuthoring=e.groupAuthoring.visual.canGroup(e.visualContainer,e.selectors,i)),e.createItems(l)}})):this.createItems(l)},t.prototype.createItems=function(t){return this.resetUpdateItemsCallCount(),this.promiseFactory.resolve(e.VisualContainerContextMenuViewModelFactory.createMenuItems(t,this.localizationService))},t.prototype.select=function(e){switch(e){case 1:this.drillDown();break;case 0:this.drillUp();break;case 2:this.drillDownLevel(3);break;case 3:this.drillDownLevel(2);break;case 4:this.drillToDetails();break;case 5:this.seeData();break;case 6:this.createGroup();break;case 7:this.includeExcludeService.setFilter(3,this.selectors,this.visualContainer);break;case 8:this.includeExcludeService.setFilter(4,this.selectors,this.visualContainer)}},t.prototype.isLastUpdateItemsCall=function(e){return this.updateItemsCallId===e},t.prototype.resetUpdateItemsCallCount=function(){this.updateItemsCallId=0},t.prototype.drillUp=function(){this.visualAuthoring.drillUp(_.first(this.roles),this.visualContainer)},t.prototype.drillDownLevel=function(e){this.visualAuthoring.drillDownLevel(_.first(this.roles),this.visualContainer,e)},t.prototype.seeData=function(){this.popOut.popOutVisualContainer(this.visualContainer,2)},t.prototype.drillToDetails=function(){if(!_.isEmpty(this.selectors)){var e=this.dataSources.get();this.drillToDetailsService.drillToDetails(this.selectors,this.visualContainer,e)}},t.prototype.drillDown=function(){_.isEmpty(this.selectors)||this.visualAuthoring.drillDown(this.selectors,this.visualContainer,this.dataSources.get(),_.first(this.roles))},t.prototype.createGroup=function(){var e=this;if(!this.pendingGroupOperation){this.pendingGroupOperation=!0;var t=this.dataSources.get();this.conceptualSchemaProxy.get(t).then((function(i){return e.groupAuthoring.visual.group(e.visualContainer,e.selectors,!0,t,i)})).finally((function(){e.pendingGroupOperation=!1}))}},t})();e.VisualContainerContextMenu=t})(t=e.components||(e.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t,i=jsCommon.EnumExtensions;!(function(e){function t(e,t){var n=[],a=i.hasFlag(e.drillDirections,4),s=i.hasFlag(e.drillDirections,2),l=a||s,c=i.hasFlag(e.drillDirections,1),u=e.canDrillToDetails,p=e.canSeeData,d=e.enableGroupAuthoring,v=e.enableIncludeExclude;return l&&n.push(r("DrillDown",1,t)),u&&n.push(r("DrillToDetails",4,t)),l&&(n.push(o()),a&&n.push(r("DrillDownLevel",2,t)),s&&n.push(r("DrillDownLevelGrouped",3,t))),c&&(l||_.isEmpty(n)||n.push(o()),n.push(r("DrillUp",0,t))),p&&(_.isEmpty(n)||n.push(o()),n.push(r("VisualContainer_SeeData_Enable",5,t))),d&&!_.isEmpty(n)&&n.push(o()),d&&n.push(r("VisualContainer_Group",6,t)),v&&(_.isEmpty(n)||n.push(o()),n.push(r("VisualContainer_ContextMenu_Include",7,t)),n.push(r("VisualContainer_ContextMenu_Exclude",8,t))),_.isEmpty(n)&&n.push(r("VisualContainer_ContextMenu_NoAvailableActions",null,t)),{items:n}}function r(e,t,i){return{key:t,text:i.get(e),type:0}}function o(){return{type:1}}e.createMenuItems=t})(t=e.VisualContainerContextMenuViewModelFactory||(e.VisualContainerContextMenuViewModelFactory={}))})(t=e.components||(e.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=e.services.events,r=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["drill","eventBridge","visualAuthoring"]}},e.prototype.$onInit=function(){var e=this;this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(i.visualContainerChanged,(function(t,i){return e.updateDrillMode(i)})),this.updateDrillModeCore()},e.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},e.prototype.drillUp=function(){this.services.visualAuthoring.drillUp(null,this.visual.contract)},e.prototype.drillDownLevel=function(){this.services.visualAuthoring.drillDownLevel(null,this.visual.contract,3)},e.prototype.drillDownLevelGrouped=function(){this.services.visualAuthoring.drillDownLevel(null,this.visual.contract,2)},e.prototype.canDrill=function(){return this.canDrillDownWithCurrentGroup||this.canDrillDownWithoutCurrentGroup||this.canDrillUp},e.prototype.drillLevelTitle=function(){var e=this.canDrillDownWithCurrentGroup||this.canDrillDownWithoutCurrentGroup?this.services.localizationService.get("DrillDownLevel_ToolTip"):this.services.localizationService.get("DrillDownLevelDisabled_ToolTip");return e},e.prototype.drillLevelGroupedTitle=function(){var e=this.canDrillDownWithCurrentGroup||this.canDrillDownWithoutCurrentGroup?this.services.localizationService.get("DrillDownLevelGrouped_ToolTip"):this.services.localizationService.get("DrillDownLevelDisabled_ToolTip");return e},e.prototype.updateDrillMode=function(e){e&&e.affectContainer(this.visual.contract)&&this.updateDrillModeCore()},e.prototype.updateDrillModeCore=function(){var e=this.visual.contract;this.canDrillDownWithCurrentGroup=this.services.drill.canDrillByDirection(e,2),this.canDrillDownWithoutCurrentGroup=this.services.drill.canDrillByDirection(e,4),this.canDrillUp=this.services.drill.canDrillByDirection(e,1)},e})();t.VisualContainerDrillController=r})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerDrill={templateUrl:"components/visualContainerDrill/visualContainerDrill.html",bindings:{visual:"<"},controller:e.common.createController(t.controllers.VisualContainerDrillController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["drill","visualAuthoring"]}},e.prototype.toggleDrillMode=function(e){var t=this.visual.contract.drillMode,i=t===e?0:e;this.services.drill.setDrillMode(this.visual.contract,i)},e.prototype.isDrillDownEnabled=function(){return this.isDrillModeEnabled(1)},e.prototype.canDrill=function(){if(!this.visual)return!1;var e=this.visual.contract;return this.services.drill.canDrillByDirection(e,2)||this.services.drill.canDrillByDirection(e,4)||this.services.drill.canDrillByDirection(e,1)},e.prototype.drillTitle=function(){var e=1===this.visual.contract.drillMode?this.services.localizationService.get("DrillMode_ToolTip"):this.services.localizationService.get("DrillDown_ToolTip");return e},e.prototype.isDrillModeEnabled=function(e){return!!this.visual&&this.services.drill.isDrillModeEnabled(this.visual.contract,e)},e})();e.VisualContainerDrillToggleController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerDrillToggle={templateUrl:"components/visualContainerDrillToggle/visualContainerDrillToggle.html",bindings:{visual:"<"},controller:e.common.createController(t.controllers.VisualContainerDrillToggleController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.services.selectionUtils,o=e.explore.util.VisualContainerUtils,n=(function(){function e(e,t){this.services=t,this.menuId=e.$id.toString()}return e.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["popOut","selection","undoRedo","viewModeState","visualPluginOps","visualRelationship"]}},e.prototype.canPopOut=function(){return!(this.visual.isPoppedOut||!this.services.visualPluginOps.supportsFocusMode(o.getVisualType(this.visual.contract)))},e.prototype.popOutVisualContainer=function(){this.services.popOut.popOutVisualContainer(this.visual.contract,1)},e.prototype.getSeeDataLayoutTitle=function(){return 2===this.visual.contract.detailVisualLayout?this.services.localizationService.get("VisualContainer_SeeData_HorizontalLayoutButton"):this.services.localizationService.get("VisualContainer_SeeData_VerticalLayoutButton")},e.prototype.toggleSeeDataLayout=function(){var e=this.visual.contract,t=e.detailVisualLayout||1;this.services.undoRedo.register("ToggleSeeDataLayout",(function(){1===t?e.detailVisualLayout=2:e.detailVisualLayout=1})),this.visual.updateViewState()},e.prototype.canSetVisualRelationshipFilterAction=function(){if(!this.services.viewModeState.getConfig().showRelationships||1!==this.services.selection.getSelectedElements().length)return!1;var e=r.getSelectedVisual(this.services.selection);return!!this.services.visualRelationship.supportsAnyFilterAction(e)&&!r.isVisualContainerSelected(this.visual.contract,this.services.selection)},e})();i.VisualContainerHeaderController=n})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerHeader={templateUrl:"components/visualContainerHeader/visualContainerHeader.html",bindings:{visual:"<",menuOptions:"<",disablePin:"<",showWarningDetails:"&",showTransformWarningDetails:"&",showInfoDetails:"&",onVisualContainerChanged:"&"},controller:e.common.createController(t.controllers.VisualContainerHeaderController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.visualHost.ResourcePackageReferenceResolver,r=e.explore.services,o=e.explore.contracts.VisualContainer,n=e.explore.util.VisualContainerUtils,a=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","explorationSerializer","localizationService","promiseFactory"],scopedDependencies:["dataSources","explorationNavigation","filterGenerator","pinVisual","resourceLoader","viewModeState","visualPlugin"]}},e.prototype.pinVisualContainer=function(e){var t,i=this,o=this.services.dataSources.get(),n=this.visual;this.services.conceptualSchemaProxy.get(o).then((function(e){t=i.visual.hostServices.getFilters(i.services.filterGenerator,e)})).then((function(){return i.resolveResourceReferences(n.contract)})).then((function(e){return i.services.pinVisual.pinVisualContainer(o,e,t,n.themeName,r.getRegisteredResourcePackage(i.services.explorationNavigation.getCurrentExploration().resourcePackages))})),e&&e.stopPropagation&&e.stopPropagation()},e.prototype.canPin=function(){if(!this.visual)return!1;if(n.hasGroupByItemsInQuery(this.visual.contract))return!1;var e=!1,t=this.visual.readOnlyState.visual.type;return e=this.services.pinVisual.canPinVisualType(t),this.services.viewModeState.getConfig().supportsPinning&&e&&!this.visual.showWatermark},e.prototype.showPin=function(){return this.visual&&this.visual.options.showPin},e.prototype.getPinTileTitle=function(){var e=this.visual.options.disablePin?this.services.localizationService.get("PinTile_NotSupportedTitle"):this.services.localizationService.get("PinVisual_ToolTip");return e},e.prototype.resolveResourceReferences=function(e){var t=this,r=this.services.promiseFactory.defer(),a=n.getVisualType(e),s=n.getObjectDefinitions(e),l=this.services.explorationNavigation.getCurrentExploration(),c=this.services.visualPlugin.capabilities(a),u=c&&c.objects;return i.loadAndResolveFromDataViewObjects(s,u,l.resourcePackages,this.services.resourceLoader,this.services.promiseFactory,!0).then((function(i){var n=o.clone(e,t.services.explorationSerializer);n.config.singleVisual.objects=i,r.resolve(n)})),r.promise},e})();t.VisualContainerPinButtonController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerPinButton={templateUrl:"components/visualContainerPinButton/visualContainerPinButton.html",bindings:{visual:"<",disablePin:"<"},controller:e.common.createController(t.controllers.VisualContainerPinButtonController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.services.events,o=t.services.selectionUtils,n=e.explore.util.VisualContainerUtils,a=(function(){function i(e,t){this.services=t}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","telemetryService"],scopedDependencies:["dataSources","eventBridge","selection","viewModeState","visualAuthoring","visualRelationship"]}},i.prototype.$onInit=function(){var e=this;this.loadVisualRelationshipFilterAction(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.selectionChanged,(function(){
return e.loadVisualRelationshipFilterAction()}))},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.setVisualRelationshipFilterAction=function(i,r){i&&i.stopPropagation&&i.stopPropagation();var a=o.getSelectedVisual(this.services.selection);this.visual.hostServices.setVisualRelationshipFilterAction(a,this.visual.contract,r,this.services.visualAuthoring),this.services.telemetryService.logEvent(e.telemetry.EXVisualRelationshipOverride,n.getVisualType(a),n.getVisualType(this.visual.contract),t.contracts.VisualRelationshipFilterActionUtil.toString(r)),this.filterAction=r,this.onVisualContainerChanged()},i.prototype.loadVisualRelationshipFilterAction=function(){var e=this,t=o.getSelectedVisual(this.services.selection);if(t){var i=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(i).then((function(i){var r=e.visual.hostServices.getVisualRelationshipFilterAction(t,e.services.visualRelationship,i);0===r&&(r=e.services.visualRelationship.defaultFilterAction(t,e.visual.contract)),e.filterAction=r}))}},i.prototype.supportsVisualRelationshipFilterAction=function(e){var t=o.getSelectedVisual(this.services.selection);return this.services.visualRelationship.supportsFilterActionTarget(t,this.visual.contract,e)},i})();i.VisualContainerRelationshipFiltersController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerRelationshipFilters={templateUrl:"components/visualContainerRelationshipFilters/visualContainerRelationshipFilters.html",bindings:{visual:"<",onVisualContainerChanged:"&"},controller:e.common.createController(t.controllers.VisualContainerRelationshipFiltersController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.models.ApplyStyle,o=e.common.events,n=t.util.ErrorDetailsUtility,a=e.explore.services.events,s=t.util.VisualContainerUtils,l=(function(){function i(e,t){this.services=t}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dataProxy","displayNameService","embedModeService","featureSwitchService","geocoder","localizationService","moduleLoader","networkAvailability","promiseFactory","singleExecutableDataProxyFactory","telemetryService","trustedVisual"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","filterGenerator","resourceLoader","scriptVisuals","shell","visualPlugin","visualPluginOps","visualQueryGenerator"]}},i.prototype.$onInit=function(){var e=this;this.initializeQueryHandler(),this.initializeVisual(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.visualThemeChanged,(function(){return e.onVisualThemeChanged()})).subscribe(a.visualContainerChanged,(function(t,i){i&&e.visual&&i.affectContainer(e.visual)&&e.onVisualContainerChanged()})),this.onVisualContainerChanged(!0,!this.services.networkAvailability.isNetworkAvailable())},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.initializeQueryHandler=function(){var i=this,r={getDataSources:function(){return i.services.dataSources.get()},notifyStart:_.noop,notifyEnd:_.noop,clearErrors:function(){return i.clearErrorState()},handleErrors:function(t){return i.setErrorState(t.getDetails(e.common.localize),t.code,t.source)},handleWarnings:_.noop,applyUpdate:function(e,t,r){return i.handleQueryResult(e,t,r)},loadMergedData:function(e){return _.noop}},o=this.createQueryVisualHostServices();this.queryHandler=t.services.createVisualContainerQueryHandler(r,o,this.services.promiseFactory,this.services.conceptualSchemaProxy,this.services.featureSwitchService,this.services.telemetryService,this.services.visualQueryGenerator,this.services.visualPlugin,this.services.visualPluginOps,this.services.dataProxy,this.services.networkAvailability,this.services.singleExecutableDataProxyFactory,this.services.embedModeService,this.services.filterGenerator,this.services.scriptVisuals,this.services.displayNameService,this.services.explorationNavigation,this.services.resourceLoader,this.services.eventBridge,this.services.shell,this.services.localizationService,this.services.trustedVisual)},i.prototype.initializeVisual=function(){var r=this,o=this.services.visualPlugin.getPlugin(this.visual.config.singleVisual.visualType),n=o?o.name:void 0,a=e.Prototype.inherit(t.services.createVisualHostServices(this.services.promiseFactory,this.services.moduleLoader,e.visuals.services.createGeolocation(),this.services.geocoder),(function(t){t.getLocalizedString=function(e){return r.services.localizationService.get(e)},t.getViewMode=function(){return r.viewMode},t.locale=function(){return e.common.unmappedCultureInfo},t.promiseFactory=function(){return r.services.promiseFactory}})),s=this.visual.config.singleVisual,l=this.services.explorationNavigation.getCurrentExploration();this.visualDefinition={interactivityOptions:{overflow:"hidden"},type:n,allowInvalidDataView:!0,themeName:l&&l.theme,viewport:{width:this.viewport.width*i.VisualScaleFactor,height:this.viewport.height*i.VisualScaleFactor,scale:i.VisualScaleFactor},dataTransforms:{objects:s.objects},hostServices:a,stylePresetName:s.stylePresetName},this.applyStyles()},i.prototype.applyStyles=function(){this.style=new r,this.visualStyle=new r,this.style.viewport(this.viewport);var e=this.visual.config.singleVisual.background,t=s.getVisualBackgroundRGBColor(e),o=s.getVisualStyleAttributes(this.visualDefinition.viewport,1/i.VisualScaleFactor,t);this.visualStyle.addAttributes(o),this.visualStyle.apply()},i.prototype.onVisualThemeChanged=function(){var e=this.services.explorationNavigation.getCurrentExploration();this.visualDefinition.themeName=e&&e.theme},i.prototype.onVisualContainerChanged=function(e,t){this.clearErrorState();var i=this.queryHandler.validate(this.visual);return i?void this.setErrorState(i.details,i.code):void(this.services.visualPluginOps.isQueryVisualContainer(this.visual)?this.applyUpdate(e,!1,t):this.queryHandler.updateNonQueryVisual(this.visual,this.visualDefinition.dataTransforms))},i.prototype.applyUpdate=function(e,t,i){this.queryHandler.runQuery({contract:this.visual,viewport:this.visualDefinition.viewport,initialLoad:e,useVisualContainerCache:!1,preferCurrentData:t,allowCache:i,currentData:this.visualDefinition.data})},i.prototype.handleQueryResult=function(t,i,r){var o=this.visualDefinition;o.dataTransforms=i,r&&(o.dataTransforms=e.Prototype.inherit(o.dataTransforms),o.dataTransforms.objects=r),o.data=t},i.prototype.clearErrorState=function(){this.errorInfo=null},i.prototype.setErrorState=function(e,t,i){this.errorInfo={code:t,details:e,fixableError:0,hideSeeDetails:!0,overlayType:n.getErrorOverlayType(t),source:i}},i.prototype.createQueryVisualHostServices=function(){var i=this;return e.Prototype.inherit(t.util.VisualHostServicesUtil.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,t){var r=i.services.explorationNavigation;return e.calculateVisualContainerFilter(r.getCurrentExploration(),r.getCurrentSection(),i.visual,t)}}))},i})();l.VisualScaleFactor=2,i.VisualContainerThumbnailController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerThumbnail={templateUrl:"components/visualContainerThumbnail/visualContainerThumbnail.html",bindings:{visual:"<",viewport:"<"},controller:e.common.createController(t.controllers.VisualContainerThumbnailController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=t.services.selectionUtils,a=t.util.VisualContainerUtils,s=(function(){function t(e,t){this.isSearchOn=!1,this.scope=e,this.services=t}return t.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dropdown","overlayService"],scopedDependencies:["dataSources","eventBridge","filterGenerator","selection","undoRedo","visualAuthoring","visualPlugin"]}},t.prototype.$onInit=function(){var e=this;this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.selectionChanged,(function(){return e.onSelectionChanged()})),this.onSelectionChanged()},t.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},t.prototype.exportVisualData=function(){var e=this,t=this.visual.readOnlyState.visual,i=t&&t.data&&t.data.dataViewSource,r=t&&t.dataTransforms,n=this.visual.contract.config.singleVisual,a=this.visual.visualTitle,s=null!=a?a.text:"",l=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(l).then((function(t){e.services.eventBridge.publishToChannel(o.exportVisualData,{dataViewSource:i,visualConfig:n,visualTitle:s,transformActions:r,additionalFilters:e.visual.hostServices.getFilters(e.services.filterGenerator,t)})})).finally((function(){e.services.overlayService.hideAllDropdowns()}))},t.prototype.toggleSort=function(e,t){this.services.overlayService.hideAllDropdowns();var i={sortableField:e,sortDirection:t};this.services.eventBridge.publishBubbling(this.scope,o.toggleSortVisualContainer,i)},t.prototype.toggleSearch=function(){var t=this,i=this.visual.contract.config.singleVisual;i.objects||(i.objects={});var o=a.getVisualCapabilities(this.visual.contract,this.services.visualPlugin),n=this.services.filterGenerator.tryGetSelfFilterEnabledProperty(o);if(n){var s=r.getValue(i.objects,n,null),l=s&&s.value||!1;this.services.undoRedo.register("ToggleSearchVisualContainer",(function(){if(l){r.deleteProperty(i.objects,n.objectName,null,n.propertyName);var a=t.services.filterGenerator.tryGetSelfFilterProperty(o);a&&r.deleteProperty(i.objects,a.objectName,null,a.propertyName),t.isSearchOn=!1}else r.setValue(i.objects,n,null,e.data.SQExprBuilder.boolean(!0)),t.isSearchOn=!0;t.services.visualAuthoring.raiseVisualContainerChanged(t.visual.contract)}))}this.services.overlayService.hideAllDropdowns()},t.prototype.deleteVisualContainer=function(){var e=this;this.services.undoRedo.register("DeleteVisualContainer",(function(){e.services.eventBridge.publishBubbling(e.scope,o.deleteVisualContainer,e.visual.contract)}))},t.prototype.getClusters=function(){this.services.eventBridge.publishBubbling(this.scope,o.getClusters,{})},t.prototype.getSpatialClusters=function(){this.services.eventBridge.publishBubbling(this.scope,o.getClusters,{useSpatialClustering:!0})},t.prototype.enterAdvancedEditMode=function(){this.services.eventBridge.publishBubbling(this.scope,o.changeEditMode,1),this.services.overlayService.hideAllDropdowns()},t.prototype.onSelectionChanged=function(){this.visual&&this.visual.contract&&(this.isSelected=n.isVisualContainerSelected(this.visual.contract,this.services.selection))},t.prototype.showOptionsMenu=function(e){var t=this,i=this.services.dropdown,r=function(t){t(),i.hideAll(),e.stopPropagation()},o={actualSortDirection:function(){return t.visual.readOnlyState.actualSortDirection},menuOptions:function(){return t.menuOptions},isSearchOn:function(){return t.isSearchOn},toggleSearch:function(){return r((function(){return t.toggleSearch()}))},toggleSort:function(e){return r((function(){return t.toggleSort(e)}))},enterAdvancedEditMode:function(){return r((function(){return t.enterAdvancedEditMode()}))},exportVisualData:function(){return r((function(){return t.exportVisualData()}))},deleteVisualContainer:function(){return r((function(){return t.deleteVisualContainer()}))},getClusters:function(){return r((function(){return t.getClusters()}))},getSpatialClusters:function(){return r((function(){return t.getSpatialClusters()}))}};i.showMenu(o,"visualContainerOptionsMenu.html",this.getMenuProperties(e))},t.prototype.getMenuProperties=function(e){return{anchorElement:$(e.currentTarget),preferLeft:!1,showInsideVisibleArea:!0,horizontal:!1}},t})();i.VisualContainerOptionsMenuController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerOptionsMenu={templateUrl:"components/visualOptionsMenu/visualContainerOptionsMenu.html",bindings:{visual:"<",menuOptions:"<",menuId:"<"},controller:e.common.createController(t.controllers.VisualContainerOptionsMenuController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.DateExtensions,o=(jsCommon.DOMConstants,t.services.events),n=t.contracts.FilterType,a=e.data.SemanticFilter,s=e.common.directives.TooltipAnchorElementType,l=(function(){function i(e,t){this.scope=e,this.services=t,this.initialize()}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","overlayService","telemetryService","localizationService","tooltipService"],scopedDependencies:["dataSources","eventBridge","undoRedo","visualAuthoring","visualPlugin"]}},i.prototype.initialize=function(){var i=this;this.scope.moduleConfig={name:"ui.bootstrap",dependency:{javascript:"angular-ui-datetimepicker"}},this.getConceptualSchema().then((function(e){var r=i.scope;i.advFilterCard=t.viewModels.FilterViewModelFactory.extractAdvFilterCard(r.viewModel.contract),r.advFilterCard=i.advFilterCard,r.applyFilter=function(){return i.applyFilter()},r.handleFocusedInputChanged=function(e,t){return i.handleFocusedInputChanged(e,t)},r.handleInputBlur=function(){return i.handleInputBlur()},r.isDirty=!1,r.markDirty=function(){return i.scope.isDirty=!0},r.clearDirty=function(){return i.scope.isDirty=!1},r.validateFilterInput=function(e){return i.validateFilterInput(e)},r.dateOptions={showWeeks:!1},r.dateSelected=function(e){return i.dateSelected(e)},r.timeSelected=function(e){return i.timeSelected(e)},r.dateTextUpdateComplete=function(e){return i.dateTextUpdateComplete(e)},r.dateTextUpdated=function(e){return i.dateTextUpdated(e)},r.keyUp=function(e){return i.onKeyUp(e)},r.tooltipConfig={tooltipLocalizeTitle:"AdvancedFilter_InvalidTooltip",tooltipAnchorElementSelector:"input[type='text']:first",tooltipAnchorElementType:s.Sibling},i.updateRestatement(),i.updateModel(e);var n=i.services.eventBridge.createChannelSubscriptionManager().subscribe(o.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)}));r.$on("$destroy",(function(){return n.unsubscribeAll()}))})).catch((function(){return i.services.telemetryService.logEvent(e.telemetry.EXLoadFilterError,"Conceptual schema could not be found.")}))},i.prototype.updateModel=function(t){var i=this;if(this.advFilterCard.loadOperators(t,this.services.aggrOps),!this.advFilterCard.operators)return void this.services.telemetryService.logEvent(e.telemetry.EXLoadFilterError,"Filter operators failed to load.");var r=this.advFilterCard.field,o=r.getMetadata(t);o&&(this.advFilterCard.isDateTime=!!o.type.dateTime),this.advFilterCard.ensureConditions();var n=this.advFilterCard.conditions,a=this.scope;a.viewModel.updateFilterProperties(t,this.services.visualPlugin,this.services.aggrOps);for(var s=0,l=n;s<l.length;s++){var c=l[s];c&&c.value&&(c.value.formatter=this.scope.viewModel.formatter)}a.viewModel.updateViewState(),a.canApplyFilter=function(){return i.canApplyFilter(t)}},i.prototype.applyFilter=function(){var i=this,r=this.scope.viewModel;r.contract.type=n.Advanced;var o=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneAdvancedFilterApplied,r.isVisualFilter,t.contracts.FilterType.Advanced);this.getConceptualSchema().then((function(e){i.services.undoRedo.register("ApplyAdvancedFilter",(function(){if(!i.canApplyFilter(e))return o.reject(),!1;var n,s=i.advFilterCard.toSQExpr(e),l=i.scope.viewModel;s?(i.services.visualAuthoring.updateFilter(l.getFilterContainerScope().container,l.contract,a.fromSQExpr(s)),n=2):(i.services.visualAuthoring.updateFilter(l.getFilterContainerScope().container,l.contract,void 0),n=10);var c={filter:r.contract,changeType:n,scope:r.getFilterContainerScope()};return i.scope.clearDirty(),i.scope.viewModel.useDefaultFilter=!1,i.updateRestatement(),i.services.eventBridge.publishBubbling(i.scope,t.viewModels.FilterEvents.filterChanged,c),o.resolve(),!0}))}),o.reject())},i.prototype.validateFilterInput=function(e){var t=this;this.getConceptualSchema().then((function(i){e.value&&e.value.value&&!t.advFilterCard.isConditionValid(i,e)?e.isInvalid=!0:(e.isInvalid=!1,t.services.tooltipService.hideTooltip())}))},i.prototype.handleFocusedInputChanged=function(e,t){this.validateFilterInput(t)},i.prototype.handleInputBlur=function(){this.services.tooltipService.hideTooltip()},i.prototype.dateSelected=function(e){this.services.overlayService.hideAllDropdowns(),e.value.dateValue&&(e.value.value=e.value.dateValue),this.scope.markDirty()},i.prototype.timeSelected=function(e){if(e.value.value&&e.value.value instanceof Date){var t=e.value.timePickerValue.getHours(),i=e.value.timePickerValue.getMinutes();e.value.dateValue=e.value.value=new Date(e.value.value.setHours(t,i))}else e.value.value=e.value.dateValue=e.value.timePickerValue;this.scope.markDirty()},i.prototype.dateTextUpdateComplete=function(e){var t=e.value;_.isString(t.value)&&(t.value=t.dateValue)},i.prototype.dateTextUpdated=function(e){var t=e.value,i=r.parseIsoDate(t.value);i&&(t.dateValue=i)},i.prototype.updateRestatement=function(){if(!this.scope.viewModel.useDefaultFilter&&this.scope.viewModel.contract.type===n.Advanced){var e=this.scope.viewModel;e.setRestatement(this.advFilterCard.getRestatement(e.formatter))}},i.prototype.getConceptualSchema=function(){var e=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(e)},i.prototype.onFilterContainerChanged=function(e){var i=this.scope.viewModel;if(e.filter===i.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)){var r=t.viewModels.FilterViewModelFactory.extractAdvFilterCard(e.filter);this.advFilterCard.conditions=r.conditions,this.updateRestatement(),this.advFilterCard.ensureConditions()}},i.prototype.canApplyFilter=function(e){return this.scope.isDirty&&!this.scope.viewModel.readOnlyState.disabled&&this.advFilterCard.areConditionsValid(e)},i.prototype.onKeyUp=function(e){var t=this;e.preventDefault();var i=e.keyCode||e.which;13===i&&this.scope.$applyAsync((function(){return t.applyFilter()}))},i})();i.AdvancedFilterController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e){return{left:e.x,top:e.y,width:e.width,height:e.height}}function r(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}var o=e.util.CanvasVisualsUtility,n=(function(){function e(e,t){this.items=[],this.services=t}return e.createOptions=function(){return{scopedDependencies:["canvasScale"]}},e.prototype.registerLayoutItem=function(e){this.items.push(e)},e.prototype.unregisterLayoutItem=function(e){_.pull(this.items,e)},e.prototype.dragEnd=function(e,t,i){this.canProcess(e)&&e.dragEnd(t,this.getNormalizedPosition(e,i))},e.prototype.dragStart=function(e,t,i){this.canProcess(e)&&(i=this.getIntermediateDimensions(e,i),e.dragStart(t,i))},e.prototype.nudge=function(e,t,i,r){this.canProcess(e)&&e.nudge(t,this.getNormalizedPosition(e,i,r))},e.prototype.resizeStart=function(e,t,i){this.canProcess(e)&&(i=this.getIntermediateDimensions(e,i),e.resizeStart(t,i))},e.prototype.resizeMove=function(e,t,i){this.canProcess(e)&&(i=this.getIntermediateDimensions(e,i),e.resizeMove(t,i))},e.prototype.resizeEnd=function(e,t,i){this.canProcess(e)&&e.resizeEnd(t,this.getNormalizedPosition(e,i))},e.prototype.setStrategy=function(e){this.strategy=e},e.prototype.setCanvasSize=function(e){this.canvasSize=e},e.prototype.getDropPosition=function(e,t,i){var r=i;if(!r){var o=this.services.canvasScale.getCanvasScaleFactor();r={x:o,y:o}}var n=this.strategy.getNearestDropPosition({item:null,allItems:this.items,rawItemPosition:{left:e,top:t,width:0,height:0},canvasSize:this.canvasSize,canvasScale:r});return n},e.prototype.getIntermediateDimensions=function(e,t){if(this.strategy.isEnforcedForIntermediateStates()){var o=i(this.getScaledPosition(e,t));return r(this.strategy.getHostRectFromScaled(o))}return t},e.prototype.getScaledPosition=function(e,t,n){var a=e.getScale(),s={x:!_.isFinite(t.x),y:!_.isFinite(t.y),width:!_.isFinite(t.width),height:!_.isFinite(t.height)},l=e.getPosition(),c=o.convertToScaledPosition(l,a,!1);if(s.x||s.y||s.width||s.height){var u=this.strategy.getHostRectFromScaled(i(c));t=__assign({},t),s.x&&(t.x=u.left),s.y&&(t.y=u.top),s.width&&(t.width=u.width),s.height&&(t.height=u.height)}var p=i(t),d=this.strategy.getNearestValidPosition({item:e,allItems:this.items,canvasSize:this.canvasSize,canvasScale:a,rawItemPosition:p,nudge:n});return d?r(d):c},e.prototype.getNormalizedPosition=function(e,t,n){var a=this.getScaledPosition(e,t,n),s=o.convertFromScaledRect(i(a),e.getScale());return r(s)},e.prototype.canProcess=function(e){return!!e&&!e.isSuspended()&&_.contains(this.items,e)},e})();t.CanvasLayoutController=n})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o){var n=i(e,o);return{width:l(r,n.width,o.colSpacing),height:l(t,n.height,o.rowSpacing)}}function i(e,t){var i=t.cols,r=t.rows,o=t.rowSpacing,n=t.colSpacing,a=n*(i+1),s=o*(r+1),l=Math.floor((e.width-a)/i),c=Math.floor((e.height-s)/r);return{width:l,height:c}}function r(e,t,r){for(var o=i(e,t),n=t.cols,a=t.rows,s=t.rowSpacing,l=t.colSpacing,c=r.width,u=r.height,p=o.width,d=o.height,v=Math.ceil(c/(p+l)),h=Math.ceil(u/(d+s)),g=[],f=0,m=0;m<=a-h;++m){f+=s;for(var y=0,w=0;w<=n-v;++w)y+=l,g.push({left:y,top:f,width:c,height:u}),y+=p;f+=d}return g}function o(e,t,i,r){return[n(t,e,r),i]}function n(e,t,r){var o=i(t,e),n=e.rowSpacing,l=e.colSpacing,c=o.width,u=o.height;return{left:a(r.left,c,l),top:a(r.top,u,n),width:s(r.width,c,l),height:s(r.height,u,n)}}function a(e,t,i){var r=e+t/2;r-=1;var o=Math.floor(r/(t+i));return c(o,t,i)}function s(e,t,i){var r=e+t/2+i,o=Math.floor(r/(t+i));return o=Math.max(1,o),l(o,t,i)}function l(e,t,i){return e*t+Math.max(0,e-1)*i}function c(e,t,i){return e*t+e*i+i}e.getSpanSize=t,e.getCellSize=i,e.getAllSlots=r,e.getAllResizeSlots=o})(t=e.CanvasLayoutGrid||(e.CanvasLayoutGrid={}))})(t=e.canvas||(e.canvas={}))})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r;!(function(i){function r(e,t,i){var r=_.chain(i).without(t).map((function(e){return a.visualPositionToRect(e.getPosition())})).value();return _.remove(e,(function(e){return _.any(r,(function(t){return o(t,e)}))})),e}function o(e,t){return!(t.left>=e.left+e.width||e.left>=t.left+t.width||t.top>=e.top+e.height||e.top>=t.top+t.height)}function n(e,t){return l.getDistance(c.getCentroid(e),c.getCentroid(t))}var a=t.util.CanvasDisplayUtility,s=t.util.CanvasVisualsUtility,l=e.visuals.shapes.Point,c=e.visuals.shapes.Rect,u=(function(){function e(e,t){void 0===t&&(t={width:3,height:3}),this.options=e,this.defaultNewCellSize=t}return e.prototype.getScaledRectFromHost=function(e){var t=this.options.offset;return t&&(e=c.add(e,t)),e},e.prototype.getHostRectFromScaled=function(e){var t=this.options.offset;return t&&(e=c.subtract(e,t)),e},e.prototype.getNearestValidPosition=function(e){var t=e.rawItemPosition,i=this.options.offset;i&&(t=c.add(e.rawItemPosition,i));var r,o=s.convertFromScaledRect(t,e.canvasScale),l=!1;e.item&&(r=a.visualPositionToRect(e.item.getPosition()),l=o.width!==r.width||o.height!==r.height);var u,p;if(l)u=this.getAvailableResizeRects(e.item,e.allItems,e.canvasSize,r,o),p=u[0];else{if(u=this.getAvailableRects(e.item,e.allItems,e.canvasSize,o),_.isEmpty(u))return;p=_.min(u,(function(e){return n(e,o)}))}return s.convertToScaledRect(p,e.canvasScale)},e.prototype.getNearestDropPosition=function(e){var t=c.getCentroid(e.rawItemPosition);this.options.offset&&(t.x-=this.options.offset.left,t.y-=this.options.offset.top),t.x/=e.canvasScale.x,t.y/=e.canvasScale.y;var r=this.defaultNewCellSize.width,o=this.defaultNewCellSize.height,a=function(){var a=i.CanvasLayoutGrid.getSpanSize(e.canvasSize,r,o,s.options),l={left:t.x-a.width/2,top:t.y-a.height/2,width:a.width,height:a.height},u=s.getAvailableRects(e.item,e.allItems,e.canvasSize,l);return _.isEmpty(u)||(_.remove(u,(function(e){return!c.containsPoint(e,t)})),_.isEmpty(u))?(--r,void--o):{value:_.min(u,(function(e){return n(e,l)}))}},s=this;do{var l=a();if("object"==typeof l)return l.value}while(r>=1&&o>=1)},e.prototype.isEnforcedForIntermediateStates=function(){return!1},e.prototype.getAvailableRects=function(e,t,o,n){var a=i.CanvasLayoutGrid.getAllSlots(o,this.options,n);return r(a,e,t)},e.prototype.getAvailableResizeRects=function(e,t,o,n,a){var s=i.CanvasLayoutGrid.getAllResizeSlots(o,this.options,n,a);return r(s,e,t)},e})();i.CanvasLayoutGridStrategy=u,i.isIntersecting=o})(r=i.canvas||(i.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){})(t=e.canvas||(e.canvas={}))})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){var i=e.explore.util.CanvasDisplayUtility,r=e.explore.util.CanvasVisualsUtility,o=e.visuals.shapes.Rect,n=(function(){function e(e){this.offset=e}return e.prototype.getScaledRectFromHost=function(e){return o.add(e,this.offset)},e.prototype.getHostRectFromScaled=function(e){return o.subtract(e,this.offset)},e.prototype.getNearestValidPosition=function(e){return o.add(e.rawItemPosition,this.offset)},e.prototype.getNearestDropPosition=function(e){var t=e.rawItemPosition.left+e.rawItemPosition.width/2,o=e.rawItemPosition.top+e.rawItemPosition.height/2;t-=this.offset.left,o-=this.offset.top,t/=e.canvasScale.x,o/=e.canvasScale.y;var n=i.DefaultVisualPosition.width,a=i.DefaultVisualPosition.height;return{left:r.checkBoundaryForCharts(t,n,e.canvasSize.width),top:r.checkBoundaryForCharts(o,a,e.canvasSize.height),width:n,height:a}},e.prototype.isEnforcedForIntermediateStates=function(){return!1},e})();t.DefaultLayoutStrategy=n})(i=t.canvas||(t.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){var i=e.explore.util.CanvasDisplayUtility,r=e.explore.components.DotGridComponent,o=e.visuals.shapes.Rect,n=e.common.controllers.TransformNudgeDirection,a=(function(){function e(e){this.options=e}return e.prototype.getScaledRectFromHost=function(e){var t=this.options.offset;return t&&(e=o.add(e,t)),e},e.prototype.getHostRectFromScaled=function(e){var t=this.options.offset;return t&&(e=o.subtract(e,t)),e},e.prototype.getNearestValidPosition=function(t){var i=o.add(t.rawItemPosition,this.options.offset),r=t.canvasScale;if(t.nudge&&t.item){var a=t.item.getPosition(),s=a.x,l=a.y;t.nudge.direction===n.Left||t.nudge.direction===n.Right?s=e.applyNudge(s,this.options.layoutX.UnitDivisions,t.nudge.direction===n.Left,t.nudge.bigNudge):t.nudge.direction!==n.Up&&t.nudge.direction!==n.Down||(l=e.applyNudge(l,this.options.layoutY.UnitDivisions,t.nudge.direction===n.Up,t.nudge.bigNudge)),i.left=s*r.x,i.top=l*r.y}var c=this.getNearestUnscaledGridRect(i,r);return{left:c.left*r.x,top:c.top*r.y,width:c.width*r.x,height:c.height*r.y}},e.applyNudge=function(e,t,i,o){e=Math.round(e);var n=o?r.CanvasLayout.UnitLength:r.CanvasLayout.UnitLength/t,a=n*(i?Math.floor:Math.ceil)(e/n);return a===e&&(a+=i?-n:n),a},e.prototype.getNearestDropPosition=function(e){var t=o.getCentroid(e.rawItemPosition);t.x-=this.options.offset.left,t.y-=this.options.offset.top;var r={left:t.x-i.DefaultVisualPosition.width/2,top:t.y-i.DefaultVisualPosition.height/2,width:i.DefaultVisualPosition.width,height:i.DefaultVisualPosition.height};return r=this.getNearestUnscaledGridRect(r,e.canvasScale)},e.prototype.getNearestUnscaledGridRect=function(t,i){var r=this.getNearestUnscaledGridPoint({x:t.left,y:t.top},i),o=this.getNearestUnscaledGridPoint({x:t.left+t.width,y:t.top+t.height},i),n=this.options.limits;if(n){var a=e.limitAdjustment(r.x,o.x,n.left,n.width);0!==a&&(r.x+=a,o.x+=a);var s=e.limitAdjustment(r.y,o.y,n.top,n.height);0!==s&&(r.y+=s,o.y+=s)}return{left:r.x,top:r.y,width:o.x-r.x,height:o.y-r.y}},e.limitAdjustment=function(e,t,i,r){if(e<i)return i-e;var o=i+r;return t>o?o-t:0},e.prototype.getNearestUnscaledGridPoint=function(t,i){return{x:e.getNearestUnscaledGridCoordinate(this.options.layoutX,t.x,i.x),y:e.getNearestUnscaledGridCoordinate(this.options.layoutY,t.y,i.y)}},e.getNearestUnscaledGridCoordinate=function(e,t,i){var o=t/i,n=r.CanvasLayout.UnitLength/e.UnitDivisions,a=Math.round(o/n);return a*n},e.prototype.isEnforcedForIntermediateStates=function(){return!0},e})();t.DotGridLayoutStrategy=a})(i=t.canvas||(t.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.util.ErrorDetailsUtility,o=e.explore.services.events,n=e.data.SQExprUtils,a=e.explore.services,s=jsCommon.TraceType,l="Sampled",c=(function(){function t(e,t){this.scope=e,this.services=t}return t.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","errorService","featureSwitchService","telemetryService"],scopedDependencies:["dataSources","eventBridge","selection","visualAuthoring"]}},t.prototype.showErrorDetails=function(){var e=this.scope.viewModel;this.logErrorAndShowDialog(e.errorInfo,e.readOnlyState.visual.type,2!==e.errorInfo.source)},t.prototype.showWarningDetails=function(){var e=this.scope.viewModel,t={details:e.warningInfo.details,code:e.warningInfo.code,fixableError:0};this.logErrorAndShowDialog(t,e.readOnlyState.visual.type,!1)},t.prototype.showTransformWarningDetails=function(){var e=this.scope.viewModel,t={details:e.transformWarningInfo.details,code:e.transformWarningInfo.code,fixableError:0};this.logErrorAndShowDialog(t,e.readOnlyState.visual.type,!1)},t.prototype.showInfoDetails=function(){var e=this.scope.viewModel,t={details:e.visualInfo.details,code:e.visualInfo.code,fixableError:0};this.logErrorAndShowDialog(t,e.readOnlyState.visual.type,!1)},t.prototype.clearError=function(){var e=this.scope.viewModel;e.errorInfo=void 0,e.warningInfo=void 0,e.transformWarningInfo=void 0,e.visualInfo=void 0},t.prototype.showErrorOverlay=function(t,i,o,n){var a=this.scope.viewModel,s=a.readOnlyState.visual.type;if(this.services.telemetryService.logEvent(e.telemetry.VisualError,i,s,t.message),!a.errorInfo||a.errorInfo.code!==i){var l=r.getErrorOverlayType(i),c=this.shouldHideSeeDetails(i),u=this.services.conceptualSchemaProxy.getLatestCapabilities(this.services.dataSources.get(),void 0),p=this.getFixableErrorKind(i,this.services.featureSwitchService.featureSwitches.enableTableToTableRelationship&&u&&u.canEdit);a.errorInfo={details:t,code:i,fixableError:p,hideSeeDetails:c,overlayType:l,requestId:o,source:n}}},t.prototype.showWarningIcon=function(e,t){var i=this.scope.viewModel,r=i.readOnlyState.visual.type;this.logVisualWarning(r,t,e.message),i.warningInfo||(i.warningInfo={details:e,code:t})},t.prototype.showTransformWarningIcon=function(e,t,i){var r=this.scope.viewModel,o=r.readOnlyState.visual.type,n=i?t.concat("|").concat(l):t;this.logVisualWarning(o,n,e.message),r.transformWarningInfo||(r.transformWarningInfo={details:e,code:t})},t.prototype.showInfoIcon=function(e,t){var i=this.scope.viewModel,r=i.readOnlyState.visual.type;this.logVisualWarning(r,t,e.message),i.visualInfo||(i.visualInfo={details:e,code:t})},t.prototype.fixErrors=function(){
var t=this.scope.viewModel;switch(t.errorInfo.fixableError){case 1:a.selectionUtils.selectVisualContainer(t.contract,this.services.selection),this.services.visualAuthoring.removeInvalidExpressions(t.contract,this.services.dataSources.get());break;case 2:var i=n.getActiveTablesNames(t.contract.config.singleVisual.query.defn);this.services.eventBridge.publishToChannel(o.missingTableRelationship,{tables:i});break;case 3:this.removeBrokenFilters();break;case 4:this.services.eventBridge.publishToChannel(e.explore.services.events.showEnableScriptVisualsDialog);break;case 0:}},t.prototype.removeBrokenFilters=function(){var e=this,t=this.scope.viewModel,i=t.contract.filters,r={scopeType:0,container:t.contract};this.services.conceptualSchemaProxy.get(this.services.dataSources.get()).then((function(t){for(var o=0,n=i;o<n.length;o++){var a=n[o];a.filter&&!_.isEmpty(a.filter.validate(t,e.services.aggrOps))&&e.services.visualAuthoring.removeFilter(a,r)}}))},t.prototype.generateShowMoreErrorDetails=function(t){var i=[],o=t.message,n=e.common.localize.get("ServiceError_CannotLoadVisual");if(r.hasAdditionalErrorInfo(t)&&(n=t.displayableErrorInfo[0].errorInfoKey,o=t.displayableErrorInfo[0].errorInfoValue,t.displayableErrorInfo.length>1))for(var a=1;a<t.displayableErrorInfo.length;a++)i.push(t.displayableErrorInfo[a]);var s={title:n,message:o,displayableErrorInfo:i,debugErrorInfo:t.debugErrorInfo};return s},t.prototype.getFixableErrorKind=function(e,t){switch(e){case"Missing_References":return 1;case"InvalidUnconstrainedJoin":return t?2:0;case"Broken_Filters":return 3;case"ScriptVisualsNotEnabled":return 4;default:return 0}},t.prototype.shouldHideSeeDetails=function(e){return 1===r.getErrorOverlayType(e)},t.prototype.logErrorAndShowDialog=function(e,t,i){var r,o,n=this.generateShowMoreErrorDetails(e.details),a=e.code;i?(r="VisualErrorSeeDetails_"+a+"_"+t,o=s.Error):(r="VisualWarningSeeDetails_"+a+"_"+t,o=s.Warning);var l={title:n.title,displayableErrorInfo:n.displayableErrorInfo,debugErrorInfo:n.debugErrorInfo,level:o};e.details&&e.details.helpLink&&(l.helpLink=e.details.helpLink),e.requestId&&(l.requestId=e.requestId),this.services.errorService.error(n.message,r,l)},t.prototype.logVisualWarning=function(t,i,r){this.services.telemetryService.logEvent(e.telemetry.VisualWarning,t,void 0,!1,e.telemetry.ErrorSource.PowerBI,i,r)},t})();i.CanvasVisualErrorController=c})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.util.ErrorDetailsUtility,o=(function(){function t(t,i){var r=this;this.services=i,this.tooltipConfigManager={getTooltipConfig:function(){return{tooltipArrowPosition:e.common.ArrowPosition.arrowTopLeft,tooltipDelay:100,tooltipDescription:r.getWarningMessage()}}}}return t.createOptions=function(){return{additionalServices:["localizationService"]}},t.prototype.isClickable=function(){var e=this.details;return!!e&&(!_.isEmpty(e.message)||this.hasAdditionalErrorInfo(e))},t.prototype.hasAdditionalErrorInfo=function(e){return r.hasAdditionalErrorInfo(e)},t.prototype.getWarningMessage=function(){var e=this.details;if(!e)return"";var t=this.hasAdditionalErrorInfo(e)?e.message+" "+this.services.localizationService.get("VisualContainer_ClickToSeeMore"):e.message;return t},t})();i.CanvasVisualHeaderIconController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=jsCommon.JsonExtensions,n=e.explore.util.ScriptVisualsUtil,a=t.services.selectionUtils,s=e.explore.util.VisualContainerUtils,l=(function(){function i(i,o){var n=this;this.services=o,this.scope=i,this.queryVisualHostServices=this.createQueryVisualHostServices(),this.scope.showCodePanel=!1,this.scope.isMinimized=!1,this.scope.scriptInput="",this.scope.datafields=[],this.scope.dataFieldsNamesList="",this.scope.dataFrameName="",this.scope.showWarningBar=!0,this.scope.canvasResize=!1;var a=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.selectionChanged,(function(){return n.update()})).subscribe(r.visualContainerChanged,(function(e,t){return n.update()})).subscribe(r.canvasSizeChangedEvent,(function(){return n.scope.canvasResize=!n.scope.canvasResize}));this.scope.$on("$destroy",(function(){a.unsubscribeAll()})),this.scope.togglePanel=function(){n.scope.showCodePanel=!n.scope.showCodePanel},this.scope.minimizeToggle=function(){n.scope.isMinimized=!n.scope.isMinimized,n.services.telemetryService.logEvent(e.telemetry.EXCodePaneResize,n.scope.currentHeight,!n.scope.isMinimized,n.scope.isMinimized)},this.scope.onResize=function(t){n.services.telemetryService.logEvent(e.telemetry.EXCodePaneResize,t,n.scope.isMinimized,n.scope.isMinimized)},this.scope.hideWarning=function(){n.hideWarningBar()},this.scope.runButtonClicked=function(){n.services.eventBridge.publishToChannel(t.services.events.visualContainerChanged,{affectContainer:s.contractEqualityComparator(n.scope.selectedVisual),allowCache:!1}),n.services.telemetryService.logEvent(e.telemetry.EXCodePaneUserRunScript)},this.scope.canLaunchExternalIDE=this.services.scriptVisuals.canLaunchExternalIDE(),this.scope.launchExternalIDEClicked=function(){return n.launchExternalIDE()},this.scope.optionsButtonClicked=function(){return n.openOptionsDialog()},this.scope.scriptInputChanged=function(){n.setScriptCode(n.scope.scriptInput)},this.setAndDisplayWarning("CodePane_WarningDuplicateRowsRemoved"),this.update()}return i.createOptions=function(){return{scopedDependencies:["dataSources","eventBridge","explorationNavigation","filterGenerator","formFactor","scriptVisuals","selection","visualAuthoring","visualQueryGenerator"],additionalServices:["conceptualSchemaProxy","displayNameService","errorService","localizationService","telemetryService","visualPlugin"]}},i.prototype.update=function(){this.scope.selectedVisual=this.getSelectedVisual(),this.scope.selectedSingleVisual=this.scope.selectedVisual&&this.scope.selectedVisual.config&&this.scope.selectedVisual.config.singleVisual?this.scope.selectedVisual.config.singleVisual:null,this.visualShouldDisplayCodePane(this.scope.selectedSingleVisual)?(this.scope.showCodePanel=!0,this.scope.scriptInput=this.getScriptCode(this.scope.selectedSingleVisual),this.compareAndUpdateDatafields(this.scope.selectedSingleVisual)):this.scope.showCodePanel=!1},i.prototype.launchExternalIDE=function(){var t=this;this.services.telemetryService.logEvent(e.telemetry.EXCodePaneUserEditScriptWithExternalIDE);var r=this.services.dataSources.get(),a=!1;""===this.getScriptCode(this.scope.selectedSingleVisual)&&(a=!0,this.setScriptCode(n.defaultScript)),this.services.conceptualSchemaProxy.get(r).then((function(s){var l=t.services.visualQueryGenerator.execute({dataSources:r,config:t.scope.selectedSingleVisual,schema:s,additionalFilters:t.queryVisualHostServices.getFilters(t.services.filterGenerator,s),dataWindow:i.DefaultVisualViewPort});return a&&t.getScriptCode(t.scope.selectedSingleVisual)===n.defaultScript&&t.setScriptCode(""),!l||l.error?void t.services.telemetryService.logEvent(e.telemetry.EXCodePaneLaunchExternalIDEFailed,e.telemetry.LaunchExternalIDEFailureType.GenerateQueryFail):void t.services.scriptVisuals.launchExternalIDE(l).then((function(){t.services.telemetryService.logEvent(e.telemetry.EXCodePaneLaunchExternalIDESucceeded)}),(function(i){var r=o.tryParseJSON(i);r&&r.title&&r.message?t.services.errorService.fatalCustom(r.title,r.message,"ScriptVisual_FailedOpeningScriptEditor"):t.services.errorService.fatal(t.services.localizationService.get("CodePane_GeneralError"),"ScriptVisual_FailedOpeningScriptEditor"),t.services.telemetryService.logEvent(e.telemetry.EXCodePaneLaunchExternalIDEFailed,e.telemetry.LaunchExternalIDEFailureType.LaunchIDEFail)}))}))},i.prototype.openOptionsDialog=function(){this.services.telemetryService.logEvent(e.telemetry.EXCodePaneUserOpenOptionsDialog),this.services.scriptVisuals.openOptionsDialog()},i.prototype.getSelectedVisual=function(){return a.getSelectedVisual(this.services.selection)},i.prototype.visualShouldDisplayCodePane=function(t){if(!t||!t.visualType||!this.services.formFactor.getCurrentLayoutCapabilities().canShowCodePane())return!1;if(this.services.visualPlugin.isCustomVisual(t.visualType))return!1;var i=this.getDataViewMappings(t);return!(!i||!e.ScriptResultUtil.findScriptResultMapping(i))},i.prototype.getScriptCode=function(t){var i=this.getDataViewMappings(t);if(!i)return"";var r,o=t.objects;return o&&(r=e.ScriptResultUtil.extractScriptResultFromVisualConfig(i,o)),r||(r=e.ScriptResultUtil.extractScriptResultDefaultFromDataViewMappings(i)),r?r.source:""},i.prototype.setScriptCode=function(t){function i(e,t){var i={objectName:e.objectName,properties:{},selector:null};return i.properties[e.propertyName]=t,i}var r=e.ScriptResultUtil.findScriptResultMapping(this.getDataViewMappings());if(r&&r.script){jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(t)&&(t="");var o=r.script,n=[];n.push(i(o.source,t)),n.push(i(o.provider,"R"));var a={merge:n};this.services.visualAuthoring.persistProperties(a,this.scope.selectedSingleVisual)}},i.prototype.getDataViewMappings=function(e){var t=e||this.scope.selectedSingleVisual;if(t&&t.visualType){var i=this.services.visualPlugin.capabilities(t.visualType);if(i&&i.dataViewMappings)return i.dataViewMappings}return null},i.prototype.compareAndUpdateDatafields=function(t){var r=this;if(this.scope.datafields=[],t&&t.query&&t.query.defn&&t.query.defn.select&&!_.isEmpty(t.query.defn.select())&&t.query.projections){var o=t.query.defn.select(),n=t.query.projections,a=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(a).then((function(a){var s=e.ScriptResultUtil.getScriptInput(n,o,a,e.ScriptResultUtil.findScriptResultMapping(r.getDataViewMappings(t)),null);s&&s.Columns&&s.VariableName&&(r.scope.dataFrameName=s.VariableName,r.scope.datafields=s.Columns,r.scope.dataFieldsNamesList=i.generateDataFieldsNamesList(s.Columns))}))}},i.prototype.createQueryVisualHostServices=function(){var i=this;return e.Prototype.inherit(t.util.VisualHostServicesUtil.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,t){var r=i.services.explorationNavigation;return e.calculateDetailVisualFilter(r.getCurrentExploration(),r.getCurrentSection(),i.getSelectedVisual(),t,1)}}))},i.generateDataFieldsNamesList=function(e){for(var t=e,i="",r=0;r<t.length;r++)r>0&&(i+=", "),i+=t[r].Name;return i},i.prototype.setAndDisplayWarning=function(t){this.scope.warningText=this.services.localizationService.get(t),this.scope.showWarningBar=!0,this.services.telemetryService.logEvent(e.telemetry.EXCodePaneShowWarning,t)},i.prototype.hideWarningBar=function(){this.scope.warningText="",this.scope.showWarningBar=!1,this.services.telemetryService.logEvent(e.telemetry.EXCodePaneUserCloseWarning)},i})();l.DefaultVisualViewPort={width:1,height:1},i.CodePaneContainerController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.errorService=this.scope.errorService,this.modalDialog=this.errorService.control(),this.scope.deleteVisual=function(){return t.deleteVisual()},this.scope.closeDialog=function(){return t.closeDialog()}}return e.prototype.deleteVisual=function(){this.closeDialog(),this.scope.deleteVisualService.deleteCustomVisuals(this.scope.explorationContract,this.scope.customVisuals)},e.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},e})();e.DeleteVisualWarningDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=e.data.SQExprBuilder,a=e.visuals.controls.internal.TablixObjects,s=e.explore.util.VisualContainerUtils,l=(function(){function i(e,i){var r=this;this.scope=e,this.services=i,this.dataProxy=this.services.singleExecutableDataProxyFactory.create(),this.visualDataProxyService=t.services.createExploreVisualDataProxyService(this.dataProxy,this.services.filterGenerator),this.queryVisualHostServices=this.createQueryVisualHostServices(),this.spinnerService=t.services.createDetailVisualSpinnerService(e,i.eventBridge),this.initialize(),this.scope.$on("$destroy",(function(){r.subscriptionManager&&r.subscriptionManager.unsubscribeAll()}))}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","featureSwitchService","geocoder","localizationService","moduleLoader","promiseFactory","singleExecutableDataProxyFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","filterGenerator","visualPlugin","visualAuthoring","visualQueryGenerator"]}},i.prototype.initialize=function(){var e=this;if(!this.initializeVisual())var t=this.scope.$watch("viewModel",(function(i){e.initializeVisual()&&t()}))},i.prototype.initializeVisual=function(){var i=this;if(!this.scope.viewModel||!this.scope.viewModel.parentContract)return!1;var r=this.scope.viewModel.visual;return r.visualPlugin=this.services.visualPlugin,r.interactivityOptions={isInteractiveLegend:!1,selection:!1},r.hostServices=e.Prototype.inherit(t.services.createVisualHostServices(this.services.promiseFactory,this.services.moduleLoader,e.visuals.services.createGeolocation(),this.services.geocoder),(function(e){e.persistProperties=function(e){return i.persistProperties(e)},e.getLocalizedString=function(e){return i.services.localizationService.get(e)},e.getViewMode=function(){return 1}})),r.type=e.visuals.plugins.matrix.name,this.initializeMatrixContract(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.visualContainerChanged,(function(e,t){t&&i.scope.viewModel.parentContract&&t.affectContainer(i.scope.viewModel.parentContract)&&i.runQuery(!1)})).subscribe(o.filterContainerChanged,(function(e,t){0===t.scope.scopeType&&t.scope.container!==i.scope.viewModel.parentContract||i.runQuery(!1)})),this.runQuery(!0),!0},i.prototype.initializeMatrixContract=function(){this.matrixContract={name:this.scope.viewModel.parentContract.name,config:{singleVisual:{visualType:e.visuals.plugins.matrix.name}},layouts:jsCommon.ArrayExtensions.extendWithId([{id:0,position:{x:0,y:0,width:0,height:0}}])};var t={};r.setValue(t,a.PropGeneralMatrixRowSubtotals,null,n.boolean(!1)),r.setValue(t,a.PropGeneralMatrixColumnSubtotals,null,n.boolean(!1)),this.matrixContract.config.singleVisual.objects=t},i.prototype.persistProperties=function(e){var t=this.matrixContract.config.singleVisual,i=_.isArray(e)?{replace:e}:e;this.services.visualAuthoring.persistProperties(i,t)&&this.runQuery(!1,!0)},i.prototype.runQuery=function(e,t){var i=this;if(this.scope.viewModel&&this.scope.viewModel.parentContract){var r=this.scope.viewModel.parentContract,o=this.services.dataSources.get();o&&r.config&&r.config.singleVisual&&(this.spinnerService.startSpinner(),this.services.conceptualSchemaProxy.get(o).then((function(r){var n=i.scope.viewModel.parentContract,a={dataSources:o,schema:r,config:n.config.singleVisual,hostServices:i.queryVisualHostServices,visualQueryGenerator:i.services.visualQueryGenerator,isLoadMore:!1,preferCurrentData:t};return i.visualDataProxyService.runQuery(a).then((function(t){return i.onDataChanged(t,e)}),(function(t){return i.clearData("Query error",e)}))}),(function(t){return i.clearData("Conceptual schema error",e)})).finally((function(){return i.spinnerService.stopSpinner()})))}},i.prototype.clearData=function(t,i){var r=this.scope.viewModel,o=r.hasData&&r.visual.data&&r.visual.data.dataView;(o||i)&&this.services.telemetryService.logEvent(e.telemetry.EXSeeDataNoMatrixData,s.getVisualType(r.parentContract),t);var n={dataView:{metadata:{columns:[]},matrix:{rows:{root:{children:[],childIdentityFields:[]},levels:[]},columns:{root:{children:[]},levels:[]},valueSources:[]}},dataViewSource:null};this.scope.viewModel.visual.dataTransforms={},this.scope.viewModel.visual.data=n,this.scope.viewModel.hasData=!1},i.prototype.onDataChanged=function(e,i){var r;if(r=e?{dataView:e&&e.dataReaderResult?e.dataReaderResult.dataView:null,dataViewSource:e&&e.dataViewSource?e.dataViewSource:null}:this.scope.viewModel.visual.data){if(r.dataView&&!r.dataView.matrix){var o="No matrix data view";return void this.clearData(o,i)}var n=s.isSegment(r.dataView);n&&(r.isFirstSegment=n);var a;if(null!=r.dataView){var l=this.visualDataProxyService.lastExecutedQuery(),c=s.getDataRolesForVisual(this.scope.viewModel.parentContract,this.services.visualPlugin),u=_.map(c,(function(e){return e.name}));if(a=t.util.MatrixVisualDataViewConverter.generate(r.dataView,l.transforms.selects,u,l.transforms.roles&&l.transforms.roles.ordering,this.services.featureSwitchService),!a)return void this.clearData("Failed to generate data view transform actions",i);a.objects=this.matrixContract.config.singleVisual.objects}this.scope.viewModel.visual.dataTransforms=a,this.scope.viewModel.visual.data=r,this.scope.viewModel.hasData=!0}},i.prototype.createQueryVisualHostServices=function(){var i=this;return e.Prototype.inherit(t.util.VisualHostServicesUtil.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,t){var r=i.services.explorationNavigation;return e.calculateDetailVisualFilter(r.getCurrentExploration(),r.getCurrentSection(),i.scope.viewModel.parentContract,t,1)}}))},i})();i.DetailVisualController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(t,i){var r=this;this.services=i,this.scope=t,this.errorService=this.services.errorService,this.modalDialog=this.errorService.control(),this.scope.acceptTermsOfService=function(){return r.acceptTermsOfService()},this.scope.rejectTermsOfService=function(){return r.rejectTermsOfService()},this.scope.learnMoreLink=e.models.EsriLearnMoreUrl,this.scope.byClickingText=this.services.localizationService.format("EsriConsentDialog_ByClicking",['<a href="https://go.microsoft.com/fwlink/?LinkID=826322" target="_blank">'+this.services.localizationService.get("Terms")+"</a>",'<a href="https://go.microsoft.com/fwlink/?LinkID=826323" target="_blank">'+this.services.localizationService.get("PrivacyPolicy")+"</a>"])}return t.createOptions=function(){return{additionalServices:["errorService","localizationService"],scopedDependencies:["eventBridge"]}},t.createAndShowEsriConsentDialog=function(e,t,i,r){var o=e.defer(),n=t.$new(!0);n.errorService=i,n.esriConsentDialogCallback=function(e){o.resolve(e)};var a={dialogName:void 0,isDismissable:!0,scope:n,template:"<esri-consent-dialog></esri-consent-dialog>",dialogCssClass:"esriConsentDialog"};return r.showLegacyWebModalDialog(a),o.promise},t.prototype.acceptTermsOfService=function(){this.closeDialog(),this.scope.esriConsentDialogCallback(!0)},t.prototype.rejectTermsOfService=function(){this.closeDialog(),this.scope.esriConsentDialogCallback(!1)},t.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},t})();t.EsriConsentDialogController=i})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.scope=e,this.scope.isMasterFormFactor=function(){return 0===t.formFactor.getCurrentLayout()},this.scope.isMobileLayoutAuthoring=function(){return 0!==t.formFactor.getCurrentLayout()&&1===t.viewModeState.getMode()}}return e.createOptions=function(){return{scopedDependencies:["formFactor","viewModeState"]}},e})();e.ExplorationController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.constants,r=e.explore.services.events,o=(function(){function t(t,o){var n=this;this.scope=t,this.scope.viewModel.isTabEditable=!1,this.services=o,this.scope.viewModeState=this.services.viewModeState,this.scope.eventBridge=this.services.eventBridge,this.scope.renameSection=function(e){return n.renameSection(e,n.scope.tabIndex)},this.scope.changeSection=function(e){return n.changeSection(e,n.scope.tabIndex)},this.scope.deleteSection=function(e){return n.deleteSection(e,n.scope.tabIndex)},this.scope.selectMenuItem=function(e){return n.selectMenuItem(e)},this.scope.beginEditSection=function(){return n.beginEditSection()},this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.sectionNameChanged,(function(e,t){n.scope.viewModel.selected&&n.scope.$emit(i.renameSectionEvent)})),this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){n.scope.viewModel.isTabEditable=!1,n.scope.$emit(i.renameSectionEvent)})),this.scope.$watch("isOnlyTab",(function(){n.scope.isOnlyTab?n.scope.dropdownItems=n.scope.viewModel.menuItems.slice(0,2):n.scope.dropdownItems=n.scope.viewModel.menuItems}))}return t.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["eventBridge","viewModeState"]}},t.prototype.beginEditSection=function(){this.scope.viewModel.isTabEditable=!0,this.scope.toggleDraggable(!1),this.scope.$emit(i.renameSectionEvent)},t.prototype.renameSection=function(e,t){if(!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)){var i={sectionNewName:e,sectionIndex:t};this.services.eventBridge.publishToChannel(r.renameSection,i),this.scope.toggleDraggable(!0)}},t.prototype.deleteSection=function(e,t){this.services.eventBridge.publishToChannel(r.deleteSectionInitiated,{sectionIndex:t,supportMinervaDialog:this.scope.supportsMinervaDialog}),e&&e.stopPropagation&&e.stopPropagation()},t.prototype.changeSection=function(e,t){this.services.eventBridge.publishBubbling(this.scope,r.switchSection,t),e&&e.stopPropagation&&e.stopPropagation()},t.prototype.selectMenuItem=function(e){switch(e.action){case 0:this.services.eventBridge.publishToChannel(r.duplicateSection,this.scope.tabIndex);break;case 1:this.beginEditSection();break;case 2:this.deleteSection(null,this.scope.tabIndex)}},t})();t.ExplorationNavigationTabController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){var t=e.overridePosition||e.position;return{height:t.height,width:t.width,top:t.y,left:t.x}}function o(t){return 0!==t.contract.popOutMode?e.common.constants.MaxSupportedZIndexValue:t.position.z}var n=e.explore.util.CanvasDisplayUtility,a=e.explore.controllers.canvas.CanvasLayoutGrid,s=i.canvas.CanvasLayoutGridStrategy,l=t.util.CanvasVisualsUtility,c=e.common.constants,u=i.canvas.DefaultLayoutStrategy,p=e.explore.components.DotGridComponent,d=i.canvas.DotGridLayoutStrategy,v=e.explore.util.DragDropTypes,h=e.common.directives.DragDropUtils,g=e.explore.constants.ExploreCanvasConstants,f=e.explore.services.events,m=e.visuals.shapes.Rect,y=e.common.directives.SwipeDirections,w=e.explore.util.VisualContainerUtils;i.CursorClass={Brush:"brush-cursor"};var C={width:0,height:0},S=0,b=0,x=(function(){function x(i,r){var o=this;this.uiScale=x.DefaultNoUiScale,this.isDraggingVisual=!1,this.scope=i,this.model=i.viewModel,this.services=r,this.scopeEventManager=e.common.createScopeEventSubscriptionManager(i),this.scope.displayOptionServices={canvasScale:this.services.canvasScale,viewModeState:this.services.viewModeState,formFactor:this.services.formFactor},this.viewModeState=this.services.viewModeState,this.scope.clearSelection=function(e){o.scope.viewModel&&o.scope.viewModel.preventSelectionClearing||t.util.EventBubblingUtility.handled(e)||(o.services.selection.clearSelection(),o.services.overlayService.hideAllDropdowns(),o.services.clipboard.clearFormatData())},this.showDotGrid=r.settingsService.getShowGridlines(),this.snapToDotGrid=r.settingsService.getSnapToGrid(),this.scope.keyDown=function(e){return o.onKeyDown(e)},this.scope.swipeHorizontally=function(e){return o.onHorizontalSwipe(e)},this.scope.drop=function(e,t){return o.drop(e,t)},this.scope.dropConfig={accept:v.Field+" "+v.VisualContainerThumbnail},this.scope.getExploreCanvasClass=function(){return o.getClass()},this.scope.shouldDisableZoom=function(){return o.shouldDisableZoom()},this.scope.canPinch=function(){return o.canPinch()},this.scope.canSwipe=function(){return o.canSwipe()},this.scope.isCanvasBackdropVisible=function(){return o.isCanvasBackdropVisible()},this.scope.showBoxGrid=function(){return o.services.formFactor.getCurrentLayoutCapabilities().canShowLayoutGrid()&&1===o.services.formFactor.getCurrentLayout()},this.scope.showDotGrid=function(){return o.showDotGrid&&o.services.formFactor.getCurrentLayoutCapabilities().canShowLayoutGrid()&&0===o.services.formFactor.getCurrentLayout()},this.scope.snapToDotGrid=function(){return o.snapToDotGrid&&0===o.services.formFactor.getCurrentLayout()},this.scope.adjustScaleForLayout=function(e){return o.adjustScaleForLayout(e)},this.scope.shouldDisableScroll=function(){return o.shouldDisableScroll()},this.subscribeToEvents(),this.scope.$watch("size",(function(e){if(e){var i=o.services.canvasScale.getDisplayOption();o.scope.useResponsiveLayout=e.width<=t.constants.ExploreCanvasConstants.ResponsiveLayoutMaxWidthBreakpoint&&o.scope.viewModel&&o.scope.viewModel.contract&&0===i,o.updateSize(),o.updateAndApplyCanvasBackground(),o.services.eventBridge.publishToChannel(f.canvasSizeChangedEvent)}})),this.updateCanvasLayoutSize(),this.updateLayoutStrategy(),this.scope.$watch("viewModel.contract.objects",(function(e){o.updateAndApplyCanvasBackground()}),!0),this.scope.$watchCollection("viewModel.visualContainers",(function(){o.scaleVisualContainersToCanvas(o.uiScale),o.scope.viewModel&&o.services.loadProgressNotificationService.reset()})),this.scope.canvasOptions||(this.scope.canvasOptions={autoLayoutVisualPadding:t.constants.ExploreCanvasConstants.AutoLayoutVisualPadding,scrollbarOffset:t.constants.ExploreCanvasConstants.ScrollbarOffset}),this.services.loadProgressNotificationService.register(this)}return x.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dragDataService","layoutInsertionHelper","$element","featureSwitchService","linguisticSchemaProxy","telemetryService","overlayService","dropdownMenuService","promiseFactory","loadProgressNotificationService","settingsService"],scopedDependencies:["canvasScale","canvasKeyHandler","canvasScale","clipboard","dataSources","eventBridge","explorationNavigation","formFactor","layoutAuthoring","popOut","resourceLoader","selection","undoRedo","viewModeState","visualAuthoring","visualQueryGenerator"]}},x.prototype.isScrollablePhoneAuthoring=function(){return 0!==this.services.formFactor.getCurrentLayout()&&1===this.services.viewModeState.getMode()},x.prototype.shouldTrackLoadProgress=function(){var e=!1,t=this.scope.viewModel&&this.scope.viewModel.visualContainers.length>0;if(t){var i=this.services.dataSources.get();if(i)for(var r=0,o=this.scope.viewModel.visualContainers;r<o.length;r++){var n=o[r];if(this.services.visualQueryGenerator.shouldExecute(n.contract.config.singleVisual,i)){e=!0;break}}}return e},x.prototype.onHorizontalSwipe=function(e){var i=this.isNextSection(e)?t.constants.explorationNextPageEvent:t.constants.explorationPreviousPageEvent;this.scope.$root.$emit(i,t.services.SectionNavigationAction.Swipe)},x.prototype.subscribeToEvents=function(){var e=this,i=this.services.eventBridge.createChannelSubscriptionManager().subscribe(f.selectionChanged,(function(){return e.onSelectionChanged()})).subscribe(f.explorationLoaded,(function(){return e.onExplorationLoaded()})).subscribe(f.explorationUnloaded,(function(t,i){return e.onExplorationUnloaded()})).subscribe(f.canvasDisplayChanged,(function(t,i){return e.applyFitOption(i)})).subscribe(f.canvasDimensionChanged,(function(t,i){return e.updateCanvasDimension(i)})).subscribe(f.align,(function(t,i){return e.alignVisuals(i)})).subscribe(f.canvasBackgroundChanged,(function(t,i){return e.updateCanvasBackground(i)})).subscribe(f.popOutModeChanged,(function(){return e.onPopOutModeChanged()})).subscribe(f.clipboardDataUpdated,(function(){return e.onClipboardDataUpdated()})).subscribe(f.formFactorChanged,(function(){return e.onFormFactorChanged()})).subscribe(f.sectionLayoutRemoved,(function(){return e.onSectionLayoutRemoved()}));this.scope.$watch((function(){return e.services.settingsService.getShowGridlines()}),(function(){return e.onShowGridlinesChanged()})),this.scope.$watch((function(){return e.services.settingsService.getSnapToGrid()}),(function(){return e.onSnapToGridChanged()})),this.scope.$on("$destroy",(function(){return i.unsubscribeAll()})),this.scopeEventManager.subscribe(t.constants.TransformElementDragStartEventName,(function(t,i){e.onDragStartPosition={x:i.x,y:i.y,width:i.width,height:i.height},e.isDraggingVisual=!0})).subscribe(t.constants.TransformElementDragMoveEventName,(function(t,i){e.moveSelectedContainersWrapper(t,i)})),this.services.eventBridge.subscribeToBubbling(this.scope,f.deleteVisualContainer,(function(t,i){e.services.visualAuthoring.deleteVisualContainer(i,e.scope.viewModel),t.stopPropagation&&t.stopPropagation()})),this.services.eventBridge.subscribeToBubbling(this.scope,f.removeVisualContainerFromLayout,(function(t,i){e.services.layoutAuthoring.removeLayoutFromVisualContainer(e.scope.viewModel,i),t.stopPropagation&&t.stopPropagation()}))},x.prototype.onSectionLayoutRemoved=function(){var e=this.services.formFactor.getCurrentLayout();_.remove(this.model.visualContainers,(function(t){return!t.contract.layouts.withId(e)})),this.services.eventBridge.publishToChannel(f.canvasChanged)},x.prototype.onShowGridlinesChanged=function(){this.showDotGrid=this.services.settingsService.getShowGridlines(),this.scope.applyFitOption()},x.prototype.onSnapToGridChanged=function(){this.snapToDotGrid=this.services.settingsService.getSnapToGrid(),this.updateLayoutStrategy()},x.prototype.applyFitOption=function(e){this.services.canvasScale.setDisplayOption(e),this.scope.applyFitOption()},x.prototype.moveSelectedContainersWrapper=function(e,t){var i=this,r=this.services.selection.getSelectedElements().length>1&&this.services.formFactor.getCurrentLayoutCapabilities().canMoveMultipleVisuals();r&&(this.isDraggingVisual?(this.isDraggingVisual=!1,this.services.undoRedo.register("MoveSelectedVisualContainers",(function(){i.moveSelectedContainers(e,t)}))):this.moveSelectedContainers(e,t))},x.prototype.alignVisuals=function(e){var t={width:this.model.width,height:this.model.height};this.services.layoutAuthoring.alignSelectedVisuals(e.alignmentType,t,l.getSelectedCanvasVisualContainers(this.scope.viewModel,this.services.selection)),this.scope.$broadcast(c.VisualSelectionOrPositionChangedEventName)},x.prototype.moveSelectedContainers=function(e,t){for(var i=this.onDragStartPosition,r={x:i.x-t.x,y:i.y-t.y,width:0,height:0},o=l.convertFromScaledPosition(r,this.uiScale),n=0,a=this.model.visualContainers;n<a.length;n++){var s=a[n];if(s.isSelected){var c=_.cloneDeep(s.position);c.x-=o.x,c.y-=o.y,this.services.layoutAuthoring.moveVisualContainer(s,c)}}i.x=t.x,i.y=t.y},x.prototype.updateCanvasDimension=function(e){var i=this;this.services.undoRedo.register("UpdateCanvasDimension",(function(){i.scope.viewModel.contract.size=e;var r=i.services.explorationNavigation.getCurrentExploration(),o=i.services.explorationNavigation.getCurrentSection(),a=n.isCortanaPageSize(e);t.PodUtils.setCortanaEnabled(r,o.name,a,i.services.linguisticSchemaProxy)}))},x.prototype.updateCanvasBackground=function(e){var t=this;this.services.undoRedo.register("UpdateCanvasBackground",(function(){t.scope.viewModel.contract.objects=e.objects}))},x.prototype.onPopOutModeChanged=function(){this.scope.hasPopOut=!!this.services.popOut.getPoppedOutVisualContainer(),this.updateSizeAndFitOption(),this.updateAndApplyCanvasBackground()},x.prototype.onFormFactorChanged=function(){
this.updateSizeAndFitOption(),this.updateLayoutStrategy(),this.updateAndApplyCanvasBackground()},x.prototype.updateAndApplyCanvasBackground=function(){if(this.scope.viewModel){var e=this.scope.viewModel.contract.objects;n.updateAndApplyCanvasBackground(this.scope,this.services.$element,e,this.services.featureSwitchService,this.services.resourceLoader,this.services.explorationNavigation,this.services.promiseFactory,this.services.formFactor,this.scope.displayOptionServices.viewModeState,this.services.canvasScale)}},x.prototype.updateSizeAndFitOption=function(){var e=this.scope.viewModel;e&&(this.scope.applyFitOption(),this.updateSize())},x.prototype.updateLayoutStrategy=function(){var e,i=this.services.formFactor.getCurrentLayout(),r=this.services.formFactor.getCurrentLayoutCapabilities(),o=t.viewModels.VisualContainer.getVisualBodyOffset(r);switch(i){case 1:var n=t.viewModels.FixedPhoneCanvasSettings.phoneGridLayout;e=new s({rows:n.rowCount,cols:n.columnCount,rowSpacing:b,colSpacing:S});break;default:if(this.scope&&this.scope.snapToDotGrid&&this.scope.snapToDotGrid()){var a=void 0,l=void 0,c=this.scope.dotGridViewModel,v=this.scope.canvasLayoutSize;c?(a=c.layoutX,l=c.layoutY):(a=p.getLayoutForScreen(this.uiScale.x*v.width,v.width),l=p.getLayoutForScreen(this.uiScale.y*v.height,v.height));var h={layoutX:a,layoutY:l,offset:o,limits:{left:0,top:0,width:v.width,height:v.height}};e=new d(h)}else e=new u(o)}this.scope.layoutStrategy=e,this.updateGridLayout()},x.prototype.adjustScaleForLayout=function(e){return this.scope.showDotGrid()?p.adjustScaleForGrid(e,this.scope.canvasLayoutSize):e},x.prototype.updateGridLayout=function(){this.model&&(this.updateBoxGridLayout(),this.updateDotGridLayout())},x.prototype.updateDotGridLayout=function(){var e=this.scope.canvasLayoutSize,t=this.scope.dotGridViewModel,i=!t,r=p.getLayoutForScreen(this.uiScale.x*e.width,e.width),o=t&&t.layoutX;i||(i=!p.sameLayout(r,o));var n=p.getLayoutForScreen(this.uiScale.y*e.height,e.height),a=t&&t.layoutY;i||(i=!p.sameLayout(n,a)),i&&(this.scope.dotGridViewModel={layoutX:r,layoutY:n})},x.prototype.updateBoxGridLayout=function(){var e,i=t.viewModels.FixedPhoneCanvasSettings.phoneGridLayout;switch(this.services.formFactor.getCurrentLayout()){case 1:var r={rows:i.rowCount,cols:i.columnCount,rowSpacing:b,colSpacing:S},o=a.getCellSize({width:this.model.width,height:this.model.height},r);e={columnCount:i.columnCount,rowCount:i.rowCount,layout:{horizontal:{margin:S,gutter:S,size:o.width},vertical:{margin:b,gutter:b,size:o.height}}};break;default:e=void 0}this.scope.boxGridLayout=e},x.prototype.autoLayoutVisualVCHeader=function(){return n.getAutoLayoutVisualVCHeader(this.services.formFactor)},x.prototype.updateSize=function(){var e=this.scope.size;if(this.model=this.scope.viewModel,e&&this.model){var t=this.services.canvasScale.getDisplayOption();if(0===t){var i=this.services.viewModeState.getConfig(),r=i.displayOptions.hideTileMenu?e.height:e.height-this.autoLayoutVisualVCHeader(),o=e.width-2*g.ExploreCanvasPadding;this.uiScale={x:o/this.model.width,y:r/this.model.height}}else{var n=this.services.canvasScale.getCanvasScaleFactor();this.uiScale={x:n,y:n}}this.scaleVisualContainersToCanvas(this.uiScale),this.updateCanvasLayoutSize(),this.updateLayoutStrategy()}},x.prototype.updateCanvasLayoutSize=function(){var e=this.scope.viewModel;e?this.scope.canvasLayoutSize={width:e.width,height:e.height}:this.scope.canvasLayoutSize=C,this.updateGridLayout()},x.prototype.scaleVisualContainersToCanvas=function(e){var i=this;if(this.model=this.scope.viewModel,this.model){for(var r=this.model.visualContainers,o=!!this.services.popOut.getPoppedOutVisualContainer(),n=this.services.canvasScale.getDisplayOption(),a=this.scope.viewModel.contract.size&&3!==n&&0!==n,s=0,l=r;s<l.length;s++){var c=l[s];if(c.uiScale=e,c.enableVisualScaling=a,!c.isPositioned){var u=this.getEmptyRawCanvasSpaces();u.z=r.length,this.services.layoutAuthoring.moveVisualContainer(c,u)}o?this.setVisualContainerSizeForPopOutMode(c):this.scope.useResponsiveLayout||(c.overridePosition=null,c.updateViewState()),this.scope.canvasOptions.disableDeferredRendering&&(c.allowDeferredRendering=!1)}if(this.scope.useResponsiveLayout&&!o)for(var p=0,d=_.sortBy(r,(function(e){return e.position.y*i.model.width+e.position.x})),v=0,h=d;v<h.length;v++){var c=h[v],g=c.getScaledPosition();p+=20,c.overridePosition={width:this.scope.size.width-2*t.constants.ExploreCanvasConstants.AutoLayoutVisualSkittlesRightPadding,height:g.height,x:t.constants.ExploreCanvasConstants.AutoLayoutVisualSkittlesRightPadding,y:p},p+=Math.round(g.height),c.updateViewState()}}},x.prototype.setVisualContainerSizeForPopOutMode=function(e){if(e.isPoppedOut){var i=this.services.formFactor.getCurrentLayoutCapabilities(),r=t.viewModels.VisualContainer.getVisualBodyOffset(i),o=this.scope.size.height,n=this.scope.size.width,a=this.services.canvasScale.getDisplayOption();if(0!==a){var s=this.services.canvasScale.getCanvasScaleFactor();o=this.scope.viewModel.height*s-r.height,n=this.scope.viewModel.width*s-r.width}e.overridePosition={width:n,height:o,x:-r.left,y:-r.top},e.updateViewState()}},x.prototype.onSelectionChanged=function(){this.getFocusOnClearSelection(),this.updateZIndexOnSelectionChanged()},x.prototype.onExplorationLoaded=function(){this.updateAndApplyCanvasBackground(),this.applyFitToPageIfAny()},x.prototype.applyFitToPageIfAny=function(){var e=this,t=jsCommon.QueryStringUtil.getQueryStringValue("loadFitToPage");t&&this.services.timeout((function(){e.applyFitOption(1)}),0,!1)},x.prototype.onExplorationUnloaded=function(){this.services.dropdownMenuService.hideMenu(),this.scope.suspendSizeUpdates&&this.scope.suspendSizeUpdates()},x.prototype.isCanvasBackdropVisible=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canShowCanvasBackdrop()},x.prototype.getFocusOnClearSelection=function(){var e=this.services.selection;_.isEmpty(e.getSelectedElements())&&(this.scope.hasFocus=!0)},x.prototype.updateZIndexOnSelectionChanged=function(){this.scope.viewModel&&l.moveSelectedItemToFront(this.scope.viewModel.visualContainers,this.services.selection)},x.prototype.getEmptyRawCanvasSpaces=function(){if(this.scope.size){var e={x:0,y:0,width:this.model.width,height:this.model.height},i=_.map(this.model.visualContainers,(function(e){var t=e.position;return{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height)}})),r=this.services.layoutInsertionHelper.getEmptySpaces(e,i);if(r.length>0){var o=r[0];o.height=Math.min(o.height,t.constants.ExploreCanvasConstants.AutoLayoutMaxSpaceHeight),o.width=Math.min(o.width,t.constants.ExploreCanvasConstants.AutoLayoutMaxSpaceWidth);var a=this.scope.canvasOptions.autoLayoutVisualPadding,s=this.autoLayoutVisualVCHeader();return o.x+=a,o.y+=s,o.width-=2*a,o.height-=2*a,o}}return n.DefaultVisualPosition},x.prototype.drop=function(e,i){var r=this,o=this.services.dragDataService.getDragContext();if(o){var a={left:0,top:0};if(e.target){var s=$(e.target).find(n.VisualContainerHostSelector.selector);s&&(a=s.offset())}var c,u=e.pageX-a.left,p=e.pageY-a.top,d=this.services.canvasScale.getDisplayOption();if(0===d&&(c=this.uiScale),o.field){var v=this.services.formFactor.getCurrentLayoutCapabilities(),g=t.viewModels.VisualContainer.getVisualBodyOffset(v),f=u,m=p;this.services.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()||(m-=g.top);var y=c;if(!y){var w=this.services.canvasScale.getCanvasScaleFactor();y={x:w,y:w}}var C=f/y.x,S=m/y.y;if(h.tryFindChildDropTarget(i.draggable,(function(){return r.getVisualContainerFromCoordinate(C,S)})))return}var b=this.scope.layout.getDropPosition(u,p,c);if(b){var x=n.rectToVisualPosition(b);if(o.field)x.z=l.getZIndexForNewVisual(this.scope.viewModel),this.addVisual(o.field,x);else if(o.source){var M=o.source;this.services.layoutAuthoring.addLayoutToVisualContainer(this.scope.viewModel,M,x)}}}},x.prototype.getVisualContainerFromCoordinate=function(e,t){var i={x:e,y:t},n=this.scope.viewModel.visualContainers,a=_.filter(n,(function(e){return m.containsPoint(r(e),i)}));if(!_.isEmpty(a)){var s=_.max(a,(function(e){return o(e)}));return s.contract}},x.prototype.addVisual=function(t,i){var r=this,o=this.services.dataSources.get();o&&this.services.visualAuthoring.addVisualContainer({expr:t,dataSources:o,allowAggregate:!0},this.scope.viewModel,i).then((function(t){r.services.telemetryService.logEvent(e.telemetry.EXCreateVisual,e.telemetry.HowVisualWasCreated.DraggedToCanvas,w.getVisualType(t))}))},x.prototype.onKeyDown=function(e){return this.services.canvasKeyHandler.onKeyDown(e,this.scope.viewModel)},x.prototype.isNextSection=function(e){var t=e.type===y[y.Left];return t},x.prototype.onClipboardDataUpdated=function(){this.updateCanvasCursor()},x.prototype.updateCanvasCursor=function(){var e=this.services.clipboard.canPasteFormat();this.setCursorClass(e?i.CursorClass.Brush:void 0)},x.prototype.setCursorClass=function(e){this.scope.customCursorClass=e},x.prototype.shouldDisableZoom=function(){return this.viewModeState.getConfig().touchOptions.disableTouchZoom},x.prototype.getClass=function(){var e=["exploreCanvas"];return this.scope.disableAnimations&&e.push("disableAnimations"),this.scope.useResponsiveLayout&&e.push("responsive"),this.scope.hasPopOut&&e.push("popOut"),this.scope.customCursorClass&&e.push(this.scope.customCursorClass),this.shouldDisableZoom()&&e.push("disableTouchZoom"),this.isScrollablePhoneAuthoring()&&e.push("scrollablePhoneAuthoring"),e.join(" ")},x.prototype.canSwipe=function(){var e=this.services.viewModeState.getConfig();return e.touchOptions.isCanvasSwipeable},x.prototype.canPinch=function(){return!(this.viewModeState&&this.viewModeState.getConfig().touchOptions.disableCanvasPinch)},x.prototype.shouldDisableScroll=function(){return this.viewModeState.getConfig().touchOptions.disableCanvasScrollOnSelectedVisual},x})();x.DefaultNoUiScale={x:1,y:1},i.ExploreCanvasController=x})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.models.ArtifactType,o=e.common.models.CollapsiblePaneExpandedWidth,n=e.common.constants,a=e.explore.services.events,s=t.viewModels.ExplorationAppBarViewModelFactory,l=e.common.dialogs.FeatureNotSupportedDialogBuilder,c=e.explore.services.selectionUtils,u=jsCommon.StringExtensions,p=e.common.constants.TaskPaneCollapsiblePaneMode,d=(function(){function i(t,i){var r=this;this.services=i,this.scope=t,this.viewModeState=this.services.viewModeState,this.shapeMenuActions=s.createShapeMenuActions(this.services.localizationService),this.alignActions=s.createAlignmentMenuActions(this.services.localizationService),this.distributeActions=s.createDistributeMenuActions(this.services.localizationService),this.services.featureSwitchService.featureSwitches.pauseQueriesEnabled&&(this.canPause=!0),this.scope.$on("destroy",(function(){r.modalDialogPromise&&r.modalDialogPromise.pending&&r.modalDialogPromise.reject("explorationAppBarController destroyed")})),this.scope.$watch((function(){return r.services.viewModeState.getMode()}),(function(e){r.onViewModeChanged(e)}));var o=this.services.eventBridge.createChannelSubscriptionManager().subscribe(a.popOutModeChanged,(function(){r.isPopOutMode=!!r.services.popOut.getPoppedOutVisualContainer()})).subscribe(a.canvasChanged,(function(){var e=r.services.explorationNavigation.getCurrentSection();r.isTransientPage=e.transient})),n=this.services.rootScope.$on(e.common.constants.onReportChangedEventName,(function(e,t){r.pinnedToReportPage&&(r.pinReportPage(),r.pinnedToReportPage=!1)}));this.scope.$on("$destroy",(function(){o.unsubscribeAll(),n()}))}return i.createOptions=function(){return{additionalServices:["applicationOptions","activeGroupId","dropdown","localizationService","modalDialogService","embedProxy","embed","explorationSerializer","featureSwitchService","errorService","checkUnsavedService","reportTileService","telemetryService","$window","analyzeInExcel","powerBIDesktopLauncher","overlayService","auditing","downloadReport","subscription","userInfo","settingsService","taskPaneSliderService","emailSubscriptionService"],scopedDependencies:["canvasScale","eventBridge","viewModeState","explorationNavigation","explorationCapabilities","popOut","drill","selection","visualAuthoring"]}},i.prototype.onViewModeChanged=function(e){var t=1===e;t?this.scope.$emit("EditMode"):t||(this.scope.$emit("ViewMode"),this.viewModeState.updateConfig((function(e){e.showRelationships&&(e.showRelationships=!1)})))},i.prototype.getMoreOptionsMenuActions=function(){return s.createReportMoreOptionsMenuItems(this.services.localizationService,this.services.analyzeInExcel,this.services.featureSwitchService,this.viewModel.reportPermission,this.canGenerateQR())},i.prototype.isSnapshotAllowed=function(){var e=this.services.featureSwitchService.featureSwitches,t=e.snapshotEmbedEnabled||e.anonymousEmbeddingEnabled,i=this.viewModel,r=i&&i.canEdit&&i.canWrite,o=this.viewModel.exploration,n=o&&o.contract,a=n&&void 0!==n.reportId,s=n&&n.modelExtensions,l=i.datasetModel,c=l&&l.contract,u=l&&l.cloudRlsEnabled,p=c&&c.originalModelId,d=c&&c.onPremModelConnectionString,v=this.services.featureSwitchService.featureSwitches.publishToWebEnabled,h=this.services.activeGroupId.isReadOnly,g=this.services.explorationCapabilities.getCapabilities().disableSnapshot,f=this.isUsageMetricsReport();return t&&!h&&r&&a&&!s&&!p&&!d&&v&&!u&&!g&&!f},i.prototype.isSharePointEmbedAllowed=function(){var e=this.services.explorationCapabilities.getCapabilities(),t=this.services.featureSwitchService.featureSwitches.sharePointEmbedEnabled&&!e.disableSharePointEmbed,i=this.services.userInfo.isPremiumUser,r=this.viewModel.exploration,o=r&&r.contract&&r.contract.report&&void 0!==r.contract.report.objectId;return t&&i&&o&&!this.isUsageMetricsReport()},i.prototype.isExportToPowerPointAllowed=function(){var e=this.services.featureSwitchService.featureSwitches,t=this.services.explorationCapabilities.getCapabilities(),i=e.exportReportToPowerPointEnabled&&e.exportToPowerPointEnabled&&!t.disableExportToPowerPoint,r=this.viewModel.exploration,o=r&&r.contract&&void 0!==r.contract.reportId;return i&&o&&!this.isUsageMetricsReport()},i.prototype.canDuplicatePage=function(){var e=this.viewModeState.getMode();return 1===e&&this.viewModel.canWrite&&!this.isPopOutMode&&!this.isTransientPage},i.prototype.canPinPage=function(){var e=this.viewModel;return e&&e.canWrite&&e.exploration&&e.exploration.contract.reportId&&!this.isTransientPage},i.prototype.pinPageDisabled=function(){var e=this.viewModel;return e&&!e.canCopy&&!e.canEdit},i.prototype.showPinPage=function(){var e=this.services.explorationCapabilities.getCapabilities(),t=!e.disablePin;return t},i.prototype.canGenerateQR=function(){var e=this.services.explorationCapabilities.getCapabilities(),t=!e.disableQRGeneration;return t&&this.viewModel&&this.viewModel.exploration&&void 0!==this.viewModel.exploration.contract.reportId&&!this.isUsageMetricsReport()},i.prototype.getFileMenuActions=function(){for(var e=this.createFileMenuActions(),t=0,i=e;t<i.length;t++){var r=i[t];if(2===r.action&&(r.show=this.isSnapshotAllowed()),3===r.action&&(r.show=this.isSharePointEmbedAllowed()),7===r.action&&(r.show=this.isExportToPowerPointAllowed()),1===r.action){var o=this.viewModel.datasetModel&&this.viewModel.datasetModel.contract&&this.viewModel.datasetModel.contract.contentProviderId;if(o){var n=this.services.localizationService,a=void 0;103===o?a=n.get("ReportAppBar_DashboardsKeyword"):102===o&&(a=n.get("ReportAppBar_ReportsKeyword")),a&&(r.description=n.format("ReportAppBar_SaveAsDescriptionForUsageMetrics",[a]))}}}return e},i.prototype.onEmbed=function(){var i=this.scope.$new(!0),r=this.viewModel.exploration.contract.reportId,o=this.services.explorationNavigation.getCurrentSection(),n=this.viewModel.displayName+" - "+o.displayName,a={reportSections:[o.id]},s={name:n,reportId:r,culture:e.common.cultureInfo,size:{height:this.viewModel.exploration.contract.height,width:this.viewModel.exploration.contract.width},version:e.build,metadata:JSON.stringify(a)},l=this.services.embedProxy.getLiveEmbedsForReport(r);i.viewModel=t.viewModels.ViewModelFactory.createEmbedModalDialog(this.services.localizationService,this.services.embed,this.viewModel.exploration,s,l,this.viewModel.exploration.contract.sections);var c=_.filter(i.viewModel.embedTab.sections,(function(e){return e.contract.name===o.name}))[0];i.viewModel.embedTab.selectedSection=c;var u={containerCssClass:"small embedContainer",dialogCssClass:"embedDialog",dialogName:null,template:"<embed-modal-dialog></embed-modal-dialog>",scope:i};this.services.modalDialogService.showLegacyWebModalDialog(u)},i.prototype.onSharepointEmbed=function(){var i=this.scope.$new(!0),r={name:this.viewModel.displayName,reportId:null,culture:e.common.cultureInfo,size:{height:this.viewModel.exploration.contract.height,width:this.viewModel.exploration.contract.width},version:e.build,metadata:null};i.viewModel=t.viewModels.ViewModelFactory.createSharepointEmbedModalDialog(this.viewModel.exploration,r);var o={containerCssClass:"embedContainer",dialogCssClass:"spEmbedDialog",dialogName:null,template:"<embed-modal-dialog></embed-modal-dialog>",scope:i};this.services.modalDialogService.showLegacyWebModalDialog(o)},i.prototype.insertTextbox=function(){this.services.eventBridge.publishToChannel(a.createTextbox)},i.prototype.showSwitchMode=function(){return!this.services.explorationCapabilities.getCapabilities().disableSwitchMode},i.prototype.showReportMoreOptionsMenu=function(){return!this.services.explorationCapabilities.getCapabilities().disableMoreOptions&&!!this.viewModel.reportPermission},i.prototype.fileMenuActionSelected=function(e){if(!e.disabled)switch(e.action){case 0:this.save();break;case 1:this.saveAs();break;case 2:this.onEmbed();break;case 3:this.onSharepointEmbed();break;case 5:this.print();break;case 6:this.showDiagnosticInfo();break;case 7:this.exportToPowerPoint();break;case 8:this.downloadReport()}},i.prototype.createFileMenuActions=function(){var e=this.services.featureSwitchService.featureSwitches,t=this.viewModeState.getMode(),i=this.services.explorationCapabilities.getCapabilities(),r={localizationService:this.services.localizationService,showSave:!i.disableSave&&1===t,showSaveAs:!i.disableSaveAs&&this.viewModel&&this.viewModel.canEdit,showPrint:e.printingEnabled!==!1&&!i.disablePrint,showEmbed:!1,showSharepointEmbed:!1,showPowerPoint:!1,showDiagnostics:this.services.applicationOptions.diagnostics,showDownloadReport:e.downloadReportEnabled&&e.exportDataEnabled&&this.viewModel&&this.viewModel.canEdit&&!i.disableDownload,canDownloadReport:this.viewModel&&this.viewModel.isReportFromPbix};return s.createFileMenuActions(r)},i.prototype.showDiagnosticInfo=function(){if(this.viewModel.exploration&&this.viewModel.exploration.contract){var e=this.services.rootScope.$new(),t=this.services.explorationSerializer.serializeExploration(this.viewModel.exploration.contract),i=u.stringifyAsPrettyJSON(t),r={dialogName:"",isDismissable:!0,scope:e,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"monotype",notificationText:i};this.services.modalDialogService.showLegacyWebModalDialog(r)}},i.prototype.alignActionSelected=function(e){switch(e.action){case 24:this.align(0);break;case 25:this.align(1);break;case 26:this.align(2);break;case 27:this.align(3);break;case 28:this.align(4);break;case 29:this.align(5)}},i.prototype.distributeActionSelected=function(e){switch(e.action){case 30:this.align(6);break;case 31:this.align(7)}},i.prototype.align=function(e){var t={alignmentType:e};this.services.eventBridge.publishToChannel(a.align,t)},i.prototype.print=function(){window.print(),this.services.telemetryService.logEvent(e.telemetry.DashboardAndReportsPrint,e.telemetry.PrintType.Report);var t=this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.reportId;this.services.auditing.auditEvent(t,e.common.contracts.AuditEntityType.Report,e.common.contracts.AuditActivityType.printReport)},i.prototype.save=function(){var e={overrideSaveRouting:this.services.explorationCapabilities.getCapabilities().overrideSaveRouting};this.services.eventBridge.publishBubbling(this.scope,a.saveExploration,e)},i.prototype.saveAs=function(){var e={overrideSaveRouting:this.services.explorationCapabilities.getCapabilities().overrideSaveRouting,saveAsWithoutPrompt:this.isUsageMetricsReport()};this.services.eventBridge.publishBubbling(this.scope,a.saveAsExploration,e)},i.prototype.refresh=function(){if(this.viewModel.exploration&&this.viewModel.exploration.contract){var t=this.viewModel.exploration.contract;t.report&&this.services.telemetryService.logEvent(e.telemetry.EXRefreshReport,t.report.objectId,t.activeSectionIndex)}this.services.eventBridge.publishBubbling(this.scope,a.refreshExploration)},i.prototype.edit=function(){this.services.eventBridge.publishToChannel(a.requestViewModeChange,1)},i.prototype.stopEditing=function(){this.services.eventBridge.publishToChannel(a.requestViewModeChange,0)},i.prototype.navigateBack=function(){this.services.$window.history.back()},i.prototype.exportToPowerPoint=function(){this.services.eventBridge.publishBubbling(this.scope,a.exportToPowerPoint)},i.prototype.viewMenuActionSelected=function(e){if(null!=e.action)if(13===e.action)this.services.settingsService.setShowGridlines(!this.services.settingsService.getShowGridlines());else if(14===e.action)this.services.settingsService.setSnapToGrid(!this.services.settingsService.getSnapToGrid());else{var t=void 0;switch(e.action){case 9:t=0;break;case 10:t=3;break;case 11:t=2;break;case 12:t=1}this.services.eventBridge.publishToChannel(a.canvasDisplayChanged,t)}},i.prototype.editReportMenuActionSelected=function(e){if(this.services.overlayService.hideAllDropdowns(),!e.disabled)switch(e.action){case 15:this.edit();break;case 16:var t=this.services.activeGroupId.activeGroupObjectId,i=this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.report&&this.viewModel.exploration.contract.report.objectId;t&&i&&this.services.powerBIDesktopLauncher(i,t)}},i.prototype.isEditInDesktopEnabled=function(){return this.services.featureSwitchService.featureSwitches.editInDesktopEnabled},i.prototype.shapeMenuActionSelected=function(e){this.services.eventBridge.publishToChannel(a.createBasicShape,{shapeType:e.param})},i.prototype.togglePlayPause=function(){this.services.eventBridge.publishBubbling(this.scope,a.pauseQueriesChanged)},i.prototype.showRelatedContentPane=function(){var e={id:this.viewModel.exploration.contract.report.objectId,artifactType:r.Report,displayName:this.viewModel.exploration.contract.report.displayName,readOnly:this.viewModel&&!this.viewModel.canCopy&&!this.viewModel.canEdit};this.services.taskPaneSliderService.expandPane(p.RelatedContent,o.Default,e)},i.prototype.showSubscriptionPane=function(){var t=this,i=this.services.explorationNavigation,r=this.viewModel.datasetModel;if(r.getPermissions()===e.common.contracts.Permissions.CopyOnWrite)return void(this.modalDialogPromise=new l(this.services.modalDialogService).show("ModalDialog_EmailSubscriptionUnSupportedContentPackTitle",this.services.featureSwitchService.featureSwitches.appsEnabled?"ModalDialog_EmailSubscriptionUnSupportedContentPackOrAppMessage":"ModalDialog_EmailSubscriptionUnSupportedContentPackMessage","https://go.microsoft.com/fwlink/?linkid=836808"));var o=i.getCurrentExploration();o.report?this.services.subscription.expandPaneForReportSubscription({currentSection:i.getCurrentSection(),report:o.report,sections:o.sections,modelId:o.dataSources[0].id}):i.getCurrentExplorationAsync().then((function(e){t.services.subscription.expandPaneForReportSubscription({currentSection:i.getCurrentSection(),report:e.report,sections:o.sections,modelId:o.dataSources[0].id})}))},i.prototype.isEmailSubscriptionEnabled=function(){return!(1===this.viewModeState.getMode()||!this.services.featureSwitchService.featureSwitches.emailSubscriptionEnabled)&&!this.isUsageMetricsReport()&&this.services.emailSubscriptionService.supportsEmailSubscription},i.prototype.isViewRelatedContentEnabled=function(){var e=this.services.explorationCapabilities.getCapabilities(),t=!e.disableViewRelatedContent;return 1!==this.viewModeState.getMode()&&t&&!this.isUsageMetricsReport()},i.prototype.canOpenEditReport=function(){return this.showSwitchMode()&&!this.viewModeState.getMode()&&this.viewModel.canEdit&&!this.isEditInDesktopEnabled()&&!this.isUsageMetricsReport()},i.prototype.showEditReportDisabled=function(){return 0===this.viewModeState.getMode()&&(this.viewModel.canEdit===!1||this.viewModel.canCopy)&&!this.isUsageMetricsReport()},i.prototype.canOpenUsageMetricsReport=function(){return this.services.featureSwitchService.featureSwitches.usageMetricsEnabled&&this.services.userInfo.isPremiumUser&&this.viewModel.canEdit&&!this.isUsageMetricsReport()&&0===this.viewModeState.getMode()},i.prototype.openUsageMetricsReport=function(){var t=this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.report;this.services.rootScope.$emit(e.common.constants.openUsageMetricsReport,t,this.services.activeGroupId.activeGroupObjectId)},i.prototype.showPinReportPageDialog=function(){var t=this;if(this.viewModel.canCopy)return void this.scope.$emit(e.common.constants.onReportPersonalizedEventName,this.viewModel.exploration.contract.reportId);if(1===this.viewModeState.getMode()&&this.services.checkUnsavedService.userHasUnsavedWork){var i=this.services.errorService.control(),r=this.services.localizationService.get("PinLiveReport_UnsavedTitle"),o=this.services.localizationService.get("PinLiveReport_UnsavedChangesMessage"),n=[new InJs.ModalDialogAction(this.services.localizationService.get("PinLiveReport_SaveAndPin"),function(e,r){t.save(),i.hideDialog(),t.pinnedToReportPage=!0}),new InJs.ModalDialogAction(this.services.localizationService.get("PinLiveReport_GoBack"),function(e,t){i.hideDialog()})];i.showPrompt(r,o,n,!0)}else this.pinReportPage()},i.prototype.pinReportPage=function(){var t=this.services.explorationNavigation.getCurrentSection();if(t){var i={exploration:this.viewModel.exploration,section:t,reportId:this.viewModel.exploration.contract.reportId,modelId:this.viewModel.datasetModel.id,packageId:this.viewModel.datasetModel.packageId};this.services.rootScope.$emit(e.common.constants.pinReportPageToDashboard,i)}},i.prototype.duplicateReportPage=function(){var e=this.services.explorationNavigation.getCurrentSection(),i=t.SectionUtils.findSectionIndexForSection(this.viewModel.exploration.contract,e);this.services.eventBridge.publishToChannel(a.duplicateSection,i)},i.prototype.showDatasetErrorDetails=function(){if(this.viewModel.datasetModel){var e=this.services.localizationService;this.services.errorService.error(e.get("InternalSystemErrorMessage"),"ExplorationAppBar_DatasetError",{title:e.get("InternalSystemErrorTitle")})}},i.prototype.toggleVisualInteractions=function(){this.services.eventBridge.publishToChannel(a.visualRelationshipsModeChanged)},i.prototype.reportMoreOptionsMenuSelected=function(t){switch(t.action){case 32:this.services.telemetryService.logEvent(e.telemetry.DashboardAndReportsAnalyzeInExcel,"Report More Options Menu",this.viewModel.datasetModel.contentProviderId,this.viewModel.datasetModel.contract.modelFeatures,this.viewModel.datasetModel.dbName),this.services.analyzeInExcel.startAnalyzeInExcel(this.viewModel.datasetModel);var i=this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.reportId;this.services.auditing.auditEvent(i,e.common.contracts.AuditEntityType.Report,e.common.contracts.AuditActivityType.analyzeReport);break;case 34:this.services.eventBridge.publishBubbling(this.scope,a.generateReportQR);break;case 33:this.services.eventBridge.publishBubbling(this.scope,a.exportAsImage)}},i.prototype.exploreMenuActionSelected=function(e){if(!e.disabled)switch(e.action){case 17:this.toggleSeeDataMode();break;case 18:this.drillDownLevel(3);break;case 19:this.drillDownLevel(2);break;case 20:this.drillUp();break;case 21:this.setDrillMode(1);break;case 22:this.setDrillMode(2)}},i.prototype.isUsageMetricsReport=function(){var e=this.viewModel.datasetModel&&this.viewModel.datasetModel.contract&&this.viewModel.datasetModel.contract.contentProviderId;return n.isUsageMetricsContentProvider(e)},i.prototype.getExploreMenuActions=function(){for(var e=s.createExploreMenuActions(this.services.localizationService),t=this.getSelectedVisual(),i=this.services.explorationCapabilities.getCapabilities().disableExploreActions,r=0,o=e;r<o.length;r++){var n=o[r];switch(n.action){case 17:var a=this.services.popOut.getPoppedOutVisualContainer();n.selected=a&&2===a.popOutMode,n.disabled=i||!this.services.drill.canSeeData(t);break;case 18:n.disabled=i||!this.services.drill.canDrillByDirection(t,4);break;case 19:n.disabled=i||!this.services.drill.canDrillByDirection(t,2);break;case 21:var l=this.services.drill.isDrillModeEnabled(t,1);n.selected=l;var c=this.services.drill.canDrillByDirection(t,4),u=this.services.drill.canDrillByDirection(t,1);n.disabled=i||!c&&!u;break;case 20:n.disabled=i||!this.services.drill.canDrillByDirection(t,1);break;case 22:var p=this.services.drill.isDrillModeEnabled(t,2);n.selected=i||p,n.disabled=i||!this.services.drill.canDrillToDetails(t)}}return e},i.prototype.toggleSeeDataMode=function(){var e=this.services.popOut.getPoppedOutVisualContainer()||this.getSelectedVisual();if(e){var t=e.popOutMode;2===t?this.services.popOut.clearPopOut():this.services.popOut.popOutVisualContainer(e,2)}},i.prototype.drillUp=function(){this.services.visualAuthoring.drillUp(null,this.getSelectedVisual())},i.prototype.drillDownLevel=function(e){this.services.visualAuthoring.drillDownLevel(null,this.getSelectedVisual(),e)},i.prototype.setDrillMode=function(e){var t=this.getSelectedVisual();if(t){var i=t.drillMode,r=i===e?0:e;this.services.drill.setDrillMode(t,r)}},i.prototype.getFileMenuProperties=function(e){return{displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:this.getFileMenuActions(),menuActionSelected:this.fileMenuActionSelected,templateName:"appBarFileMenu.html"}},i.prototype.getViewMenuProperties=function(e){return{displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:this.getViewMenuActions(),menuActionSelected:this.viewMenuActionSelected,templateName:"appBarViewMenu.html"}},i.prototype.getEditReportMenuProperties=function(e){return{displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:this.getEditReportMenuActions(),menuActionSelected:this.editReportMenuActionSelected,templateName:"appBarEditReportMenu.html"}},i.prototype.getExploreMenuProperties=function(e){return{displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:this.getExploreMenuActions(),menuActionSelected:this.exploreMenuActionSelected,templateName:"appBarExploreMenu.html"}},i.prototype.getMoreOptionsMenuProperties=function(e){return{displayOptions:{anchorElement:e,blurNeeded:!1,preferLeft:!0},menuActions:this.getMoreOptionsMenuActions(),menuActionSelected:this.reportMoreOptionsMenuSelected,templateName:"appBarMoreOptionsMenu.html"}},i.prototype.showMenu=function(e,t){var i=this,r=this.services.dropdown,o=function(t,i){t(i),r.hideAll(),e.stopPropagation()},n=t.bind(this)($(e.currentTarget)),a={menuActionSelected:function(e){return o(n.menuActionSelected.bind(i),e)},getMenuActions:function(){return n.menuActions},getMode:function(){return i.viewModeState.getMode()}};r.showMenu(a,n.templateName,n.displayOptions)},i.prototype.getSelectedVisual=function(){return c.getSelectedVisual(this.services.selection)},i.prototype.getDisplayOption=function(){return this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.exploreCanvas&&this.viewModel.exploration.exploreCanvas.contract&&this.viewModel.exploration.exploreCanvas.contract.size&&this.viewModel.exploration.exploreCanvas.contract.size.displayOption;
},i.prototype.getViewMenuActions=function(){for(var e=this.getDisplayOption(),t=s.createViewMenuActions(this.services.localizationService,this.services.settingsService,1===this.viewModeState.getMode(),this.getDisplayOption()),i=0,r=t;i<r.length;i++){var o=r[i];9===o.action&&(o.selected=0===e),12===o.action&&(o.selected=1===e),11===o.action&&(o.selected=2===e),10===o.action&&(o.selected=3===e),13===o.action&&(o.checked=this.services.settingsService.getShowGridlines()),14===o.action&&(o.checked=this.services.settingsService.getSnapToGrid())}return t},i.prototype.getEditReportMenuActions=function(){return s.createEditReportMenuActions(this.services.localizationService,this.viewModel&&this.viewModel.isReportFromPbix)},i.prototype.downloadReport=function(){var e=this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.report;if(e){var t=e.objectId,i=e.displayName;if(t&&i){var r={id:t,filename:u.normalizeFileName(i)};this.services.downloadReport.downloadReport(r)}}},i})();i.ExplorationAppBarController=d})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.explore.services.SectionNavigationAction,n=(function(){function i(t,i){var n=this;this.scope=t,this.services=i,this.services.eventBridge.setBubblingScope(t).subscribe(r.switchSection,(function(e,t){return n.onSwitchSection(e,t)})).subscribe(r.reorderSection,(function(e,t){return n.onReorderSection(e,t)})).subscribe(r.visualConversion,(function(e,t){return n.onVisualConversion(t)})).subscribe(r.undo,(function(e,t){return i.undoRedo.undo()})).subscribe(r.redo,(function(e,t){return i.undoRedo.redo()}));var a=this.services.rootScope.$on(e.explore.constants.explorationNextPageEvent,(function(e,t){return void 0===t&&(t=o.Unknown),n.switchToAdjacentSection(!0,t)})),s=this.services.rootScope.$on(e.explore.constants.explorationPreviousPageEvent,(function(e,t){return void 0===t&&(t=o.Unknown),n.switchToAdjacentSection(!1,t)})),l=this.services.rootScope.$on(e.explore.constants.deleteSectionEvent,(function(e,t){return n.onDeleteSection(e,t)})),c=this.services.rootScope.$on(e.explore.constants.insertSectionEvent,(function(e,t){return n.onInsertSection(e,t)})),u=this.services.rootScope.$on(e.explore.constants.switchSectionEvent,(function(e,t){return n.onSwitchSection(e,t)})),p=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.podParameterChanged,(function(e,t){return n.onPodParameterChanged(t)})).subscribe(r.createSection,(function(e,t){return n.onCreateSection(e,t)})).subscribe(r.duplicateSection,(function(e,t){return n.onDuplicateSection(e,t)})).subscribe(r.deleteSection,(function(e,t){return n.onDeleteSection(e,t)}));t.$on(e.common.constants.scopeDestroyEventName,(function(){a(),s(),l(),c(),u(),p.unsubscribeAll()}))}return i.createOptions=function(){return{additionalServices:["explorationSerializer","linguisticSchemaProxy","localizationService","telemetryService","featureSwitchService"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","formFactor","selection","undoRedo","visualAuthoring","visualPlugin"]}},i.prototype.switchToAdjacentSection=function(e,i){if(void 0===i&&(i=o.Unknown),this.scope.viewModel.exploration){var r=this.scope.viewModel.sectionStatus&&this.scope.viewModel.sectionStatus.currentSectionNumber;if(null==r)return;var n=r+(e?1:-1),a=this.scope.viewModel.exploration.sections.length;(n<0||n===a)&&(n=a-Math.abs(n)),t.SectionUtils.gotoSection(this.scope.viewModel,n,this.services.selection,this.services.explorationNavigation,this.services.formFactor.getCurrentLayout(),i)}},i.prototype.onSwitchSection=function(e,i){if(this.scope.viewModel.exploration){for(var r=this.scope.viewModel.exploration.sections,o=!0,n=0,a=r.length;n<a;n++)this.scope.viewModel.exploration.sections[n].selected===!0&&n===i&&(o=!1);o&&t.SectionUtils.gotoSection(this.scope.viewModel,i,this.services.selection,this.services.explorationNavigation,this.services.formFactor.getCurrentLayout())}e.stopPropagation&&e.stopPropagation()},i.prototype.onCreateSection=function(e,i){var r=this;this.scope.viewModel.exploration&&(this.services.undoRedo.register("CreateSection",(function(){var e=i?i.size:void 0;t.SectionUtils.createSection(r.scope.viewModel,r.services.selection,r.services.explorationNavigation,r.services.localizationService,e)})),e.stopPropagation&&e.stopPropagation())},i.prototype.onDuplicateSection=function(e,i){var r=this;this.scope.viewModel.exploration&&(this.services.undoRedo.register("DuplicateSection",(function(){var e=r.scope.viewModel,o=t.SectionUtils.duplicateSection(e,i,r.services.localizationService,r.services.telemetryService,r.services.visualPlugin);t.PodUtils.duplicatePod(e.exploration.contract,o,i,r.services.linguisticSchemaProxy).then((function(){t.SectionUtils.insertSection(e,o,r.services.selection,r.services.explorationNavigation)}))})),e.stopPropagation&&e.stopPropagation())},i.prototype.onDeleteSection=function(e,i){var r=this;if(this.scope.viewModel.exploration){var o=this.scope.viewModel.exploration.contract;this.services.undoRedo.register("DeleteSection",(function(){t.PodUtils.deletePod(o,o.sections[i].name,r.services.linguisticSchemaProxy),t.SectionUtils.deleteSection(r.scope.viewModel,i,r.services.selection,r.services.explorationNavigation)}))}e.stopPropagation&&e.stopPropagation()},i.prototype.onInsertSection=function(e,i){var r=this;this.scope.viewModel.exploration&&(this.services.undoRedo.register("InsertSection",(function(){t.SectionUtils.insertSection(r.scope.viewModel,i,r.services.selection,r.services.explorationNavigation)})),e.stopPropagation&&e.stopPropagation())},i.prototype.onReorderSection=function(e,i){var r=this;this.services.undoRedo.register("ReorderSection",(function(){return t.SectionUtils.reorderSection(r.scope.viewModel,i.originalIndex,i.targetIndex)})),this.scope.$apply()},i.prototype.onVisualConversion=function(e){var t=this;this.services.undoRedo.register("VisualConversion",(function(){return t.services.visualAuthoring.convert(e.visualContainer,t.services.dataSources.get(),e.newVisualType).then((function(){e.actionAfterConversion&&e.actionAfterConversion()}))}))},i.prototype.onPodParameterChanged=function(e){var i=this,r=this.scope.viewModel.exploration.contract;if(r){var o=this.services.explorationNavigation.getCurrentSection();this.services.undoRedo.register("PodParameterChanged",(function(){switch(e.type){case 0:t.PodUtils.addParameter(r,o.name,e.filterName);break;case 1:case 2:t.PodUtils.deleteParameter(r,o.name,e.filterName,i.services.linguisticSchemaProxy)}}))}},i})();i.ExplorationHostController=n})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.services.events,r=(function(){function e(e,t){var i=this;this.scope=e,this.services=t,this.scope.prev=function(){return i.prev()},this.scope.next=function(){return i.next()},this.scope.getSelectedPageIndex=function(){return i.getSelectedPageIndex()}}return e.createOptions=function(){return{scopedDependencies:["eventBridge"]}},e.prototype.prev=function(){var e=this.getSelectedPageIndex();if(void 0!==e){var t=e-1;t>-1&&this.services.eventBridge.publishBubbling(this.scope,i.switchSection,t)}},e.prototype.next=function(){var e=this.getSelectedPageIndex();if(void 0!==e){var t=e+1;t<this.scope.viewModel.exploration.sections.length&&this.services.eventBridge.publishBubbling(this.scope,i.switchSection,t)}},e.prototype.getSelectedPageIndex=function(){if(this.scope.viewModel.exploration)for(var e=this.scope.viewModel.exploration.sections,t=e.length-1;t>=0;--t)if(e[t].selected)return t},e})();t.ExplorationPaginatorController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.data.FieldExprPattern,n=e.explore.util.HierarchyUtils,a=e.explore.util.ModelAuthoringUtility,s=t.services.selectionUtils,l=(e.data.SQColumnRefExpr,e.data.SQExpr),c=e.data.SQExprBuilder,u=e.data.SQExprConverter,p=jsCommon.StringExtensions,d=(function(){function i(e,i){var o=this;this.scope=e,this.services=i,this.scope.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.scope.$on(t.constants.explorationLoadedEventName,(function(){return o.explorationLoaded()}));var n=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.modelChanged,(function(e,t){return o.explorationLoaded(t)})).subscribe(r.selectionChanged,(function(){return o.updateChecked()})).subscribe(r.visualContainerChanged,(function(){return o.updateChecked()})).subscribe(r.selectionChanged,(function(){return o.unselect()})).subscribe(r.modelingContextChanged,(function(){return o.unselect()}));this.services.eventBridge.subscribeToBubbling(e,t.viewModels.FieldListEvents.fieldListAction,(function(e,t){return o.processFieldListAction(e,t)})),this.scope.$on("$destroy",(function(){return n.unsubscribeAll()})),this.scope.unselect=function(){return o.unselect()},this.scope.onSearchStringChanged=function(){return o.onSearchStringChanged()},this.scope.showContextMenu=function(e){return o.showContextMenu(e)},this.explorationLoaded()}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dropdown","errorService","featureSwitchService","modalDialogService","promiseFactory","$timeout"],scopedDependencies:["dataSources","eventBridge","groupingDesignStateService","groupAuthoring","lazyScoped","modelAuthoring","modelChangeHandler","quickCalcService","selection","shell","schemaItemActivation","visualAuthoring","visualPlugin"]}},i.prototype.onDestroy=function(){this.modalDialogPromise&&this.modalDialogPromise.pending&&this.modalDialogPromise.reject("fieldListController destroyed")},i.prototype.explorationLoaded=function(e){var t=this,i=this.services.dataSources.get();return i?void this.services.conceptualSchemaProxy.get(i).then((function(r){return t.loadModel(r,i,e)}),(function(){return t.clearModel()})):void this.clearModel()},i.prototype.clearModel=function(){this.loadModel(null)},i.prototype.loadModel=function(e,i,r){var n=this,a=this.services.featureSwitchService.featureSwitches.showNonUserEntitiesEnabled,s=this.scope.fieldListConfig.disableEditing;this.scope.viewModel=t.viewModels.FieldListViewModelMerger.mergeModel(this.scope.viewModel,e,this.scope.fieldListConfig.viewModelFactory,r,a,s);var l=this.getConceptualModel();l&&(l.showHidden=this.services.shell.canShowHiddenSchemaItem(),l.showCheckboxes=this.services.shell.canToggleSchemaItems()),this.updateChecked(),this.updateUnsupportedProperties();var c=t.viewModels.FieldListViewModelOperations.applyModelChanges(l,this.services.schemaItemActivation,r);if(c){var u=o.toFieldExprEntityItemPattern(c),p=c.column||c.columnAggr||c.groupingColumn||c.groupingColumnAggr||c.measure,d=p?p.name:void 0;this.services.$timeout((function(){return n.scope.scrollToItem(u.entity,d)}),0,!1)}},i.prototype.updateUnsupportedProperties=function(){var e=this.getConceptualModel();e&&t.viewModels.FieldListViewModelOperations.updateSupportedProperties(e)},i.prototype.updateChecked=function(){var e=this.getConceptualModel();if(e){for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.hasCheckedProperties=!1;for(var n=0,a=r.properties;n<a.length;n++){var c=a[n];c.checked=!1,c.hasCheckedChildren=!1}}var p=s.getSelectedVisual(this.services.selection);if(p&&p.config.singleVisual&&p.config.singleVisual.query&&p.config.singleVisual.query.defn)for(var d=p.config.singleVisual.query.defn.select(),v=0,h=d;v<h.length;v++){var c=h[v];if(!l.isTransformOutputRoleRef(c.expr)){var g=u.asFieldPattern(c.expr),f=o.toFieldExprEntityItemPattern(g);if(g){var m=g.hierarchyLevel||g.hierarchyLevelAggr;if(m){var y=e.findHierarchies(f.entity,m.name,m.schema);if(y)for(var w=0,C=y;w<C.length;w++){var S=C[w];S.checked=!0,S.entity.hasCheckedProperties=!0,this.updateCheckedStateForAncestors(S);for(var b=0,x=S.hierarchyLevels;b<x.length;b++){var M=x[b];M.name===m.level&&(M.checked=!0,this.updateCheckedStateForAncestors(M))}}}else{var E=g.columnHierarchyLevelVariation?g.columnHierarchyLevelVariation.source.name:o.getPropertyName(g),D=e.findFields(f.entity,E,f.schema)||e.findKpiMeasures(f.entity,E,f.schema);if(D)for(var F=0,V=D;F<V.length;F++){var I=V[F];I.checked=!0,I.entity.hasCheckedProperties=!0,this.updateCheckedStateForAncestors(I)}}}}}}},i.prototype.updateCheckedStateForAncestors=function(e){e&&e.parent&&(e.parent.hasCheckedChildren=!0,this.updateCheckedStateForAncestors(e.parent))},i.prototype.unselect=function(){if(!this.scope.fieldListConfig.alwaysHasActiveItem){var e=this.getConceptualModel();if(!e)return;for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.selected=!1;for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];a.selected=!1}}this.services.schemaItemActivation.clearActiveItem()}},i.prototype.showContextMenu=function(e){var t=this.getConceptualModel().getMenuItems();this.services.dropdown.showContextMenu(t,{x:e.pageX,y:e.pageY},this.onMenuItemSelected.bind(this),!1)},i.prototype.onMenuItemSelected=function(e){var t;switch(e.action){case 2:t=1;break;case 3:t=2;break;case 14:t=15;break;case 15:t=16;break;default:return}var i={action:t};this.processFieldListAction(null,i)},i.prototype.processFieldListAction=function(e,i){var r,s=this.getConceptualModel();if(s){var l,p;i.fieldExpr&&(p=u.asFieldPattern(i.fieldExpr),l=o.toFieldExprEntityItemPattern(p));var d=s.name;switch(s.canEdit||(d=t.constants.ExplorationSchemaName),i.action){case 0:var v=t.viewModels.FieldListViewModelOperations.toggleHide(s,i.fieldExpr);v&&!s.showHidden&&this.unselect(),a.hide(i.fieldExpr,v,this.services.modelAuthoring);break;case 4:a.deleteItem(i.fieldExpr,this.services.modelAuthoring);var h=t.ScopeUtils.getSchemaPromise(this.services.dataSources.get(),this.services.promiseFactory,this.services.conceptualSchemaProxy);this.services.groupAuthoring.telemetry.logGroupsDeleteTelemetry(h,i.fieldExpr,this.services.groupingDesignStateService);break;case 5:r=n.findHierarchyLevelIndex(s.contract,i.fieldExpr),null!=r&&a.move(i.fieldExpr,r-1,this.services.modelAuthoring);break;case 6:r=n.findHierarchyLevelIndex(s.contract,i.fieldExpr),null!=r&&a.move(i.fieldExpr,r+1,this.services.modelAuthoring);break;case 1:t.viewModels.FieldListViewModelOperations.toggleShowHidden(s),this.services.shell.setShowHiddenSchemaItem(s.showHidden);break;case 2:t.viewModels.FieldListViewModelOperations.unhideAll(s);var g=c.entity(d,"");a.hide(g,!1,this.services.modelAuthoring);break;case 7:a.createMeasure(c.entity(d,l.entity),this.services.modelAuthoring);break;case 8:a.createHierarchy([i.fieldExpr],this.services.modelAuthoring);break;case 9:a.createHierarchyLevel(i.fieldExpr,i.newHierarchyLevel.hierarchy,i.newHierarchyLevel.index,this.services.modelAuthoring);break;case 10:a.createCalculatedColumn(c.entity(s.name,l.entity),this.services.modelAuthoring);break;case 11:this.showGroupsDialog(i.property,!0);break;case 12:this.showGroupsDialog(i.property,!1);break;case 13:this.showEditClusteringDialogAsync(p);break;case 14:this.showQuickCalcDialog(i.fieldExpr);break;case 15:t.viewModels.FieldListViewModelOperations.collapseOrExpandAllEntities(s,!1);break;case 16:t.viewModels.FieldListViewModelOperations.collapseOrExpandAllEntities(s,!0)}e&&e.stopPropagation&&e.stopPropagation()}},i.prototype.onSearchStringChanged=function(){var e=this.getConceptualModel();if(e){var t=_.trim(this.scope.searchString);if(_.isEmpty(t))for(var i=0,r=e.entities;i<r.length;i++){var o=r[i];o.isShownInSearch=void 0;for(var n=0,a=o.properties;n<a.length;n++){var s=a[n];s.isShownInSearch=void 0}}else for(var l=0,c=e.entities;l<c.length;l++){for(var o=c[l],u=p.containsIgnoreCase(o.displayName,t),d=0,v=o.properties;d<v.length;d++){var s=v[d];s.isShownInSearch=this.isSearchHit(s,t)||u,2===s.fieldType&&this.setHierarchyShownInSearch(s,t)}o.isShownInSearch=u||_.any(o.properties,(function(e){return e.isShownInSearch}))}}},i.prototype.setHierarchyShownInSearch=function(e,t){for(var i=0,r=e.hierarchyLevels;i<r.length;i++){var o=r[i];o.isShownInSearch=this.isSearchHit(o,t)||e.isShownInSearch}e.isShownInSearch=_.any(e.hierarchyLevels,(function(e){return e.isShownInSearch}))},i.prototype.showGroupsDialog=function(e,t){var i={schema:e.entity.contractSchema.name,entity:e.entity.name,name:t?null:e.name,sourcePropertyName:t?e.name:null,valueType:e.type,groupingMetadata:t?null:e.contract.column.groupingMetadata};this.services.groupAuthoring.dialog.showDialog(i)},i.prototype.showEditClusteringDialogAsync=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.services.lazyScoped("clustering")];case 1:return e=i.sent(),this.modalDialogPromise=e.editClustering(t,this.services.dataSources.get()),[2]}}))}))},i.prototype.showQuickCalcDialog=function(e){this.modalDialogPromise=this.services.quickCalcService.createQuickCalc(e)},i.prototype.getConceptualModel=function(){return this.scope.viewModel&&this.scope.viewModel.schema},i.prototype.isSearchHit=function(e,i){return t.viewModels.FieldListUtils.isFieldVisible(e)&&p.containsIgnoreCase(e.displayName,i)},i})();i.FieldListController=d})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.explore.util.FieldListActionEventPublisher,n=e.explore.util.ModelAuthoringUtility,a=t.services.schemaItemActivationUtils,s=(function(){function i(i,r){var n=this;this.scope=i,this.services=r,this.scope.toggle=function(e){return n.toggle(e)},this.scope.select=function(){return n.select()},this.scope.editLabel=function(){return n.editLabel()},this.scope.rename=function(e){return n.rename(e)},this.scope.isNameValid=function(e){return n.isNameValid(e)},this.scope.filterProperties=function(t){return e.explore.viewModels.FieldListUtils.isFieldVisible(t)},this.scope.showContextMenu=function(e){return n.showContextMenu(e)},this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){n.scope.viewModel.isEditingLabel=!1})),this.fieldListActionEventPublisher=new o(this.scope,this.services.eventBridge),this.scope.tooltipConfigManager={getTooltipConfig:function(){return{tooltipTitle:n.getTooltipTitle()}}};var a=this.services.eventBridge.createChannelSubscriptionManager().subscribe(t.services.events.schemaItemActivationChanged,(function(){return n.schemaItemActivationChanged()}));this.scope.$on("$destroy",(function(){return a.unsubscribeAll()}))}return i.createOptions=function(){return{additionalServices:["dropdown","featureSwitchService"],scopedDependencies:["eventBridge","modelAuthoring","schemaItemActivation","shell"]}},i.prototype.toggle=function(e){var t=this.scope.viewModel;t.expanded=!t.expanded,this.select(),e.stopPropagation()},i.prototype.getTooltipTitle=function(){var e=this.scope.viewModel;return e.errorMessage?e.errorMessage:e.displayName},i.prototype.select=function(){var i=this.scope.viewModel.canEdit||this.services.featureSwitchService.featureSwitches.reportMeasures&&this.scope.viewModel.contractSchema.capabilities.isExtendable;if(i){var r=this.scope.viewModel,o=e.data.SQExprBuilder.entity(r.schema.name,r.name);a.setActiveSchemaItem(this.services.schemaItemActivation,o),t.viewModels.FieldListViewModelOperations.clearSelection(r.schema),r.selected=!0}},i.prototype.editTable=function(){var t=this.scope.viewModel,i=e.data.SQExprBuilder.entity(t.schema.name,t.name);this.services.shell.showEditQueriesEditor(i.entity)},i.prototype.fieldExpr=function(){var t=this.scope.viewModel;return e.data.SQExprBuilder.entity(t.contractSchema.name,t.name)},i.prototype.selectMenuItem=function(e){switch(e.action){case 4:this.editLabel();break;case 1:this.fieldListActionEventPublisher.toggleHidden(this.fieldExpr());break;case 5:this.fieldListActionEventPublisher.delete(this.fieldExpr());break;case 2:this.fieldListActionEventPublisher.viewHidden();break;case 3:this.fieldListActionEventPublisher.unHideAll();break;case 10:this.fieldListActionEventPublisher.addMeasure(this.fieldExpr());break;case 11:this.fieldListActionEventPublisher.addHierarchy(this.fieldExpr());break;case 13:this.fieldListActionEventPublisher.addColumn(this.fieldExpr());break;case 14:this.fieldListActionEventPublisher.collapseAll();break;case 15:this.fieldListActionEventPublisher.expandAll();break;case 6:n.refreshEntity(this.fieldExpr(),this.services.modelAuthoring);break;case 9:this.editTable();break;case 20:this.services.eventBridge.publishToChannel(r.copyTable,this.scope.viewModel.name)}},i.prototype.showContextMenu=function(e){e.stopPropagation(),this.services.dropdown.showContextMenu(this.scope.viewModel.getMenuItems(),{x:e.pageX,y:e.pageY},this.selectMenuItem.bind(this),!1)},i.prototype.editLabel=function(){this.scope.viewModel.canEdit&&(this.scope.viewModel.isEditingLabel=!0,this.scope.toggleDraggable(!1))},i.prototype.rename=function(e){this.scope.toggleDraggable(!1),this.isNameValid(e)&&n.rename(this.fieldExpr(),e,this.services.modelAuthoring)},i.prototype.isNameValid=function(e){var t=this.scope.viewModel;if(!t.schema)return!0;var i=e!==this.scope.viewModel.name,r=jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e);return i&&!r},i.prototype.schemaItemActivationChanged=function(){var e=this.services.schemaItemActivation.getActiveItem();this.scope.viewModel.selected=e&&e.entity===this.scope.viewModel.name&&e.schema===this.scope.viewModel.schema.name},i})();i.FieldListEntityController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.util.DragDropTypes,o=e.explore.services.events,n=e.explore.util.FieldListActionEventPublisher,a=t.util.HierarchyUtils,s=e.explore.util.ModelAuthoringUtility,l=t.services.schemaItemActivationUtils,c=t.services.selectionUtils,u=jsCommon.StringExtensions,p=e.data.SQExpr,d=e.data.SQExprConverter,v=0,h=(function(){function i(i,o){var a=this;this.scope=i,this.services=o,o.featureSwitchService.featureSwitches.hierarchyAuthoringEnabled&&o.featureSwitchService.featureSwitches.hierarchyDragDrop&&(this.dropConfig={accept:r.Field,greedy:!1}),this.services.localizationService.ensureLocalization((function(){a.tooltipConfigManager={getTooltipConfig:function(){return{tooltipDisable:a.viewModel.isEditingLabel,tooltipTitle:a.getTooltipTitle()}}}})),this.elementId=this.createUniqueId();var s=this.scope.$watch((function(){return a.viewModel}),(function(e){a.fieldListExprGenerator=t.util.createFieldListExprGenerator(a.getExprKind(a.viewModel),a.services.groupingDesignStateService),s()})),l=this.services.eventBridge.createChannelSubscriptionManager().subscribe(t.services.events.selectionChanged,(function(){return a.updateSelection()})).subscribe(t.services.events.schemaItemActivationChanged,(function(){return a.schemaItemActivationChanged()}));this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){a.viewModel.isEditingLabel=!1})),this.scope.$on("$destroy",(function(){return l.unsubscribeAll()})),this.updateSelection(),this.fieldListActionEventPublisher=new n(this.scope,this.services.eventBridge)}return i.createOptions=function(){return{additionalServices:["dragDataService","dropdown","featureSwitchService","localizationService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","groupingDesignStateService","schemaItemActivation","explorationNavigation","selection","visualAuthoring","modelAuthoring"]}},i.prototype.drop=function(e,t,i){var r=this.services.dragDataService.getDragContext();if(r&&r.field){var o=r.field,n=this.fieldExpr();if(p.isColumn(o))p.isColumn(n)?s.createHierarchy([n,o],this.services.modelAuthoring):p.isHierarchy(n)&&s.createHierarchyLevel(o,n.hierarchy,void 0,this.services.modelAuthoring);else if(p.isHierarchyLevel(o)&&p.isHierarchy(n))s.move(o,0,this.services.modelAuthoring);else if(p.isHierarchyLevel(o)&&p.isHierarchyLevel(n)){var l=a.findHierarchyLevelIndex(this.viewModel.entity.schema.contract,o),c=a.findHierarchyLevelIndex(this.viewModel.entity.schema.contract,n),u=l>c?c:c-1;3===i&&(u+=1),s.move(o,u,this.services.modelAuthoring)}}},i.prototype.canCreateHierarchyLevelFromColumn=function(t,i){if(p.isEntity(t.arg)&&p.equals(t.arg,i.source)){var r=e.data.SQExprConverter.asFieldPattern(t),o=e.data.FieldExprPattern.toFieldExprEntityItemPattern(r),n=this.viewModel.entity.findHierarchies(t.hierarchy,o.schema);if(!_.isEmpty(n)){var a=_.first(n),s=a.hierarchyLevels,l=i.ref,c=_.find(s,(function(e){return e.contract.name===l}));return _.isEmpty(c)}}},i.prototype.getDropAction=function(e){var t=this.services.promiseFactory.defer(),i=this.services.dragDataService.getDragContext(),r=0;if(i&&this.viewModel.entity.canEdit){var o=i.field,n=this.fieldExpr();if(!_.isEmpty(o)&&!p.equals(o,n))if(p.isColumn(o)&&(p.isHierarchy(n)&&this.canCreateHierarchyLevelFromColumn(n,o)||p.isColumn(n)&&p.equals(o.source,n.source)))r=1;else{var s=this.viewModel.entity.schema.contract;if(p.isHierarchyLevel(o)&&p.isHierarchyLevel(n)&&p.equals(o.arg,n.arg)){var l=a.findHierarchyLevelIndex(s,o),c=a.findHierarchyLevelIndex(s,n);l<c&&(c-=1),1===e&&(c+=1),l!==c&&(r=0===e?2:3)}else p.isHierarchyLevel(o)&&2===this.viewModel.fieldType&&p.equals(o.arg,n)&&0!==a.findHierarchyLevelIndex(s,o)&&(r=3)}}return t.resolve(r),t.promise},i.prototype.getExprKind=function(e){switch(e.fieldType){case 2:return 1;case 3:return 2;case 0:return 0;default:return 0}},i.prototype.getTooltipTitle=function(){var e,t=this.viewModel;if(5===t.fieldType){var i=t;e=2===i.kpiType?u.format(this.services.localizationService.get("Field_Tooltip"),i.entity.displayName,i.parent.displayName):u.format(this.services.localizationService.get("Field_Kpi_Tooltip"),i.entity.displayName,i.parent.displayName,i.displayName)}else e=t.entity?u.format(this.services.localizationService.get("Field_Tooltip"),t.entity.displayName,t.displayName):t.displayName;return t.errorMessage&&(e=t.errorMessage),e},i.prototype.getPropertyStyle=function(){var e=this.viewModel,t={selected:e.selected,inactive:e.hidden&&e.showHidden,isLeaf:3===e.fieldType||5===e.fieldType,lastLeaf:this.isLastLeaf(),expanded:this.viewModel.expanded};return t[this.getFieldType()]=!0,t},i.prototype.getIndentationStyle=function(){var e=this.getIndentationLevel(),t=8*e,i={"padding-left":t+"px"};return i},i.prototype.getIndentationLevel=function(){for(var e=this.viewModel,t=1,i=e.parent;i;)t++,i=i.parent;return t},i.prototype.isLastLeaf=function(){var e=this.viewModel.fieldType,t=this.viewModel.parent;return!(3!==e&&5!==e||!t||_.last(t.children)!==this.viewModel)},i.prototype.createUniqueId=function(){return"fieldListProp_"+ ++v},i.prototype.toggle=function(){this.viewModel.checked?this.addField():this.removeField()},i.prototype.addField=function(){var t=this,i=this.fieldExpr(),r=c.getSelectedVisuals(this.services.selection);if(1===r.length){var n=r[0];if(n){var a=this.services.dataSources.get();this.services.visualAuthoring.addFieldToVisual(i,a,n,e.telemetry.HowFieldWasAddedToVisual.CheckboxTickedInFieldList).catch((function(){t.viewModel.checked=!1}))}}else this.services.eventBridge.publishToChannel(o.addVisualContainer,{expr:i,allowAggregate:!0,telemetrySource:0})},i.prototype.removeField=function(){var e=this.services.dataSources.get();this.services.visualAuthoring.removeField(e,this.fieldExpr())},i.prototype.getIconClassName=function(){var e=this.viewModel.fieldType;if(1===e)return"folder";if(3===e||5===e)return"none";if(2===e)return"hierarchy";var t=this.viewModel;if(1===t.contract.queryable)return"error";if(1===t.kind)return t.contract.measure&&t.contract.measure.kpi&&4===t.fieldType?"kpi":"measure";if(void 0!==t.contract.type&&void 0!==t.contract.type.geography)return"geoData";if(0===t.kind){if(t.contract.column&&t.contract.column.groupingMetadata)return"group";if(t.contract.column&&t.contract.column.calculated)return t.type&&t.type.numeric?"numericCalculatedColumn":"calculatedColumn";if(t.idOnEntityKey)return"identity"}return t.type&&t.type.numeric&&1!==t.defaultAggregate&&this.allowAggregation()?"numeric":"none"},i.prototype.getDragContext=function(){return{field:this.fieldExpr()}},i.prototype.fieldExpr=function(){return this.fieldListExprGenerator.fieldExpr(this.viewModel)},i.prototype.updateSelection=function(){this.selectedVisualContainer=null;var e=c.getSelectedVisual(this.services.selection);e&&(this.selectedVisualContainer=e)},i.prototype.select=function(e){var i=this.viewModel.canEdit||this.services.featureSwitchService.featureSwitches.reportMeasures&&this.viewModel.entity.schema.contract.capabilities.isExtendable;if(i){var r=this.viewModel;r.selected||(t.viewModels.FieldListViewModelOperations.clearSelection(r.entity.schema),r.selected=!0);var o=this.fieldExpr();o?l.setActiveSchemaItem(this.services.schemaItemActivation,o):this.services.schemaItemActivation.clearActiveItem(),e.stopPropagation()}},i.prototype.selectMenuItem=function(e){switch(e.action){case 4:this.editLabel();break;case 0:this.addFilter();break;case 1:this.fieldListActionEventPublisher.toggleHidden(this.fieldExpr());break;case 5:this.fieldListActionEventPublisher.delete(this.fieldExpr());break;case 7:this.fieldListActionEventPublisher.moveUp(this.fieldExpr());break;case 8:this.fieldListActionEventPublisher.moveDown(this.fieldExpr());break;case 2:this.fieldListActionEventPublisher.viewHidden();break;case 3:this.fieldListActionEventPublisher.unHideAll();break;case 10:this.fieldListActionEventPublisher.addMeasure(this.fieldExpr());break;case 11:this.fieldListActionEventPublisher.addHierarchy(this.fieldExpr());break;case 12:this.fieldListActionEventPublisher.addHierarchyLevel(this.fieldExpr(),e.hierarchyName);break;case 13:this.fieldListActionEventPublisher.addColumn(this.fieldExpr());break;case 16:this.fieldListActionEventPublisher.setGroups(this.viewModel);break;case 17:this.fieldListActionEventPublisher.editGroups(this.viewModel);break;case 18:this.fieldListActionEventPublisher.editClustering(this.fieldExpr());break;case 19:this.fieldListActionEventPublisher.newQuickCalc(this.fieldExpr());break;case 14:this.fieldListActionEventPublisher.collapseAll();break;case 15:this.fieldListActionEventPublisher.expandAll()}},i.prototype.toggleExpand=function(e){var t=this.viewModel;t.expanded=!t.expanded,this.select(e),e.stopPropagation()},i.prototype.showContextMenu=function(e){e.stopPropagation(),this.services.dropdown.showContextMenu(this.viewModel.getMenuItems(),{x:e.pageX,y:e.pageY},this.selectMenuItem.bind(this),!1)},i.prototype.addFilter=function(){var e;e=this.selectedVisualContainer?{container:this.selectedVisualContainer,scopeType:0}:{container:this.services.explorationNavigation.getCurrentSection(),scopeType:1},this.services.visualAuthoring.addFilter(this.fieldExpr(),e,this.services.dataSources.get())},i.prototype.editLabel=function(){var e=this.viewModel;e.canEdit&&this.isEditableField(e.fieldType)&&(e.isEditingLabel=!0,this.scope.toggleDraggable(!1))},i.prototype.rename=function(t){this.scope.toggleDraggable(!0),this.isNameValid(t)&&e.explore.util.ModelAuthoringUtility.rename(this.fieldExpr(),t,this.services.modelAuthoring)},i.prototype.isNameValid=function(e){var t=e!==this.viewModel.name,i=u.isNullOrUndefinedOrWhiteSpaceString(e);return t&&!i},i.prototype.allowAggregation=function(){return!(this.viewModel.entity&&this.viewModel.entity.schema&&this.viewModel.entity.schema.contract&&this.viewModel.entity.schema.contract.capabilities)||!this.viewModel.entity.schema.contract.capabilities.discourageQueryAggregateUsage},i.prototype.isEditableField=function(e){return 5!==e&&(2!==e&&3!==e||this.services.featureSwitchService.featureSwitches.hierarchyAuthoringEnabled)},i.prototype.schemaItemActivationChanged=function(){var e=this.services.schemaItemActivation.getActiveItem(),t=this.fieldExpr();if(t){var i=d.asFieldPattern(t);i.column&&(this.viewModel.selected=e&&e.entity===this.viewModel.entity.name&&e.property===this.viewModel.name&&e.schema===this.viewModel.schemaName);
}},i.prototype.getFieldType=function(){switch(this.viewModel.fieldType){case 0:return"property";case 1:return"displayFolder";case 4:return"kpi";case 2:return"hierarchy";case 5:return"kpiMeasure";case 3:return"hierarchyLevel";default:return"property"}},i})();i.FieldListPropertyController=h})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=t.contracts.FilterType,n=e.data.SemanticFilter,a=(function(){function i(e,i){var o=this;this.scope=e,this.services=i,this.scope.viewModel.updateViewState(),this.scope.viewModel.updateAvailableTypes(),this.scope.toggle=function(e,t){return o.toggle(e,t)},this.scope.deleteFilter=function(e,t){return o.deleteFilter(e,t)},this.scope.clearFilter=function(e,t){return o.clearFilter(e,t)},this.scope.restoreDefaultFilter=function(e,t){return o.restoreDefaultFilter(e,t)},this.scope.switchCardType=function(e,t){return o.switchCardType(e,t)},this.scope.invalidFilterTooltip=this.services.localizationService.get("Invalid_Filter_Tooltip"),this.scope.updateRequiredState=function(){return o.updateRequiredState()},this.scope.viewModel.isSingleSelectionRequired=this.scope.viewModel.isPodEnabled()&&this.initializeDefaultRequiredState(),this.scope.tooltipConfigManager={getTooltipConfig:function(){return{tooltipDisable:!e.viewModel.readOnlyState.invalid,tooltipTitle:i.localizationService.get("Invalid_Filter_Tooltip")}}},this.services.eventBridge.subscribeToBubbling(e,t.viewModels.FilterEvents.filterChanged,(function(e,t){return o.onFilterChanged(e,t)})),this.scope.viewModel.chevronExpandDescription=i.localizationService.get("Chevron_ExpandDescription"),this.scope.viewModel.chevronCollapseDescription=i.localizationService.get("Chevron_CollapseDescription");var n=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.filterContainerChanged,(function(e,t){return o.onFilterContainerChanged(t)}));this.scope.$on("$destroy",(function(){return n.unsubscribeAll()})),this.initializeDefaultValue()}return i.createOptions=function(){return{additionalServices:["localizationService","featureSwitchService","telemetryService"],scopedDependencies:["eventBridge","explorationNavigation","visualAuthoring"]}},i.prototype.onFilterChanged=function(e,t){var i=this.scope.viewModel.contract.expression;this.scope.viewModel.useDefaultFilter&&(t.filter.filter=n.getDefaultValueFilter(i)),this.services.eventBridge.publishToChannel(r.filterContainerChanged,t),this.updateRestatement()},i.prototype.onFilterContainerChanged=function(e){var t=this.scope.viewModel;e.filter===t.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)&&this.updateRestatement()},i.prototype.toggle=function(t,i){var o=i.contract;o.expanded=!o.expanded;var n=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneExpandCollapseFilter,o.expanded);i.updateViewState();var a=this.scope.viewModel,s={filter:a.contract,changeType:16,scope:a.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,s),n.resolve()},i.prototype.clearFilter=function(t,i){if(!i.contract.filter)return void t.stopPropagation();this.scope.viewModel.clearRestatement();var o=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneClearAdvancedFilter),n=this.scope.viewModel;this.services.visualAuthoring.clearFilter(n.getFilterContainerScope().container,n.contract);var a={filter:i.contract,changeType:10,scope:i.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,a),t.stopPropagation(),o.resolve()},i.prototype.restoreDefaultFilter=function(t,i){var o=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneClearAdvancedFilter),a=this.scope.viewModel,s=this.scope.viewModel.contract.expression;this.services.visualAuthoring.updateFilter(a.getFilterContainerScope().container,a.contract,n.getDefaultValueFilter(s));var l={filter:i.contract,changeType:10,scope:i.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,l),a.useDefaultFilter=!0,this.updateRestatement(),t.stopPropagation(),o.resolve()},i.prototype.deleteFilter=function(e,t){var i=t.getFilterContainerScope();if(this.services.visualAuthoring.removeFilter(t.contract,i),this.scope.viewModel.isSingleSelectionRequired){var o={filterName:t.contract.name,type:2};this.services.eventBridge.publishToChannel(r.podParameterChanged,o)}e.stopPropagation()},i.prototype.switchCardType=function(e,t){switch(e.type){case o.Advanced:case o.Categorical:case o.TopN:t.switchType(e.type),t.updateViewState()}},i.prototype.updateRequiredState=function(){var e={filterName:this.scope.viewModel.contract.name,type:this.scope.viewModel.isSingleSelectionRequired?0:1};this.services.eventBridge.publishToChannel(r.podParameterChanged,e);var t=this.scope.viewModel;if(t.isSingleSelectionRequired){this.services.visualAuthoring.updateFilter(t.getFilterContainerScope().container,t.contract,void 0);var i={filter:t.contract,changeType:10,scope:t.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,i)}},i.prototype.initializeDefaultRequiredState=function(){var e=this.services.explorationNavigation.getCurrentExploration(),i=this.services.explorationNavigation.getCurrentSection(),r=this.scope.viewModel.contract.name;return!!(e&&i&&r)&&t.PodUtils.hasParameter(e,i.name,r)},i.prototype.updateRestatement=function(){var e=this.scope.viewModel;e.useDefaultFilter?e.setRestatement(t.viewModels.RestatementHelper.fromDefault(e.defaultValue.value)):e.contract.type===o.Passthrough&&(e.setRestatement(e.contract.restatement),e.updateViewState())},i.prototype.initializeDefaultValue=function(){var e=this.scope.viewModel;(e.hasDefaultValue&&!e.contract.filter||n.isDefaultFilter(e.contract.filter))&&(e.useDefaultFilter=!0,this.updateRestatement())},i})();i.FilterController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.util.DragDropTypes,o=e.explore.services.events,n=e.explore.util.ScriptVisualsUtil,a=t.services.selectionUtils,s=e.explore.util.VisualContainerUtils,l=(function(){function i(e,i){var n=this;this.scope=e,this.services=i;var a=this.services.explorationNavigation.getCurrentExploration();this.scope.viewModel=t.viewModels.ViewModelFactory.createFilterPane(null!=a),this.scope.viewModeState=i.viewModeState,this.scope.dropPageFilter=function(e,t,i){return n.dropPageFilter(e,t,i)},this.scope.dropReportFilter=function(e,t,i){return n.dropReportFilter(e,t,i)},this.scope.dropVisualFilter=function(e,t,i){return n.dropVisualFilter(e,t,i)},this.scope.dropConfig={accept:r.Field},this.scope.getDropAction=function(e){return n.getDropAction(e)},this.scope.isVisualFiltersVisible=function(){return n.isVisualFiltersVisible()},this.scope.isPageFiltersVisible=function(){return n.isPageFiltersVisible()},this.scope.isReportFiltersVisible=function(){return n.isReportFiltersVisible()};var s=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.selectionChanged,(function(){return n.updateSelection()})).subscribe(o.modelChanged,(function(){return n.onModelChanged()})).subscribe(o.canvasChanged,(function(){return n.onCanvasChanged()})).subscribe(o.explorationLoaded,(function(){return n.onModelChanged()})).subscribe(o.visualContainerChanged,(function(e,t){return n.onVisualContainerChanged(t)})).subscribe(o.filterContainerChanged,(function(e,t){return n.onFilterContainerChanged(t)}));e.$on("$destroy",(function(){return s.unsubscribeAll()})),this.updateSelection(),this.onModelChanged()}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","displayNameService","dragDataService","localizationService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationCapabilities","explorationNavigation","scriptVisuals","selection","viewModeState","visualAuthoring","visualPlugin","visualPluginOps"]}},i.prototype.onModelChanged=function(){this.createReportFilters(),this.createPageFilters()},i.prototype.onCanvasChanged=function(){this.createPageFilters()},i.prototype.getDropAction=function(e){var t=this.services.promiseFactory.defer(),i=this.services.dragDataService.getDragContext();return i&&i.field?t.resolve(3):t.resolve(0),t.promise},i.prototype.dropVisualFilter=function(e,t,i){var r=this.getSelectedVisual();r&&this.addFilterToScopeFromDrop(0,r)},i.prototype.dropPageFilter=function(e,t,i){var r=this.services.explorationNavigation.getCurrentSection();this.addFilterToScopeFromDrop(1,r)},i.prototype.dropReportFilter=function(e,t,i){var r=this.services.explorationNavigation.getCurrentExploration();this.addFilterToScopeFromDrop(2,r)},i.prototype.addFilterToScopeFromDrop=function(e,t){var i=this.services.dragDataService.getDragContext();if(i&&i.field){var r={scopeType:e,container:t},o=this.services.dataSources.get();this.services.visualAuthoring.addFilter(i.field,r,o)}},i.prototype.isVisualFiltersVisible=function(){var e=this.scope.viewModeState,t=e.getMode(),i=1===t,r=this.scope.viewModel;return i&&r.isVisualVisible||0===t&&!!r.visualFilters.length},i.prototype.isPageFiltersVisible=function(){var e=this.scope.viewModeState,t=e.getMode(),i=1===t,r=this.scope.viewModel;return r.pageFilters&&(e.getConfig().alwaysPopulatePanes||i||!!r.pageFilters.length)},i.prototype.isReportFiltersVisible=function(){var e=this.scope.viewModeState,t=e.getMode(),i=1===t,r=this.scope.viewModel;return r.reportFilters&&(e.getConfig().alwaysPopulatePanes||i||!!r.reportFilters.length)},i.prototype.updateSelection=function(){var e=this.scope.viewModel,t=this.getSelectedVisual();e.visualFilters.length=0,t&&this.services.visualPluginOps.isQueryVisual(t.config.singleVisual.visualType)?(e.isVisualVisible=!0,this.createVisualFilters()):this.scope.viewModel.isVisualVisible=!1},i.prototype.onVisualContainerChanged=function(e){if(e){var t=this.getSelectedVisual();t&&e.affectContainer(t)&&this.createVisualFilters()}},i.prototype.onFilterContainerChanged=function(e){var i=this;if(2===e.scope.scopeType){var r=this.services.explorationNavigation.getCurrentExploration();s.clearVisualContainerQueryCaches(r)}var o=this.scope.viewModel;if(1===e.changeType)this.getConceptualSchema().then((function(r){var n=s.getVisualCapabilities(i.getSelectedVisual(),i.services.visualPlugin),a=t.viewModels.FilterViewModelFactory.convertFilterContainer(e.filter,r,i.services.displayNameService,e.scope,i.services.visualPlugin,i.services.aggrOps,i.services.localizationService,n);0===e.scope.scopeType&&e.scope.container===i.getSelectedVisual()?o.visualFilters.push(a):1===e.scope.scopeType?(o.pageFilters.push(a),i.addConfigToPageOrReportFilters(o.pageFilters,r)):2===e.scope.scopeType&&(o.reportFilters.push(a),i.addConfigToPageOrReportFilters(o.reportFilters,r))}));else if(0===e.changeType){var n;switch(e.scope.scopeType){case 0:n=o.visualFilters;break;case 1:n=o.pageFilters;break;case 2:n=o.reportFilters;break;default:return}for(var a=0,l=n.length;a<l;a++)if(n[a].contract===e.filter){n.splice(a,1);break}}10!==e.changeType&&1!==e.changeType&&2!==e.changeType&&0!==e.changeType||(this.updateCategoricalFiltersOnParentFilterChange(this.scope.viewModel.visualFilters,e.filter),0!==e.scope.scopeType&&this.updateCategoricalFiltersOnParentFilterChange(this.scope.viewModel.pageFilters,e.filter),2===e.scope.scopeType&&this.updateCategoricalFiltersOnParentFilterChange(this.scope.viewModel.reportFilters,e.filter)),this.logRTelemetry(e)},i.prototype.logRTelemetry=function(t){var i=this.services.explorationNavigation,r=i.getCurrentExploration(),o=i.getCurrentSection(),a=t.scope.scopeType,s=n.getScriptVisualIds(a,r,o,this.getSelectedVisual(),this.services.scriptVisuals);if(!_.isEmpty(s)){var l=t.changeType.toString();this.services.telemetryService.logEvent(e.telemetry.EXFilterScriptVisual,l,JSON.stringify(s))}},i.prototype.updateCategoricalFiltersOnParentFilterChange=function(e,i){for(var r=0,n=e;r<n.length;r++){var a=n[r];if(t.FilterUtils.isCategoricalFilter(a.contract.type)&&a.contract!==i){var s={filter:a.contract,changeType:4,scope:a.getFilterContainerScope()};this.services.eventBridge.publishToChannel(o.filterContainerChanged,s)}}},i.prototype.getConceptualSchema=function(){var e=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(e)},i.prototype.getSelectedVisual=function(){return a.getSelectedVisual(this.services.selection)},i.prototype.createPageFilters=function(){var e=this,i=this.services.explorationNavigation.getCurrentSection(),r=this.services.explorationCapabilities.getCapabilities();return!i||r.shouldShowPageFilters&&!r.shouldShowPageFilters(i)?void(this.scope.viewModel.pageFilters=null):void this.getConceptualSchema().then((function(r){e.scope.viewModel.pageFilters=t.viewModels.ViewModelFactory.createFilters({scopeType:1,container:i},r,e.services.displayNameService,e.services.visualPlugin,e.services.aggrOps,e.services.localizationService,null),e.addConfigToPageOrReportFilters(e.scope.viewModel.pageFilters,r)}))},i.prototype.createReportFilters=function(){var e=this,i=this.services.explorationNavigation.getCurrentExploration();return i?void this.getConceptualSchema().then((function(r){e.scope.viewModel.reportFilters=t.viewModels.ViewModelFactory.createFilters({scopeType:2,container:i},r,e.services.displayNameService,e.services.visualPlugin,e.services.aggrOps,e.services.localizationService,null),e.addConfigToPageOrReportFilters(e.scope.viewModel.reportFilters,r)})):void(this.scope.viewModel.reportFilters=null)},i.prototype.addConfigToPageOrReportFilters=function(e,t){if(!_.isEmpty(e)){var i=this.services.dataSources.get();this.services.visualAuthoring.addConfigToCategoricalFilters(e,t,i)}},i.prototype.createVisualFilters=function(){var e=this;this.getConceptualSchema().then((function(t){var i=e.getSelectedVisual();i&&(e.scope.viewModel.visualFilters=e.services.visualAuthoring.createVisualFilters(i,e.services.dataSources.get(),t))}))},i})();i.FilterPaneController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=e.explore.services,a=e.data.SemanticFilter,s=e.data.SQExpr,l=e.data.SQExprBuilder,c=e.data.SQExprConverter,u=e.explore.util.VisualContainerUtils,p=e.explore.util.VisualHostServicesUtil,d=jsCommon.EnumExtensions,v=(function(){function i(e,t){var i=this;this.scope=e,this.services=t;var r=this.services.singleExecutableDataProxyFactory.create();this.visualDataProxyService=n.createExploreVisualDataProxyService(r,this.services.filterGenerator),this.crossFilteringHostService=this.createFilteringHostService();var a=this.scope.$watch("viewModel",(function(e){i.init(e),a()})),s=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)})).subscribe(o.podParameterChanged,(function(e,t){return i.updateFilterConfig(t)}));this.scope.$on("$destroy",(function(){s.unsubscribeAll(),i.viewModel.setServices(void 0,i.services.visualPlugin),i.viewModel.readOnlyState.visual=void 0}))}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","geocoder","localizationService","moduleLoader","promiseFactory","singleExecutableDataProxyFactory"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","filterGenerator","filterRestatement","hostFiltersService","undoRedo","visualAuthoring","visualPlugin","visualQueryGenerator","visualRelationship"]}},i.prototype.init=function(i){var o=this;this.viewModel=i,this.viewModel.setServices(e.Prototype.inherit(t.services.createVisualHostServices(this.services.promiseFactory,this.services.moduleLoader,e.visuals.services.createGeolocation(),this.services.geocoder),(function(e){e.persistProperties=function(e){return o.persistProperties(e)},e.loadMoreData=function(){return o.loadMoreData()},e.promiseFactory=function(){return o.services.promiseFactory},e.analyzeFilter=function(e){return o.createAnalyzedFilter(e)},e.canSelect=function(e){return!0},e.setIdentityDisplayNames=function(e){return o.updateCachedLabel(e)},e.getIdentityDisplayNames=function(e){return o.getLabelForScopeId(e)}})),this.services.visualPlugin),this.getConceptualSchema().then((function(t){if(o.viewModel.updateFilterProperties(t,o.services.visualPlugin,o.services.aggrOps),o.viewModel.updateViewState(),o.viewModel.isSingleSelectionRequired){var i=o.viewModel.contract.config.singleVisual.objects;i||(i={});var n=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,a=e.visuals.slicerProps.selection.singleSelect;r.setValue(i,n,null,l.boolean(!1)),r.setValue(i,a,null,l.boolean(!0))}if(o.viewModel.readOnlyState.expanded)o.loadData(!1);else var s=o.scope.$watch("viewModel.readOnlyState.expanded",(function(e,t,i){e!==t&&e&&(o.loadData(!1),s())}));o.loadRestatement()}))},i.prototype.loadRestatement=function(){var e=this;this.services.filterRestatement.loadRestatement(this.services.dataSources.get(),this.viewModel.contract,this.viewModel.formatter).then((function(t){return e.viewModel.setRestatement(t)}))},i.prototype.createAnalyzedFilter=function(e){var i=this.viewModel.contract;e.filter=i.filter;var r=1!==i.howCreated&&!a.isDefaultFilter(i.filter),o=t.services.createAnalyzedFilter(e,r);return o},i.prototype.persistProperties=function(i){var r=this,o=this.viewModel;o.useDefaultFilter=!1;var n;if(i&&!_.isEmpty(i.merge)){var s=this.services.filterGenerator.tryGetFilterPropertyIdentifier(e.visuals.plugins.slicer.capabilities);n=i.merge[0].properties[s.propertyName]}if(!a.isSameFilter(o.contract.filter,n)&&(!a.isAnyFilter(o.contract.filter)||n)){var l=this.viewModel.readOnlyState.visual,c=__assign({},l.data);l.data=c,this.services.undoRedo.register("UpdateFilter",(function(){r.viewModel.contract.type=r.viewModel.readOnlyState.type,r.services.visualAuthoring.updateFilter(o.getFilterContainerScope().container,o.contract,n);var e=n?2:10,i={filter:o.contract,changeType:e,scope:o.getFilterContainerScope()};r.services.eventBridge.publishToChannel(t.services.events.filterContainerChanged,i),r.loadRestatement()}))}},i.prototype.createFilteringHostService=function(){var t=this;return e.Prototype.inherit(p.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,i){return{dataFilter:t.services.filterGenerator.calculateFilterContainerInputFilter(t.services.explorationNavigation.getCurrentExploration(),t.services.explorationNavigation.getCurrentSection(),t.viewModel.contract,i,t.viewModel.getFilterContainerScope())}}}))},i.prototype.loadMoreData=function(){this.visualDataProxyService.canLoadMore()&&this.loadData(!0)},i.prototype.loadData=function(e){var t=this;this.viewModel.isLoading=!0,this.hasQueryError=!1,this.getConceptualSchema().then((function(i){var r=t.services.dataSources.get(),o={dataSources:r,schema:i,config:t.viewModel.contract.config.singleVisual,hostServices:t.crossFilteringHostService,visualQueryGenerator:t.services.visualQueryGenerator,isLoadMore:e};return t.visualDataProxyService.runQuery(o).then((function(r){var o=t.visualDataProxyService.lastExecutedQuery();e===!0?t.onMergeMoreData(r,i,o.transforms):t.onDataChanged(r,i,o.transforms)}),(function(e){t.hasQueryError=!0})).finally((function(){t.viewModel.isLoading=!1}))}))},i.prototype.onDataChanged=function(e,t,i){var r=this.viewModel.readOnlyState.visual;if(e&&e.dataReaderResult&&r){var o={dataView:e&&e.dataReaderResult?e.dataReaderResult.dataView:null,dataViewSource:e&&e.dataViewSource?e.dataViewSource:null},n=u.isSegment(o.dataView);n&&(o.isFirstSegment=n),r.data=o,r.dataTransforms=i,this.viewModel.updateViewState(),this.dataLoaded=!0}},i.prototype.onMergeMoreData=function(t,i,r){var o=this.viewModel.readOnlyState.visual;if(t&&t.dataReaderResult&&o){var n=t.dataReaderResult.dataView;if(n){var a=o.data.dataView;e.data.segmentation.DataViewMerger.mergeDataViews(a,n);var s={dataView:a,dataViewSource:t&&t.dataViewSource,isFirstSegment:!1};o.data=s,o.dataTransforms=r}}},i.prototype.onFilterContainerChanged=function(i){var r=this.viewModel,o=r.readOnlyState.visual;if(i.filter===r.contract)if(d.hasFlag(i.changeType,2)){if(10===i.changeType)return o&&o.visual&&o.visual.onClearSelection(),void(r.contract.filter||r.setRestatement(t.viewModels.RestatementHelper.fromDataViewScopeIdentities([],!1,r.formatter)));a.isSameFilter(r.contract.filter,i.filter.filter)||(this.services.visualAuthoring.updateFilter(r.getFilterContainerScope().container,r.contract,i.filter.filter),null!=i.filter.filter&&this.loadData(!1))}else this.dataLoaded&&d.hasFlag(i.changeType,4)?this.loadData(!1):d.hasFlag(i.changeType,16)&&o&&o.visual&&o.visual.update({viewport:t.viewModels.FilterViewModel.DefaultVisualViewPort,type:e.VisualUpdateType.Resize,dataViews:null})},i.prototype.updateFilterConfig=function(t){if(2!==t.type){var i=this.viewModel.readOnlyState.visual;if(i&&i.data){var o=this.viewModel.isSingleSelectionRequired,n=i.dataTransforms.objects,a=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,s=e.visuals.slicerProps.selection.singleSelect;n||(n={}),r.setValue(n,a,null,l.boolean(!o)),r.setValue(n,s,null,l.boolean(o));var c={dataView:i.data.dataView,dataViewSource:i.data.dataViewSource,isFirstSegment:i.data.isFirstSegment};i.data=c}}},i.prototype.updateCachedLabel=function(t){if(!_.isEmpty(t)){var i=t[0].identity,r=i&&i.expr,o=e.data.ScopeIdentityExtractor.getKeys(r),n=this.viewModel.contract;1===o.length&&s.equals(n.expression,o[0])||(n.cachedValueItems=t,this.loadRestatement())}},i.prototype.getLabelForScopeId=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i],n=this.getDisplayNameFromCache(o);n||(n={displayName:c.getFirstComparandValue(o),identity:o}),t.push(n)}return t},i.prototype.getDisplayNameFromCache=function(t){var i=this.viewModel.contract.cachedValueItems;if(!_.isEmpty(i))return _.find(this.viewModel.contract.cachedValueItems,(function(i){return e.DataViewScopeIdentity.equals(i.identity,t,!0)}))},i.prototype.getConceptualSchema=function(){var e=this.services.dataSources.get();return e&&this.viewModel.contract.config&&this.viewModel.contract.config.singleVisual?this.services.conceptualSchemaProxy.get(e):this.services.promiseFactory.reject()},i})();i.FilterVisualController=v})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.errorService=this.scope.errorService,this.modalDialog=this.errorService.control(),this.scope.closeDialog=function(){return t.closeDialog()}}return e.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},e})();e.ImportVisualErrorDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.errorService=this.scope.errorService,this.modalDialog=this.errorService.control(),this.scope.importVisual=function(){return t.importVisual()},this.scope.closeDialog=function(){return t.closeDialog()}}return e.prototype.importVisual=function(){this.closeDialog(),this.scope.importVisualService.importWithDialog(this.scope.explorationContract)},e.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},e})();e.ImportVisualWarningDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.scope=e,this.services=t,this.scope.eventBridge=this.services.eventBridge,this.scope.schemaItemActivationService=this.services.schemaItemActivation}return e.createOptions=function(){return{scopedDependencies:["eventBridge","schemaItemActivation"]}},e})();e.ModelingContextChangerController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)?"":e.length>=260?t.get("ReportAppBar_SaveError_TooLong"):null}function i(e,i,r,o,n){var a=$.Deferred();n=n||i.get("ModalDialog_Save");var s=e.control();o=o||i.get("ReportAppBar_SaveAsDialogInstructions");var l='<div class="content"><div class="message instructions"></div><input type="text" class="explorationSaveAsName" /><div class="errorMessage"></div></div>',c=$(l);c.find(".message").text(o);var u=c.find(".explorationSaveAsName"),p=[new InJs.ModalDialogAction(n,function(e,t){var i=jsCommon.StringExtensions.trimWhitespace(u.val());s.hideDialog(),a.resolve(i)}),new InJs.ModalDialogAction(i.get("ModalDialog_Cancel"),function(e,t){s.hideDialog(),a.reject()})];return r=r||i.get("ReportAppBar_SaveAsDialogTitle"),s.showCustomDialog(r,c,p,(function(e){e.parent().find('input[value = "'+n+'"]').prop("disabled",!0),u.focus().on("change keyup paste mouseup",(function(r){var o=t($(r.target).val(),i);e.parent().find('input[value = "'+n+'"]').prop("disabled",null!==o),e.parent().find(".errorMessage").text(o)})).on("keyup",(function(e){13===e.which&&null===t($(e.target).val(),i)?p[0].actionCallback(null,null,null):27===e.which&&p[1].actionCallback(null,null,null)}))}),!0),a}e.validateReportName=t,e.showSaveAsDialog=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t){for(var i=w.filterTransient(t),r=w.filterTransient(e),o=i.length-1;o>=0;o--){var n=i[o],a=r[o];n.id=a.id;for(var s=n.visualContainers.length-1;s>=0;s--){var l=n.visualContainers[s];l.id=a.visualContainers[s].id}}}function o(e,i,r,o,n,a){void 0===a&&(a=C.Unknown);var s=e.exploration.contract;if(i>-1&&s&&i<s.sections.length){r&&r.getSelectedElements().length>0&&r.clearSelection(),e.sectionStatus.currentSectionNumber=i;var l=s.sections[i];e.exploration.exploreCanvas=t.viewModels.ViewModelFactory.convertSectionToExploreCanvas(s,s.sections[i],n);for(var c=e.exploration.sections,u=c.length-1;u>=0;--u)c[u].selected=u===i;l.crossHighlight=void 0,o.goto(l,{action:a})}}function n(e,t,i){e.exploration.contract.sections[i].displayName=t,e.exploration.sections[i].displayName=t,e.exploration.sections[i].isTabEditable=!1}function a(t,i,r,o,n){var a=t.exploration.contract,s=e.explore.services.createExplorationSerializer(n,o),l=s.serializePage(a.sections[i],1),u=s.deserializePage(l);return u.name=c(a),u.displayName=r.format("DuplicateSectionName_StartingText",[u.displayName]),u}function s(e,i,r,n){i.id=void 0;var a=e.exploration.contract,s=a.sections;s.push(i),e.exploration.sections.push(t.viewModels.ViewModelFactory.convertSectionToViewModel(i)),o(e,s.length-1,r,n,0)}function l(e,t,i,r){var n=e.exploration.contract;if(t>-1&&n&&t<n.sections.length){var a=n.sections[t];n.sections.splice(t,1);var s=e.exploration.sections,l=s[t];l&&l.contract===a&&s.splice(t,1);var c=e.sectionStatus.currentSectionNumber;if(c===t){var u=t;u>=n.sections.length&&(u=n.sections.length-1),o(e,u,i,r,0)}else{var p=t>c?c:c-1;e.sectionStatus.currentSectionNumber=p,n.activeSectionIndex=p}}}function c(e){for(var t={},i=0,r=e.sections;i<r.length;i++){var o=r[i];t[o.name]=!0}return S.findUniqueName(t,b)}function u(e,t){for(var i=1,r=t.format("Explore_Section_Page",[i.toFixed()]);_.findLastIndex(e,(function(e){return e.displayName===r}))>=0;)r=t.format("Explore_Section_Page",[(++i).toFixed()]);return r}function p(e,i,r,n,a,s){var l=e.exploration.contract,p=l.sections;a||(a={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultWidescreenWidth,height:t.constants.ExploreCanvasConstants.DefaultWidescreenHeight});var d={name:c(l),displayName:u(l.sections,n),size:a,objects:s,visualContainers:[],filters:[]};p.push(d),e.exploration.sections.push(t.viewModels.ViewModelFactory.convertSectionToViewModel(p[p.length-1])),o(e,p.length-1,i,r,0)}function d(e,t){if(e&&e.sections){var i=e.sections,r=_.findIndex(i,(function(e){return e.name===t}));return r!==-1?r:void 0}}function v(e,t){if(!e||!e.sections)return-1;var i=e.sections,r=_.findIndex(i,(function(e){return e===t}));return r}function h(e,t){return e&&e.sections?y.findWithId(e.sections,t):null}function g(e,t){if(!e||!e.sections)return-1;var i=e.sections,r=_.findIndex(i,(function(e){return e.id===t}));return r}function f(e,t){for(var i=e.sections,r=0,o=i;r<o.length;r++){var n=o[r];n.displayName||(n.displayName=u(e.sections,t))}}function m(e,t,i){if(t<0||i<0)return!1;var r=!1,o=e.exploration.contract.sections,n=o[t];o.splice(t,1),o.splice(i,0,n);var a=e.exploration.sections,s=a[t];s&&s.contract===n&&(a.splice(t,1),a.splice(i,0,s),r=!0);for(var l=a.length-1;l>=0;--l)if(a[l].selected){e.sectionStatus.currentSectionNumber=l;break}return r}var y=jsCommon.ArrayExtensions,w=e.explore.contracts.Section,C=e.explore.services.SectionNavigationAction,S=jsCommon.StringExtensions,b="ReportSection";i.synchronizeSectionsIds=r,i.gotoSection=o,i.renameSection=n,i.duplicateSection=a,i.insertSection=s,i.deleteSection=l,i.createSection=p,i.findSectionIndexForSectionName=d,i.findSectionIndexForSection=v,i.findSectionById=h,i.findSectionIndexForSectionId=g,i.fillDefaultSectionDisplayNames=f,i.reorderSection=m})(i=t.SectionUtils||(t.SectionUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=8192,o=8192,n=128,a=(function(){function i(e,t){var i=this;this.scope=e,this.services=t,this.scope.eventBridge=this.services.eventBridge,this.scope.generateEmbedCode=function(){return i.generateEmbedCode()},this.scope.goToConfirmation=function(){return i.goToConfirmation()},this.scope.generateEmbedCodeAndGoToSuccess=function(){return i.generateEmbedCodeAndGoToSuccess()},this.scope.getCode=function(e){return i.getCode(e)},this.scope.showDeleteMessage=function(e){return i.showDeleteMessage(e)},this.scope.formatDate=function(e){return i.formatDate(e)},this.scope.refresh=function(e){return i.refresh(e)},this.scope.delete=function(e){return i.delete(e)},this.scope.interactiveReportEmbedEnabled=this.services.featureSwitchService.featureSwitches.anonymousEmbeddingEnabled,this.scope.updateEmbedTab=function(e){return i.updateEmbedTab(e)},this.scope.showEmbedCode=function(){return i.showEmbedCode()},this.scope.nameChanged=function(){return i.nameChanged()},this.scope.sizeChanged=function(){return i.sizeChanged()},this.scope.pagesChanged=function(e,t){return i.pagesChanged(e,t)},this.scope.updateSize=function(){return i.updateSize()},this.scope.includeShareLinkChanged=function(){return i.reset()},this.scope.setSharepointEmbedLink=function(){return i.setSharepointEmbedLink()},this.updateEmbedTypes(),this.updateSize(),this.setSharepointEmbedLink()}return i.createOptions=function(){return{additionalServices:["embedProxy","localizationService","notificationToast","telemetryService","featureSwitchService","embed","promiseFactory"],scopedDependencies:["eventBridge"]}},i.prototype.goToConfirmation=function(){this.scope.viewModel.publishState=2},i.prototype.generateEmbedCodeAndGoToSuccess=function(){var e=this,t=function(){e.scope.viewModel.publishState=3};this.generateEmbedCode(t)},i.prototype.generateEmbedCode=function(i){var r=this,o=this.scope.viewModel.embedTab;o.generating=!0;var n=o.embed,a=o.selectedSection,s=[],l=this.services.localizationService.get("Embed_EntireReport");a.contract.displayName===l&&a.contract.id===-1?(s=_.map(o.sections,(function(e){return e.contract.id})),s=_.filter(s,(function(e){return e!==-1}))):s.push(a.contract.id);var c,u={enableShareLink:o.embed.enableShareLink,ignoreExistingCache:!0},p=o.selectedEmbedType.value===t.contracts.EmbedType.Interactive?e.telemetry.EXPublicEmbedCreate:e.telemetry.EXSnapshotEmbedCreate,d=this.services.telemetryService.startEvent(p);c=o.selectedEmbedType.value===t.contracts.EmbedType.Static?this.services.embed.createEmbedReportResource(this.scope.viewModel.exploration.contract,s,u):this.services.promiseFactory.resolve(null),
c.then((function(a){var l=JSON.stringify({resourceLang:e.common.localizedStrings?e.common.cultureInfo:"en-US",cultureLang:e.common.cultureInfo}),c={snapshotEmbedResource:null!=a?JSON.stringify(a):"{}",options:{name:n.contract.name,culture:l,version:e.build,type:t.contracts.SnapshotReportType,size:{height:n.contract.size.height,width:n.contract.size.width},reportId:r.scope.viewModel.exploration.contract.reportId,metadata:JSON.stringify({reportSections:s}),embedType:o.selectedEmbedType.value}};r.services.embedProxy.createEmbed(c).then((function(e){r.scope.viewModel.currentEmbed=e;var n=t.viewModels.ViewModelFactory.createEmbed(e);n.embedCode=r.services.embed.createEmbedCode(e),n.link=r.services.embed.createEmbedUri(e),o.embed=n,r.scope.viewModel.embeddedInTab.embeds.push(n),o.error.exist=!1,d.resolve(),i&&i()}),(function(e){var t=o.error;t.type="create",t.info=r.services.localizationService.get("Embed_CreateError"),t.message=e.error.message,t.requestId=e.requestId,t.activityId=e.activityId,t.exist=!0,d.reject()})).finally((function(){o.generating=!1,o.edit=!0}))}))},i.prototype.checkEnabled=function(){var e=this.scope.viewModel.embedTab;return 0===e.nameError.length&&0===e.sizeError.length},i.prototype.nameChanged=function(){var e=this.scope.viewModel.embedTab,t=e.embed.contract.name.length;0===t?e.nameError=this.services.localizationService.get("Embed_NameErrorEmpty"):t>n?e.nameError=this.services.localizationService.get("Embed_NameErrorTooLong"):e.nameError="",e.disabled=!this.checkEnabled(),this.reset()},i.prototype.pagesChanged=function(e,t){var i=this.scope.viewModel.embedTab.embed.contract.name;i=i.replace(t,e),this.reset()},i.prototype.updateEmbedTab=function(e){this.showEmbedCode()&&this.reset(),1===e&&(this.scope.viewModel.embedTab.error.exist=!1),this.scope.viewModel.viewModeState=e},i.prototype.getCode=function(e){if(e.showCode||e.refreshingData)return void(e.showCode=!1);if(e.embedCode.length<=0){var t=this.services.embed.createEmbedCode(e.contract);e.embedCode=t,e.showCode=!0}else e.showCode=!0},i.prototype.showDeleteMessage=function(e){return e.refreshingData?void(e.deleteRequest=!1):(e.deleteRequest=!0,void(e.showCode=!1))},i.prototype.formatDate=function(e){var t=e.contract.date.slice(8,27),i=new Date(Date.parse(t));return i.toLocaleDateString()},i.prototype.refresh=function(t){var i=this;t.refreshingData=!0;var r=this.services.telemetryService.startEvent(e.telemetry.EXSnapshotEmbedRefresh),o={ignoreExistingCache:!0},n=JSON.parse(t.contract.metadata),a=n.reportSections;this.services.embed.createEmbedReportResource(this.scope.viewModel.exploration.contract,a,o).then((function(o){var n={snapshotEmbedResource:JSON.stringify(o),options:{version:e.build}};i.services.embedProxy.saveSnapshotEmbed(t.contract.snapshotId,n).then((function(o){i.services.notificationToast.notify({title:i.services.localizationService.get("Embed_RefreshSuccess"),message:i.services.localizationService.format("Embed_RefreshSuccessDetail",[t.contract.name]),notificationType:e.common.NotificationToastType.Success}),t.error.exist=!1,r.resolve()})).catch((function(e){var o=t.error;o.type="refresh",o.exist=!0,o.info=i.services.localizationService.get("Embed_RefreshError"),o.message=e.error.message,o.requestId=e.requestId,o.activityId=e.activityId,r.reject()})).finally((function(){t.refreshingData=!1}))}),(function(e){r.reject()}))},i.prototype.delete=function(t){var i=this;t.deleteConfirm=!0;var r=this.services.telemetryService.startEvent(e.telemetry.EXSnapshotEmbedDelete);this.services.embedProxy.deleteSnapshotEmbed(t.contract.snapshotId).then((function(){var o=i.scope.viewModel.embeddedInTab.embeds.indexOf(t);i.scope.viewModel.embeddedInTab.embeds.splice(o,1),i.services.notificationToast.notify({title:i.services.localizationService.get("Embed_DeleteSuccess"),message:i.services.localizationService.format("Embed_DeleteSuccessDetail",[t.contract.name]),notificationType:e.common.NotificationToastType.Success}),r.resolve()}),(function(e){var o=t.error;o.exist=!0,o.type="delete",o.info=i.services.localizationService.get("Embed_DeleteError"),o.message=e.error.message,o.requestId=e.requestId,o.activityId=e.activityId,r.reject(),t.deleteConfirm=!1}))},i.prototype.sizeChanged=function(){var e=this.scope.viewModel.embedTab,t=e.embed.contract.size;if(t.width<=0||t.height<=0?e.sizeError=this.services.localizationService.get("Embed_SizeErrorNegative"):t.width>r||t.height>o?e.sizeError=this.services.localizationService.get("Embed_SizeErrorTooLarge"):e.sizeError="",e.disabled=!this.checkEnabled(),this.showEmbedCode()){var i=this.services.embed.createEmbedCode(this.scope.viewModel.currentEmbed);e.embed.embedCode=i}else this.reset()},i.prototype.updateEmbedTypes=function(){},i.prototype.updateSize=function(){var e=this.scope.viewModel.embedTab,i=this.scope.viewModel.currentEmbed.size;switch(e.selectedEmbedSize.value){case t.viewModels.EmbedSize.Small:i.height=t.viewModels.EmbedSizes.small.height,i.width=t.viewModels.EmbedSizes.small.width;break;case t.viewModels.EmbedSize.Medium:i.height=t.viewModels.EmbedSizes.medium.height,i.width=t.viewModels.EmbedSizes.medium.width;break;case t.viewModels.EmbedSize.Large:i.height=t.viewModels.EmbedSizes.large.height,i.width=t.viewModels.EmbedSizes.large.width}if(e.disabled=!1,this.showEmbedCode()){var r=this.services.embed.createEmbedCode(this.scope.viewModel.currentEmbed);e.embed.embedCode=r}},i.prototype.showEmbedCode=function(){var e=this.scope.viewModel.embedTab.embed.embedCode;return this.scope.viewModel.currentEmbed&&e&&e.length>0},i.prototype.reset=function(){this.scope.viewModel.currentEmbed=null,this.scope.viewModel.embedTab.embed.embedCode=""},i.prototype.setSharepointEmbedLink=function(){var e=this.scope.viewModel.publishState;if(5===e){var t=this.scope.viewModel.embedTab,i=this.scope.viewModel.exploration.contract.report.objectId;t.embed.link=this.services.embed.createSharepointEmbedUri(i)}},i})();i.EmbedModalDialogController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.scope.toggleTaskPane=function(){return t.toggleTaskPane()}}return e.createOptions=function(){return{}},e.prototype.toggleTaskPane=function(){this.scope.viewModel.isPaneExpanded=!this.scope.viewModel.isPaneExpanded},e})();e.TaskPaneController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.constants,o=e.common.events,n=e.data.services.DataViewTransformActionsSerializer,a=t.util.DragDropTypes,s=e.common.directives.DragDropUtils,l=e.data.dsr.DsrMessage,c=t.services.events,u=t.util.QueryGeocodingTracker,p=t.services.selectionUtils,d=e.data.Selector,v=e.data.SQExpr,h=e.data.SQExprConverter,g=t.util.VisualContainerUtils,f=e.visualHost.visualPluginServiceHelpers,m=(function(){function i(i,o){var n=this;this.scope=i,this.services=o,this.isExplorationUnloaded=!1,this.queryExecutionServices={getDataSources:function(){return n.services.dataSources.get()},notifyStart:function(){return n.startProgressBar()},notifyEnd:function(){return n.stopProgressBar()},clearErrors:function(){return n.scope.ctrlError.clearError()},handleErrors:function(e){return n.handleQueryErrors(e)},handleWarnings:function(e,t){return n.handleWarnings(e,t)},applyUpdate:function(e,t,i){return n.handleQueryResult(e,t,i)},loadMergedData:function(e){return n.loadMergedData(e)}},this.initializeVisualContainerQueryHandler(),this.progressBarCount=0,this.detailVisualProgressBarCount=0,this.scopeEventManager=e.common.createScopeEventSubscriptionManager(i),this.visualContainerDataSelectionService=t.services.createVisualContainerDataSelectionService(this.scope.viewModel,new e.data.DataViewQueryEngine,this.services.visualPluginOps),this.scope.getVisualContainerStyle=function(){return n.computeStyle()},this.scope.isHeaderVisible=function(){return n.isHeaderVisible()},this.scope.canRemoveFromLayout=function(){return n.canRemoveFromLayout()},this.scope.removeVisualFromLayout=function(){return n.removeVisualFromLayout()},this.scope.isPopOutBarVisible=function(){return n.isPopOutBarVisible()},this.scope.shouldRestrictTransformDraw=function(){return n.shouldRestrictTransformDraw()},this.scope.viewModeState=o.viewModeState,this.scope.viewModel.showWatermark=!1,this.scope.viewModel.options=o.explorationCapabilities.getCapabilities().visualContainerOptions,this.endLoadDefer=this.services.promiseFactory.defer(),this.scope.$watch("viewModel.errorInfo",(function(){return n.updateDetailVisualVisibility()})),this.scope.ensureFocus=function(e){return n.ensureFocus(e)},this.scope.toggleSelect=function(e){return n.toggleSelect(e)},this.scope.onDoubleClick=function(e){return n.onDoubleClick(e)},this.scope.onVisualContainerChanged=function(){return n.onVisualContainerChangedAsync()},this.scope.viewModel.setTooltip(),this.setOnClearSelectedDataPoints(),this.scope.menuOptions={canDelete:!1,canExport:!1,canSort:!1,canSearch:!1,canCluster:!1,canSpatialCluster:!1,hasMoreOptions:!1,canEdit:!1,sortSetting:{defaultSortBehavior:!1,sortableFields:[]}},this.sortHelper=e.explore.services.createVisualSortHelper(this.scope.menuOptions.sortSetting,this.scope.viewModel,this.services.sort,this.services.undoRedo,this.services.timeout,this.services.visualAuthoring),this.scope.hasPositionOverride=function(){return null!=n.scope.viewModel.overridePosition},this.scope.getDragRestriction=function(){return n.getDragRestrictElementRect()},this.scope.drop=function(e,t){return n.drop(e,t)},this.scope.dropConfig={accept:a.Field,greedy:!1},this.scopeEventManager.subscribe(t.constants.explorationLoadedEventName,(function(){return n.applyUpdate(!0)}));var s=this.scope.viewModel.contract.config.singleVisual.visualType;this.visualHostTelemetryService=t.services.createVisualHostTelemetryService(o.telemetryService,s),this.setViewModelServices(),this.scope.closePopOut=function(){n.setPopOutMode(0),2===n.services.viewModeState.getMode()&&n.services.viewModeState.setMode(1),n.scope.viewModel.setEditMode(0)},this.scope.disablePin=this.scope.viewModel.options.disablePin,this.scope.$watch("viewModel.options.disablePin",(function(){return n.updateDisablePin()})),this.resetVisualStyle(),this.resetBackground(),this.resetTitle(),this.resetAspectRatio(),this.resetBorder(),this.resetSortSettings(),this.scope.viewModel.updateViewState(),this.updateSelection(),this.resetPadding(),this.scopeEventManager.subscribe(t.constants.TransformElementDragStartEventName,(function(e,t){n.isSelected()||n.selectVisualContainer()})),this.scopeEventManager.subscribe(r.visualReady,(function(e){e.stopPropagation(),n.endLoadDefer.resolve(null),n.services.eventBridge.publishToChannel(c.visualContainerDataRendered,n.scope.viewModel.contract)})),this.createCanvasLayoutItemOptions(),this.subscribeToEvents();var l=this.scope.viewModel.contract,p=!l.initialLoadCompleted;l.initialLoadCompleted=!0;var d;this.services.networkAvailability.isNetworkAvailable()||(d=!0),this.scope.$applyAsync((function(){return n.onVisualContainerChangedAsync(p,d)})),this.geocodingTracker=new u({onStartGeocoding:function(){n.startProgressBar(),n.scope.$applyAsync()},onStopGeocoding:function(){n.updateProgressBarState(),n.scope.$applyAsync()}}),this.setTransformScopeProperties(this.scope),this.contextMenu=o.visualContainerContextMenuFactory.create()}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","errorService","dataProxy","displayNameService","dragDataService","embedModeService","errorService","explorationSerializer","featureSwitchService","geocoder","loadProgressNotificationService","localizationService","moduleLoader","networkAvailability","overlayService","promiseFactory","singleExecutableDataProxyFactory","telemetryService","visualHostTooltip","trustedVisual"],scopedDependencies:["clipboard","dataSources","drill","drillToDetails","eventBridge","explorationCapabilities","explorationNavigation","filterGenerator","formFactor","groupingDesignStateService","layoutAuthoring","lazyScoped","popOut","resourceLoader","scriptVisuals","selection","shell","sort","undoRedo","uiComponent","viewModeState","visualAuthoring","visualContainerContextMenuFactory","visualPlugin","visualPluginOps","visualQueryGenerator"]}},i.prototype.setTransformScopeProperties=function(t){var i=this.services.formFactor.getCurrentLayoutCapabilities();t.aspectRatioOffset=e.explore.viewModels.VisualContainer.getVisualBodyOffset(i)},i.prototype.initializeVisualContainerQueryHandler=function(){this.queryHandler=t.services.createVisualContainerQueryHandler(this.queryExecutionServices,this.scope.viewModel.hostServices,this.services.promiseFactory,this.services.conceptualSchemaProxy,this.services.featureSwitchService,this.services.telemetryService,this.services.visualQueryGenerator,this.services.visualPlugin,this.services.visualPluginOps,this.services.dataProxy,this.services.networkAvailability,this.services.singleExecutableDataProxyFactory,this.services.embedModeService,this.services.filterGenerator,this.services.scriptVisuals,this.services.displayNameService,this.services.explorationNavigation,this.services.resourceLoader,this.services.eventBridge,this.services.shell,this.services.localizationService,this.services.trustedVisual)},i.prototype.computeStyle=function(){var e=this.scope.viewModel,t=this.services.viewModeState,i=this.services.viewModeState.getConfig(),r=t.getMode(),o=0===r&&!i.displayOptions.showVisualBordersInViewMode;return{loading:!e.contract.initialLoadCompleted,selected:e.isSelected,"swipeable-blocked":e.isSelected,readMode:0===r,editMode:1===r,hideBorder:o,disableFadeout:i.displayOptions.disableFadeout,popOut:e.isPoppedOut,seeData:2===e.contract.popOutMode,seeDataVerticalLayout:2===e.contract.detailVisualLayout,paddingDisabled:e.isPaddingDisabled,noVisualTitle:!e.visualTitleVisible(),preventVisualScrolling:this.preventInnerScroll()}},i.prototype.toggleSelect=function(e){var i=this;if(e.ctrlKey&&this.isSelected()&&p.getSelectedVisuals(this.services.selection).length>1)return t.util.EventBubblingUtility.markAsHandled(e),this.services.overlayService.hideAllDropdowns(),void p.unselectVisualContainer(this.scope.viewModel.contract,this.services.selection);this.selectVisualContainer(e.ctrlKey),this.services.overlayService.hideAllDropdowns();var r=!t.util.EventBubblingUtility.handled(e),o=$(e.currentTarget);t.util.EventBubblingUtility.markAsHandled(e),this.services.timeout((function(){r&&o.focus(),i.services.clipboard.tryPasteFormat()}))},i.prototype.onDoubleClick=function(e){this.services.viewModeState.getConfig().visualDoubleClickEnabled&&this.popOutVisualContainer()},i.prototype.onContextMenu=function(e){var t=this.scope;t.viewModel.options.showContextMenu&&(t.dataRoles=e.dataRoles,t.contextMenuData=e.data,this.isSelected()||this.selectVisualContainer(),this.contextMenu.create(t.viewModel.contract,t.contextMenuData,t.dataRoles,e.position))},i.prototype.ensureFocus=function(e){t.util.FocusUtility.isFocusInTree($(e.currentTarget))&&t.util.EventBubblingUtility.markAsHandled(e)},i.prototype.setViewModelServices=function(){var i=this;this.scope.viewModel.setServices({getLocalizedString:function(e){return i.services.localizationService.get(e)},canSelect:function(e){return i.canSelect(e)},onDragStart:function(e){return i.onDragStart(e)},onContextMenu:function(e){return i.onContextMenu(e)},onSelecting:function(e){return i.onSelecting(e)},onSelect:function(e){return i.onSelect(e)},persistProperties:function(e){return i.persistProperties(e)},shouldRetainSelection:function(){return i.shouldRetainSelection()},loadMoreData:function(){return i.loadMoreData()},onCustomSort:function(e){return i.onCustomSort(e.sortDescriptors)},getViewMode:function(){return i.scope.viewModeState.getMode()},getEditMode:function(){return i.scope.viewModel.editMode},setWarnings:function(e){return i.setClientWarnings(e)},setToolbar:function(e){return i.setToolbar(e)},geocoder:function(){return i.geocodingTracker.wrapGeocoder(i.services.geocoder)},geolocation:function(){return e.visuals.services.createGeolocation()},locale:function(){return e.common.unmappedCultureInfo},promiseFactory:function(){return i.services.promiseFactory},analyzeFilter:function(e){return t.services.createAnalyzedFilter(e,!1)},setIdentityDisplayNames:_.noop,getIdentityDisplayNames:function(e){return i.getLabelForScopeId(e)},visualCapabilitiesChanged:function(){return i.visualCapabilitiesChanged()},tooltips:function(){return i.services.visualHostTooltip},telemetry:function(){return i.visualHostTelemetryService},loader:function(){return i.services.moduleLoader},getUIComponentFactory:function(){return i.services.uiComponent.getUIComponentFactory(i.scope)},applyJsonFilter:function(e,t,r){return i.applyJsonFilter(e,t,r)}},this.services.visualPlugin,this.services.visualPluginOps,this.scope.viewModeState,this.services.formFactor,{getNextDataSegment:function(){return i.getNextDataSegment()},startProgressBar:function(){return i.startProgressBar()},stopProgressBar:function(){return i.stopProgressBar()}})},i.prototype.visualCapabilitiesChanged=function(){this.convertTo(this.scope.viewModel.readOnlyState.visual.type),this.services.eventBridge.publishToChannel(c.visualContainerChanged,{affectContainer:function(){return!0}})},i.prototype.getLabelForScopeId=function(e){return _.map(e,(function(e){return{displayName:h.getFirstComparandValue(e),identity:e}}))},i.prototype.createCanvasLayoutItemOptions=function(){var e=this,t=function(t,i){e.hideOverlays()},i=function(t,i){1===e.services.selection.getSelectedElements().length&&e.updateDimensions(t,i)},r=function(t,i){if(e.isEditable()&&!e.scope.viewModel.isPoppedOut&&1===e.services.selection.getSelectedElements().length){var r=new w(e.scope.viewModel.id,"nudge");e.updateDimensions(t,i,r),e.services.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1})}},n=function(t,i){e.hideOverlays(),e.services.eventBridge.publishToChannel(o.visualContainerResizeStart)},a=function(t,i){return e.updateVisualViewport(t,i)},s=function(t,i){e.updateDimensions(t,i),e.services.eventBridge.publishToChannel(o.visualContainerResizeEnd)},l=function(){return e.isExplorationUnloaded},c=function(){return e.getPosition(e.scope.viewModel.contract)},u=function(){return e.scope.viewModel.uiScale};this.scope.canvasLayoutItemOptions={dragEnd:i,dragStart:t,nudge:r,resizeStart:n,resizeMove:a,resizeEnd:s,isSuspended:l,getPosition:c,getScale:u}},i.prototype.subscribeToEvents=function(){var i=this,r=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.visualThemeChanged,(function(){return i.onVisualThemeChanged()})).subscribe(c.selectionChanged,(function(){return i.updateSelection()})).subscribe(c.visualContainerChanged,(function(e,t){t&&t.affectContainer(i.scope.viewModel.contract)&&!i.tryDeleteEmptyContainer()&&i.onVisualContainerChangedAsync(!1,t.allowCache)})).subscribe(c.filterContainerChanged,(function(e,t){i.onFilterContainerChanged(t)})).subscribe(c.dataSelectionChanged,(function(e,t){t&&t.affectContainer(i.scope.viewModel.contract)&&i.clearDataSelection()})).subscribe(c.explorationUnloaded,(function(e,t){i.scopeEventManager.unsubscribeAll(),i.isExplorationUnloaded=!0})).subscribe(c.changeViewMode,(function(e,t){return i.onChangeViewMode(t)})).subscribe(c.popOutModeChanged,(function(){var e=i.scope.viewModel.readOnlyState.visual;e.isInFocus=i.scope.viewModel.isPoppedOut,i.detailVisualProgressBarCount&&2!==i.scope.viewModel.contract.popOutMode&&(i.detailVisualProgressBarCount=0,i.updateProgressBarState()),i.scope.viewModel.updateViewState(),g.isScriptVisual(i.scope.viewModel.contract,i.services.visualPlugin)&&i.applyUpdate()}));this.services.eventBridge.subscribeToBubbling(this.scope,t.viewModels.DetailVisualEvents.spinnerAction,(function(e,t){if(e.stopPropagation&&e.stopPropagation(),2===i.scope.viewModel.contract.popOutMode)switch(t){case 0:i.startProgressBar(),i.detailVisualProgressBarCount++;break;case 1:0===--i.detailVisualProgressBarCount&&i.updateProgressBarState()}})),this.services.eventBridge.subscribeToBubbling(this.scope,c.toggleSortVisualContainer,(function(e,t){i.sortHelper.toggleSort(t.sortableField,t.sortDirection)})),this.services.eventBridge.subscribeToBubbling(this.scope,c.getClusters,(function(t,r){return __awaiter(i,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.services.lazyScoped("clustering")];case 1:return e=t.sent(),e.createClusters(this.scope.viewModel,this.services.dataSources.get(),r.useSpatialClustering),[2]}}))}))})),this.services.eventBridge.subscribeToBubbling(this.scope,c.changeEditMode,(function(e,t){i.onChangeEditMode(t)}));var n,a=this.scope.viewModel.contract.config.singleVisual.visualType;!a||this.services.trustedVisual.canLoadVisual(a)&&this.services.visualPlugin.getPlugin(a)||(n=this.services.rootScope.$on(e.constants.reloadEmptyVisuals,(function(e,t){_.contains(t.visualTypes,a)&&(n(),i.onVisualContainerChangedAsync())}))),this.scope.$on("$destroy",(function(){r.unsubscribeAll(),n&&n(),i.scope.viewModel.contract.config.singleVisual.getCurrentVisual=void 0,i.scope.viewModel.contract.config.singleVisual.getErrorDetails=void 0,i.scope.viewModel.contract.config.singleVisual.getWarnings=void 0,i.scope.viewModel.contract.config.singleVisual.getSelectedDataPoints=void 0}))},i.prototype.onFilterContainerChanged=function(e){if(0!==e.scope.scopeType||e.scope.container===this.scope.viewModel.contract)switch(e.changeType){case 1:case 0:null!=e.filter&&null!=e.filter.filter&&this.applyUpdate();break;case 10:case 2:this.applyUpdate()}},i.prototype.drop=function(t,i){var r=this.services.dragDataService.getDragContext();r&&r.field&&s.isDropOnExpectedTarget(i.draggable,this.scope.viewModel.contract)&&(p.selectVisualContainer(this.scope.viewModel.contract,this.services.selection),this.services.visualAuthoring.addFieldToVisual(r.field,this.services.dataSources.get(),this.scope.viewModel.contract,e.telemetry.HowFieldWasAddedToVisual.DraggedToVisual))},i.prototype.getDragRestrictElementRect=function(){var e={top:0,left:0,bottom:1,right:1};if(p.hasMultipleVisualContainerSelection(this.services.selection)){for(var t=p.getSelectedVisuals(this.services.selection),i=0,r=0,o=0,n=0,a=null,s=0,l=0,c=t.length;l<c;l++){s=l;var u=t[l],d=this.scope.viewModel.contract;if(u===d){a=this.getPosition(u);break}}if(!a)return;if(t.splice(s,1),a){for(var v=0,h=t;v<h.length;v++){var u=h[v],g=this.getPosition(u),f=a.x-g.x;i=i<f?f:i,f=g.y+g.height-(a.y+a.height),r=r<f?f:r,f=a.y-g.y,o=o<f?f:o,f=g.x+g.width-(a.x+a.width),n=n<f?f:n}e={top:0-(o>0?o/a.height:0),left:0-(i>0?i/a.width:0),bottom:1+(r>0?r/a.height:0),right:1+(n>0?n/a.width:0)}}}return e},i.prototype.setClientWarnings=function(e){if(_.isEmpty(e))return void(this.warnings=null);if(_.isArray(e)?this.warnings={warnings:e}:this.warnings=e,!_.isEmpty(this.warnings.warnings)){var t=this.warnings.warnings[0].getMessages(this.services.localizationService),i={message:t.message,displayableErrorInfo:[{errorInfoKey:t.title,errorInfoValue:t.detail}]};this.scope.ctrlError.showInfoIcon(i,this.warnings.warnings[0].code)}},i.prototype.setToolbar=function(e){this.scope.viewModel.toolbarViewModel.$element=e,this.scope.viewModel.toolbarViewModel.update(),null!=e&&this.setToolbarVisible(!0)},i.prototype.setToolbarVisible=function(e){var t=this;if(this.scope.viewModel.toolbarViewModel.$element){var i=this.services.viewModeState.getMode();if(e=e&&this.scope.viewModel.isSelected&&1===i){var r=this.services.formFactor.getCurrentLayoutCapabilities();e=r.canShowVisualToolbar()}this.scope.viewModel.toolbarViewModel.visible!==e&&this.scope.$applyAsync((function(){t.scope.viewModel.toolbarViewModel.visible=e,t.scope.viewModel.toolbarViewModel.update()}))}},i.prototype.hideOverlays=function(){this.services.overlayService.hideAllDropdowns(),this.setToolbarVisible(!1)},i.prototype.onVisualThemeChanged=function(){this.resetVisualStyle(),this.onVisualContainerChangedAsync(!1,!0)},i.prototype.onVisualContainerChangedAsync=function(e,t){var i=this;return f.ensurePlugin(this.scope.viewModel.contract.config.singleVisual.visualType,this.services.visualPlugin,this.services.moduleLoader,this.services.promiseFactory).then((function(){var r=i.scope.viewModel;r.contract.config.singleVisual.getCurrentVisual=function(){return r.readOnlyState.visual.visual},r.contract.config.singleVisual.getErrorDetails=function(){return i.getErrorDetails()},r.contract.config.singleVisual.getWarnings=function(){return i.getWarnings()},r.contract.config.singleVisual.getSelectedDataPoints=function(){return i.getSelectedDataPoints()},i.setOnClearSelectedDataPoints(),i.updateVisualContainerProperties();var o=r.dataViewSource,n=i.scope.viewModel.readOnlyState.visual;o?(i.queryHandler.visualizeDataViewSource(r.contract,o,n.viewport),r.dataViewSource=null):i.services.visualPluginOps.isQueryVisualContainer(r.contract)?i.scope.viewModel.errorInfo||i.applyUpdate(e,!1,t):i.queryHandler.updateNonQueryVisual(r.contract,n.dataTransforms)}))},i.prototype.updateVisualContainerProperties=function(){var e=this.scope.viewModel;this.scope.ctrlError.clearError();var t=this.queryHandler.validate(e.contract);t&&(this.scope.ctrlError.showErrorOverlay(t.details,t.code),this.updateDisablePin()),e.setTooltip(),this.updateDetailVisualVisibility(),this.resetBackground(),this.resetTitle(),this.resetAspectRatio(),this.resetBorder(),this.resetPadding(),this.resetSortSettings(),this.updateMenuButtonsState(),this.scope.viewModel.errorInfo||e.updateViewState()},i.prototype.getErrorDetails=function(){if(this.scope.viewModel.errorInfo)return this.scope.viewModel.errorInfo.details},i.prototype.getWarnings=function(){return this.warnings},i.prototype.getSelectedDataPoints=function(){return this.selectedDatapoints},i.prototype.updateMenuButtonsState=function(){var e=this,t=this.services.viewModeState.getMode(),i=this.scope.menuOptions;i.canExport=this.canExport(),i.canDelete=1===t&&this.services.viewModeState.getConfig().supportsDeletion;var r=i.sortSetting;i.canSort=r.defaultSortBehavior&&r.sortableFields.length>0,i.canEdit=this.canEdit();var o=[];o.push(this.canSearch().then((function(){return i.canSearch=!0,!0}),(function(){return i.canSearch=!1,!0}))),o.push(this.canCluster().then((function(){return i.canCluster=1===e.services.viewModeState.getMode(),i.canSpatialCluster=i.canCluster&&e.services.featureSwitchService.featureSwitches.spatialClusteringEnabled,!0}),(function(){return i.canCluster=!1,i.canSpatialCluster=!1,!0}))),this.services.promiseFactory.all(o).then((function(){i.hasMoreOptions=e.scope.viewModel.options.showMenu&&(i.canExport||i.canDelete||i.canSort||i.canSearch||i.canCluster)}))},i.prototype.canEdit=function(){var e=g.getVisualType(this.scope.viewModel.contract),t=this.services.viewModeState.getMode(),i=this.scope.viewModel.editMode,r=this.services.formFactor.getCurrentLayout(),o=0===r&&!this.scope.viewModel.errorInfo&&this.canPopOut();return 1===t&&1!==i&&this.services.visualPluginOps.canEdit(e,o)},i.prototype.canCluster=function(){var t=this;if(!this.services.featureSwitchService.featureSwitches.clusteringEnabled)return this.services.promiseFactory.reject();var i=this.scope.viewModel.contract.config.singleVisual,r=this.services.visualPlugin.capabilities(i.visualType);if(!r||!r.grouping||!r.grouping.cluster)return this.services.promiseFactory.reject();var o=r.grouping.cluster,n=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(n).then((function(r){var n=i.query;if(!n||!n.defn||_.some(n.defn.select(),(function(e){return v.isHierarchyLevel(e.expr)||v.isHierarchy(e.expr)}))||g.hasGroupByItems(n))return t.services.promiseFactory.reject();var a=_.chain(n.defn.select()).map((function(e){return e.expr.getTargetEntity().schema})).uniq().value(),s=1===_.size(a)&&r.schema(a[0]).capabilities.supportsClustering;if(!s)return t.services.promiseFactory.reject();for(var l=n.projections,c=g.createRoleKindByQueryRef(i.query),u=0,p=o.conditions;u<p.length;u++){var d=p[u],h=e.DataViewAnalysis.checkForConditionErrors(l,d,c,!1);if(_.isEmpty(h))return t.services.promiseFactory.resolve()}return t.services.promiseFactory.reject()}))},i.prototype.updateVisualViewport=function(e,t){e.stopPropagation();var i={width:t.width,height:t.height};this.scope.viewModel.updateVisualViewportForUserResize(i),this.setToolbarVisible(!1)},i.prototype.updateDimensions=function(e,t,i){var r=this;e.stopPropagation&&e.stopPropagation(),this.services.undoRedo.register("VisualContainerUpdateDimensions",(function(){var e=r.scope.viewModel,i={x:t.x,y:t.y,z:e.position.z,width:t.width,height:t.height,angle:t.angle};r.services.layoutAuthoring.moveVisualContainer(r.scope.viewModel,i)}),i),this.setToolbarVisible(!0)},i.prototype.convertTo=function(e){var i=this;this.services.eventBridge.publishBubbling(this.scope,c.visualConversion,{visualContainer:this.scope.viewModel.contract,newVisualType:e,actionAfterConversion:function(){i.resetSortSettings(),t.util.VisualContainerUtils.notifyVisualContainersExceptSource(i.services.eventBridge,i.scope.viewModel.contract)}})},i.prototype.getPosition=function(e){var t=e.layouts.withId(this.services.formFactor.getCurrentLayout());return t&&t.position},i.prototype.selectVisualContainer=function(e){p.selectVisualContainer(this.scope.viewModel.contract,this.services.selection,e)},i.prototype.isSelected=function(){return p.isVisualContainerSelected(this.scope.viewModel.contract,this.services.selection)},i.prototype.updateSelection=function(){var e=this.isSelected();this.scope.viewModel.setSelected(e),this.setToolbarVisible(e),this.scope.$emit(r.VisualSelectionOrPositionChangedEventName)},i.prototype.preventInnerScroll=function(){return!this.isSelected()&&this.services.viewModeState.getConfig().touchOptions.touchEventsOnSelectedVisualOnly},i.prototype.clearDataSelection=function(){var e=this.scope.viewModel.contract.config.singleVisual;e.clearSelectedDataPoints()},i.prototype.setOnClearSelectedDataPoints=function(){var e=this,t=this.scope.viewModel.contract.config.singleVisual;t.clearSelectedDataPoints=function(){if(e.selectedDatapoints=void 0,t.getCurrentVisual){var i=t.getCurrentVisual();i&&i.onClearSelection&&i.onClearSelection()}}},i.prototype.onChangeViewMode=function(e){this.updateMenuButtonsState();var t=1===e;this.setToolbarVisible(t),0===e&&this.scope.viewModel.setEditMode(0);var i=this.scope.viewModel.readOnlyState.visual,r=i.visual;r&&r.onViewModeChanged&&r.onViewModeChanged(e)},i.prototype.onChangeEditMode=function(t){this.updateMenuButtonsState();var i=(this.scope.viewModel.readOnlyState.visual,this.scope.viewModel);i.setEditMode(t);var r=g.getVisualType(i.contract),o=this.services.visualPlugin.capabilities(r);o&&2===o.advancedEditModeSupport?this.services.popOut.popOutVisualContainer(i.contract,1):r!==e.visualHost.EsriVisual&&r!==e.visualHost.SandDanceVisual||(this.services.viewModeState.setMode(2),this.services.viewModeState.updateConfig((function(e){e.alwaysPopulatePanes||(e.alwaysPopulatePanes=!0)})),this.services.popOut.popOutVisualContainer(i.contract,1))},i.prototype.popOutVisualContainer=function(){var e=this.scope.viewModel;this.services.popOut.popOutVisualContainer(e.contract,1)},i.prototype.canPopOut=function(){return!this.scope.viewModel.isPoppedOut&&this.services.visualPluginOps.supportsFocusMode(g.getVisualType(this.scope.viewModel.contract))},i.prototype.resetSortSettings=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,r,o,n,a,s;return __generator(this,(function(l){switch(l.label){case 0:return e=this.services.dataSources.get(),e?[4,this.services.conceptualSchemaProxy.get(e)]:[3,3];case 1:return t=l.sent(),[4,f.ensurePlugin(this.scope.viewModel.contract.config.singleVisual.visualType,this.services.visualPlugin,this.services.moduleLoader,this.services.promiseFactory)];case 2:l.sent(),i=this.scope.viewModel.contract.config.singleVisual,i&&i.query&&(r=this.services.visualPlugin.capabilities(i.visualType),o=i.query,r&&(n=void 0!==r.sorting&&void 0!==r.sorting.default,
a=this.services.sort.getSortableFields({query:o,schema:t,visualType:i.visualType,objectDefns:i.objects}),this.sortHelper.resetSortSettings(a,n))),s=_.findIndex(this.scope.menuOptions.sortSetting.sortableFields,(function(e){return e.active})),s>=0&&(this.scope.viewModel.readOnlyState.actualSortDirection=this.scope.menuOptions.sortSetting.sortableFields[s].sortDirection),this.updateMenuButtonsState(),l.label=3;case 3:return[2]}}))}))},i.prototype.resetVisualStyle=function(){var e=t.ScopeUtils.findThemeName(this.scope);this.scope.viewModel.themeName=e,this.scope.viewModel.readOnlyState.visual&&(this.scope.viewModel.readOnlyState.visual.themeName=e)},i.prototype.resetPadding=function(){var e=this.scope.viewModel.contract.config.singleVisual,t=this.services.visualPlugin.capabilities(e.visualType);this.scope.viewModel.isPaddingDisabled=t&&t.suppressDefaultPadding},i.prototype.resetBackground=function(){var e=this.scope.viewModel.contract.config.singleVisual,t=e.background,i=this.scope.viewModel;t&&t.show?i.visualBackground={colorRGB:g.getVisualBackgroundRGBColor(t)}:i.visualBackground=null},i.prototype.resetAspectRatio=function(){var e=this.scope.viewModel,t=e.contract.config.singleVisual.aspectRatio;e.lockAspectRatio=!(!t||!t.show)},i.prototype.resetBorder=function(){var e=this.scope.viewModel.contract.config.singleVisual,i=e.border,r=this.scope.viewModel,o=t.viewModels.VisualBorder.getDefaultValues(),n={show:i?i.show:o.show,color:i&&i.color?i.color:o.color};r.visualBorder=n.show?new t.viewModels.VisualBorder(n):null},i.prototype.resetTitle=function(){var e=this,i=this.scope.viewModel,r=i.contract.config.singleVisual,o=this.services.visualPlugin.capabilities(r.visualType),n=this.services.dataSources.get();this.startProgressBar(),o&&!t.contracts.VisualTitle.isHidden(r.title)&&n?this.services.conceptualSchemaProxy.get(n).then((function(t){e.services.displayNameService&&(i.setVisualTitle(e.services.displayNameService.getVisualTitle(r,t,o)),i.updateViewState())})).finally((function(){e.stopProgressBar()})):(i.visualTitle=void 0,this.stopProgressBar())},i.prototype.hasMultipleScopeIds=function(e){if(!(e&&e.data&&e.data.length>0))return!1;if(e.data.length>1)return!0;if(!e.data[0])return!1;var t=e.data[0];if(!t.expr)return!1;var i=t.expr;return 8===i.kind},i.prototype.canSelect=function(i){var r,o=this,n=e.extensibility.legacy.isOldSelectEventArgs(i);if(r=n?e.extensibility.legacy.getSelectors(i):_.map(i.visualObjects,(function(e){return d.convertSelectorsByColumnToSelector(e.selectorsByColumn)})),r.length>1&&r.some((function(e){return o.hasMultipleScopeIds(e)}))){if(i.visualObjects){var a=this.scope.viewModel.contract.config.singleVisual,s=_.map(i.visualObjects,(function(e){return e.selectorsByColumn}));if(this.services.featureSwitchService.featureSwitches.tuplesFiltering){var l=this.services.conceptualSchemaProxy.getLatestCapabilities(this.services.dataSources.get(),void 0);if(l&&l.supportsMultiTableTupleFilters)return!0}if(t.utils.GroupUtils.canGroup(s,a.query))return!0}return!1}return!0},i.prototype.onDragStart=function(e){},i.prototype.shouldRetainSelection=function(){return this.isDrillEnabled()},i.prototype.isDrillEnabled=function(){var e=this.scope.viewModel.contract,t=this.services.drill;if(e&&e.drillMode)return t.isDrillModeEnabled(e,1)||t.isDrillModeEnabled(e,2)},i.prototype.drill=function(e,t){var i=this.scope.viewModel.contract,r=this.services.dataSources.get();switch(i.drillMode){case 1:this.services.visualAuthoring.drillDown(e,i,r,t);break;case 2:this.services.drillToDetails.drillToDetails(e,i,r)}},i.prototype.onSelecting=function(t){if(this.isDrillEnabled()){var i=_.isEmpty(t.dataRoles)?void 0:_.first(t.dataRoles);e.extensibility.legacy.isOldSelectEventArgs(t)?this.drill(e.extensibility.legacy.getSelectorsByColumn(t),i):this.drill(_.map(t.visualObjects,(function(e){return e.selectorsByColumn})),i),t.action=1}else t.action=0},i.prototype.onSelect=function(t){var i=e.extensibility.legacy.isOldSelectEventArgs(t);if(this.isDrillEnabled())this.services.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1}),i?this.drill(e.extensibility.legacy.getSelectorsByColumn(t)):this.drill(_.map(t.visualObjects,(function(e){return e.selectorsByColumn})));else{var r=void 0;r=i?e.extensibility.legacy.getSelectors(t):_.map(t.visualObjects,(function(e){return d.convertSelectorsByColumnToSelector(e.selectorsByColumn)}));for(var o=0,n=r;o<n.length;o++){var a=n[o];a.data=d.filterTransformSelectorsForSelection(a.data)}var s=0!==_.size(t.visualObjects)||0!==_.size(this.selectedDatapoints);this.selectedDatapoints=t.visualObjects?_.map(t.visualObjects,(function(e){return e.selectorsByColumn})):void 0,this.scope.viewModel.hostServices.selectDataPoint(this.services.filterGenerator,r),s&&this.raiseDataPointsSelectedEvent(r)}},i.prototype.raiseDataPointsSelectedEvent=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i],n=this.visualContainerDataSelectionService.getSelectedValues(o);t.push({selector:o,values:n})}var a={dataPointsDescriptions:t,visualContainer:this.scope.viewModel.contract,visualTitleText:this.scope.viewModel.visualTitle?this.scope.viewModel.visualTitle.text:null};this.services.eventBridge.publishToChannel(c.dataPointsSelected,a)},i.prototype.startProgressEvent=function(){this.progressTransitionEvent&&this.progressTransitionEvent.resolve(),this.progressTransitionEvent=this.services.telemetryService.startActivity(this.scope,e.telemetry.EXRenderExplorationVisual,this.scope.viewModel.contract&&this.scope.viewModel.contract.config&&this.scope.viewModel.contract.config.singleVisual&&this.scope.viewModel.contract.config.singleVisual.visualType)},i.prototype.endProgressEvent=function(){this.progressTransitionEvent&&(this.progressTransitionEvent.resolve(),this.progressTransitionEvent=null)},i.prototype.startProgressBar=function(){var e=this.scope.viewModel.showProgressBar;this.scope.viewModel.showProgressBar=!0,this.progressBarCount++,e||(this.services.loadProgressNotificationService.beginLoad(),this.startProgressEvent())},i.prototype.stopProgressBar=function(){0===--this.progressBarCount&&this.updateProgressBarState()},i.prototype.updateProgressBarState=function(){var e=this,t=this.progressBarCount>0&&this.detailVisualProgressBarCount>0;this.scope.viewModel.showProgressBar=t&&this.geocodingTracker.hasPendingGeocoding(),t||this.endProgressEvent(),this.scope.viewModel.showProgressBar||this.endLoadDefer.promise.finally((function(){e.services.loadProgressNotificationService.endLoad()}))},i.prototype.updateDisablePin=function(){this.scope.disablePin=this.scope.viewModel.options.disablePin||this.shouldBlockPinButtonForScriptVisual()},i.prototype.shouldBlockPinButtonForScriptVisual=function(){var e=this.services.visualPlugin,t=this.scope.viewModel.contract;return g.isScriptVisual(t,e)&&this.services.viewModeState.getConfig().supportsPinning&&this.services.scriptVisuals.shouldBlockScriptVisual()},i.prototype.applyUpdate=function(e,i,r){var o=this,a=this.scope.viewModel,s=a.contract,l=a.readOnlyState.visual&&a.readOnlyState.visual.viewport,c=this.scope.viewModel.readOnlyState.visual,u=this.queryExecutionServices.getDataSources();!e&&this.scope.viewModel.hostServices?this.services.conceptualSchemaProxy.get(u).then((function(p){var d={dataSources:u,schema:p,config:s.config.singleVisual,hostServices:o.scope.viewModel.hostServices,visualQueryGenerator:o.services.visualQueryGenerator,isLoadMore:!1,isInitialLoad:e,allowCache:r,preferCurrentData:i,viewport:l},v=t.services.createExploreVisualDataProxyService(o.services.singleExecutableDataProxyFactory.create(),o.services.filterGenerator),h=v.generateQuery(d);if(h&&s.cachedData){s.cachedData.dataUpdatedTime=void 0;var g=o.services.visualPlugin.capabilities(s.config.singleVisual.visualType);s.cachedData.transformsObject=n.serializeDataViewTransformActions(h.transforms,g.objects),s.cachedData.queryObject=h.options.query.command,s.cachedData.dataObject=void 0}o.queryHandler.runQuery({contract:s,viewport:l,initialLoad:e,useVisualContainerCache:a.shouldUseCache(),preferCurrentData:i,allowCache:r,currentData:c.data,geocodingTracker:o.geocodingTracker,generatedQuery:h})})):this.queryHandler.runQuery({contract:s,viewport:l,initialLoad:e,useVisualContainerCache:a.shouldUseCache(),preferCurrentData:i,allowCache:r,currentData:c.data,geocodingTracker:this.geocodingTracker})},i.prototype.loadMergedData=function(e){var t=this.scope.viewModel.readOnlyState.visual;t.data=e},i.prototype.handleQueryResult=function(t,i,r){var o=this.scope.viewModel.readOnlyState.visual;o.dataTransforms=i,r&&(o.dataTransforms=e.Prototype.inherit(o.dataTransforms),o.dataTransforms.objects=r),o.data=t;var n=this.scope.viewModel;n&&n.contract&&n.contract.cachedData&&n.contract.cachedData.dataUpdatedTime&&(n.lastUpdateAttemptTime=(new Date).toLocaleString())},i.prototype.handleQueryErrors=function(i){if(i||(i=new y),!i.ignorable||i.ignorable!==!0){var o,n=this.scope.viewModel.readOnlyState.visual;if(i instanceof e.DsrClientError){var a=i,s=a.powerBiErrorDetails,l=a.AdditionalErrorMessages;if(s)try{var c=JSON.parse(s);o=c.error,this.services.eventBridge.publishBubbling(this.scope,t.services.events.showErrorNotification,c.error)}catch(e){}if(l)for(var u=0,p=l.length;u<p;u++){var d=l[u];if(d.Code&&d.Message){var v=d.Code,h=d.Message;if(v===r.serverErrors.onPremiseServiceException)try{var c=JSON.parse(h);o=c.error,this.services.eventBridge.publishBubbling(this.scope,t.services.events.showErrorNotification,c.error)}catch(e){}}}}var f=i.getDetails(e.common.localize);if(o){f.displayableErrorInfo.length>0&&(f.displayableErrorInfo[0].errorInfoValue=e.common.localize.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+o.code)),f.displayableErrorInfo.push({errorInfoKey:e.common.localize.get("AdditionalErrorInfo_ErrorText"),errorInfoValue:o.code});var m=e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessage(o);m.always((function(e){if(e&&e.displayableErrorInfo)for(var t=0;t<e.displayableErrorInfo.length;t++)f.displayableErrorInfo.push(e.displayableErrorInfo[t])}))}if(g.isScriptVisual(this.scope.viewModel.contract,this.services.visualPlugin)){var w=this.services.scriptVisuals.overrideEmbeddedErrorDetails(f);f=w||f}this.scope.ctrlError.showErrorOverlay(f,i.code,i.requestId,i.source),n.data=null}},i.prototype.handleWarnings=function(t,i){if(!_.isEmpty(t))for(var r=_.any(t,(function(t){return t instanceof e.data.dsr.DsrLimitsWarning})),o=0,n=t;o<n.length;o++){var a=n[o];a.columnNameFromIndex=function(e){var t=i.selects;return t.length<=e?null:t[e].displayName};var s=a.getDetails(e.common.localize);a instanceof e.data.dsr.DsrLimitsWarning?this.scope.ctrlError.showInfoIcon(s,a.code):a instanceof l&&a.isTransformMessage()?this.scope.ctrlError.showTransformWarningIcon(s,a.code,r):this.scope.ctrlError.showWarningIcon(s,a.code)}},i.prototype.getNextDataSegment=function(){var e=this.scope.viewModel,t=e.contract,i=e.readOnlyState.visual&&e.readOnlyState.visual.viewport;return this.queryHandler.getNextDataSegment({contract:t,viewport:i,useVisualContainerCache:e.shouldUseCache()})},i.prototype.loadMoreData=function(){var e=this.scope.viewModel,t=e.contract,i=e.readOnlyState.visual&&e.readOnlyState.visual.viewport,r=e.readOnlyState.visual.data;this.queryHandler.loadMoreData({contract:t,currentData:r,useVisualContainerCache:e.shouldUseCache(),viewport:i})},i.prototype.persistProperties=function(e){var t=this,i=this.scope.viewModel,r=i.contract.config.singleVisual;this.services.undoRedo.register("VisualContainerPersistProperties",(function(){var i=_.isArray(e)?{replace:e}:e;return!!t.services.visualAuthoring.persistProperties(i,r)&&(t.applyUpdate(void 0,!0),t.updateVisualContainerProperties(),!0)}))},i.prototype.applyJsonFilter=function(t,i,r){return __awaiter(this,void 0,e.Promise,(function(){var e,o,n,a,s,l,u;return __generator(this,(function(p){switch(p.label){case 0:return e=this.services.dataSources.get(),[4,this.services.moduleLoader.require({javascript:"JSONFilter/services/jsonFilterParserMin"})];case 1:return o=p.sent(),n=o.create(this.services.promiseFactory),[4,this.services.conceptualSchemaProxy.get(e)];case 2:return a=p.sent(),s=n.tryCreateSemanticFilter("Filter",a,t),l={},l[r]=s,u={merge:[{objectName:i,properties:l,selector:void 0}]},this.persistProperties(u),this.services.eventBridge.publishToChannel(c.visualContainerChanged,{affectContainer:g.contractUnEqualityComparator(this.scope.viewModel.contract)}),[2]}}))}))},i.prototype.onCustomSort=function(e){this.sortHelper.applySortByFields(e),this.services.overlayService.hideAllDropdowns()},i.prototype.tryDeleteEmptyContainer=function(){var t=this.scope.viewModel.contract.config;if(t&&t.singleVisual&&this.services.visualPluginOps.isQueryVisual(t.singleVisual.visualType)&&t.singleVisual.query&&0===t.singleVisual.query.defn.select().length){var i=this.services.visualPlugin.capabilities(t.singleVisual.visualType);if(i){var r=e.ScriptResultUtil.extractScriptResultFromVisualConfig(i.dataViewMappings,t.singleVisual.objects);if(r&&!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(r.source))return!1}return this.deleteVisualContainer(!0),!0}return!1},i.prototype.deleteVisualContainer=function(e){var t=this;e?this.deleteVisualContainerInternal():this.services.undoRedo.register("DeleteVisualContainer",(function(){return t.deleteVisualContainerInternal()}))},i.prototype.deleteVisualContainerInternal=function(){var e=this.scope.viewModel,t=this.services,i=t.eventBridge;i.publishBubbling(this.scope,c.deleteVisualContainer,e.contract)},i.prototype.updateDetailVisualVisibility=function(){var e=this.scope.viewModel.contract,t=2===e.popOutMode;t&&!this.services.drill.canSeeData(e)&&this.setPopOutMode(1)},i.prototype.setPopOutMode=function(e){0===e?this.services.popOut.clearPopOut():this.services.popOut.popOutVisualContainer(this.scope.viewModel.contract,e)},i.prototype.isHeaderVisible=function(){if(this.services.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeader()){var e=this.services.viewModeState.getConfig().displayOptions;return(!e.hideInFocusTileMenu||!this.scope.viewModel.isPoppedOut)&&!(e.hideTileMenu||this.scope.viewModel.options.hideHeader)}},i.prototype.canRemoveFromLayout=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canRemoveVisualFromLayout()&&!this.isHeaderVisible()},i.prototype.removeVisualFromLayout=function(){this.services.eventBridge.publishBubbling(this.scope,c.removeVisualContainerFromLayout,this.scope.viewModel.contract)},i.prototype.isPopOutBarVisible=function(){return this.scope.viewModel.isPoppedOut&&!this.scope.viewModel.options.hideHeader&&!this.services.viewModeState.getConfig().displayOptions.hideInFocusBar},i.prototype.shouldRestrictTransformDraw=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()},i.prototype.isEditable=function(){var e=this.services.viewModeState.getMode();return 1===e},i.prototype.canExport=function(){var e=!1,t=!1,i=!!this.services.viewModeState.getConfig().supportsExportData,r=this.scope.viewModel;if(null!=r){t=r.showWatermark;var o=r.contract&&r.contract.config,n=o&&o.singleVisual&&o.singleVisual.visualType;jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(n)||(e=this.services.visualPluginOps.isQueryVisual(n))}return i&&e&&!t},i.prototype.canSearch=function(){var e=this,t=this.scope.viewModel;if(t){var i=g.getVisualType(t.contract);if(this.services.visualPluginOps.supportVisualSearch(i)){var r=this.services.dataSources.get();if(r)return this.services.conceptualSchemaProxy.get(r).then((function(i){return g.containSearchableField(t.contract,e.services.visualPlugin,i)?e.services.promiseFactory.resolve():e.services.promiseFactory.reject()}))}}return this.services.promiseFactory.reject()},i})();i.VisualContainerController=m;var y=(function(e){function t(){return e.call(this,"VisualDataProxyExecutionUnknownError")||this}return __extends(t,e),t})(e.UnknownClientError),w=(function(){function e(e,t){this.visualContainerId=e,this.action=t}return e.prototype.equals=function(e){return!!e&&this.action===e.action&&this.visualContainerId===e.visualContainerId},e})()})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.explore.modules,n=e.visuals.plugins,a=t.services.selectionUtils,s=t.util.VisualContainerUtils,l=(function(){function e(e,i){var n=this;this.scope=e,this.services=i,this.scope.viewModeState=i.viewModeState,this.scope.setActiveSection=function(e){return n.setActiveSection(e)},this.scope.setActivePagePaneSection=function(e){return n.setActivePagePaneSection(e)},this.scope.toggle=function(){return n.toggle()},this.scope.exploreUIShellConfig=o.ExploreUIShellModule,this.scope.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.updateAll();var a=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.selectionChanged,(function(){n.updateSections(),n.updateHeader(),n.updatePagePaneSections()}));this.scope.$watchGroup(["viewModeState.getMode()","viewModeState.getConfig().alwaysPopulatePanes"],(function(){return n.updateAll()})),this.scope.$on(t.constants.explorationLoadedEventName,(function(){return n.updateAll()})),this.scope.$on("$destroy",(function(){return a.unsubscribeAll()}))}return e.createOptions=function(){return{additionalServices:["featureSwitchService","localizationService"],scopedDependencies:["eventBridge","selection","viewModeState","visualPlugin","visualPluginOps"]}},e.prototype.setActiveSection=function(e){this.scope.viewModel.activeSection=e,this.updateShowHideElements()},e.prototype.setActivePagePaneSection=function(e){this.scope.viewModel.activePageSection=e,this.updateShowHideElements()},e.prototype.updateAll=function(){var e=this.scope.viewModeState.getMode();this.scope.isEditing=1===e,this.scope.populatePanes=this.scope.isEditing||this.scope.viewModeState.getConfig().alwaysPopulatePanes,this.scope.showVisualTypes=this.scope.populatePanes,this.scope.viewModel&&(this.updateShowHideElements(),this.updateSections(),this.updatePagePaneSections(),this.updateHeader())},e.prototype.updateShowHideElements=function(){var e=this.scope.viewModel.activeSection,t=this.scope.viewModel.activePageSection,i=this.scope.populatePanes,r=this.getSelectedVisual();r?this.scope.showVisualTypes=i&&this.services.visualPluginOps.canConvertVisual(r):this.scope.showVisualTypes=i,this.scope.showFieldWellOrFilters=!e&&!t||0===e||0===t,this.scope.showFieldWell=i&&(0===e||0===t),this.scope.showPropertyPane=i&&1===e,this.scope.showPagePropertyPane=i&&1===t&&!this.scope.isNonQueryVisual,this.scope.showAnalyticsPane=i&&2===e},e.prototype.updateSections=function(){var e=this.getSelectedVisual(),t=this.scope.viewModel,i=s.getVisualType(e),r=this.services.visualPluginOps,o=r.isSupportedVisual(e),n=i&&r.isQueryVisual(i);if(this.scope.isNonQueryVisual=void 0!==e&&!n,t.sections=[],!e||!o)return void this.setActiveSection(void 0);if(this.scope.isEditing&&this.scope.isNonQueryVisual)this.setActiveSection(1);else{var a=t.activeSection;void 0===a&&this.setActiveSection(0),t.sections.push({sectionType:0,displayName:this.services.localizationService.get("VisualizationPane_Section_Fields"),cssClass:"fields"})}r.canFormatVisual(e)&&(t.sections.push({sectionType:1,displayName:this.services.localizationService.get("VisualizationPane_Section_Format"),cssClass:"format"}),t.sections.push({sectionType:2,displayName:this.services.localizationService.get("VisualizationPane_Section_Analytics"),cssClass:"analytics"}))},e.prototype.updatePagePaneSections=function(){var e=this.getSelectedVisual(),t=this.scope.viewModel;return t.pagePaneSections=[],e?void this.setActivePagePaneSection(void 0):(void 0===t.activePageSection&&this.setActivePagePaneSection(0),t.pagePaneSections.push({sectionType:0,displayName:this.services.localizationService.get("VisualizationPane_Section_Fields"),cssClass:"fields"}),void t.pagePaneSections.push({sectionType:1,displayName:this.services.localizationService.get("VisualizationPane_Section_Format"),cssClass:"format"}))},e.prototype.updateHeader=function(){var e;if(this.scope.populatePanes){var t=this.getSelectedVisual();if(t){var i=t.config.singleVisual.visualType;i===n.basicShape.name?e="VisualizationPane_Shape":i===n.image.name&&(e="VisualizationPane_Image")}e=e||"VisualizationPane_Title"}else e="VisualizationPane_Filters";this.scope.viewModel.header=this.services.localizationService.get(e)},e.prototype.toggle=function(){this.scope.viewModel.isPaneExpanded=!this.scope.viewModel.isPaneExpanded},e.prototype.getSelectedVisual=function(){return a.getDefaultSelectedVisualInSingleOrMultiCase(this.services.selection)},e})();i.VisualizationPaneController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.ImportVisualErrorDialogController),this.templateUrl="views/importVisualErrorDialog.html"}return i})();i.ImportVisualErrorDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.ImportVisualWarningDialogController),this.templateUrl="views/importVisualWarningDialog.html"}return i})();i.ImportVisualWarningDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.replace=!0,this.scope={items:"=",selectedValue:"=",onSelect:"="},this.templateUrl="views/inputFields/selectionBox.html",this.link=function(e,t){function i(i){e.selectedItem=i,e.selectedValue=i.value,e.showDropdown=!1,t.focus(),e.onSelect(e.selectedValue)}function r(){if(e.selectedItem=null,e.items)for(var t=e.selectedValue,i=0,r=e.items;i<r.length;i++){var o=r[i];if(o.value===t){e.selectedItem=o;break}}}e.showDropdown=!1,e.hasHideableItems=_.any(e.items,(function(e){return void 0!==e.isHidden})),e.itemSelected=function(e){return i(e)},r();var o=e.$watch("selectedValue",(function(e,t){r()})),n=e.$on("$destroy",(function(){o(),n()}))}}return e})();e.SelectionBox=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.require="ngModel",this.restrict="E",this.scope={validators:"=",placeholder:"<",inputType:"@"},this.templateUrl="views/inputFields/propertyPaneTextBox.html",this.link=function(e,i,r,o){o.$render=function(){e.sliceValue=o.$viewValue},e.onKeydown=function(e){e.which===$.ui.keyCode.DELETE&&e.stopPropagation()},e.onChange=function(){e.inputForm&&!e.inputForm.$invalid&&o.$setViewValue(e.sliceValue)},e.getErrorMessage=function(){var i,r=e.inputForm.$error;return r&&(r.decimal||r.number?i=t.localizationService.get("Validation_NotANumber"):r.min?i=t.localizationService.get("Validation_NumberBelowMin"):r.max?i=t.localizationService.get("Validation_NumberAboveMax"):r.integer?i=t.localizationService.get("Validation_NumberNotInteger"):r.required&&(i=t.localizationService.get("Validation_Empty"))),{tooltipDescription:i,tooltipDisable:_.isEmpty(r)}}},this.localizationService=e}return e})();e.PropertyPaneTextBox=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.AdvancedFilterController),this.templateUrl="views/advancedFilter.html"}return i})();i.AdvancedFilter=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.controllers.CanvasLayoutController,o=(function(){function t(){this.restrict="A",this.controller=e.common.createController(r),this.link=function(e,t,i,r){function o(){var t=e.layoutStrategy;r.setStrategy(t)}function n(){var t=e.canvasLayoutSize;r.setCanvasSize(t)}o(),e.$watch("layoutStrategy",o),e.$watch("canvasLayoutSize",n)}}return t})();i.CanvasLayout=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(i,r,o){var n=function(e,t){return r.dragStart(o,e,t)},a=function(e,t){return r.dragEnd(o,e,t)},s=function(e,t,i){return r.nudge(o,e,t,i)},l=function(e,t){return r.resizeStart(o,e,t)},c=function(e,t){return r.resizeMove(o,e,t)},u=function(e,t){return r.resizeEnd(o,e,t)};return e.common.createScopeEventSubscriptionManager(i).subscribe(t.constants.TransformElementDragEndEventName,a).subscribe(t.constants.TransformElementDragStartEventName,n).subscribe(t.constants.TransformElementNudgeEventName,s).subscribe(t.constants.TransformElementResizeStartEventName,l).subscribe(t.constants.TransformElementResizeMoveEventName,c).subscribe(t.constants.TransformElementResizeEndEventName,u)}var o=(function(){function e(){this.restrict="A",this.require="^canvasLayout",this.link=function(e,t,i,o){var n=e.canvasLayoutItemOptions;o.registerLayoutItem(n),e.getIntermediateDimensions=function(e){return o.getIntermediateDimensions(n,e)};var a=r(e,o,n);e.$on("$destroy",(function(){o.unregisterLayoutItem(n),a.unsubscribeAll()}))}}return e})();i.CanvasLayoutItem=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="A",this.scope=!1,this.controller=e.common.createController(t.controllers.CanvasVisualErrorController),this.controllerAs="ctrlError",this.bindToController=!0}return i})();i.CanvasVisualError=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.replace=!0,this.restrict="E",this.scope={},this.controller=e.common.createController(t.controllers.CanvasVisualHeaderIconController),this.controllerAs="$ctrl",this.bindToController={details:"=",iconType:"="},this.templateUrl="views/canvasVisualHeaderIcon.html"}return i})();i.CanvasVisualHeaderIcon=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.constants,o=41,n=35,a=250,s=(function(){function t(){var t=this;this.restrict="E",this.templateUrl="views/carousel.html",this.transclude=!0,this.replace=!0,this.scope={autoResize:"="},this.link=function(i,s){i.element=s,i.scrollPane=s.find(".carouselScrollPane"),i.previousNavButton=s.find(".carouselNavButton.previousPage"),i.nextNavButton=s.find(".carouselNavButton.nextPage");var l=i.previousNavButton,c=i.nextNavButton,u=i.scrollPane,p=!1,d=function(){return u.children()},v=function(){l.prop("disabled",!1),c.prop("disabled",!1),0===u.scrollLeft()&&l.prop("disabled",!0);var e=2;Math.abs(u.scrollLeft()+u.width()-u[0].scrollWidth)<=e&&c.prop("disabled",!0)},h=function(e){if(e&&e.length>0){p=!0;var i=d(),r=e.position().left-t.getLeftmostScrollChildOffset(i);u.animate({scrollLeft:r},a,(function(){v(),p=!1}))}},g=function(){if(!p){var e=u.find(".selected");h(e)}};if(i.scrollToLast=function(){var e=d().last();h(e)},i.updateCarouselWidth=function(){window.setTimeout((function(){for(var e=i.element.parent().width(),t=d(),r=0,a=0,s=t.length;a<s;a++)r+=t.eq(a).outerWidth(!0);var l=r+n;e>o&&(l=Math.min(e-o,l)),i.element.width(l),v()}))},i.scrollToNext=function(){for(var e,i=d(),r=u.scrollLeft()+u.width()+t.getLeftmostScrollChildOffset(i),o=0;o<i.length;o++)if(e=i.eq(o),e.position().left+e.width()>r){h(e);break}},i.scrollToPrevious=function(){for(var e,i=d(),r=u.scrollLeft()-u.width()+t.getLeftmostScrollChildOffset(i),o=0;o<i.length;o++)if(e=i.eq(o),e.position().left>=r){h(e);break}},i.autoResize){e.common.createScopeEventSubscriptionManager(i).subscribe(r.renameSectionEvent,(function(){window.setTimeout((function(){i.updateCarouselWidth()}))}));var f=0,m=new MutationObserver(function(e){for(var t=0,r=e;t<r.length;t++){var o=r[t];if(o.addedNodes.length>0||o.removedNodes.length>0){i.updateCarouselWidth();var n=d().length;f===n-1?i.scrollToLast():0===f&&g(),f=n}}}),y={childList:!0,characterData:!0,attributes:!0};m.observe(i.scrollPane[0],y)}var w=0;i.carouselResized=function(){if(i.autoResize){var e=s.parent().width();e!==w&&(w=e,i.updateCarouselWidth(),g())}},i.$on(r.explorationLoadedEventName,(function(){return i.enableResize()})),i.$on(r.explorationClearedEventName,(function(){return i.suspendResize()}))}}return t.prototype.getLeftmostScrollChildOffset=function(e){return e.length>0?e.eq(0).position().left:0},t})();i.Carousel=s})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={},this.controller=e.common.createController(t.controllers.CodePaneContainerController),this.templateUrl="views/codePaneContainer.html"}return i})();i.CodePaneContainer=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.DeleteVisualWarningDialogController),this.templateUrl="views/deleteVisualWarningDialog.html"}return i})();i.DeleteVisualWarningDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.templateUrl="views/detailVisual.html",this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.DetailVisualController)}return i})();i.DetailVisual=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.EsriConsentDialogController),this.templateUrl="views/esriConsentDialog.html"}return i})();i.EsriConsentDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(i,r,l,c,u){var p={width:0,height:0};i.outerViewport=p;var d=null;i.canvasPinchStart=function(e){u&&u.hide({isTouchEvent:!0,immediately:!0}),1===e&&(i.suspendResize(),o.storeOverflowValuesAndChange(r,jsCommon.CssConstants.visibleValue))},i.canvasPinchEnd=function(e){1===e&&(o.restoreOverflowValues(r),i.enableResize&&i.enableResize())},r.on("touchstart",".visualContainer.selected",(function(){i.shouldDisableScroll&&i.shouldDisableScroll()&&r.addClass(s)})),r.on("touchend",(function(){r.removeClass(s)}));var v=function(){var e=i.onResizeViewport.width,t=i.onResizeViewport.height;i.outerViewport={width:e,height:t},e===p.width&&t===p.height||(p.width=e,p.height=t,i.forceSyncSizeUpdates?o.applyFitOption(i,r,i.displayOptionServices):window.requestAnimationFrame((function(){o.applyFitOption(i,r,i.displayOptionServices)}))),i.$emit(n.domLayoutChangedEvent)},h=_.throttle(v,a);i.canvasResized=function(){return i.forceSyncSizeUpdates?v():void h()},i.$evalAsync((function(){i.enableResize()})),i.disableAnimations=!0,i.$watch("useResponsiveLayout",(function(){r.scrollTop(0)})),i.$watch("hasFocus",(function(e){e===!0&&(r.focus(),i.hasFocus=!1)})),i.$watch("viewModel.contract.size",(function(e){e&&(o.updateCanvasSize(i,e.width,e.height),o.applyFitOption(i,r,i.displayOptionServices));
}));var g=null;i.$on(t.constants.explorationLoadedEventName,(function(){c&&(d=c.startActivity(i,e.telemetry.EXLoadExplorationVisuals),g&&g(),g=i.$watchCollection("viewModel.visualContainers",(function(e){e&&(0===e.length&&d&&(d.resolve(),d=null),g(),g=null)})))})),i.$on("visualContainerRepeatFinished",(function(){d&&(d.resolve(),d=null),document.activeElement||r.focus(),i.$emit(t.constants.exploreCanvasVisualRendered),i.$emit(n.domLayoutChangedEvent)})),i.applyFitOption=function(){o.applyFitOption(i,r,i.displayOptionServices),i.$emit(n.domLayoutChangedEvent)},i.$on("$destroy",(function(){i.suspendResize()}))}var o=t.util.CanvasDisplayUtility,n=e.common.constants,a=300,s="disableScroll";i.linkCanvas=r;var l=(function(){function i(i,o,n){var a=this;this.telemetryService=i,this.overlayService=o,this.visualHostTooltip=n,this.restrict="E",this.replace=!0,this.scope={viewModel:"=",disablePrint:"=",canvasOptions:"=?"},this.controller=e.common.createController(t.controllers.ExploreCanvasController),this.controllerAs="$ctrl",this.templateUrl="views/exploreCanvas.html",this.require="canvasLayout",this.link=function(e,t,i,o){e.layout=o,r(e,t,a.overlayService,a.telemetryService,a.visualHostTooltip)},this.telemetryService=i,this.overlayService=o,this.visualHostTooltip=n}return i})();i.ExploreCanvas=l})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.scope={},this.controller=e.common.createController(t.controllers.ExplorationAppBarController),this.controllerAs="$ctrl",this.bindToController={viewModel:"="},this.templateUrl="views/explorationAppBar.html"}return i})();i.ExplorationAppBar=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.transclude=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.ExplorationHostController),this.templateUrl="views/explorationHost.html"}return i})();i.ExplorationHost=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.directives.DragDropUtils,o="dragover",n="section",a=".pane.sections",s=".section.dynamic",l=(function(){function i(i){var a=this;this.restrict="E",this.replace=!0,this.scope={viewModel:"=",tabIndex:"=",isOnlyTab:"<",isEditing:"="},this.controller=e.common.createController(t.controllers.ExplorationNavigationTabController),this.templateUrl="views/explorationNavigationTab.html",this.link=function(t,i,s){t.toggleDraggable=function(e){return i.draggable({disabled:!e})},t.supportsMinervaDialog=a.platformCapabilities.supportsMinervaDialog,i.droppable({accept:function(e){return"sections"===r.getDragSourceType(e)},activate:function(e,i){return t.dragoverIndex=-1},hoverClass:o,tolerance:"pointer",over:function(e,r){if(1===t.viewModeState.getMode()){var o=-1,s=a.getSections();o=i.hasClass(n)?s.index(i):Math.max(s.length-1,0),t.dragoverIndex=o,t.$apply()}},drop:function(i,r){if(1===t.viewModeState.getMode()){var o=r.draggable;if(o){var n=a.getSections(),s=n.index(o),l=t.dragoverIndex;s!==l&&s!==-1&&t.eventBridge.publishBubbling(t,e.explore.services.events.reorderSection,{originalIndex:s,targetIndex:l})}}}}),t.$on("$destroy",(function(){return i.droppable({disabled:!0}).droppable("destroy")}))},this.platformCapabilities=i}return i.prototype.getSections=function(){return $(a).find(s)},i})();i.ExplorationNavigationTab=l})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.ExplorationPaginatorController),this.templateUrl="views/explorationPaginator.html"}return i})();i.ExplorationPaginator=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"=",disablePrint:"=",canvasOptions:"<"},this.controller=e.common.createController(t.controllers.ExplorationController),this.templateUrl="views/exploration.html"}return i})();i.Exploration=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.directives.NgScrollbars,o=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={fieldListConfig:"<"},this.controller=e.common.createController(t.controllers.FieldListController),this.templateUrl="views/fieldList.html",this.link=function(e,t,i){t.click((function(){e.$evalAsync((function(){return e.unselect()}))})),e.$on("$destroy",(function(){return t.unbind("click")})),e.scrollToItem=function(e,i){var o=t.find(".fieldListEntityContainer").filter((function(t,i){return $(i).find(".fieldListEntity").text().trim()===e})),n=o.find(".fieldListProperty").filter((function(e,t){return $(t).text().trim()===i})),a=t.find(".scroll-wrapper .scroll-content");r.scrollVertical(a[0],n[0]||o[0])}}}return i})();i.FieldList=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.scope={viewModel:"=",searchString:"="},this.controller=e.common.createController(t.controllers.FieldListEntityController),this.templateUrl="views/fieldListEntity.html",this.link=function(e,t,i){e.toggleDraggable=function(e){t.attr("draggable",e.toString())}}}return i})();i.FieldListEntity=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.scope={},this.controller=e.common.createController(t.controllers.FieldListPropertyController),this.controllerAs="ctrl",this.bindToController={viewModel:"=",searchString:"="},this.templateUrl="views/fieldListProperty.html",this.link=function(e,t,i,r){e.toggleDraggable=function(e){r.viewModel.draggable&&t.draggable({disabled:!e})}}}return i})();i.FieldListProperty=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.FilterController),this.templateUrl="views/filter.html"}return i})();i.Filter=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={},this.controller=e.common.createController(t.controllers.FilterPaneController),this.templateUrl="views/filterPane.html"}return i})();i.FilterPane=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.bindtoController={viewModel:"="},this.controller=e.common.createController(t.controllers.FilterVisualController),this.controllerAs="$ctrl",this.templateUrl="views/filterVisual.html"}return i})();i.FilterVisual=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=(function(){function i(){this.restrict="A",this.controller=e.common.createController(t.controllers.ModelingContextChangerController),this.link=function(e,t,i){var o=e.eventBridge.createChannelSubscriptionManager().subscribe(r.schemaItemActivationChanged,(function(){e.schemaItemActivationService.getActiveItem()?t.on("click",(function(){e.eventBridge.publishToChannel(r.modelingContextChanged)})):t.off("click")}));e.$on("$destroy",(function(){return o.unsubscribeAll()}))}}return i})();i.ModelingContextChanger=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="A",this.require="ngModel",this.scope={pbiValidate:"="},this.link=function(t,i,r,o){t.pbiValidate&&(o.$validators.required=function(e,i){return null==i||!t.pbiValidate.required||""!==i},o.$validators.min=function(i,r){return e.isLargerOrEqual(r,t.pbiValidate.min)},o.$validators.max=function(i,r){return e.isLargerOrEqual(t.pbiValidate.max,r)},o.$validators.decimal=function(e,i){return null==i||!t.pbiValidate.decimal||_.isFinite(Number(i))},o.$validators.integer=function(e,i){if(null==i||!t.pbiValidate.integer)return!0;var r=Number(i);return _.isFinite(r)&&Math.floor(r)===r})}}return e.isLargerOrEqual=function(e,t){if(null==e||null==t||""===e||""===t)return!0;var i=Number(e),r=Number(t);return!_.isFinite(i)||!_.isFinite(r)||i>=r},e})();e.PbiValidate=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.EmbedModalDialogController),this.templateUrl="views/embedModalDialog.html"}return i})();i.EmbedModalDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"=",fieldListConfig:"<"},this.controller=e.common.createController(t.controllers.TaskPaneController),this.templateUrl="views/taskPane.html"}return i})();i.TaskPane=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.VisualContainerController),this.templateUrl="views/visualContainer.html"}return i})();i.VisualContainer=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.replace=!0,this.templateUrl="views/visualContainerPopOutBar.html"}return e})();e.VisualContainerPopOutBar=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.VisualizationPaneController),this.templateUrl="views/visualizationPane.html"}return i})();i.VisualizationPane=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(t,i){var r=this;this.restrict="E",this.replace=!0,this.template='<div class="watermark"></div>',this.scope={visualType:"="},this.link=function(t,i){function o(e,t,i,r){var o=e.indexOf('id="'+t),n=t.length+6,a=e.substring(o+n,e.indexOf(i)),s=a.indexOf(r),l=a.substring(0,s);return l}function n(t,i,r){t=o(t,i,"</svg>","</symbol>");var n=$(e.svgTemplate+t+"</svg>");n.appendTo(r)}function a(t,i,r,o){var a=o.getPlugin(i),s=a&&a.watermarkKey||e.defaultWatermark;r.attr(e.dataAttribute,s),n(t,s,r)}var s="views/svg/visualsWatermarks.svg",l=r.visualPlugin,c=r.templateCache.get(s),u=t.visualType;a(c,u,i,l),t.$watch("visualType",(function(e,t){e!==t&&(i.empty(),a(c,e,i,l))}))},this.templateCache=t,this.visualPlugin=i}return e})();t.svgTemplate='<svg id="Layer_1" x="0px" y="0px" viewBox="0 0 400 300" enable-background="new 0 0 400 300" xml:space="preserve">',t.dataAttribute="data-svg-visual-key",t.defaultWatermark="defaultWatermark",e.VisualWatermark=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.replace=!0,this.transclude=!0,this.scope={initLimit:"=",totalItemsAmount:"="},this.templateUrl="views/virtualList.html",this.link=function(e,t){var i=0,r=10;e.limitItems=+e.initLimit,e.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1};var o=t.find(".virtual-list"),n=2*t.height();o.scroll((function(){var a=o.scrollTop();n||(n=2*t.height()),a+n>o.height()&&e.totalItemsAmount>=e.limitItems&&a>i&&(i=a,e.limitItems+=r,e.$digest())}))}}return e})();e.VirtualList=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var i="";switch(e){case 0:i=t.get("ReportAppBar_ViewDynamic");break;case 1:i=t.get("ReportAppBar_ViewFitToPage");break;case 2:i=t.get("ReportAppBar_ViewFitToWidth");break;case 3:i=t.get("ReportAppBar_ViewActualSize")}return i}e.convert=t})(t=e.DisplayOptionFilter||(e.DisplayOptionFilter={}))})(t=e.filters||(e.filters={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this._contract=e,this._state=t}return Object.defineProperty(e.prototype,"contract",{get:function(){return this._contract},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readOnlyState",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.updateViewState=function(){this.updateViewStateCore(this._state)},e.prototype.updateViewStateCore=function(e){},e})();e.ViewModel=t})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.spinnerAction={name:"spinnerAction"}})(t=e.DetailVisualEvents||(e.DetailVisualEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.constants.ExploreCanvasConstants;t.FixedPhoneCanvasSettings={phoneWidth:i.PhoneAuthoringViewportWidth,phoneHeight:i.PhonePortraitCanvasHeight,phoneGridLayout:{columnCount:6,rowCount:i.PhonePortraitRowCount,layout:{horizontal:{margin:9.5,gutter:9,size:44},vertical:{margin:9.5,gutter:9,size:50}}}};var r=(function(){function e(e,t){void 0===t&&(t=0),this.selectedVisualOriginalPosition=-1,this.contract=e,this.canvasLayout=t}return Object.defineProperty(e.prototype,"width",{get:function(){return 0===this.canvasLayout?this.contract.size&&this.contract.size.width:t.FixedPhoneCanvasSettings.phoneWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return 0===this.canvasLayout?this.contract.size&&this.contract.size.height:t.FixedPhoneCanvasSettings.phoneHeight},enumerable:!0,configurable:!0}),e})();t.ExploreCanvas=r})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){function i(){return r.createNavigationMenuItems()}t.createNavigationMenuItems=i;var r;!(function(t){function i(){return[r("Duplicate_page",0),r("Rename_page",1),r("Delete_page",2)]}function r(t,i){return{text:e.common.localize.get(t),labelClass:"itemLabel",action:i,type:DropDownMenuItemType.Item,hrefTarget:jsCommon.DOMConstants.selfValue}}t.createNavigationMenuItems=i})(r||(r={}))})(i=t.ExplorationContainerViewModelFactory||(t.ExplorationContainerViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.EnumExtensions,i=(function(){function e(e){this.contract=e,this.showCheckboxes=!0,this.entities=[]}return Object.defineProperty(e.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEdit",{get:function(){return this.contract.capabilities.canEdit&&!this.disableEditing},enumerable:!0,configurable:!0}),e.prototype.findEntity=function(e){return _.find(this.entities,(function(t){return t.name===e}))},e.prototype.findFields=function(e,t,i){var r=this.findEntity(e);if(r)return r.findFields(t,i)},e.prototype.findHierarchies=function(e,t,i){var r=this.findEntity(e);if(r)return r.findHierarchies(t,i)},e.prototype.findKpis=function(e,t,i){var r=this.findEntity(e);if(r)return r.findKpis(t,i)},e.prototype.findKpiMeasures=function(e,t,i){var r=this.findEntity(e);if(r)return r.findKpiMeasures(t,i)},e.prototype.getMenuItems=function(){return this.menuItemFactory.createSchemaMenuItems(this)},e})();e.FieldListConceptualModel=i;var r=(function(){function i(e,t,i){this.hasCheckedProperties=!1,this.contract=e,this.contractSchema=t,this.schema=i,this.properties=[],this.hierarchies=[],this.displayFolders=[]}return Object.defineProperty(i.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayName",{get:function(){return this.contract.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"errorMessage",{get:function(){return this.contract.errorMessage},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"calculated",{get:function(){return this.contract.calculated},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"iconClassName",{get:function(){return 1===this.contract.queryable?"error":this.calculated?"calculatedTable":this.isMeasureGroup?"measureGroup":void 0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hidden",{get:function(){return t.hasFlag(this.contract.visibility,1)&&_.all(this.properties,(function(e){return!e.isExtension||e.hidden}))},set:function(e){e?this.contract.visibility=t.setFlag(this.contract.visibility,1):this.contract.visibility=t.resetFlag(this.contract.visibility,1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canEdit",{get:function(){return this.contractSchema.capabilities.canEdit&&!this.schema.disableEditing&&!e.FieldListViewModelUtils.isAbandoned(this.contract)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"private",{get:function(){return t.hasFlag(this.contract.visibility,4)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showAsVariationsOnly",{get:function(){return t.hasFlag(this.contract.visibility,2)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showHidden",{get:function(){return this.schema.showHidden},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasMenu",{get:function(){return this.schema.menuItemFactory.hasEntityMenu()},enumerable:!0,configurable:!0}),i.prototype.findFields=function(e,t){return this.findFieldsByType(e,t,0)},i.prototype.findKpis=function(e,t){return this.findFieldsByType(e,t,4)},i.prototype.findKpiMeasures=function(e,t){return this.findFieldsByType(e,t,5)},i.prototype.findHierarchies=function(e,t){return this.findFieldsByType(e,t,2)},i.prototype.findFieldsByType=function(e,t,i){var r;if(r=2===i?_.filter(this.hierarchies,(function(i){return i.name===e&&i.schema.name===t})):_.filter(this.properties,(function(r){return r.name===e&&r.fieldType===i&&r.schemaName===t})),!_.isEmpty(r))return r},Object.defineProperty(i.prototype,"userEntity",{get:function(){return this.schema.showNonUserEntities||!(this.private||this.showAsVariationsOnly)},enumerable:!0,configurable:!0}),i.prototype.getMenuItems=function(){return this.schema.menuItemFactory.createEntityMenuItems(this)},i})();e.FieldListConceptualEntity=r;var o=(function(){function e(e,t,i){this.hasCheckedChildren=!1,this.contract=e,this.schema=t,this.entity=i}return Object.defineProperty(e.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schemaName",{get:function(){return this.schema.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this.contract.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorMessage",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return!this.parent||this.parent.expanded&&this.parent.visible},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.contract.hidden},set:function(e){this.contract.hidden=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showHidden",{get:function(){return this.entity.showHidden},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEdit",{get:function(){return this.schema.capabilities.canEdit&&!this.entity.schema.disableEditing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMenu",{get:function(){return this.entity.schema.menuItemFactory.hasPropertyMenu()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isExtension",{get:function(){return!1},enumerable:!0,configurable:!0}),e})();e.FieldListConceptualItem=o;var n=(function(e){function t(t,i,r){var o=e.call(this,t,i,r)||this;return o.draggable=!0,o.fieldType=0,o}return __extends(t,e),Object.defineProperty(t.prototype,"kind",{get:function(){return this.contract.kind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultAggregate",{get:function(){return this.contract.column?this.contract.column.defaultAggregate:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.contract.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idOnEntityKey",{get:function(){return!!this.contract.column&&this.contract.column.idOnEntityKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorMessage",{get:function(){return this.contract.errorMessage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canRename",{get:function(){return this.canEdit&&(!this.contract.measure||this.contract.measure.canRename!==!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canDelete",{get:function(){return this.canEdit&&(!this.contract.measure||this.contract.measure.canDelete!==!1)},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createPropertyMenuItems(this)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.template=this.template,e},t})(o);e.FieldListConceptualProperty=n;var a=(function(e){function t(t,i,r){return e.call(this,t,i,r)||this}return __extends(t,e),Object.defineProperty(t.prototype,"defaultAggregate",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idOnEntityKey",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isExtension",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createExtensionMeasureMenuItems(this)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.template=this.template,e},t})(n);e.FieldListConceptualExtensionMeasure=a;var s=(function(e){function t(t,i,r,o){var n=this;return n=e.call(this,t.column,i,o)||this,n.hierarchyLevelContract=t,n.parent=r,n.fieldType=3,n}return __extends(t,e),Object.defineProperty(t.prototype,"hidden",{get:function(){return this.parent.hidden},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.hierarchyLevelContract.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this.hierarchyLevelContract.displayName},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createHierarchyLevelMenuItems(this)},t.prototype.clone=function(e){var i=e||this.parent,r=new t(this.hierarchyLevelContract,this.schema,i,this.entity);return r.template=this.template,r},t})(n);e.FieldListConceptualHierarchyLevel=s;var l=(function(e){function t(t,i,r){var o=e.call(this,t,i,r)||this;return o.expanded=!1,o.hierarchyLevels=[],o.draggable=!0,o.fieldType=2,o}return __extends(t,e),Object.defineProperty(t.prototype,"properties",{get:function(){return this.hierarchyLevels},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this.hierarchyLevels},enumerable:!0,configurable:!0}),t.prototype.findLevel=function(e,t){return _.find(this.hierarchyLevels,(function(t){return t.name===e}))},t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createHierarchyMenuItems(this)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.hierarchyLevels=_.map(this.hierarchyLevels,(function(t){return t.clone(e)})),e.template=this.template,e},t})(o);e.FieldListConceptualHierarchy=l;var c=(function(e){function t(t,i,r){var o=e.call(this,t,i,r)||this;return o.expanded=!1,o.kpiMeasures=[],o.fieldType=4,o}return __extends(t,e),Object.defineProperty(t.prototype,"kind",{get:function(){return this.contract.kind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this.kpiMeasures},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this.kpiMeasures},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createKpiMenuItems(this)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.kpiMeasures=_.map(this.kpiMeasures,(function(t){return t.clone(e)})),e.template=this.template,e},t})(o);e.FieldListConceptualKpi=c;var u=(function(e){function t(t,i,r,o,n,a){var s=this;return s=e.call(this,t,i,n)||this,s.kpiType=r,s.parent=o,s.locOptions=a,s.draggable=!0,s.fieldType=5,s}return __extends(t,e),Object.defineProperty(t.prototype,"displayName",{get:function(){var e;switch(this.kpiType){case 2:e=this.locOptions.KpiValueDisplayName;break;case 1:e=this.locOptions.KpiGoalDisplayName;break;case 0:e=this.locOptions.KpiStatusDisplayName;break;case 3:e=this.locOptions.KpiTrendDisplayName}return e||this.contract.displayName},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createKpiMeasureMenuItems(this)},t.prototype.clone=function(e){var i=e||this.parent,r=new t(this.contract,this.schema,this.kpiType,i,this.entity,this.locOptions);return r.template=this.template,r},t})(n);e.FieldListConceptualKpiMeasure=u;var p=(function(e){function t(t,i,r,o,n){var a=e.call(this,t,o,n)||this;a.expanded=!1,a.parent=r,a.children=i,a.fieldType=1;for(var s=0,l=i;s<l.length;s++){var c=l[s];c.parent=a}return a}return __extends(t,e),Object.defineProperty(t.prototype,"hidden",{get:function(){return!_.any(this.children,(function(e){return!e.hidden}))},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMenu",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return{items:[]}},t.prototype.clone=function(){},t})(o);e.FieldListConceptualDisplayFolder=p})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.fieldListAction={name:"fieldListAction"}})(t=e.FieldListEvents||(e.FieldListEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new s(e,t,i)}var r=e.explore.utils.GroupUtils,o=e.explore.util.HierarchyUtils;t.createFieldListMenuItemFactory=i;var n;!(function(e){function t(){return{type:1,checked:!1}}function i(e,t,i,r){return void 0===r&&(r=!1),{text:i.get(e),key:t,type:0,checked:!!r}}e.createItemSeparator=t,e.createFieldListMenuItem=i})(n=t.FieldListMenuItemViewModelGenerator||(t.FieldListMenuItemViewModelGenerator={}));var a;!(function(e){e[e.Filter=0]="Filter",e[e.HierarchyCreate=1]="HierarchyCreate",e[e.HierarchyAddTo=2]="HierarchyAddTo",e[e.Create=3]="Create",e[e.Entity=4]="Entity",e[e.Copy=5]="Copy",e[e.Edit=6]="Edit",e[e.Hidden=7]="Hidden",e[e.ExpandCollapse=8]="ExpandCollapse",e[e.Groups=9]="Groups"})(a||(a={}));var s=(function(){function e(e,t,i){this.localizationService=e,this.featureSwitchService=t,this.groupingDesignStateService=i}return e.prototype.createSchemaMenuItems=function(e){var t=this.canAuthorReportMeasuresOnSchema(e.contract);return this.createMenuItems({canViewHidden:e.canEdit||t,canUnHideAll:e.canEdit||t,canExpandCollapseAll:!0,showHidden:e.showHidden})},e.prototype.createEntityMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e);return this.createMenuItems({canDelete:e.canEdit,canRename:e.canEdit,canViewHidden:e.schema.canEdit||t,canUnHideAll:e.schema.canEdit||t,canExpandCollapseAll:!0,isEntity:!0,canRefresh:e.canEdit,canHide:e.schema.canEdit,canEditEntity:e.canEdit&&!e.calculated,canCreateColumn:e.canEdit,canCreateMeasure:e.canEdit||this.canCreateNewReportMeasureOnEntity(e),hidden:e.hidden,showHidden:e.showHidden})},e.prototype.createHierarchyMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e.entity);return this.createMenuItems({canDelete:e.canEdit,canRename:e.canEdit,canHide:e.canEdit&&e.entity.schema.canEdit,canCreateColumn:e.entity.canEdit,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||t,canUnHideAll:e.entity.schema.canEdit||t,canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden})},e.prototype.createHierarchyLevelMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e.entity),i=e.parent.contract.levels;return this.createMenuItems({canAddToFilter:!0,canDelete:e.canEdit,canRename:e.canEdit,canMoveUp:e.canEdit&&_.first(i).name!==e.hierarchyLevelContract.name,canMoveDown:e.canEdit&&_.last(i).name!==e.hierarchyLevelContract.name,canCreateColumn:e.entity.canEdit,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||t,canUnHideAll:e.entity.schema.canEdit||t,canExpandCollapseAll:!0,showHidden:e.showHidden,canCreateQuickCalcMeasure:this.featureSwitchService.featureSwitches.daxTemplatesEnabled&&e.entity.schema.canEdit})},e.prototype.createPropertyMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e.entity),i=this.createMenuSections({canAddToFilter:!0,canDelete:this.canDeleteProperty(e),canRename:e.canRename,canHide:e.canEdit,canGroup:e.canEdit&&this.featureSwitchService.featureSwitches.enableGroupAuthoring&&this.groupingDesignStateService&&0===e.kind&&r.canPropertyBeGrouped(e.contract),canEditGroups:e.canEdit&&this.featureSwitchService.featureSwitches.enableGroupAuthoring&&this.groupingDesignStateService&&r.isGroupOrBinColumn(e.entity.name,e.contract,this.groupingDesignStateService),canEditClustering:e.canEdit&&this.featureSwitchService.featureSwitches.clusteringEnabled&&this.groupingDesignStateService&&r.isClusteringColumn(e.entity.name,e.contract,this.groupingDesignStateService),canCreateColumn:e.entity.canEdit,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||t,canUnHideAll:e.entity.schema.canEdit||t,canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden,canCreateQuickCalcMeasure:this.featureSwitchService.featureSwitches.daxTemplatesEnabled&&e.entity.schema.canEdit
}),o=e.entity.canEdit&&1!==e.kind;return o&&this.createHierarchyMenuSections(e,i),{items:this.getMenuItemsAndSeparators(i)}},e.prototype.canDeleteProperty=function(e){return e.canDelete&&!(e.entity&&e.entity.calculated&&e.contract.column&&!e.contract.column.calculated)},e.prototype.canCreateNewReportMeasureOnEntity=function(e){return this.canAuthorReportMeasuresOnEntity(e)&&!t.FieldListViewModelUtils.isAbandoned(e.contract)},e.prototype.canAuthorReportMeasuresOnEntity=function(e){return e.contractSchema.isExtensionSchema?e.contractSchema.capabilities.canEdit&&this.featureSwitchService.featureSwitches.reportMeasures:this.canAuthorReportMeasuresOnSchema(e.contractSchema)},e.prototype.canAuthorReportMeasuresOnSchema=function(e){return this.featureSwitchService.featureSwitches.reportMeasures&&e.capabilities.isExtendable},e.prototype.createExtensionMeasureMenuItems=function(e){return this.createPropertyMenuItems(e)},e.prototype.createKpiMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e.entity);return this.createMenuItems({canDelete:e.canEdit,canRename:e.canEdit,canCreateColumn:e.entity.canEdit,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||t,canUnHideAll:e.entity.schema.canEdit||t,canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden})},e.prototype.createKpiMeasureMenuItems=function(e){return this.createMenuItems({canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden})},e.prototype.hasPropertyMenu=function(){return!0},e.prototype.hasEntityMenu=function(){return!0},e.prototype.createMenuItems=function(e){return{items:this.getMenuItemsAndSeparators(this.createMenuSections(e))}},e.prototype.createMenuSections=function(e){var t=[];return e.canAddToFilter&&this.addMenuItem(t,a.Filter,"FieldListMenuItem_AddFilter",0),e.canCreateMeasure&&this.addMenuItem(t,a.Create,"FieldListMenuItem_NewMeasure",10),e.canCreateColumn&&this.addMenuItem(t,a.Create,"FieldListMenuItem_NewColumn",13),e.canCreateQuickCalcMeasure&&this.addMenuItem(t,a.Create,"QuickCalc_NewMeasure",19),e.isEntity&&(e.canRefresh&&this.addMenuItem(t,a.Entity,"FieldListMenuItem_RefreshEntity",6),e.canEditEntity&&this.addMenuItem(t,a.Entity,"FieldListMenuItem_EditEntity",9),e.canCopyTable&&this.addMenuItem(t,a.Copy,"DataExplorerFieldListMenuItem_CopyTable",20)),e.canMoveUp&&this.addMenuItem(t,a.Edit,"FieldListMenuItem_MoveUp",7),e.canMoveDown&&this.addMenuItem(t,a.Edit,"FieldListMenuItem_MoveDown",8),e.canRename&&this.addMenuItem(t,a.Edit,"FieldListMenuItem_Rename",4),e.canDelete&&this.addMenuItem(t,a.Edit,"FieldListMenuItem_Delete",5),e.canHide&&this.addMenuItem(t,a.Edit,"FieldListMenuItem_Hide",1,e.hidden),e.canHideInReportView&&this.addMenuItem(t,a.Edit,"FieldListMenuItem_HideInReportView",1,e.hidden),(e.canUnHideAll||e.canViewHidden)&&(e.canViewHidden&&this.addMenuItem(t,a.Hidden,"FieldListMenuItem_ViewHidden",2,e.showHidden),e.canUnHideAll&&this.addMenuItem(t,a.Hidden,"FieldListMenuItem_UnHideAll",3)),e.canExpandCollapseAll&&(this.addMenuItem(t,a.ExpandCollapse,"FieldListMenuItem_CollapseAll",14),this.addMenuItem(t,a.ExpandCollapse,"FieldListMenuItem_ExpandAll",15)),e.canGroup&&this.addMenuItem(t,a.Groups,"ContextMenuItem_CreateGroups",16),e.canEditGroups&&this.addMenuItem(t,a.Groups,"ContextMenuItem_EditGroups",17),e.canEditClustering&&this.addMenuItem(t,a.Groups,"Clustering_EditClusters",18),t},e.prototype.createHierarchyMenuSections=function(e,i){var r=e.contract,n=e.entity.contract.hierarchies;if(this.addMenuItem(i,a.HierarchyCreate,"FieldListMenuItem_NewHierarchy",11),!_.isEmpty(n)){var s=n.slice(0);o.sortHierarchies(s);var l=t.FieldListViewModelUtils.getHierarchyLevelDictionary(n),c=_.filter(s,(function(e){var t=l[e.name];return!(t&&t[r.name])})),u=_.map(c,(function(e){return{text:e.displayName,key:{action:12,hierarchyName:e.name},type:0,checked:!1}}));if(!_.isEmpty(u)){var p=this.addMenuItem(i,a.HierarchyAddTo,"FieldListMenuItem_AddToHierarchy",void 0);p.children=u}}return i},e.prototype.addMenuItem=function(e,t,i,r,o){void 0===o&&(o=!1);var a=n.createFieldListMenuItem(i,void 0!==r?{action:r}:void 0,this.localizationService,o);return this.addMenuItems(e,t,[a]),a},e.prototype.addMenuItems=function(e,t,i){var r=e[t];r||(r=[],e[t]=r),r.push.apply(r,i)},e.prototype.getMenuItemsAndSeparators=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];_.size(o)>0&&(t.length>0&&t.push(n.createItemSeparator()),t.push.apply(t,o))}return t},e})();t.FieldListMenuItemFactory=s})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new i}e.DefaultPropertyTemplate="Default",e.FolderPropertyTemplate="Folder",e.KpiPropertyTemplate="Kpi",e.HierarchyPropertyTemplate="Hierarchy",e.LeafPropertyTemplate="Leaf",e.createFieldListPropertyTemplateGenerator=t;var i=(function(){function t(){}return t.prototype.getTemplate=function(t){switch(t.fieldType){case 0:return this.getTemplateUri(e.DefaultPropertyTemplate);case 1:return this.getTemplateUri(e.FolderPropertyTemplate);case 4:return this.getTemplateUri(e.KpiPropertyTemplate);case 2:return this.getTemplateUri(e.HierarchyPropertyTemplate);case 5:case 3:return this.getTemplateUri(e.LeafPropertyTemplate);default:return this.getTemplateUri(e.DefaultPropertyTemplate)}},t.prototype.getTemplateUri=function(e){return"views/fieldListProperty"+e+".html"},t})();e.FieldListPropertyTemplateGenerator=i})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o){return new i(e,t,r,o)}e.createFieldListViewModelFactory=t;var i=(function(){function t(e,t,i,r){this.menuItemFactory=e,this.propertyTemplateGenerator=t,this.localizationService=i,this.featureSwitchService=r}return Object.defineProperty(t.prototype,"featureSwitches",{get:function(){return this.featureSwitchService.featureSwitches},enumerable:!0,configurable:!0}),t.prototype.createModel=function(t,i,r){var o,n=t.schemas,a=e.FieldListViewModelUtils.getExtensions(n);n=e.FieldListViewModelUtils.sortExtensionSchemasAtEnd(n);for(var s=0,l=n;s<l.length;s++){var c=l[s];o=this.convertConceptualSchema(c,i,o,a,r)}return e.FieldListViewModelOperations.expandIfSingleEntity(o.entities),o},t.prototype.convertConceptualSchema=function(t,i,r,o,n){var a=this;r=r||new e.FieldListConceptualModel(t);var s=_.filter(t.entities,(function(t){return!e.FieldListViewModelUtils.isExtension(t)||e.FieldListViewModelUtils.isAbandoned(t)})),l=_.map(s,(function(e){return a.convertConceptualEntity(e,t,r,o)}));return(c=r.entities).push.apply(c,l),r.showNonUserEntities=i,r.disableEditing=n,r.menuItemFactory=this.menuItemFactory,r;var c},t.prototype.convertConceptualEntity=function(t,i,r,o){var n=this,a=new e.FieldListConceptualEntity(t,i,r);if(a.properties=[],t.properties&&!e.FieldListViewModelUtils.isExtension(t))for(var s=0,l=t.properties;s<l.length;s++){var c=l[s];c.measure&&c.measure.kpi?a.properties.push(this.convertConceptualKpi(c,i,a)):c.kpiValue||a.properties.push(this.convertConceptualProperty(c,i,a))}if(a.isMeasureGroup=e.FieldListViewModelUtils.isMeasureGroup(t.properties),a.expanded=!1,t.hierarchies&&t.hierarchies.length>0){a.hierarchies=_.map(t.hierarchies,(function(e){return n.convertConceptualHierarchy(e,i,a)}));for(var u=0,p=a.hierarchies;u<p.length;u++){var d=p[u];a.properties.push(d)}}if(!_.isEmpty(t.displayFolders)){var v=void 0;a.displayFolders=_.map(t.displayFolders,(function(e){return n.convertConceptualDisplayFolder(e,i,v,a)})),(b=a.properties).push.apply(b,a.displayFolders)}if(o){var h=e.FieldListViewModelUtils.getExtensionKey(i.name,t.name),g=o.entities[h];if(g)for(var f=0,m=g;f<m.length;f++)for(var y=m[f],w=0,C=y.entity.properties;w<C.length;w++){var c=C[w],S=this.convertConceptualExtensionMeasure(c,y.schema,a);a.properties.push(S)}}return e.FieldListViewModelUtils.sortProperties(a.properties),e.FieldListViewModelUtils.removeDuplicateProperties(a.properties,a.displayFolders),e.FieldListViewModelUtils.flattenFolders(a),e.FieldListViewModelUtils.updatePropertiesWithChildren(a),a;var b},t.prototype.convertConceptualDisplayFolder=function(e,t,i,r){for(var o={},n=0,a=r.properties;n<a.length;n++){var s=a[n];o[s.name]=s}return this.convertConceptualDisplayFolderCore(e,t,i,o,r)},t.prototype.convertConceptualDisplayFolderCore=function(t,i,r,o,n){for(var a=[],s=0,l=t.properties;s<l.length;s++){var c=l[s];if(c){var u=o[c.name];u&&a.push(u.clone())}}for(var p=0,d=t.hierarchies;p<d.length;p++){var v=d[p];if(v){var u=o[v.name];u&&a.push(u.clone())}}var h=new e.FieldListConceptualDisplayFolder(t,a,r,i,n);h.template=this.propertyTemplateGenerator.getTemplate(h);for(var g=0,f=t.displayFolders;g<f.length;g++){var m=f[g];h.children.push(this.convertConceptualDisplayFolderCore(m,i,h,o,n))}return e.FieldListViewModelUtils.sortProperties(h.children),h},t.prototype.convertConceptualHierarchy=function(t,i,r){var o=new e.FieldListConceptualHierarchy(t,i,r);o.template=this.propertyTemplateGenerator.getTemplate(o),o.hierarchyLevels=[];for(var n=0,a=t.levels;n<a.length;n++){var s=a[n];o.hierarchyLevels.push(this.convertConceptualHierarchyLevel(s,i,o))}return o},t.prototype.convertConceptualHierarchyLevel=function(t,i,r){var o=new e.FieldListConceptualHierarchyLevel(t,i,r,r.entity);return o.template=this.propertyTemplateGenerator.getTemplate(o),o},t.prototype.convertConceptualProperty=function(t,i,r){var o=new e.FieldListConceptualProperty(t,i,r);return o.template=this.propertyTemplateGenerator.getTemplate(o),o},t.prototype.convertConceptualExtensionMeasure=function(t,i,r){var o=new e.FieldListConceptualExtensionMeasure(t,i,r);return o.template=this.propertyTemplateGenerator.getTemplate(o),o},t.prototype.convertConceptualKpi=function(t,i,r){var o=this,n=new e.FieldListConceptualKpi(t,i,r);n.template=this.propertyTemplateGenerator.getTemplate(n);var a={};this.localizationService.ensureLocalization((function(){a.KpiValueDisplayName=o.localizationService.get("KpiValueFieldListDisplayName"),a.KpiStatusDisplayName=o.localizationService.get("KpiStatusFieldListDisplayName"),a.KpiGoalDisplayName=o.localizationService.get("KpiGoalFieldListDisplayName"),a.KpiTrendDisplayName=o.localizationService.get("KpiTrendFieldListDisplayName")}));var s=t.measure.kpi,l=s.goal,c=s.status,u=s.trend;return n.kpiMeasures=[],n.kpiMeasures.push(this.convertConceptualKpiMeasure(t,i,2,n,r,a)),l&&n.kpiMeasures.push(this.convertConceptualKpiMeasure(l,i,1,n,r,a)),c&&n.kpiMeasures.push(this.convertConceptualKpiMeasure(c,i,0,n,r,a)),u&&n.kpiMeasures.push(this.convertConceptualKpiMeasure(u,i,3,n,r,a)),n},t.prototype.convertConceptualKpiMeasure=function(t,i,r,o,n,a){var s=new e.FieldListConceptualKpiMeasure(t,i,r,o,n,a);return s.template=this.propertyTemplateGenerator.getTemplate(s),s},t})()})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return _.find(e,(function(e){return!e.hidden}))&&!_.find(e,(function(e){return!e.hidden&&1!==e.kind&&2!==e.kind}))}function i(e){for(var t={entities:{}},i=0,r=e;i<r.length;i++){var a=r[i];if(n(a))for(var s=a.extends,l=0,c=a.entities;l<c.length;l++){var u=c[l];if(n(u)){var p={schema:a,entity:u},d=o(s,u.name),v=t.entities[d];v?v.push(p):(v=[p],t.entities[d]=v)}}}return t}function r(e){var t=_.where(e,(function(e){return!n(e)})),i=_.where(e,(function(e){return n(e)}));return _.union(t,i)}function o(e,t){return JSON.stringify({e:t})}function n(e){return e.hasOwnProperty("extends")}function a(e){var t=e;return t.isAbandoned}function s(e){for(var t=0,i=e.properties;t<i.length;){var r=i[t];if(r.properties)for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];i.splice(t+1,0,a),t++}t++}}function l(e){_.isEmpty(e)||e.sort(c)}function c(e,t){var i=e.displayName.toLocaleUpperCase(),r=t.displayName.toLocaleUpperCase();return i.localeCompare(r)}function u(e,t){if(!_.isEmpty(e)){var i={};p(t,i);var r=_.filter(e,(function(e){return 1!==e.fieldType&&i[e.name]}));_.isEmpty(r)||_.pull.apply(_,[e].concat(r))}}function p(e,t){if(!_.isEmpty(e)){for(var i=[],r=0,o=e;r<o.length;r++)for(var n=o[r],a=0,s=n.children;a<s.length;a++){var l=s[a];1===l.fieldType?i.push(l):t[l.name]=l}p(i,t)}}function d(e){var t=[];v(e.properties,t),e.properties=t}function v(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i];if(t.push(o),1===o.fieldType){var n=o;v(n.children,t)}}}function h(e){var t={};if(!_.isEmpty(e))for(var i=0,r=e;i<r.length;i++){var o=r[i],n={};t[o.name]=n;for(var a=0,s=o.levels;a<s.length;a++){var l=s[a];n[l.column.name]=l}}return t}e.isMeasureGroup=t,e.getExtensions=i,e.sortExtensionSchemasAtEnd=r,e.getExtensionKey=o,e.isExtension=n,e.isAbandoned=a,e.updatePropertiesWithChildren=s,e.sortProperties=l,e.removeDuplicateProperties=u,e.flattenFolders=d,e.getHierarchyLevelDictionary=h})(t=e.FieldListViewModelUtils||(e.FieldListViewModelUtils={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(i){function r(e,t,i,r,n,a){if(e&&t||(e={schema:void 0,isLoaded:!1}),t){var s=t.schemas;_.any(s)&&(e.schema?o(e,t,n,r,i):(e.schema=i.createModel(t,n,a),e.isLoaded=!0))}return e}function o(e,i,r,o,n){var a=t.FieldListViewModelUtils.getExtensions(i.schemas);g.visitModel(e,i,a,[new f(e.schema,o),new m(n,a),new y(n,a,o),new w])}function n(e,t,i,r){t.contract=i;for(var o=i.measure.kpi,n=0,s=t.kpiMeasures;n<s.length;n++){var l=s[n],c=void 0;switch(l.kpiType){case 2:c=i;break;case 1:c=o.goal;break;case 0:c=o.status;break;case 3:c=o.trend}a(l,c)}}function a(e,t){e.contract=t}function s(e,i,r,o,n){var a={};if(!_.isEmpty(i))for(var c=0,u=i;c<u.length;c++){var p=u[c];a[p.name]=p}for(var d=0,v=r;d<v.length;d++){var h=v[d],g=h.name,p=a[g];if(p){delete a[g];var f=_.filter(p.children,(function(e){return 1===e.fieldType}));l(e,p,h),s(e,f,h.displayFolders,o,p)}else{var m=o.convertConceptualDisplayFolder(h,e.contractSchema,n,e);n?(n.children||(n.children=[]),n.children.push(m),t.FieldListViewModelUtils.sortProperties(n.children)):(e.displayFolders||(e.displayFolders=[]),e.displayFolders.push(m),e.properties.push(m))}}if(!_.isEmpty(a)){var y=_.values(a);n?_.pull.apply(_,[n.children].concat(y)):_.pull.apply(_,[e.displayFolders].concat(y))}}function l(e,t,i){var r={},o=_.filter(t.children,(function(e){return 1!==e.fieldType}));if(!_.isEmpty(o))for(var n=0,a=o;n<a.length;n++){var s=a[n];r[s.name]=s}if(!_.isEmpty(i.properties))for(var l=0,c=i.properties;l<c.length;l++){var u=c[l],p=u.name,s=r[p];if(s)delete r[p];else{var d=e.findFields(p,t.schemaName)||e.findKpis(p,t.schemaName);d&&t.children.push(d[0].clone())}}if(!_.isEmpty(i.hierarchies))for(var v=0,h=i.hierarchies;v<h.length;v++){var g=h[v],f=g.name,m=r[f];if(m)delete r[f];else{var d=e.findHierarchies(f,t.schemaName);d&&t.children.push(_.first(d).clone())}}if(!_.isEmpty(r)){var y=_.values(r);_.pull.apply(_,[t.children].concat(y))}}function c(e){var t=e.properties,i=_.filter(t,(function(e){return 1===e.fieldType}));_.isEmpty(i)||_.pull.apply(_,[t].concat(i)),e.displayFolders&&t.push.apply(t,e.displayFolders)}function u(e){return!!e.measure&&!!e.measure.kpi}function p(e){return!!e.kpiValue}function d(e,t,i,r,o){if(!_.isEmpty(e)){var n=_.filter(e,(function(e){return e.propertyRename&&e.propertyRename.after===t}));_.isEmpty(n)||(t=n[0].propertyRename.before)}return r.findFieldsByType(t,i,o)}var v=e.explore.util.HierarchyUtils,h=e.data.contracts.SchemaChangeType.ObjectTypeEnum;i.mergeModel=r;var g;!(function(e){function i(e,i,o,n){for(var a,s=t.FieldListViewModelUtils.sortExtensionSchemasAtEnd(i.schemas),l=0,c=s;l<c.length;l++){var u=c[l];if(!t.FieldListViewModelUtils.isExtension(u))for(var p=0,d=n;p<d.length;p++){var v=d[p];a=v.visitModel(a,u)}for(var h=0,g=u.entities;h<g.length;h++){var f=g[h];t.FieldListViewModelUtils.isExtension(f)&&!t.FieldListViewModelUtils.isAbandoned(f)||r(u,f,o,n)}if(!t.FieldListViewModelUtils.isExtension(u))for(var m=0,y=n;m<y.length;m++){var v=y[m];a=v.modelVisited(a,u)}}}function r(e,i,r,c){for(var v,h=0,g=c;h<g.length;h++){var f=g[h];v=f.visitEntity(v,e,i)}if(!t.FieldListViewModelUtils.isExtension(i))for(var m=0,y=i.properties;m<y.length;m++){var w=y[m];t.FieldListViewModelUtils.isExtension(w)||(u(w)?a(e,w,c):p(w)?s(e,w,c):o(e,w,c))}var C=r.entities[t.FieldListViewModelUtils.getExtensionKey(e.name,i.name)];if(C)for(var S=0,b=C;S<b.length;S++)for(var x=b[S],M=0,E=x.entity.properties;M<E.length;M++){var w=E[M];n(x.schema,w,c)}for(var D=0,F=i.hierarchies;D<F.length;D++){var V=F[D];l(e,V,c)}for(var I=0,P=c;I<P.length;I++){var f=P[I];v=f.entityVisited(v,i)}for(var A=0,T=i.displayFolders;A<T.length;A++){var L=T[A];d(e,L,c)}}function o(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitProperty(r,e,t)}}function n(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitExtensionMeasure(r,e,t)}}function a(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitKpi(r,e,t)}}function s(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitKpiMeasure(r,e,t)}}function l(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitHierarchy(r,e,t)}for(var s=0,l=t.levels;s<l.length;s++){var u=l[s];c(e,u,i)}}function c(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitHierarchyLevel(r,e,t)}}function d(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitDisplayFolder(r,e,t)}for(var s=0,l=t.displayFolders;s<l.length;s++){var c=l[s];d(e,c,i)}}e.visitModel=i})(g||(g={}));var f=(function(){function e(e,t){this.fieldListConceptualModel=e,t&&(this.schemaChanges=t.changes,this.entityRenameChanges=_.filter(this.schemaChanges,(function(e){return e.entityRename})))}return e.prototype.visitModel=function(e,t){return this.fieldListConceptualModel},e.prototype.visitEntity=function(e,i,r){return this.fieldListConceptualEntity=this.getFieldListConceptualEntity(r),this.fieldListConceptualEntity&&t.FieldListViewModelUtils.isAbandoned(this.fieldListConceptualEntity.contract)!==t.FieldListViewModelUtils.isAbandoned(r)&&(this.fieldListConceptualEntity=null),this.propertyRenameChanges=this.fieldListConceptualEntity&&_.filter(this.schemaChanges,(function(e){return e.propertyRename&&e.propertyRename.entity===r.name&&e.propertyRename.objectType!==h.Hierarchy})),this.hierarchyRenameChanges=this.fieldListConceptualEntity&&_.filter(this.schemaChanges,(function(e){return e.propertyRename&&e.propertyRename.entity===r.name&&e.propertyRename.objectType===h.Hierarchy})),this.fieldListConceptualEntity},e.prototype.visitProperty=function(e,t,i){if(this.fieldListConceptualEntity){var r=d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,0);return _.filter(r,(function(e){return!e.isExtension}))}},e.prototype.visitExtensionMeasure=function(e,t,i){if(this.fieldListConceptualEntity){var r=d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,0);return _.filter(r,(function(e){return e.isExtension}))}},e.prototype.visitHierarchy=function(e,t,i){if(this.fieldListConceptualHierarchies=this.fieldListConceptualEntity&&d(this.hierarchyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,2),_.isEmpty(this.fieldListConceptualHierarchies))this.fieldListConceptualHierarchies=null,this.existingLevels=null;else{this.existingLevels={};for(var r=_.first(this.fieldListConceptualHierarchies).hierarchyLevels,o=0,n=r;o<n.length;o++){var a=n[o];this.existingLevels[a.name]=a}}return this.fieldListConceptualHierarchies},e.prototype.visitHierarchyLevel=function(e,t,i){var r=this;if(!_.isEmpty(this.fieldListConceptualHierarchies)){var o=i.name,n=_.first(this.fieldListConceptualHierarchies),a=_.filter(this.schemaChanges,(function(e){return e.hierarchyLevelRename&&e.hierarchyLevelRename.entity===r.fieldListConceptualEntity.contract.name&&e.hierarchyLevelRename.hierarchy===n.contract.name&&e.hierarchyLevelRename.after===o}));return _.isEmpty(a)||(o=_.first(a).hierarchyLevelRename.before),this.existingLevels[o]}},e.prototype.visitKpi=function(e,t,i){if(this.fieldListConceptualEntity)return d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,4)},e.prototype.visitKpiMeasure=function(e,t,i){if(this.fieldListConceptualEntity)return d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,5)},e.prototype.visitDisplayFolder=function(e,t,i){return this.fieldListConceptualEntity?d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,1):e},e.prototype.modelVisited=function(e,t){return e},e.prototype.entityVisited=function(e,t){return e},e.prototype.getFieldListConceptualEntity=function(e){var t=e.name;if(!_.isEmpty(this.entityRenameChanges)){var i=_.filter(this.entityRenameChanges,(function(t){return t.entityRename&&t.entityRename.after===e.name}));_.isEmpty(i)||(t=i[0].entityRename.before)}return this.fieldListConceptualModel.findEntity(t)},e})(),m=(function(){function e(e,t){this.fieldListViewModelFactory=e,this.extensions=t}return e.prototype.visitModel=function(e,t){return this.fieldListConceptualModel=e,e&&(e.contract=t),e},e.prototype.visitEntity=function(e,t,i){return this.fieldListConceptualEntity=e,e&&(e.contract=i),this.fieldListConceptualEntity},e.prototype.modelVisited=function(e,t){return e},e.prototype.entityVisited=function(e,t){return e},e.prototype.visitProperty=function(e,t,i){if(e)for(var r=0,o=e;r<o.length;r++){var n=o[r];n.contract=i}return e},e.prototype.visitExtensionMeasure=function(e,t,i){if(e)for(var r=0,o=e;r<o.length;r++){var n=o[r];n.contract=i}return e},e.prototype.visitHierarchy=function(e,t,i){if(e){for(var r=0,o=e;r<o.length;r++){var n=o[r];n.contract=i}this.fieldListConceptualHierarchies=e;for(var a=0,s=this.fieldListConceptualHierarchies;a<s.length;a++){var l=s[a];l.hierarchyLevels=[]}}return e},e.prototype.visitHierarchyLevel=function(e,t,i){if(e){e.contract=i.column,e.hierarchyLevelContract=i;for(var r=0,o=this.fieldListConceptualHierarchies;r<o.length;r++){var n=o[r];n.hierarchyLevels.push(e)}}return e},e.prototype.visitKpi=function(e,t,i){if(!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var a=o[r];n(this.fieldListConceptualEntity,a,i,this.fieldListConceptualEntity.contract)}return e},e.prototype.visitKpiMeasure=function(e,t,i){if(!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];n.contract=i}return e},e.prototype.visitDisplayFolder=function(e,t,i){return e},e})(),y=(function(){function e(e,t,i){this.fieldListViewModelFactory=e,this.extensions=t,i&&(this.modelSchemaChanges=i.changes)}return e.prototype.visitModel=function(e,t){return this.fieldListConceptualModel=e,this.schema=t,e},e.prototype.visitEntity=function(e,i,r){if(this.fieldListConceptualEntity=e,this.fieldListConceptualModel&&!e){var o=this.fieldListViewModelFactory.convertConceptualEntity(r,i,this.fieldListConceptualModel,this.extensions);this.fieldListConceptualModel.entities.push(o)}return this.sortedHierarchies=r.hierarchies.slice(0),v.sortHierarchies(this.sortedHierarchies),this.hierarchyLevelDictionary=this.fieldListConceptualModel.canEdit&&t.FieldListViewModelUtils.getHierarchyLevelDictionary(r.hierarchies),this.fieldListConceptualEntity},e.prototype.modelVisited=function(e,t){return e},e.prototype.entityVisited=function(e,t){return e&&s(this.fieldListConceptualEntity,this.fieldListConceptualEntity.displayFolders,t.displayFolders,this.fieldListViewModelFactory,null),e},e.prototype.visitProperty=function(e,t,i){if(this.fieldListConceptualEntity&&_.isEmpty(e)){var r=this.fieldListViewModelFactory.convertConceptualProperty(i,t,this.fieldListConceptualEntity);this.fieldListConceptualEntity.properties.push(r)}return e},e.prototype.visitExtensionMeasure=function(e,t,i){if(this.fieldListConceptualEntity&&_.isEmpty(e)){var r=this.fieldListViewModelFactory.convertConceptualExtensionMeasure(i,t,this.fieldListConceptualEntity);this.fieldListConceptualEntity.properties.push(r)}return e},e.prototype.visitHierarchy=function(e,t,i){if(this.fieldListConceptualHierarchies=e,this.fieldListConceptualEntity&&_.isEmpty(e)){var r=this.fieldListViewModelFactory.convertConceptualHierarchy(i,t,this.fieldListConceptualEntity);this.fieldListConceptualEntity.hierarchies||(this.fieldListConceptualEntity.hierarchies=[]),this.fieldListConceptualEntity.hierarchies.push(r),this.fieldListConceptualEntity.properties.push(r),this.expandHierarchyIfJustCreated(r),e=[r]}return e},e.prototype.visitHierarchyLevel=function(e,t,i){if(!_.isEmpty(this.fieldListConceptualHierarchies)&&!e){var r=_.first(this.fieldListConceptualHierarchies);e=this.fieldListViewModelFactory.convertConceptualHierarchyLevel(i,t,r);for(var o=0,n=this.fieldListConceptualHierarchies;o<n.length;o++){var a=n[o];a.hierarchyLevels.push(e)}}return e},e.prototype.visitKpi=function(e,t,i){if(this.fieldListConceptualEntity&&_.isEmpty(e)){var r=this.fieldListViewModelFactory.convertConceptualKpi(i,t,this.fieldListConceptualEntity);this.fieldListConceptualEntity.properties.push(r),e=[r]}return e},e.prototype.visitKpiMeasure=function(e,t,i){return e},e.prototype.visitDisplayFolder=function(e,t,i){return e},e.prototype.expandHierarchyIfJustCreated=function(e){var t=this;_.any(this.modelSchemaChanges,(function(i){var r=i.hierarchyCreate&&i.hierarchyCreate.entity===t.fieldListConceptualEntity.contract.name&&i.hierarchyCreate.name===e.name;return r}))&&(e.expanded=!0)},e})(),w=(function(){function e(){}return e.prototype.visitModel=function(e,t){this.fieldListConceptualModel=e,this.existingEntities=[];for(var i=0,r=this.fieldListConceptualModel.entities;i<r.length;i++){var o=r[i];this.existingEntities.push(o)}return e},e.prototype.visitEntity=function(e,t,i){if(this.fieldListConceptualEntity=e,e){if(_.pull(this.existingEntities,e),this.existingHierarchies=[],this.fieldListConceptualEntity.hierarchies)for(var r=0,o=this.fieldListConceptualEntity.hierarchies;r<o.length;r++){var n=o[r];this.existingHierarchies.push(n)}this.existingProperties=[];for(var a=0,s=this.fieldListConceptualEntity.properties;a<s.length;a++){var l=s[a];this.existingProperties.push(l)}}return this.fieldListConceptualEntity},e.prototype.modelVisited=function(e,i){return _.pull.apply(_,[this.fieldListConceptualModel.entities].concat(this.existingEntities)),t.FieldListViewModelOperations.expandIfSingleEntity(this.fieldListConceptualModel.entities),e},e.prototype.entityVisited=function(e,i){return e&&(_.pull.apply(_,[this.fieldListConceptualEntity.hierarchies].concat(this.existingHierarchies)),_.pull.apply(_,[this.fieldListConceptualEntity.properties].concat(this.existingProperties)),c(this.fieldListConceptualEntity),t.FieldListViewModelUtils.sortProperties(this.fieldListConceptualEntity.properties),t.FieldListViewModelUtils.removeDuplicateProperties(this.fieldListConceptualEntity.properties,this.fieldListConceptualEntity.displayFolders),t.FieldListViewModelUtils.flattenFolders(this.fieldListConceptualEntity),t.FieldListViewModelUtils.updatePropertiesWithChildren(this.fieldListConceptualEntity)),e},e.prototype.visitProperty=function(e,t,i){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n)}return e},e.prototype.visitExtensionMeasure=function(e,t,i){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n)}return e},e.prototype.visitHierarchy=function(e,t,i){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n),_.pull(this.existingHierarchies,n)}return e},e.prototype.visitHierarchyLevel=function(e,t,i){return e},e.prototype.visitKpi=function(e,t,i){if(!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n)}return e},e.prototype.visitKpiMeasure=function(e,t,i){return e},e.prototype.visitDisplayFolder=function(e,t,i){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n)}return e},e})()})(i=t.FieldListViewModelMerger||(t.FieldListViewModelMerger={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.FieldExprPattern,n=t.services.schemaItemActivationUtils;!(function(e){function t(e){return e.supported&&(!e.hidden||e.showHidden)}e.isFieldVisible=t})(r=i.FieldListUtils||(i.FieldListUtils={}));var a;!(function(t){function i(t,i,r){var o=e.explore.util.ModelAuthoringUtility.getLastNewCalculationSchemaChangeAsFieldExpr(r);if(o)return s(t,o),n.setActiveSchemaItem(i,o),o}function r(e,t){for(var i=0,r=e.entities;i<r.length;i++){var o=r[i];o.expanded=t;for(var n=0,a=o.properties;n<a.length;n++){var s=a[n];2!==s.fieldType&&4!==s.fieldType&&1!==s.fieldType||(s.expanded=t)}}}function a(t,i){var r=e.data.SQExprConverter.asFieldPattern(i),n=o.toFieldExprEntityItemPattern(r);if(n.entity){var a=t.findEntity(n.entity);a&&(a.expanded=!0)}}function s(e,i){a(e,i),t.updateSelection(e,i)}function l(t,i){var r=e.data.SQExprConverter.asFieldPattern(i),n=o.toFieldExprEntityItemPattern(r);if(n&&n.entity)if(o.hasFieldExprName(r)){var a=t.findFields(n.entity,o.getPropertyName(r),n.schema);if(a){for(var s=0,l=a;s<l.length;s++){var c=l[s];c.hidden=!c.hidden}return _.first(a).hidden}}else if(r.hierarchy){var u=t.findHierarchies(n.entity,o.getHierarchyName(r),n.schema);if(u){for(var p=0,d=u;p<d.length;p++){var v=d[p];v.hidden=!v.hidden}return _.first(u).hidden}}else{var h=t.findEntity(n.entity);if(h)return h.hidden=!h.hidden,h.hidden}}function c(e){e.showHidden=!e.showHidden}function u(e){for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.canEdit&&r.hidden&&(r.hidden=!1);for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];a.canEdit&&a.hidden&&(a.hidden=!1)}}}function p(e){for(var t=0,i=e.entities;t<i.length;t++)for(var r=i[t],o=0,n=r.properties;o<n.length;o++){var a=n[o],s=a;s.supported=!(s.type&&s.type.binary)}}function d(e){for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.selected=!1;for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];a.selected=!1}}}function v(i,r){t.clearSelection(i);var n=e.data.SQExprConverter.asFieldPattern(r);if(n){var a=o.toFieldExprEntityItemPattern(n);if(a.entity)if(o.hasFieldExprName(n)){var s=i.findFields(a.entity,o.getPropertyName(n),a.schema);if(s)for(var l=0,c=s;l<c.length;l++){var u=c[l];u.selected=!0}}else{var p=i.findEntity(a.entity);p&&(p.selected=!0)}}}function h(e){var t=_.filter(e,(function(e){return e.userEntity&&!e.hidden}));1===t.length&&(t[0].expanded=!0)}t.applyModelChanges=i,t.collapseOrExpandAllEntities=r,t.expandEntity=a,t.expandEntityAndSelect=s,t.toggleHide=l,t.toggleShowHidden=c,t.unhideAll=u,t.updateSupportedProperties=p,t.clearSelection=d,t.updateSelection=v,t.expandIfSingleEntity=h})(a=i.FieldListViewModelOperations||(i.FieldListViewModelOperations={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=jsCommon.ArrayExtensions,r=e.data.SQExpr,o=e.VisualObjectRepetition,n=(function(){function e(e,t,i,r,o,n,a,s,l,c,u,p){this.expr=e,this.role=t,this.startIndex=i,this.endIndex=r,this.isReplaceable=o,this.displayName=n,this.dropDownItems=a,this.tooltip=s,this.valid=l,this.hierarchyLevels=c,this.colorScalesVisualObjectRepetition=u,this.dataBarsVisualObjectRepetition=p}return e.prototype.equals=function(e){return this.role===e.role&&this.startIndex===e.startIndex&&this.endIndex===e.endIndex&&this.displayName===e.displayName&&this.isReplaceable===e.isReplaceable&&this.tooltip===e.tooltip&&this.valid===e.valid&&o.equals(this.colorScalesVisualObjectRepetition,e.colorScalesVisualObjectRepetition)&&o.equals(this.dataBarsVisualObjectRepetition,e.dataBarsVisualObjectRepetition)&&r.equals(this.expr,e.expr)&&_.isEqual(this.dropDownItems,e.dropDownItems)&&i.comparableSequenceEqual(this.hierarchyLevels,e.hierarchyLevels)},e})();t.FieldWellProperty=n;var a=(function(){function e(e,t){
this.expr=e,this.displayName=t}return e.prototype.equals=function(e){return r.equals(this.expr,e.expr)&&this.displayName===e.displayName},e})();t.FieldWellHierarchyLevel=a;var s=(function(){function e(e,t,i,r,o){this.role=e,this.displayName=t,this.properties=i,this.supportsMultipleItems=r,this.description=o}return e.prototype.equals=function(e){return this.role===e.role&&this.displayName===e.displayName&&i.comparableSequenceEqual(this.properties,e.properties)&&this.supportsMultipleItems===e.supportsMultipleItems&&this.description===e.description},e})();t.FieldWellBucket=s;var l=(function(){function e(e){this.buckets=e}return e})();t.FieldWell=l})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.explore.util.ConditionalFormattingUtil,n=e.explore.util.DataBarsUtil,a=e.data.FieldExprPattern,s=e.explore.utils.GroupUtils,l=e.data.SQExprBuilder,c=e.data.SQExprUtils,u=e.data.SQHierarchyExprUtils,p=e.explore.util.VisualContainerUtils;!(function(i){function r(e,t,i,r,o,n,s){var l=new f(e,o,n,t,i,r,s);return a.visit(e,l)}function d(e){return{type:0}}function v(e,t,i,r,o,n,s,l,c){return{items:a.visit(e.expr,new m(e,t,i,r,o,n,s,l,c))}}function h(e,t){var i=e.getConceptualProperty(t);return i&&1===i.kind}var g="Aggregate_";i.createAggregateMenuItems=r;var f=(function(){function i(e,t,i,r,o,n,a){this.sqExpr=e,this.dataRoleKind=t,this.requiredTypes=i,this.schema=r,this.aggrOps=o,this.hasHierarchyLevels=n,this.property=a}return i.prototype.visitEntity=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumn=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumnAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitGroupingColumn=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitGroupingColumnAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumnHierarchyLevelVariation=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitEntityAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchy=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchyLevel=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchyLevelAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitMeasure=function(e){return[]},i.prototype.visitPercentOfGrandTotal=function(e){var t=l.fieldExpr(e.baseExpr);return this.createMenuItemsForPercentOfTotal(t)},i.prototype.visitPercentOfRoleTotal=function(e){var t=l.fieldExpr(e.baseExpr);return this.createMenuItemsForPercentOfTotal(t)},i.prototype.visitPercentile=function(e){return[]},i.prototype.visitSelectRef=function(e){return[]},i.prototype.createMenuItemsForPercentOfTotal=function(e){var t=l.removeAggregate(e).getMetadata(this.schema);if(!t)return[];var i=t.type,r=i.text||i.dateTime||i.duration?[3,4]:[];return this.createMenuItems(e,r)},i.prototype.createMenuItems=function(t,i){void 0===i&&(i=[]);var r=[];if(!this.hasHierarchyLevels&&_.isEmpty(t.validate(this.schema,this.aggrOps))&&!c.discourageAggregation(t,this.schema)){var o=this.dataRoleKind===e.VisualDataRoleKind.Grouping,n=this.dataRoleKind===e.VisualDataRoleKind.GroupingOrMeasure,a=o?[]:this.aggrOps.getSupportedAggregates(t,this.schema,this.requiredTypes);a=_.difference(a,i),n&&!h(t,this.schema)&&r.push(this.createRemoveAggregateMenuItem());for(var s=0,l=a;s<l.length;s++){var u=l[s];r.push(this.createAggregateMenuItem(u))}}return r},i.prototype.createAggregateMenuItem=function(i){var r=d(this.property);r.key={action:2,aggregate:i};var o=l.removeAggregate(this.sqExpr).getMetadata(this.schema),n=t.services.getAggregateKey(i,o);return r.text=e.common.localize.get(g+n),r},i.prototype.createRemoveAggregateMenuItem=function(){var t=d(this.property);return t.key={action:1},t.text=e.common.localize.get("FieldWell_RemoveAggregate"),t},i.prototype.visitTransformOutputRoleRef=function(e){return[]},i})(),m=(function(){function t(e,t,i,r,o,n,a,s,l){this.property=e,this.bucket=t,this.dataRole=i,this.schema=r,this.aggrOps=o,this.visual=n,this.featureSwitchService=a,this.groupingDesignStateService=s,this.showValueAsService=l,this.property=e,this.bucket=t,this.dataRole=i,this.schema=r,this.aggrOps=o,this.visual=n,this.featureSwitchService=a,this.groupingDesignStateService=s,this.menuItems=[this.createDeleteMenuItem()]}return t.prototype.visitEntity=function(e){return this.menuItems},t.prototype.visitColumn=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.addGroupsMenuItems(e),this.menuItems},t.prototype.visitColumnAggr=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.menuItems},t.prototype.visitGroupingColumn=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.addGroupsMenuItems(e),this.menuItems},t.prototype.visitGroupingColumnAggr=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.menuItems},t.prototype.visitColumnHierarchyLevelVariation=function(e){var t=this.property.expr;return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.source.schema),this.addQuickCalcMenuItem(e.source.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitEntityAggr=function(e){var t=this.property.expr;return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitHierarchy=function(e){return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addShowAllMenuItem(_.first(this.property.hierarchyLevels).expr),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitHierarchyLevel=function(e){var t=this.property.expr;return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitHierarchyLevelAggr=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitMeasure=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitPercentile=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.menuItems},t.prototype.visitSelectRef=function(e){return[]},t.prototype.visitTransformOutputRoleRef=function(e){return[]},t.prototype.visitPercentOfGrandTotal=function(e){return this.addPercentTotalMenuItems(e.baseExpr)},t.prototype.visitPercentOfRoleTotal=function(e){return this.addPercentTotalMenuItems(e.baseExpr)},t.prototype.addPercentTotalMenuItems=function(e){var t=l.fieldExpr(e);this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(a.getSchema(e)),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels);var i=a.getProperty(e);return i&&this.addVariationsMenuItems(i),this.menuItems},t.prototype.addAggregateMenuItems=function(){var e=r(this.property.expr,this.schema,this.aggrOps,!_.isEmpty(this.property.hierarchyLevels),this.dataRole.kind,this.dataRole.requiredTypes,this.property);_.isEmpty(e)||(this.menuItems.push(this.createSeparatorMenuItem()),(t=this.menuItems).push.apply(t,e));var t},t.prototype.addConditionalFormattingMenuItems=function(e){if(this.property.colorScalesVisualObjectRepetition||this.property.dataBarsVisualObjectRepetition){var t=e.getMetadata(this.schema);if(t){var i=1===t.kind&&t.type.numeric,r=p.hasGroupByItems(this.visual.query);i&&!r&&(this.menuItems.push(this.createSeparatorMenuItem()),this.addSetConditionalFormattingMenuItem(),this.addRemoveConditionalFormattingMenuItem())}}},t.prototype.addSetConditionalFormattingMenuItem=function(){var t=[];if(this.property.colorScalesVisualObjectRepetition&&t.push(this.createMenuItemWithAction(12,"FieldWell_ConditionalFormatting_ColorScales")),this.property.dataBarsVisualObjectRepetition&&t.push(this.createMenuItemWithAction(13,"FieldWell_ConditionalFormatting_DataBars")),!_.isEmpty(t)){var i=d(this.property);i.text=e.common.localize.get("FieldWell_ConditionalFormatting"),i.children=t,this.menuItems.push(i)}},t.prototype.addRemoveConditionalFormattingMenuItem=function(){var t=[],i=this.property.colorScalesVisualObjectRepetition&&this.visual&&o.isConditionalFormattingApplied(this.visual.objects,this.property.colorScalesVisualObjectRepetition),r=this.property.dataBarsVisualObjectRepetition&&this.visual&&n.isDataBarsApplied(this.visual.objects,n.getDataBarsPropertyId(this.property.dataBarsVisualObjectRepetition),this.property.dataBarsVisualObjectRepetition.selector);if(i||r){if(this.property.colorScalesVisualObjectRepetition&&this.property.dataBarsVisualObjectRepetition){var a=this.createMenuItemWithAction(14,"FieldWell_ConditionalFormatting_All");a.disabled=!(i&&r),t.push(a)}if(this.property.colorScalesVisualObjectRepetition){var s=this.createMenuItemWithAction(15,"FieldWell_ConditionalFormatting_ColorScales");s.disabled=!i,t.push(s)}if(this.property.dataBarsVisualObjectRepetition){var l=this.createMenuItemWithAction(16,"FieldWell_ConditionalFormatting_DataBars");l.disabled=!r,t.push(l)}var c=d(this.property);c.text=e.common.localize.get("FieldWell_RemoveConditionalFormatting"),c.children=t,this.menuItems.push(c)}},t.prototype.createMenuItemWithAction=function(t,i){var r=d(this.property);return r.key={action:t},r.text=e.common.localize.get(i),r},t.prototype.addShowAllMenuItem=function(t){var i=c.isMeasure(t);p.hasGroupByItems(this.visual.query)||(this.dataRole.kind===e.VisualDataRoleKind.Grouping||this.dataRole.kind===e.VisualDataRoleKind.GroupingOrMeasure&&!i)&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createShowAllMenuItem()))},t.prototype.addHierarchiesMenuItems=function(e){if(!_.isEmpty(e)){var t=_.first(e),i=u.expandExpr(this.schema,t.expr.arg);i instanceof Array&&i.length===e.length||this.bucket.supportsMultipleItems&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createRestoreHierarchyMenuItem()))}},t.prototype.addShowValueAsMenuItem=function(t){if(_.isEmpty(this.property.hierarchyLevels)&&this.property.expr.getConceptualProperty(this.schema)){var i=this.schema.schema(t),r=i&&i.capabilities.supportsScopedEval;if(this.featureSwitchService.featureSwitches.quickCalc&&!p.hasGroupByItems(this.visual.query)&&r&&this.dataRole.kind!==e.VisualDataRoleKind.Grouping){var o=this.property.expr,n=this.showValueAsService.createShowValueAsMenuItems(o,this.schema,this.visual.visualType);_.isEmpty(n)||(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createShowValueAsMenuItem(n)))}}},t.prototype.addQuickCalcMenuItem=function(e){if(this.property.expr.getConceptualProperty(this.schema)){var t=this.schema.schema(e),i=t&&t.capabilities.canEdit&&!t.isExtensionSchema;this.featureSwitchService.featureSwitches.daxTemplatesEnabled&&i&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createQuickCalcMenuItem()))}},t.prototype.addVariationsMenuItems=function(t){var i=l.fromColumn(t),r=i.getConceptualProperty(this.schema);if(r){var o=r.column;if(o&&!_.isEmpty(o.variations)){for(var n=l.entity(t.schema,t.entity),a=this.createVariationMenuItem(r.displayName,i),s=[],c=0,u=o.variations;c<u.length;c++){var p=u[c];if(p.navigationProperty&&p.navigationProperty.targetEntity){var d=p.navigationProperty.targetEntity;if(this.dataRole.kind!==e.VisualDataRoleKind.Measure)for(var v=_.filter(d.hierarchies,(function(e){return!e.hidden})),h=0,g=v;h<g.length;h++){var f=g[h],m=l.hierarchy(l.propertyVariationSource(n,p.name,r.name),f.name);s.push(this.createVariationMenuItem(f.name,m))}for(var y=l.entity(n.schema,d.name),w=_.filter(d.properties,(function(e){return!e.hidden})),C=0,S=w;C<S.length;C++){var b=S[C],x=l.columnRef(y,b.name);s.push(this.createVariationMenuItem(b.displayName,x))}}}if(!_.isEmpty(s)){this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(a),(M=this.menuItems).push.apply(M,s);var M}}}},t.prototype.addGroupsMenuItems=function(e){var t=this.schema.schema(e.schema),i=t&&t.capabilities.canEdit;if(i){var r=this.featureSwitchService.featureSwitches.enableGroupAuthoring,o=this.featureSwitchService.featureSwitches.clusteringEnabled;if(r||o){var n=[],a=this.property.expr.getConceptualProperty(this.schema);!s.canExprBeGrouped(this.schema,this.property.expr)||this.property.hierarchyLevels&&this.property.hierarchyLevels.length>0||n.push(this.createGroupsMenuItem()),s.isGroupOrBinColumn(e.entity,a,this.groupingDesignStateService)&&n.push(this.createEditGroupsMenuItem()),s.isClusteringColumn(e.entity,a,this.groupingDesignStateService)&&n.push(this.createEditClusteringMenuItem()),n.length>0&&(this.menuItems.push(this.createSeparatorMenuItem()),(l=this.menuItems).push.apply(l,n))}var l}},t.prototype.createShowValueAsMenuItem=function(t){var i=d(this.property);i.key={action:4};var r="FieldWell_ShowValueAs";return i.text=e.common.localize.get(r),i.children=t,i},t.prototype.createQuickCalcMenuItem=function(){var t=d(this.property);t.key={action:6};var i="QuickCalc_NewMeasure";return t.text=e.common.localize.get(i),t},t.prototype.createGroupsMenuItem=function(){var t=d(this.property);return t.key={action:8},t.text=e.common.localize.get("ContextMenuItem_CreateGroups"),t},t.prototype.createEditGroupsMenuItem=function(){var t=d(this.property);return t.text=e.common.localize.get("ContextMenuItem_EditGroups"),t.key={action:9},t},t.prototype.createEditClusteringMenuItem=function(){var t=d(this.property);return t.text=e.common.localize.get("Clustering_EditClusters"),t.key={action:10},t},t.prototype.createRestoreHierarchyMenuItem=function(){var t=d(this.property);return t.text=e.common.localize.get("FieldWell_RestoreHierarchy"),t.key={action:11},t},t.prototype.createVariationMenuItem=function(e,t){var i=d(this.property);return i.text=e,i.key={action:7,variationExpr:t},i},t.prototype.createShowAllMenuItem=function(){var t=d(this.property);return t.key={action:3},t.text=e.common.localize.get("FieldWell_ShowAll"),t},t.prototype.createDeleteMenuItem=function(){var t=d(this.property);return t.key={action:0},t.text=e.common.localize.get("FieldWell_Remove"),t},t.prototype.createSeparatorMenuItem=function(){var e=d(this.property);return e.type=1,e},t})();i.createDropDownItems=v})(r=i.MenuItemFactory||(i.MenuItemFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r;!(function(r){function o(e,t,i){var r=i.promiseFactory.defer(),o=S.getDataRolesForVisual(e,i.visualPlugin);return _.isEmpty(o)?r.resolve([]):w.enumerateObjectRepetition(e.config.singleVisual,i.promiseFactory).then((function(n){r.resolve(a(e,t,o,n,r,i))}),(function(n){r.resolve(a(e,t,o,[],r,i))})),r}function n(e){if(!e)return[];for(var t=[],r=0,o=e;r<o.length;r++){var n=o[r];s(n)&&t.push(new i.FieldWellBucket(n.name,n.displayName?i.ViewModelFactory.getDisplayName(n.displayName):n.name,[],(!1),i.ViewModelFactory.getDisplayName(n.description)))}return t}function a(e,t,i,r,o,a){var s=n(i);return r=r||[],l(s,e,r,t,i,a),s}function s(t){var i=t.kind;return i===e.VisualDataRoleKind.Measure||i===e.VisualDataRoleKind.Grouping||i===e.VisualDataRoleKind.GroupingOrMeasure}function l(e,t,i,r,o,n){var a=t.config.singleVisual.query;if(a&&a.defn){var s=a.projections,l=v(e);for(var p in s){var h=l[p];if(h)for(var g=a.tryGetExprs(p),y=C.groupExprs(r,g),w=0,S=y;w<S.length;w++){var b=S[w],x=void 0,M=void 0,E=t.config.singleVisual.query.defn.selectNameOf(b.expr),D=n.visualPlugin.capabilities(t.config.singleVisual.visualType);b.children||(x=f.findObjectRepetition(E,D,i),M=m.findObjectRepetition(E,D,i));var F={group:b,schema:r,displayNameService:n.displayName,roleName:p,dataRoles:o,bucket:h,visual:t,colorScalesObjectRepetition:x,dataBarsObjectRepetition:M,featureSwitchService:n.featureSwitch};h.properties.push(u(F,n.aggrOps,n.visualPlugin))}}d(e,t,n.visualPlugin,n.featureSwitch,n.geoTagging),c(e,t,n.aggrOps,r,o,n.featureSwitch,n.groupingDesignState,n.showValueAsService)}}function c(e,t,r,o,n,a,s,l){for(var c=0,u=e;c<u.length;c++)for(var p=u[c],d=0,v=p.properties;d<v.length;d++){var h=v[d];h.dropDownItems=i.MenuItemFactory.createDropDownItems(h,p,g.findItemWithName(n,p.role),o,r,t.config.singleVisual,a,s,l),i.FieldWellViewModelOperations.updateSelectedMenuItems(h,t)}}function u(e,r,o){var n=t.util.ModelAuthoringUtility.validate(e.group.expr,e.schema,r),a=_.isEmpty(n);if(e.group.children)for(var s=0,l=e.group.children.length;a&&s<l;s++){var c=t.util.ModelAuthoringUtility.validate(e.group.children[s],e.schema,r);a=a&&_.isEmpty(c)}var u=S.getVisualCapabilities(e.visual,o),d=new i.FieldWellProperty(e.group.expr,e.roleName,e.group.selectQueryIndex,e.group.selectQueryIndex+(e.group.children?e.group.children.length-1:0),(!1),e.displayNameService.getDisplayName(e.group.expr,e.schema,u),null,h(e.group.expr,e.schema,a,e.displayNameService,u),a,p(e,u),e.colorScalesObjectRepetition,e.dataBarsObjectRepetition);return d}function p(e,t){var r=[];if(e.group.children)for(var o=0,n=e.group.children.length;o<n;o++){var a=e.group.children[o];r.push(new i.FieldWellHierarchyLevel(a,e.displayNameService.getDisplayName(a,e.schema,t)))}return r}function d(e,t,i,r,o){for(var n=i.capabilities(t.config.singleVisual.visualType),a=y.getDrillableRoles(n),s=S.getNumberRangesForRoles(t,i,o),l=0,c=e;l<c.length;l++){var u=c[l],p=s[u.role];u.supportsMultipleItems=_.contains(a,u.role)||!p||null==p.max||p.max>1;for(var d=0,v=u.properties;d<v.length;d++){var h=v[d];h.isReplaceable=!u.supportsMultipleItems}}}function v(e){for(var t={},i=0,r=e;i<r.length;i++){var o=r[i];t[o.role]=o}return t}function h(t,i,r,o,n){return r?o.getQualifiedDisplayName(t,i,n,{includeDefaultAggregate:!0}):e.common.localize.get("Invalid_FieldWellProperty_Tooltip")}var g=jsCommon.ArrayExtensions,f=t.util.ConditionalFormattingUtil,m=t.util.DataBarsUtil,y=e.explore.util.DrillUtils,w=t.contracts.SingleVisualConfig,C=e.data.SQExprGroupUtils,S=e.explore.util.VisualContainerUtils;r.createBuckets=o,r.createEmptyBuckets=n})(r=i.FieldWellViewModelFactory||(i.FieldWellViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){function i(e,t){var i=a.getAggregate(e.expr),o=void 0!==i,s=e.dropDownItems;if(s)for(var l=0,c=s.items;l<c.length;l++){var u=c[l],p=u.key;if(p)switch(p.action){case 2:u.checked=o&&p.aggregate===i;break;case 1:u.checked=!o;break;case 3:u.checked=t.config.singleVisual.query.projections[e.role].showAll;break;case 7:u.checked=r(e,u.text);break;case 4:for(var d=0,v=u.children;d<v.length;d++){var h=v[d];h.checked=n(e,h.key.showValueAs)}break;default:u.checked=!1}}}function r(e,t){var i=o(e);if(i)return i.hierarchy===t;var r=s.asFieldPattern(e.expr);return!!r&&(r.columnAggr?r.columnAggr.name===t:r.groupingColumnAggr?r.groupingColumnAggr.name===t:r.column?r.column.name===t:!!r.groupingColumn&&r.groupingColumn.name===t)}function o(e){if(!_.isEmpty(e.hierarchyLevels)){var t=e.hierarchyLevels[0],i=t.expr;return i.arg}}function n(e,t){var i=s.asFieldPattern(e.expr);if(!i||!t)return!1;switch(t.kind){case void 0:return!i.percentOfGrandTotal&&!i.percentOfRoleTotal;case 0:return!!i.percentOfGrandTotal;case 1:var r=t;return!(!i.percentOfRoleTotal||!_.all(i.percentOfRoleTotal.roles,(function(e){return _.contains(r.roles,e)})));default:return!1}}var a=e.data.FieldExprPattern,s=e.data.SQExprConverter;e.data.SQHierarchyExpr;t.updateSelectedMenuItems=i})(i=t.FieldWellViewModelOperations||(t.FieldWellViewModelOperations={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.filterChanged={name:"filterChanged"}})(t=e.FilterEvents||(e.FilterEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.contracts.FilterType,o=e.data.SQExprUtils,n=e.explore.util.VisualContainerUtils,a=(function(i){function a(e,t){var r=i.call(this,e,{expanded:!1,canToggleSingleSelect:!1,availableTypes:[],type:e.type})||this;return r.id=a.counter++,r.restatement="",r.displayName="",r.containerScope=t,r.howCreated=0,r}return __extends(a,i),a.prototype.setServices=function(e,t){this.visualHostServices=e,this.visualPlugin=t},a.prototype.isInvalid=function(){return this.invalid},Object.defineProperty(a.prototype,"isVisualFilter",{get:function(){return this.containerScope&&0===this.containerScope.scopeType},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasDefaultValue",{get:function(){return void 0!==this.defaultValue&&1===this.howCreated},enumerable:!0,configurable:!0}),a.prototype.getFilterContainerScope=function(){return this.containerScope},a.prototype.setRestatement=function(e){this.contract.type===this.readOnlyState.type&&(this.restatement=e)},a.prototype.clearRestatement=function(){this.restatement=""},a.prototype.getRestatement=function(){return this.restatement},Object.defineProperty(a.prototype,"visualContainer",{get:function(){if(this.isVisualFilter)return this.containerScope.container},enumerable:!0,configurable:!0}),a.prototype.updateFilterProperties=function(e,i,r){if(this.contract.expression){var a=this.contract.expression;this.isMeasure=o.isMeasure(a),this.discourageAggregation=o.discourageAggregation(a,e),this.valueType=t.FilterUtils.getValueType(a,e),this.formatter=t.FilterUtils.getFormatter(a,e),this.defaultValue=o.getDefaultValue(a,e),1===o.getAggregateBehavior(a,e)&&(this.isSingleSelectionRequired=!0,this.disableSelectionModeToggle=!0)}var s=this.containerScope.container;this.hasGroupingScope=s&&n.hasGrouping(s,e),this.invalid=!_.isEmpty(t.FilterUtils.validate(this.contract,e,r)),this.disabled=t.FilterUtils.shouldDisableFilter(this.contract,e,s,r,i)},a.prototype.switchType=function(e){this.readOnlyState.type=e},a.prototype.canVisualize=function(){var e=this.contract;return e.expression&&e.type!==r.Passthrough&&!this.isMeasure},a.prototype.updateViewStateCore=function(t){var i=this.contract,o=!this.invalid;if(t.disabled=this.disabled,t.expanded=i.expanded&&o,t.invalid=!o,_.any(this.availableTypes,(function(e){return e.type===r.Categorical}))&&!t.visual&&i.config){var n=i.config.singleVisual;n&&this.visualHostServices&&this.visualPlugin&&(t.visual={viewport:a.DefaultVisualViewPort,type:e.visuals.plugins.slicer.name,dataTransforms:{objects:n.objects},hostServices:this.visualHostServices,interactivityOptions:{dragDataPoint:!1,selection:!0},allowInvalidDataView:!0,visualPlugin:this.visualPlugin})}t.canToggleSingleSelect=!!(!t.disabled&&this.isPodEnabled()&&t.expanded&&t.visual&&t.visual.data)},a.prototype.updateAvailableTypes=function(){var t=this.readOnlyState.type;if(t===r.Passthrough)return void(this.availableTypes=[]);var i=[];this.valueType&&!this.valueType.bool&&i.push({type:r.Advanced,label:e.common.localize.get("FilterPane_Advanced")}),this.isMeasure||(i.push({type:r.Categorical,label:e.common.localize.get("FilterPane_Basic")}),this.isVisualFilter&&i.push({type:r.TopN,label:e.common.localize.get("FilterPane_TopN")})),this.availableTypes=i,this.cardType=_.find(i,(function(e){return e.type===t}))},a.prototype.isPodEnabled=function(){return this.containerScope&&1===this.containerScope.scopeType&&t.FilterUtils.isCategoricalFilter(this.readOnlyState.type)},a})(i.ViewModel);a.DefaultVisualViewPort={width:146,height:180,scale:1},a.counter=0,i.FilterViewModel=a})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.FieldExprPattern,n=t.contracts.FilterType,a=e.data.SQExprConverter;!(function(r){function s(e,t,r,o,a,s,l,c){var u;switch(e.type){case n.TopN:u=v(e,c,o,t,s,r);break;case n.Advanced:case n.Categorical:u=d(e,c,o,t,r);break;case n.Passthrough:u=p(e,o);break;case n.Include:case n.Exclude:u=new i.FilterViewModel(e,o);break;default:u=v(e,c,o,t,s,r)||d(e,c,o,t,r)||p(e,o)}return u.howCreated=e.howCreated,u.updateFilterProperties(t,a,s),u}function l(e){var t;if(e.filter){var r=e.filter.conditions(),o=r[0];o&&(t=i.FilterCardConverter.createAdvFilter(o,null,e.expression))}return!t&&e.expression&&(t=new i.AdvFilterCard(e.expression)),t}function c(e,t,i,r){var n=a.asFieldPattern(e),s={includeVariationSource:!0};return i.getDisplayName(e,t,r,s)||(n?o.getFieldExprName(n):void 0)}function u(e,t,i,r){return i.getQualifiedDisplayName(e,t,r)}function p(e,t){null==e.type&&(e.type=n.Passthrough);var r=new i.FilterViewModel(e,t);return r.setRestatement(e.restatement),r}function d(e,r,o,a,s,p){var d=l(e);if(d){e.expression||(e.expression=d.field),null==e.type&&(e.type=t.FilterUtils.getDefaultFilterType(e.expression,a)),null==e.type&&(e.type=n.Categorical);var v=e.expression,h=new i.FilterViewModel(e,o);return h.displayName=c(v,a,s,r),h.tooltip=u(v,a,s,r),h}}function v(t,r,o,a,s,l){var p=e.data.TopNFilterPattern.extractParametersFromFilter(t.filter);if(p){null==t.type&&(t.type=n.TopN);var d=new i.FilterViewModel(t,o);return d.displayName=c(p.fieldBeingFiltered,a,l,r),d.tooltip=u(p.fieldBeingFiltered,a,l,r),d}if(t.type===n.TopN&&t.expression){var d=new i.FilterViewModel(t,o);return d.displayName=c(t.expression,a,l,r),d.tooltip=u(t.expression,a,l,r),d}}r.convertFilterContainer=s,r.extractAdvFilterCard=l})(r=i.FilterViewModelFactory||(i.FilterViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t,i){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];this.kind=e,this.name=i.format(t,r)}return e})();e.ShowValueAsCalculation=t;var i=(function(e){function t(t){return e.call(this,void 0,"ShowValueAs_Calculation_None",t)||this}return __extends(t,e),t})(t);e.ShowValueAsNoCalculation=i;var r=(function(e){function t(t){return e.call(this,0,"ShowValueAs_Calculation_PercentOfGrandTotal",t)||this}return __extends(t,e),t})(t);e.ShowValueAsPercentOfGrandTotalCalculation=r;var o=(function(e){function t(t,i,r){var o=e.call(this,1,"ShowValueAs_Calculation_PercentOfRoleTotal",t,r)||this;return o.roles=i,o}return __extends(t,e),t})(t);e.ShowValueAsPercentOfRoleTotalCalculation=o})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large",e[e.Custom=3]="Custom"})(t=e.EmbedSize||(e.EmbedSize={})),e.EmbedSizes={small:{height:510,width:680},medium:{height:600,width:800},large:{height:700,width:933}}})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.common.models.ApplyStyle,n=jsCommon.ArrayExtensions,a=e.visuals.plugins,s=e.data.SQExpr,l=e.data.SQExprUtils,c=jsCommon.StringExtensions,u=e.explore.util.VisualContainerUtils;!(function(r){function p(){return{exploration:null,options:null,taskPane:v(),visualizationPane:h(),sectionStatus:{currentSectionNumber:-1,isEditing:!1},isNavPaneCollapsed:!0}}function d(e){return{contract:e,selected:!1,displayName:e.displayName,menuItems:i.ExplorationContainerViewModelFactory.createNavigationMenuItems()}}function v(){return{isPaneExpanded:!0}}function h(){return{sections:[],activeSection:0,pagePaneSections:[],activePageSection:0,isPaneExpanded:!1}}function g(e){return{visuals:e}}function f(e){var t=_.filter(e,(function(e){return e.custom}));return m(t)}function m(t,i){for(var r=[],o=e.common.localize,n=0,s=t;n<s.length;n++){var l=s[n],c={plugin:l,enabled:!0,active:!1,menuItems:[]};switch(l.name){case a.table.name:c.class="table",c.title=o.get("Table_ToolTip");break;case a.matrix.name:c.class="matrix",c.title=o.get("Matrix_ToolTip");break;case a.pivotTable.name:c.class="matrix",c.title=o.get("PivotTable_ToolTip");break;case a.tableEx.name:c.class="table",c.title=o.get("TableEx_ToolTip");break;case a.scatterChart.name:c.class="scatterChart",c.title=o.get("ScatterChart_ToolTip");break;case a.barChart.name:c.class="barChart",c.title=o.get("BarChart_ToolTip");break;case a.clusteredBarChart.name:c.class="clusteredBarChart",c.title=o.get("ClusteredBarChart_ToolTip");break;case a.hundredPercentStackedBarChart.name:c.class="hundredPercentStackedBarChart",c.title=o.get("HundredPercentStackedBarChart_ToolTip");break;case a.columnChart.name:c.class="columnChart",c.title=o.get("ColumnChart_ToolTip");break;case a.clusteredColumnChart.name:c.class="clusteredColumnChart",c.title=o.get("ClusteredColumnChart_ToolTip");break;case a.dataDotClusteredColumnComboChart.name:c.class="dataDotClusteredColumnComboChart",c.title=o.get("DataDotClusteredColumnComboChart_ToolTip");break;case a.dataDotStackedColumnComboChart.name:c.class="dataDotStackedColumnComboChart",c.title=o.get("DataDotStackedColumnComboChart_ToolTip");break;case a.hundredPercentStackedColumnChart.name:c.class="hundredPercentStackedColumnChart",c.title=o.get("HundredPercentStackedColumnChart_ToolTip");break;case a.realTimeLineChart.name:case a.lineChart.name:c.class="lineChart",c.title=o.get("LineChart_ToolTip");break;case a.areaChart.name:c.class="areaChart",c.title=o.get("AreaChart_ToolTip");break;case a.stackedAreaChart.name:c.class="stackedAreaChart",c.title=o.get("StackedAreaChart_ToolTip");break;case a.lineClusteredColumnComboChart.name:c.class="lineClusteredColumnComboChart",c.title=o.get("LineClusteredColumnComboChart_ToolTip");break;case a.lineStackedColumnComboChart.name:c.class="lineStackedColumnComboChart",c.title=o.get("LineStackedColumnComboChart_ToolTip");break;case a.pieChart.name:c.class="pieChart",c.title=o.get("PieChart_ToolTip");break;case a.treemap.name:c.class="treemap",c.title=o.get("Treemap_ToolTip");break;case a.sunburst.name:c.class="sunburst",c.title=o.get("Sunburst_ToolTip");break;case a.map.name:c.class="map",c.title=o.get("Map_ToolTip");break;case a.filledMap.name:c.class="filledMap",c.title=o.get("FilledMap_ToolTip");break;case a.shapeMap.name:c.class="shapeMap",c.title=o.get("ShapeMap_ToolTip");break;case a.funnel.name:c.class="funnel",c.title=o.get("Funnel_ToolTip");break;case a.gauge.name:c.class="gauge",c.title=o.get("Gauge_ToolTip");break;case a.multiRowCard.name:c.class="multiRowCard",c.title=o.get("MultiRowCard_ToolTip");break;case a.card.name:c.class="card",c.title=o.get("Card_ToolTip");break;case a.waterfallChart.name:
c.class="waterfallChart",c.title=o.get("WaterfallChart_ToolTip");break;case a.slicer.name:c.class="slicer",c.title=o.get("Slicer_ToolTip");break;case a.donutChart.name:c.class="donutChart",c.title=o.get("DonutChart_ToolTip");break;case a.kpi.name:c.class="kpi",c.title=o.get("kpi_Tooltip");break;case a.scriptVisual.name:c.class="scriptVisual",c.title=o.get("ScriptVisual_ToolTip");break;case a.realTimeLineChart.name:c.class="lineChart",c.title=o.get("LineChart_ToolTip");break;case a.debugVisual.name:c.class="debugVisual",c.title=o.get("DebugVisual_ToolTip");break;default:if(i&&i.isTrustedVisual(l.name)){var u=i.getVisualTypeOptions(l.name);if(u){c.class=u.class?u.class:l.class,c.title=u.titleKey?o.get(u.titleKey):l.name,c.plugin.watermarkKey=u.watermarkKey;break}}c.class=l.class,c.title=l.name}if(l.custom){c.title=l.displayName||l.name.match(/([A-z]+)/g)[0];var p=y(o.get("DeleteVisual_ContextMenu"),0);c.menuItems.push(p)}r.push(c)}return r}function y(e,t){return{text:e,hasGlyph:!1,labelClass:"visualContextMenu itemLabel",action:t,type:DropDownMenuItemType.Item,checked:!1,hrefTarget:jsCommon.DOMConstants.selfValue}}function w(e,t,i){i.hostServices={deleteVisualRelationships:function(e,i){return i.deleteVisualRelationships(t,e)},getFilters:function(r,o){return r.calculateVisualContainerFilter(e,t,i.contract,o)},getVisualRelationshipFilterAction:function(e,r,o){return r.relationshipFilterAction(t,e,i.contract,o)},selectDataPoint:function(r,o){r.setFilterOnSelectData(e,o,t,i.contract)},setVisualRelationshipFilterAction:function(e,i,r,o){return o.setVisualRelationship(t,e,i,r)},clearHighlight:function(e){e.clearCrossHighlight(t)}}}function C(e,t,i){var r=_.map(e.sections,d),o=e.sections,n=void 0;if(o&&o.length>0){var a=void 0!==i?i:0;if(a<o.length){n=S(e,o[a],t);for(var s=o.length-1;s>=0;--s)r[s].selected=s===a}}return{contract:e,sections:r,exploreCanvas:n}}function S(e,t,r){var o=new i.ExploreCanvas(t,r);if(t.visualContainers&&(o.visualContainers=n.extendWithId(_(t.visualContainers).map((function(e){return b(e,r)})).filter((function(e){return!!e})).value()),!_.isEmpty(o.visualContainers)))for(var a=o.visualContainers,s=0,l=a;s<l.length;s++){var c=l[s];w(e,t,c)}return o}function b(e,t){void 0===t&&(t=0);var r=new o,n=e.layouts.withId(t);if(n){var a=n.position;return r.position({y:a.y,x:a.x}),r.zIndex(a.z||0),r.viewport({height:a.height,width:a.width}),new i.VisualContainer(e,r,t)}}function x(e,t,i,r){var o=b(i,r);if(o)return w(e,t,o),o}function M(t){return e.data.getDisplayName(t,e.common.localize)}function E(){return{schema:null,isLoaded:!1}}function D(){return new i.FieldWell([])}function F(t){return void 0===t&&(t=!0),{isVisualVisible:!1,reportFilters:t?[]:null,pageFilters:[],visualFilters:[],activeFilterPane:void 0,addFilterLabel:e.common.localize.get("FieldDropZone_Watermark")}}function V(e,r,o,n,a,c,p,d){var v,h=e.filters||[],g=[],f=t.FilterUtils.supportsVisualFilters(e,a,c),m={container:e,scopeType:0},y=u.getSelectExprs(e);y&&(v=_.map(y,(function(e){return e.expr})));for(var w=0,C=h;w<C.length;w++){var S=C[w],b=i.FilterViewModelFactory.convertFilterContainer(S,r,o,m,n,p,d,u.getVisualCapabilities(e,n));if(g.push(b),v&&f){var x=S.expression?l.indexOfExpr(v,S.expression):-1;x===-1?0===S.howCreated&&(b.howCreated=S.howCreated=1):(1===S.howCreated&&(b.howCreated=S.howCreated=0),v.splice(x,1))}}if(v&&f)for(var M=0,E=v;M<E.length;M++){var D=E[M];if(!s.isTransformOutputRoleRef(D)&&_.isEmpty(D.validate(r,p))){var F={name:void 0,expression:D,expanded:!1,howCreated:0,type:t.FilterUtils.getDefaultFilterType(D,r)},b=i.FilterViewModelFactory.convertFilterContainer(F,r,o,m,n,p,d,u.getVisualCapabilities(e,n));b.howCreated=F.howCreated,g.push(b)}}return g.sort(k),g}function I(t,r,o,n,a,s,l){var c=[];if(!t||!t.container||!t.container.filters)return c;for(var u=0,p=t.container.filters;u<p.length;u++){var d=p[u];d.name||(d.name=e.explore.FilterUtils.getNextFilterName(t.container.filters));var v=i.FilterViewModelFactory.convertFilterContainer(d,r,o,t,n,a,s,l);c.push(v)}return c.sort(k),c}function P(r,o,n,a,s,l){var c={name:i.EmbedSizes.medium.width+" x "+i.EmbedSizes.medium.height+" px",value:i.EmbedSize.Medium},u=r.get("Embed_CopyEmbedCode"),p=r.get("Embed_DeleteReportSnapshot"),v=[{name:r.get("Embed_EmbedType_Interactive"),value:t.contracts.EmbedType.Interactive},{name:r.get("Embed_EmbedType_Static"),value:t.contracts.EmbedType.Static}],h={currentEmbed:a,exploration:n,embedTab:{embed:T(a),sections:_.map(l,d),selectedSection:null,selectedEmbedSize:c,sizes:[{name:i.EmbedSizes.small.width+" x "+i.EmbedSizes.small.height+" px",value:i.EmbedSize.Small},c,{name:i.EmbedSizes.large.width+" x "+i.EmbedSizes.large.height+" px",value:i.EmbedSize.Large}],embedTypes:v,selectedEmbedType:v[0],edit:!1,generating:!1,disabled:!1,nameError:"",sizeError:"",error:{exist:!1,showDetails:!1}},embeddedInTab:{embeds:[],loaded:!1,localizedCopyEmbedCodeTitle:u,localizedDeleteReportSnapshotTitle:p},viewModeState:0,publishState:0},g=r.get("Embed_EntireReport");return h.embedTab.sections.push({displayName:g,contract:{id:-1,displayName:g,name:g,size:{displayOption:0,width:e.explore.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:e.explore.constants.ExploreCanvasConstants.DefaultCanvasHeight},visualContainers:[]},selected:!1}),s.then((function(e){for(var t=0;t<e.length;t++)h.embeddedInTab.embeds.push(T(e[t]));if(h.embeddedInTab.loaded=!0,e.length>0){var r=e[0];r.size.height=i.EmbedSizes.medium.height,r.size.width=i.EmbedSizes.medium.width,h.currentEmbed=r;var n=T(r);n.embedCode=o.createEmbedCode(r),n.link=o.createEmbedUri(r),h.embedTab.embed=n,h.publishState=4}else h.publishState=1})),h}function A(e,t){var r={name:i.EmbedSizes.medium.width+" x "+i.EmbedSizes.medium.height+" px",value:i.EmbedSize.Medium},o={currentEmbed:t,exploration:e,embedTab:{embed:T(t),sections:null,selectedSection:null,selectedEmbedSize:r,sizes:void 0,embedTypes:null,selectedEmbedType:null,edit:!1,generating:!1,disabled:!1,nameError:"",sizeError:"",error:{exist:!1,showDetails:!1}},embeddedInTab:void 0,viewModeState:0,publishState:5};return o}function T(e){return{contract:e,showCode:!1,deleteRequest:!1,deleteConfirm:!1,refreshingData:!1,embedCode:"",enableShareLink:!0,error:{exist:!1,showDetails:!1}}}function L(e){var t=_.map(e,(function(e){return c.replaceAll(e,R,O)}));return t.join(R)}function k(e,t){var i=e.displayName?-1:1,r=t.displayName?-1:1;if(i!==r)return i-r;var o=e.displayName||e.getRestatement()||"",n=t.displayName||t.getRestatement()||"";return o.localeCompare(n)}var R="-",O="\\"+R;r.createExplorationContainer=p,r.convertSectionToViewModel=d,r.createTaskPane=v,r.createVisualizationPane=h,r.createVisualTypesContainer=g,r.getCustomVisualTypes=f,r.getAvailableVisualTypes=m,r.convertExploration=C,r.convertSectionToExploreCanvas=S,r.convertVisualContainerStandalone=b,r.convertVisualContainer=x,r.getDisplayName=M,r.createFieldList=E,r.createFieldWell=D,r.createFilterPane=F,r.createVisualFilters=V,r.createFilters=I,r.createEmbedModalDialog=P,r.createSharepointEmbedModalDialog=A,r.createEmbed=T,r.createUniqueId=L})(r=i.ViewModelFactory||(i.ViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e){e&&(this.color=e.color,this.visible=e.show)}return Object.defineProperty(t.prototype,"thickness",{get:function(){return t.Width},enumerable:!0,configurable:!0}),t.prototype.getBorderStyle=function(){if(this.visible)return t.Width+"px "+t.Style+" "+e.common.utils.ColorUtility.hexToRGBString(this.color)},t})();t.VisualBorder=i,(function(e){function t(){return{color:e.DefaultColor,show:e.DefaultShow}}e.Width=1,e.Style="solid",e.DefaultColor="#000",e.DefaultShow=!1,e.getDefaultValues=t})(i=t.VisualBorder||(t.VisualBorder={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.CssConstants,o=t.util.DetailVisualUtils,n=jsCommon.KeyUtils,a=e.explore.util.VisualContainerUtils,s=(function(s){function l(e,t,i){var r=s.call(this,e,{style:t,titleStyle:null,visualViewportStyle:null,popOutBarTitle:"",popOutBarSubtitle:""})||this;return r.uiScale={x:1,y:1},r.availableVisuals=[],r.toolbarViewModel={visible:!1,$element:null,update:_.noop},r.currentCanvasLayout=i,r.currentEditMode=0,r}return __extends(l,s),l.getVisualBodyOffset=function(e){return e.canShowVisualContainerHeaderInset()?{top:0,height:0,width:0,left:0}:{top:this.VisualContainerHeaderHeight,height:-this.VisualContainerHeaderHeight,width:0,left:0}},Object.defineProperty(l.prototype,"id",{get:function(){return this.contract.id},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"position",{get:function(){var e=this.currentCanvasLayout;return this.contract.layouts.withId(e).position},set:function(e){var t=this.currentCanvasLayout,i=this.contract.layouts.withId(t);i.position=e},enumerable:!0,configurable:!0}),l.prototype.getScaledPosition=function(){return this.convertToScaledPosition(this.position)},Object.defineProperty(l.prototype,"editMode",{get:function(){return this.currentEditMode},enumerable:!0,configurable:!0}),l.prototype.setEditMode=function(t){this.currentEditMode=t;var i=this.readOnlyState.visual;this.updateVisual(i,i.viewport,e.VisualUpdateType.ViewMode)},Object.defineProperty(l.prototype,"isPositioned",{get:function(){var e=this.position;return 0!==e.width&&0!==e.height},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isPoppedOut",{get:function(){return null!=this.contract.popOutMode&&0!==this.contract.popOutMode},enumerable:!0,configurable:!0}),l.prototype.visualTitleVisible=function(){var e=this.contract.config.singleVisual,i=e.title,r=i&&i.text,o=this.visualPlugin&&this.visualPlugin.capabilities(e.visualType);return!t.contracts.VisualTitle.isHidden(i)&&o&&(!o.suppressDefaultTitle||o.suppressDefaultTitle&&r)&&""!==r&&!this.isPoppedOut&&this.viewModeState&&!this.viewModeState.getConfig().displayOptions.hideVisualBodyTitle},l.prototype.setServices=function(e,t,i,r,o,n){this.visualHostServices=e,this.visualAdapterHostServices=n,this.visualPlugin=t,this.visualPluginOps=i,this.viewModeState=r,this.formFactor=o},l.prototype.setSelected=function(e){this.isSelected=e},l.prototype.handleKeyDown=function(t){var i=this.contract.config.singleVisual.visualType;if(i===e.visuals.plugins.textbox.name&&!n.isArrowKey(t.keyCode)&&!n.isNudgeModifierKey(t.keyCode)){var r=this.readOnlyState.visual.visual,o=r.unwrap?r.unwrap():r;return o.focus()}},l.prototype.setVisualTitle=function(e){this.visualTitle=e;var t="",i="";e&&(e.titleComponents&&e.titleComponents.title?t=e.titleComponents.title:e.text&&(t=e.text),e.titleComponents&&e.titleComponents.subtitle&&(i=e.titleComponents.subtitle)),this.readOnlyState.popOutBarTitle=t,this.readOnlyState.popOutBarSubtitle=i},l.prototype.setTooltip=function(){var e=a.getVisualType(this.contract),t=this.contract.config.singleVisual.title,i=t&&t.text||"",r=this.contract.config.singleVisual.altText||"";this.tooltip=i+" "+e+" "+r},l.prototype.updateVisualViewportForUserResize=function(t){var i=this.readOnlyState.visual;this.enableVisualScaling?(t.width/=this.uiScale.x,this.visualBorder&&(t.width-=2*this.visualBorder.thickness),t.height-=l.VisualContainerHeaderHeight,t.height/=this.uiScale.y,this.visualBorder&&(t.height-=2*this.visualBorder.thickness)):t.height-=l.VisualContainerHeaderHeight;var r=this.getVisualViewport(t.width,t.height,1);i&&this.updateVisual(i,r,e.VisualUpdateType.Resize,1),this.hasDetailVisual()&&this.updateVisual(this.readOnlyState.detailVisual.visual,r,e.VisualUpdateType.Resize,1),this.applyVisualBodyStyle(this.readOnlyState,t)},l.prototype.shouldUseCache=function(){return this.contract.id&&!this.options.disableQueryCacheUpdates},l.prototype.adjustForVisualContainerHeader=function(e,t){this.formFactor&&this.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()||(e.y+=t,e.height-=t)},l.prototype.convertToScaledPosition=function(e){var i=t.util.CanvasVisualsUtility.convertToScaledPosition(e,this.uiScale,!0);return this.adjustForVisualContainerHeader(i,-l.VisualContainerHeaderHeight),i},l.prototype.updateViewStateCore=function(t){var r=this.contract,n=this.position,a=this.overridePosition||this.convertToScaledPosition(n),s=e.Prototype.inherit(a);if(this.enableVisualScaling?this.overridePosition?(s.height-=l.VisualContainerHeaderHeight,s.height/=this.uiScale.y,s.width/=this.uiScale.x):(s=e.Prototype.inherit(n),this.formFactor&&this.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()&&(s.height-=l.VisualContainerHeaderHeight/this.uiScale.y)):s.height-=l.VisualContainerHeaderHeight,this.visualBorder&&(s.width-=2*this.visualBorder.thickness,s.height-=2*this.visualBorder.thickness),this.isPoppedOut&&(!this.options||!this.options.hideHeader)){var c=i.VisualContainer.PopOutBarHeight;this.enableVisualScaling&&(c/=this.uiScale.y),s.height-=c}var u=this.getVisualViewport(s.width,s.height,this.uiScale.x),p=r.config.singleVisual;if(p){if(p.query){var d=p.query.defn;if(d){var v=d.orderBy();t.actualSortDirection=v&&v.length?v[0].direction:void 0}this.showWatermark=!1}else{var h=p.visualType;"debugVisual"===h?this.showWatermark=!1:this.visualPluginOps&&this.visualPluginOps.isQueryVisual(h)&&(this.showWatermark=!0)}t.visual?(t.visual.type!==p.visualType&&(t.visual.data=null),t.visual.type=p.visualType,t.visual.stylePresetName=p.stylePresetName):this.visualHostServices&&(t.visual={viewport:u,type:p.visualType,dataTransforms:{objects:p.objects},hostServices:this.visualHostServices,visualAdapterHostServices:this.visualAdapterHostServices,interactivityOptions:{dragDataPoint:!1,selection:!0,isVisualInteractive:!0},allowInvalidDataView:!0,visualPlugin:this.visualPlugin,themeName:this.themeName}),this.hasDetailVisual()?t.detailVisual||(t.detailVisual={parentContract:this.contract,visual:{viewport:o.getDetailVisualViewport(u,this.contract.detailVisualLayout),themeName:this.themeName,allowInvalidDataView:!0,hostServices:null},hasData:!1}):t.detailVisual=null,this.setViewport(t,u)}t.style.position({x:a.x,y:a.y}),t.style.viewport({width:a.width,height:a.height}),null==this.zIndexOverride?t.style.zIndex(n.z||0):t.style.zIndex(this.zIndexOverride),t.style.rotate(n.angle||0),t.style.apply(),this.applyTitleStyle(t),this.applyVisualBodyStyle(t,s),this.toolbarViewModel.update(),this.availableVisuals=this.visualPlugin?this.visualPlugin.getVisuals():[]},l.prototype.getAdjustedVisualScale=function(){var e=this.getScaledPosition(),t=this.position.width;return e.width/t},l.prototype.applyVisualBodyStyle=function(t,i){var r=this.getAdjustedVisualScale();t.visualViewportStyle||(t.visualViewportStyle=new e.common.models.ApplyStyle);var o=a.getVisualStyleAttributes(i,this.enableVisualScaling?r:void 0,this.visualBackground&&this.visualBackground.colorRGB,this.visualBorder&&this.visualBorder.getBorderStyle());t.visualViewportStyle.addAttributes(o),t.visualViewportStyle.apply()},l.prototype.applyTitleStyle=function(t){var i={};if(this.visualTitleVisible()){i[r.visibilityProperty]=r.visibleValue;var o=this.contract.config.singleVisual.title;if(o){i[r.textAlignProperty]=o.alignment?o.alignment:"",i[r.backgroundColorProperty]=o.background?o.background:"",i[r.colorProperty]=o.fontColor?o.fontColor:"";var n=a.getTitleFontSize(o);i[r.fontSizeProperty]=n,i[r.heightProperty]=a.getTitleHeight(o)}}else i[r.visibilityProperty]=r.hiddenValue;t.titleStyle||(t.titleStyle=new e.common.models.ApplyStyle),t.titleStyle.addAttributes(i),t.titleStyle.apply()},l.prototype.setViewport=function(e,t){e.visual&&this.setVisualViewport(e.visual,t),this.hasDetailVisual()&&this.setVisualViewport(e.detailVisual.visual,o.getDetailVisualViewport(t,this.contract.detailVisualLayout))},l.prototype.setVisualViewport=function(e,t){e&&t&&(e.viewport.height===t.height&&e.viewport.width===t.width&&e.viewport.scale===this.uiScale.x||(e.viewport=t,e.viewport.scale=this.enableVisualScaling?this.uiScale.x:1))},l.prototype.getVisualViewport=function(e,t,r){var o=this.isPaddingDisabled?0:i.VisualContainer.VisualContainerPaddingRight+i.VisualContainer.VisualContainerPaddingLeft,n=this.isPaddingDisabled?0:i.VisualContainer.VisualContainerPaddingTop+i.VisualContainer.VisualContainerPaddingBottom,s=0;this.visualTitleVisible()&&(s=a.getTitleHeight(this.contract.config.singleVisual.title));var l=e-o,c=t-n-s;if(this.hasDetailVisual()){var u=this.contract.detailVisualLayout||1;1===u?(c-=n,c/=2):(l-=o,l/=2)}return{width:Math.max(l,0),height:Math.max(c,0),scale:r}},l.prototype.updateVisual=function(e,t,i,r){if(e&&t){var o=e.visual;o&&o.update({viewport:t,suppressAnimations:!0,dataViews:e.dataViews,type:i,resizeMode:r,viewMode:this.visualHostServices.getViewMode(),editMode:this.editMode})}},l.prototype.hasDetailVisual=function(){return 2===this.contract.popOutMode},l})(i.ViewModel);s.VisualContainerHeaderHeight=20,s.VisualContainerPaddingTop=5,s.VisualContainerPaddingRight=5,s.VisualContainerPaddingBottom=5,s.VisualContainerPaddingLeft=5,s.PopOutBarHeight=40,i.VisualContainer=s})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,s){return new a(e,t,i,r,o,n,s)}function o(e,t,i){var r=_.find(t.visualContainers,(function(e){return e.contract===i}));if(r)return _.pull(t.visualContainers,r),_.remove(i.layouts,(function(t){return t.id===e})).length>0}var n=e.telemetry;i.createLayoutAuthoring=r;var a=(function(){function e(e,t,i,r,o,n,a){this.explorationSerializer=e,this.telemetryService=t,this.eventBridge=i,this.undoRedoService=r,this.explorationNavigation=o,this.formfactorProvider=n,this.selectionService=a}return e.prototype.addLayoutToVisualContainer=function(e,r,o){var n=this;this.undoRedoService.register("AddLayoutToVisualContainer",(function(){var a=n.formfactorProvider.getCurrentLayout();r.layouts.push({id:a,position:o});var s=t.viewModels.ViewModelFactory.convertVisualContainer(n.explorationNavigation.getCurrentExploration(),e.contract,r,a);e.visualContainers.push(s),n.eventBridge.publishToChannel(i.events.canvasChanged)}))},e.prototype.removeLayoutFromSelectedVisuals=function(e){var t=this;this.undoRedoService.register("RemoveLayoutFromSelectedVisuals",(function(){for(var r=_.map(t.selectionService.getSelectedElements(),(function(e){return e.visualContainer})),n=t.formfactorProvider.getCurrentLayout(),a=0,s=r;a<s.length;a++){var l=s[a];o(n,e,l)}t.eventBridge.publishToChannel(i.events.canvasChanged)}))},e.prototype.removeLayoutFromVisualContainer=function(e,t){var r=this;this.undoRedoService.register("RemoveLayoutFromVisualContainer",(function(){var n=r.formfactorProvider.getCurrentLayout();o(n,e,t),r.eventBridge.publishToChannel(i.events.canvasChanged)}))},e.prototype.removeLayoutFromSection=function(e,t,r){var o=this,a=0,s=e.visualContainers;this.undoRedoService.register("RemoveLayoutsFromVisualContainers",(function(){for(var e=0,r=s;e<r.length;e++){var n=r[e];_.remove(n.layouts,(function(e){return e.id===t})).length>0&&a++}o.eventBridge.publishToChannel(i.events.sectionLayoutRemoved)})),1===t&&this.telemetryService.logEvent(n.EXRemoveMobileCanvasVisuals,r.reportId,a)},e.prototype.updateSectionPenAnnotations=function(e,t){e.penAnnotations=t},e.prototype.updateExplorationActiveSectionIndex=function(e,i,r,o){var a=t.SectionUtils.findSectionIndexForSectionName(e,i);if(!(a&&e&&e.sections&&e.sections[a].transient)){e.activeSectionIndex=a;var s=e.sections[a],l=s?s.objectId:void 0;this.telemetryService.logEvent(n.ExploreHostChangeReportPage,e.reportId,r,a,l,o)}},e.prototype.moveVisualContainer=function(e,t){e.position=t,e.updateViewState();var r=e.contract;this.eventBridge.publishToChannel(i.events.visualContainerPositionChanged,{affectContainer:function(e){return e===r}})},e.prototype.moveVisualContainersHelper=function(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i],n=o.position;t(n),this.moveVisualContainer(o,n)}},e.prototype.alignSelectedVisuals=function(e,t,i){1===i.length?this.alignSingleVisualContainer(e,t,i[0]):this.alignMultipleVisualContainers(e,t,i)},e.prototype.alignMultipleVisualContainers=function(t,i,r){var o=this;this.undoRedoService.register("AlignMultipleVisualContainers",(function(){var n=_.map(r,(function(e){return e.position}));switch(t){case 3:var a=_.min(_.map(n,(function(e){return e.y})));o.moveVisualContainersHelper(r,(function(t){return t.y=e.clampYValue(a,t.height,i)}));break;case 4:var s=_.sum(n,(function(e){return e.y+e.height/2})),l=s/n.length;o.moveVisualContainersHelper(r,(function(t){return t.y=e.clampYValue(l-t.height/2,t.height,i)}));break;case 5:var c=_.max(_.map(n,(function(e){return e.y+e.height})));o.moveVisualContainersHelper(r,(function(t){return t.y=e.clampYValue(c-t.height,t.height,i)}));break;case 0:var u=_.min(_.map(n,(function(e){return e.x})));o.moveVisualContainersHelper(r,(function(t){return t.x=e.clampXValue(u,t.width,i)}));break;case 1:var p=_.sum(n,(function(e){return e.x+e.width/2})),d=p/n.length;o.moveVisualContainersHelper(r,(function(t){return t.x=e.clampXValue(d-t.width/2,t.width,i)}));break;case 2:var v=_.max(_.map(n,(function(e){return e.x+e.width})));o.moveVisualContainersHelper(r,(function(t){return t.x=e.clampXValue(v-t.width,t.width,i)}));break;case 6:o.distributeSpace(r,n,!0,i);break;case 7:o.distributeSpace(r,n,!1,i)}}))},e.prototype.alignSingleVisualContainer=function(e,t,i){var r=this;this.undoRedoService.register("AlignSingleVisualContainer",(function(){var o=i.position;switch(e){case 3:r.moveVisualContainersHelper([i],(function(e){return e.y=0}));break;case 4:case 7:var n=t.height/2-o.height/2;r.moveVisualContainersHelper([i],(function(e){return e.y=n}));break;case 5:var a=t.height-o.height;r.moveVisualContainersHelper([i],(function(e){return e.y=a}));break;case 0:r.moveVisualContainersHelper([i],(function(e){return e.x=0}));break;case 1:case 6:var s=t.width/2-o.width/2;r.moveVisualContainersHelper([i],(function(e){return e.x=s}));break;case 2:var l=t.width-o.width;r.moveVisualContainersHelper([i],(function(e){return e.x=l}))}}))},e.prototype.distributeSpace=function(t,i,r,o){for(var n=r?"x":"y",a=r?"width":"height",s=r?e.clampXValue:e.clampYValue,l=_.min(_.map(i,(function(e){return e[n]}))),c=_.max(_.map(i,(function(e){return e[n]+e[a]}))),u=_.reduce(i,(function(e,t){return e-t[a]}),c-l),p=u/(t.length-1),d=_.sortBy(t,(function(e){return e.position[n]})),v=l,h=0,g=d;h<g.length;h++){var f=g[h],m=f.position;m[n]=s(v,m[a],o),v+=m[a]+p,this.moveVisualContainer(f,m)}},e.clampXValue=function(e,t,i){return e<0?0:t+e>i.width?i.width-t:e},e.clampYValue=function(e,t,i){return e<0?0:t+e>i.height?i.height-t:e},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,l,c,u,p,d,v,h,g,f,m,y,w,C,S,b){return new s(i,o,n,e,t,a,l,c,u,p,d,v,r,h,g,f,m,y,w,C,S,b)}var o=e.data.DataViewObjectDefinition,n=e.data.DataViewObjectDefinitions,a=e.visuals.plugins.textbox;i.createVisualAuthoring=r;var s=(function(){function r(e,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f,m,y,w,C,S,b){this.schemaProxy=e,this.telemetry=i,this.explorationNavigationService=r,this.visualPluginService=o,this.visualPluginOps=n,this.selectionService=a,this.geotaggingAnalyzerService=s,this.explorationSerializer=l,this.eventBridge=c,this.promiseFactory=u,this.undoRedoService=p,this.featureSwitchService=d,this.displayNameService=v,this.sortService=h,this.visualRelationshipService=g,this.drill=f,this.filterGenerator=m,this.aggrOps=y,this.visualHostTooltip=w,this.resourceRegistration=C,this.formFactorProvider=S,this.localizationService=b,this.visualAuthoringOperations=t.util.createVisualAuthoringOperations(o,n,v,i,r,a,s,l,c,d,h,g,f,m,y,C,S,b)}return r.prototype.addFieldToVisual=function(e,t,i,r){var o=this;return this.registerUndoableAction(t,(function(t){return o.visualAuthoringOperations.addFieldToVisual(t,e,i,r)}),"AddFieldToVisual")},r.prototype.addFieldInRole=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(i,(function(i){return n.visualAuthoringOperations.addFieldInRole(i,e,t,r,o)}),"AddFieldInRole")},r.prototype.expandHierarchy=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(e,(function(e){return n.visualAuthoringOperations.expandHierarchy(e,t,i,r,o)}),"ExpandHierarchy")},r.prototype.removeField=function(e,t){var i=this;return this.registerUndoableAction(e,(function(e){return i.visualAuthoringOperations.removeField(t,e)}),"RemoveField")},r.prototype.removeProjection=function(e){var t=this;return this.undoRedoService.register("RemoveProjection",(function(){return t.visualAuthoringOperations.removeProjection(e)}))},r.prototype.removeInvalidExpressions=function(e,t){var i=this;return this.registerUndoableAction(t,(function(t){return i.visualAuthoringOperations.removeInvalidExpressions(t,e)}),"RemoveInvalidExpressions")},r.prototype.moveProjection=function(e,t,i,r,o,n){var a=this;return this.registerUndoableAction(n,(function(n){return a.visualAuthoringOperations.moveProjection(n,e,t,i,r,o)}),"MoveProjection")},r.prototype.drillDownLevel=function(e,t,i){var r=this;this.undoRedoService.register("DrillDownLevel",(function(){return r.visualAuthoringOperations.drillDownLevel(e,t,i)}))},r.prototype.replaceProjection=function(e,i,r,o,n){var a=this;return this.undoRedoService.register("ReplaceProjection",(function(){return a.schemaProxy.get(n).then((function(n){var s=a.filterGenerator.supportsFilterOutput(o),l=a.visualAuthoringOperations.replaceProjection(n,e,i,r,o);return l&&s&&t.util.VisualContainerUtils.notifyVisualContainersExceptSource(a.eventBridge,o),l}))}))},r.prototype.drillDown=function(e,t,i,r){var o=this;return this.registerUndoableAction(i,(function(i){return o.visualAuthoringOperations.drillDown(i,e,t,r)}),"DrillDown")},r.prototype.drillUp=function(e,t){var i=this;this.undoRedoService.register("DrillUp",(function(){return i.visualAuthoringOperations.drillUp(e,t)}))},r.prototype.setAggregate=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(o,(function(o){return n.visualAuthoringOperations.setAggregate(o,e,t,i,r)}),"SetAggregate")},r.prototype.removeAggregate=function(e,t,i,r){var o=this;return this.registerUndoableAction(r,(function(r){return o.visualAuthoringOperations.removeAggregate(r,e,t,i)}),"RemoveAggregate")},r.prototype.setPercentOfGrandTotal=function(e,t,i,r){var o=this;return this.getSchemaAndExecuteAction(r,(function(r){return o.visualAuthoringOperations.setPercentOfGrandTotal(r,e,t,i)}))},r.prototype.removePercentOfGrandTotal=function(e,t,i,r){var o=this;return this.getSchemaAndExecuteAction(r,(function(r){return o.visualAuthoringOperations.removePercentOfGrandTotal(r,e,t,i)}))},r.prototype.setPercentOfRoleTotal=function(e,t,i,r,o){var n=this;return this.getSchemaAndExecuteAction(o,(function(o){return n.visualAuthoringOperations.setPercentOfRoleTotal(o,e,t,i,r)}))},r.prototype.removePercentOfRoleTotal=function(e,t,i,r){var o=this;return this.getSchemaAndExecuteAction(r,(function(r){return o.visualAuthoringOperations.removePercentOfRoleTotal(r,e,t,i)}))},r.prototype.toggleShowAll=function(e,t){this.visualAuthoringOperations.toggleShowAll(e,t)},r.prototype.setVariation=function(e,t,i,r,o,n){var a=this;return this.registerUndoableAction(e,(function(e){return a.visualAuthoringOperations.setVariation(e,t,i,r,o,n)}),"SetVariation")},r.prototype.createVisualContainerConfig=function(e){var t=this;return this.schemaProxy.get(e.dataSources).then((function(i){return t.visualAuthoringOperations.createVisualContainerConfig(i,e)}))},r.prototype.addVisualContainerImage=function(e,t,i,r,o,n){var a=this;this.undoRedoService.register("AddVisualContainerImage",(function(){return a.visualAuthoringOperations.addVisualContainerImage(e,t,i,r,o,n)}))},r.prototype.addVisualContainerBasicShape=function(e,t,i){var r=this;this.undoRedoService.register("AddVisualContainerBasicShape",(function(){return r.visualAuthoringOperations.addVisualContainerBasicShape(e,t,i)}))},r.prototype.addVisualContainerTextbox=function(e,t){return this.addEmptyVisualContainer(e,a.name,t)},r.prototype.addVisualContainer=function(e,t,i){var r=this;return this.undoRedoService.register("AddVisualContainer",(function(){return r.schemaProxy.get(e.dataSources).then((function(o){return r.visualAuthoringOperations.addVisualContainer(o,e,t,i)}))}))},r.prototype.addEmptyVisualContainer=function(e,t,i){var r=this;return this.undoRedoService.register("AddEmptyVisualContainer",(function(){return r.visualAuthoringOperations.addEmptyVisualContainer(e,t,i)}))},r.prototype.copyVisual=function(e,t,i){var r=this.explorationSerializer.deserializeVisualContainer(e);r.id=100;var o=this.formFactorProvider.getCurrentLayout(),n=r.layouts.withId(o),a=n.position;return n.position={height:a.height,width:a.width,x:Math.max(0,t?t-a.width/2:0),y:Math.max(0,i?i-a.height/2:0),z:a.z},r},r.prototype.addConfigToCategoricalFilters=function(e,t,i){var r=_.filter(e,(function(e){return!e.isInvalid()&&e.canVisualize()}));if(r)for(var o=0,n=r;o<n.length;o++){var a=n[o];this.createFilterVisualContainerConfig(a.contract,i,t)}},r.prototype.createVisualFilters=function(e,t,i){return this.visualAuthoringOperations.createVisualFilters(e,t,i)},r.prototype.addFilter=function(e,t,i){var r=this;return this.registerUndoableAction(i,(function(o){return r.visualAuthoringOperations.addFilter(o,e,t,i)}),"AddFilter")},r.prototype.removeFilter=function(e,t){var i=this;return this.undoRedoService.register("RemoveFilter",(function(){return i.visualAuthoringOperations.removeFilter(e,t)}))},r.prototype.clearFilter=function(e,t){var i=this;return this.undoRedoService.register("ClearFilter",(function(){return i.updateFilter(e,t,void 0)}))},r.prototype.updateFilter=function(e,t,i){t.filter=i;var r=t.config&&t.config.singleVisual;if(r){var o=this.visualPluginService.capabilities(r.visualType),a=this.filterGenerator.tryGetFilterPropertyIdentifier(o);a&&(r.objects||(r.objects={}),null==i?n.deleteProperty(r.objects,a.objectName,null,a.propertyName):n.setValue(r.objects,a,null,i))}null==e.filters&&(e.filters=[]),_.indexOf(e.filters,t)===-1&&e.filters.push(t)},r.prototype.createFilterVisualContainerConfig=function(e,t,i){return this.visualAuthoringOperations.createFilterVisualContainerConfig(e,t,i)},r.prototype.raiseVisualContainerChanged=function(e){this.visualAuthoringOperations.raiseVisualContainerChanged(e)},r.prototype.convert=function(e,t,i){var r=this;return this.schemaProxy.get(t).then((function(t){return r.visualAuthoringOperations.convert(t,e,i)?r.promiseFactory.resolve():r.promiseFactory.reject()}))},r.prototype.setOrderBy=function(e,t){e.config.singleVisual.query.orderBy(t),this.raiseVisualContainerChanged(e)},r.prototype.removeOrderBy=function(e,t){for(var i=0,r=t;i<r.length;i++){var o=r[i];e.config.singleVisual.query.removeOrderBy(o)}this.raiseVisualContainerChanged(e)},r.prototype.addConditionalFormatting=function(e,t,i){var r=this;this.undoRedoService.register("Set Conditional Formatting",(function(){return r.visualAuthoringOperations.addConditionalFormatting(e,t,i),r.raiseVisualContainerChanged(e),!0}))},r.prototype.removeConditionalFormatting=function(e,t){var i=this;this.undoRedoService.register("Removing Conditional Formatting",(function(){return i.visualAuthoringOperations.removeConditionalFormatting(e,t),i.raiseVisualContainerChanged(e),!0}))},r.prototype.addDataBars=function(e,t,i,r){var o=this;this.undoRedoService.register("Set Data Bars",(function(){return o.visualAuthoringOperations.addDataBars(e,t,i,r),o.raiseVisualContainerChanged(e),!0}))},r.prototype.removeDataBars=function(e,t,i){var r=this;this.undoRedoService.register("Removing Data Bars",(function(){return r.visualAuthoringOperations.removeDataBars(e,t,i),r.raiseVisualContainerChanged(e),!0}))},r.prototype.persistProperties=function(e,t){var i=!1,a=t.objects||{},s=this.visualPluginService.capabilities(t.visualType),l=s?s.objects:void 0;if(e.replace)for(var c=0,u=e.replace;c<u.length;c++){var p=u[c],d=n.ensure(a,p.objectName,p.selector),v={};
for(var h in p.properties)o.isValidPropertyName(h)&&(v[h]=r.encodePropertyValue(p,h,l));n.allPropertiesAreEqual(d.properties,v)||(i=!0,d.properties=v)}if(e.merge)for(var g=0,f=e.merge;g<f.length;g++){var p=f[g],d=n.ensure(a,p.objectName,p.selector);for(var h in p.properties)if(o.isValidPropertyName(h)){var m=r.encodePropertyValue(p,h,l);n.propertiesAreEqual(d.properties[h],m)||(i=!0,d.properties[h]=m)}}if(e.remove)for(var y=0,w=e.remove;y<w.length;y++){var p=w[y],d=n.getObjectDefinition(a,p.objectName,p.selector);if(d)for(var h in p.properties)o.isValidPropertyName(h)&&d.properties.hasOwnProperty(h)&&(delete d.properties[h],i=!0)}if(e.removeObject)for(var C=0,S=e.removeObject;C<S.length;C++){var p=S[C];n.getObjectDefinition(a,p.objectName,p.selector)&&(i=n.deleteObjectDefinition(a,p.objectName,p.selector)||i)}return!!i&&(t.objects=a,!0)},r.prototype.deleteSelectedVisuals=function(e){for(var t=_.map(this.selectionService.getSelectedElements(),(function(e){return e.visualContainer})),i=!1,r=0,o=t;r<o.length;r++){var n=o[r];n&&(i=this.deleteVisualContainerInternal(n,e)||i)}i&&(this.notifyVisualContainersAndClearSelection(t,e),this.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1}))},r.prototype.deleteVisualContainer=function(e,t){this.deleteVisualContainerInternal(e,t)&&this.notifyVisualContainersAndClearSelection([e],t)},r.prototype.deleteVisualContainers=function(e,t){var i=this,r=t.sections.filter((function(e){return e.selected}))[0],o=[];t.contract.sections.forEach((function(t){t.name===r.contract.name?e.forEach((function(e){_.any(t.visualContainers,(function(t){return t.config.singleVisual.visualType===e.config.singleVisual.visualType}))&&o.push(e)})):e.forEach((function(e){_.remove(t.visualContainers,(function(t){return e.config.singleVisual.visualType===t.config.singleVisual.visualType}))}))})),o.length>0&&(o.forEach((function(e){i.deleteVisualContainer(e,t.exploreCanvas)})),this.notifyVisualContainersAndClearSelection(o,t.exploreCanvas))},r.prototype.deleteVisualRelationships=function(e,t){this.visualAuthoringOperations.deleteVisualRelationships(e,t)},r.prototype.setVisualRelationship=function(e,t,i,r){var o=this;this.undoRedoService.register("SetVisualRelationship",(function(){return o.visualAuthoringOperations.setVisualRelationship(e,t,i,r)}))},r.prototype.registerUndoableAction=function(e,t,i){var r=this;return this.undoRedoService.register(i,(function(){return r.getSchemaAndExecuteAction(e,(function(e){return t(e)}))}))},r.prototype.getSchemaAndExecuteAction=function(e,t){var i=this;return this.schemaProxy.get(e).then((function(e){return t(e)?i.promiseFactory.resolve():i.promiseFactory.reject()}))},r.prototype.notifyVisualContainersAndClearSelection=function(e,t){var r=this;t.contract.crossHighlight&&_.any(e,(function(e){return e===t.contract.crossHighlight.sourceVisualContainer}))?this.filterGenerator.clearCrossHighlight(t.contract):_.any(e,(function(e){return r.filterGenerator.supportsFilterOutput(e)}))&&this.eventBridge.publishToChannel(i.events.visualContainerChanged,{affectContainer:function(e){return!0}}),this.selectionService.clearSelection()},r.prototype.deleteVisualContainerInternal=function(t,i){if(t){var r=e.explore.util.CanvasVisualsUtility.findVisualContainerViewModel(i.visualContainers,t);if(r){this.visualAuthoringOperations.deleteVisualRelationships(i.contract,t);var o=i.visualContainers.indexOf(r);i.visualContainers.splice(o,1);var n=i.contract,a=n.visualContainers.indexOf(t);return n.visualContainers.splice(a,1),!0}}},r.encodePropertyValue=function(e,t,i){var r,o=e.properties[t];return i&&i[e.objectName]&&i[e.objectName].properties[t]&&(r=i[e.objectName].properties[t].type),n.encodePropertyValue(o,r||{})},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,s,l,c,u){return new a(e,t,i,r,o,n,s,l,c,u)}var o=(jsCommon.DOMConstants,e.explore.util.CanvasVisualsUtility),n=t.services.selectionUtils;i.createCanvasKeyHandlerService=r;var a=(function(){function e(e,t,i,r,o,n,a,s,l,c){this.clipboardService=e,this.selectionService=t,this.explorationSerializer=i,this.viewModeState=r,this.undoRedoService=o,this.visualAuthoring=n,this.eventBridge=a,this.popOutService=s,this.formFactor=l,this.layoutAuthoring=c}return e.prototype.onKeyDown=function(e,t){var i=e.which,r=e.ctrlKey;if(27===i)return this.onClearSelection(e),this.onClearFormatPainterData(e),this.preventStopAndReturnFalse(e);if(this.isSaveEvent(e))return this.onSave(),this.preventStopAndReturnFalse(e);if(0!==this.viewModeState.getMode()){var o=this.formFactor.getCurrentLayoutCapabilities();if(this.isDeleteEvent(e))return o.canRemoveVisualFromLayout()?this.onRemoveFromLayout(e,t):o.canDelete()&&this.onDelete(e,t),this.preventStopAndReturnFalse(e);if(r)switch(i){case 65:return this.onSelectAll(e,t),this.preventStopAndReturnFalse(e);case 67:return o.canCutCopyPaste()&&this.onCopy(e),this.preventStopAndReturnFalse(e);case 88:return o.canCutCopyPaste()&&this.onCut(e),this.preventStopAndReturnFalse(e);case 86:return o.canCutCopyPaste()&&this.onPaste(e),this.preventStopAndReturnFalse(e);case 89:return this.onRedo(),this.preventStopAndReturnFalse(e);case 90:return this.onUndo(),this.preventStopAndReturnFalse(e)}else if(o.canPassUnhandledKeysToSelectedVisual())return this.allowSelectedVisualContainerToHandle(e,t)}},e.prototype.allowSelectedVisualContainerToHandle=function(e,t){var i=n.getSelectedVisual(this.selectionService);if(i){var r=o.findVisualContainerViewModel(t.visualContainers,i);if(r)return r.handleKeyDown(e)}},e.prototype.preventStopAndReturnFalse=function(e){return e.originalEvent&&(e.originalEvent.preventDefault(),e.originalEvent.stopPropagation()),!1},e.prototype.onUndo=function(){this.undoRedoService.undo()},e.prototype.onRedo=function(){this.undoRedoService.redo()},e.prototype.onCopy=function(e){this.canCopyOrCut()&&this.clipboardService.copy()},e.prototype.onCut=function(e){this.canCopyOrCut()&&this.clipboardService.cut()},e.prototype.onPaste=function(e){this.clipboardService.paste()},e.prototype.onRemoveFromLayout=function(e,t){this.layoutAuthoring.removeLayoutFromSelectedVisuals(t)},e.prototype.onDelete=function(e,t){var i=this;this.undoRedoService.register("CanvasKeyDelete",(function(){i.visualAuthoring.deleteSelectedVisuals(t)}))},e.prototype.onClearSelection=function(e){this.selectionService.clearSelection()},e.prototype.onClearFormatPainterData=function(e){this.clipboardService.clearFormatData()},e.prototype.onSelectAll=function(e,t){var i=_.map(t.visualContainers,(function(e){return e.contract}));n.selectVisualContainers(i,this.selectionService)},e.prototype.onSave=function(){this.eventBridge.publishToChannel(i.events.saveKeyPressedEvent)},e.prototype.isSaveEvent=function(e){return e.ctrlKey&&83===e.which},e.prototype.isDeleteEvent=function(e){return!e.ctrlKey&&46===e.which},e.prototype.canCopyOrCut=function(){return!this.popOutService.getPoppedOutVisualContainer()},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o){return new i(e,t,r,o)}e.createCanvasScaleService=t;var i=(function(){function e(e,t,i,r){this.explorationNavigation=e,this.formFactorProvider=t,this.popOut=i,this.viewModeState=r,this.m_scale=1}return e.prototype.setCanvasScaleFactor=function(e){this.m_scale=e},e.prototype.getCanvasScaleFactor=function(){return this.m_scale},e.prototype.getDisplayOption=function(){var e=this.formFactorProvider.getCurrentLayout();if(1===e&&1===this.viewModeState.getMode())return 3;var t=!!this.popOut.getPoppedOutVisualContainer();if(t)return 0;var i=this.explorationNavigation.getCurrentSection();if(i)return i.size.displayOption},e.prototype.setDisplayOption=function(e){var t=this.explorationNavigation.getCurrentSection();t&&(t.size.displayOption=e)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r){return new o(e,t,i,r)}i.createConnectionSetupService=r;var o=(function(){function i(e,t,i,r){this.conceptualSchemaProxy=e,this.dataProxy=t,this.visualAuthoring=i,this.visualQueryGenerator=r}return i.prototype.setup=function(i,r){var o=this;void 0===r&&(r=t.constants.ConnectionSetupLimit);var n=1,a="undefined";i&&i.length>0&&(a=i[0].name),r>t.constants.ConnectionSetupLimit&&(r=t.constants.ConnectionSetupLimit),this.conceptualSchemaProxy.get(i).then((function(t){var s=t.schema(a),l=s.capabilities;if(!l||!l.discourageQueryAggregateUsage)for(var c=s.entities,u=0,p=c;u<p.length;u++){var d=p[u];if(n>r)break;for(var v=0,h=d.properties;v<h.length;v++){var g=h[v];if(n>r)break;n++;var f=e.data.SQExprBuilder.fieldExpr({column:{schema:a,entity:d.name,name:g.name}});o.visualAuthoring.createVisualContainerConfig({expr:f,dataSources:i,allowAggregate:!0}).then((function(e){var r=o.visualQueryGenerator.execute({config:e.singleVisual,dataSources:i,schema:t,additionalFilters:null});r&&r.options&&r.options.query&&(r.options.query.allowCache=!1,o.dataProxy.execute(r.options).then((function(){}),(function(){})))}))}}}))},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,n){return new o(e,t,i,r,n)}var r=e.explore.services.events;t.createDeleteVisualService=i;var o=(function(){function t(e,t,i,r,o){this.eventBridge=e,this.$rootScope=t,this.telemetryService=i,this.visualPluginService=r,this.undoRedoService=o}return t.prototype.deleteCustomVisuals=function(t,i){var o=this;this.undoRedoService.register("DeleteCustomVisual",(function(){i.forEach((function(i){o.telemetryService.logEvent(e.telemetry.EXDeleteCustomViz,i.name),o.visualPluginService.removePlugin(i.name),_.remove(t.resourcePackages,(function(e){return e.name===i.name})),o.eventBridge.publishToChannel(r.deleteCustomVisual,{visual:i})})),o.eventBridge.publishToChannel(r.visualPluginsChanged)}))},t})()})(i=t.services||(t.services={}))})(t=e.exploreui||(e.exploreui={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e,t){return new r(e,t)}t.createDetailVisualSpinnerService=i;var r=(function(){function t(e,t){this.scope=e,this.eventBridge=t}return t.prototype.startSpinner=function(){this.eventBridge.publishBubbling(this.scope,e.viewModels.DetailVisualEvents.spinnerAction,0)},t.prototype.stopSpinner=function(){this.eventBridge.publishBubbling(this.scope,e.viewModels.DetailVisualEvents.spinnerAction,1)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i){return new c(e,t,i)}var o=e.explore.util.DrillUtils,n=jsCommon.EnumExtensions,a=t.util.DetailVisualUtils,s=e.visuals.plugins,l=t.util.VisualContainerUtils;i.createDrillService=r;var c=(function(){function t(e,t,i){this.eventBridge=e,this.visualPlugin=t,this.visualPluginOps=i}return t.prototype.getSupportedDrillDirections=function(e,t){var i=this.getProjections(e);if(!i)return 0;var r=t;if(_.isEmpty(r)){var n=e.config.singleVisual,a=this.visualPlugin.capabilities(n.visualType);if(!a)return 0;var s=o.getDrillableRoles(a);r=_.first(s)}var l=i[r];if(l&&l.activeProjectionRefs){var c=0,u=l.all();if(1===u.length)return c;var p=l.activeProjectionRefs,d=this.findActiveProjectionIndexInQueryCollection(u,p);return _.isEmpty(p)||d+p.length===u.length||(this.canDrillDownLevel(e,2,r)&&(c|=2),this.canDrillDownLevel(e,3,r)&&(c|=4)),!_.isEmpty(l.activeProjectionRefs)&&(0!==d||p.length>1)&&(c|=1),c}return 0},t.prototype.setDrillMode=function(e,t){e&&e.drillMode!==t&&(e.drillMode=t,this.raiseDrillModeChanged(e,t))},t.prototype.canSeeData=function(e){if(!(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query))return!1;var t=l.getVisualType(e),i=e.config.singleVisual,r=i.getErrorDetails&&!!i.getErrorDetails();return!r&&a.supportsVisualDetails(t,this.visualPlugin,this.visualPluginOps)},t.prototype.canDrillToDetails=function(t,i){if(!t)return!1;var r=l.getVisualQuery(t);if(!r)return!1;var o=l.getVisualType(t);if(o===s.lineChart.name||o===s.areaChart.name||o===s.stackedAreaChart.name)return!1;var n=l.getVisualCapabilities(t,this.visualPlugin);if(!n||n.supportsSelection===!1)return!1;var a=_(l.getSelectExprs(t)).filter((function(t){return e.data.SQExpr.isAggregation(t.expr)})).map((function(e){return e.name})).value();if(_.isEmpty(a))return!1;if(!_.isEmpty(i)&&!_.contains(a,_.first(_.first(i).metadata)))return!1;var c=n.dataRoles;if(_.isEmpty(c))return!1;for(var u=_(c).filter((function(t){return t.kind===e.VisualDataRoleKind.Measure&&0!==t.joinPredicate})).map((function(e){return e.name})).value(),p=0,d=0,v=u;d<v.length;d++){var h=v[d],g=r.projections[h];if(!_.isEmpty(g)){if(p++,p>1)return!1;var f=g.all(),m=_.some(f,(function(e){return!_.contains(a,e.queryRef)}));if(m)return!1}}return 0!==p},t.prototype.canDrillByDirection=function(e,t){if(!e)return!1;var i=this.getSupportedDrillDirections(e);return!!i&&n.hasFlag(i,t)},t.prototype.isDrillModeEnabled=function(e,t){return!!e&&e.drillMode===t},t.prototype.canDrillDownLevel=function(t,i,r){var o=l.getVisualQuery(t);if(!o)return!1;var n=l.getVisualCapabilities(t,this.visualPlugin);if(!n)return!1;if(!r)return!1;var a=o.projections[r],s=a.getLastActiveQueryReference();if(!s)return!1;for(var c=_.findIndex(a.all(),(function(e){return e.queryRef===s})),u=function(n){var s=a.all()[n],l=o.defn.select().withName(s.queryRef).expr;if(0===_.filter(t.filters,(function(t){return 2===t.howCreated&&e.data.SQExpr.equals(l,t.expression)})).length)return{value:o.currentDrillMode(r)===i}},p=0;p<c;p++){var d=u(p);if("object"==typeof d)return d.value}return!0},t.prototype.getProjections=function(e){return e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query&&e.config.singleVisual.query.projections},t.prototype.findActiveProjectionIndexInQueryCollection=function(e,t){if(!_.isEmpty(t))for(var i=0;i<e.length;i++){for(var r=i,o=0;o<t.length&&r<e.length&&t[o]===e[r].queryRef;)o++,r++;if(o===t.length)return i}return-1},t.prototype.raiseDrillModeChanged=function(e,t){var r={visualContainer:e};this.eventBridge.publishToChannel(i.events.drillModeChanged,r)},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,i,r,o,n,a,s,l,c,u,p,v,h,g,f,m,y,w,C,S,b,x,M){var E=t.util.createVisualAuthoringOperations(r,o,g,f,c,l,n,i,h,s,m,y,w,C,S,b,M,x);return new d(e,E,a,l,c,i,u,p,v,h,f,C,x,r)}var o=jsCommon.ArrayExtensions,n=t.util.FilterContainerBuilder,a=e.explore.FilterUtils,s=e.data.SQExpr,l=e.visuals.controls.internal.TablixObjects,c=jsCommon.Utility,u=t.util.VisualContainerUtils,p=(function(){function e(e,t,i,r,o){this.sourceSection=e,this.sourceVisualContainer=t,this.targetSection=i,this.targetVisualContainer=r,this.navigationState=o}return e.prototype.toSnapshot=function(e){var i=this;if(e.getCurrentSection()===this.targetSection){var r=e.getCurrentExploration(),o=t.SectionUtils.findSectionIndexForSection(r,this.sourceSection),n=t.SectionUtils.findSectionIndexForSection(r,this.targetSection),a=_.findIndex(this.sourceSection.visualContainers,(function(e){return e===i.sourceVisualContainer})),s=_.findIndex(this.targetSection.visualContainers,(function(e){return e===i.targetVisualContainer}));return{sourceSectionIndex:o,sourceVisualIndex:a,targetSectionIndex:n,targetVisualIndex:s}}},e.fromSnapshot=function(t,i){if(t){var r=i.getCurrentExploration(),o=r.sections[t.sourceSectionIndex],n=o.visualContainers[t.sourceVisualIndex],a=r.sections[t.targetSectionIndex],s=a.visualContainers[t.targetVisualIndex];return new e(o,n,a,s,0)}},e})();i.DrillToDetailsContext=p,i.createDrillToDetailsService=r;var d=(function(){function r(e,t,r,o,n,a,s,l,c,u,p,d,v,h){var g=this;this.conceptualSchemaProxy=e,this.visualAuthoringOperations=t,this.undoRedo=r,this.selectionService=o,this.explorationNavigationService=n,this.explorationSerializer=a,this.popOut=s,this.rootScope=l,this.timeout=c,this.eventBridge=u,this.telemetryService=p,this.filterGenerator=d,this.localizationService=v,this.visualPluginService=h,u.createChannelSubscriptionManager().subscribe(i.events.canvasChanged,(function(){return g.onSectionChanged()})).subscribe(i.events.popOutModeChanged,(function(){return g.onPopOutModeChanged()})).subscribe(i.events.explorationUnloaded,(function(e,t){return g.clearContext()}))}return r.prototype.drillToDetails=function(t,i,r){var o=this;if(!_.isEmpty(t)){var n=_.first(t);if(n&&!_.isEmpty(n.metadata)){var a=u.getVisualQuery(i);if(a&&a.defn){if(_.isEmpty(n.dataMap)){if(!a.projections)return;var p=u.getDataRolesForVisual(i,this.visualPluginService),d=_(p).filter((function(t){return t.kind!==e.VisualDataRoleKind.Measure})).map((function(e){return e.name})).value();for(var v in a.projections)if(!_.isEmpty(a.projections[v])&&_.contains(d,v))return}var h=a.defn.select().withName(_.first(n.metadata));h&&s.isAggregation(h.expr)&&this.conceptualSchemaProxy.get(r).then((function(r){var n=o.visualAuthoringOperations.drillToDetails(c.generateGuid(),r,h.expr,t,i);n&&(o.addCrossFilters(i,o.explorationNavigationService.getCurrentSection(),n,!1,r),n.config.singleVisual.objects=l.generateTablixDefaultObjects(e.visuals.controls.TablixType.Table),o.drillToDetailsCore(t,i,n))}),(function(){return _.noop}))}}}},r.prototype.generateDetailsTable=function(e,t,i){if(i){var r=this.mockVisualContainer(e),o=i,n=this.visualAuthoringOperations.drillToDetails(c.generateGuid(),t,o,null,r);return n?n.config.singleVisual:void 0}},r.prototype.clear=function(){if(this.drillToDetailsContext){this.drillToDetailsContext.navigationState=1;var e=t.SectionUtils.findSectionIndexForSection(this.explorationNavigationService.getCurrentExploration(),this.drillToDetailsContext.sourceSection);this.rootScope.$emit(t.constants.switchSectionEvent,e)}},r.prototype.getContext=function(){return this.drillToDetailsContext},r.prototype.setContext=function(e){this.drillToDetailsContext=e},r.prototype.clearContext=function(){this.drillToDetailsContext=null},r.prototype.getDetailsTableTargetMeasure=function(t){var i=this.mockVisualContainer(t),r=u.getVisualQuery(i);if(r&&r.defn){var o=u.getDataRolesForVisual(i,this.visualPluginService);if(!_.isEmpty(o))for(var n=_(o).filter((function(t){return(t.kind===e.VisualDataRoleKind.Measure||t.kind===e.VisualDataRoleKind.GroupingOrMeasure)&&0!==t.joinPredicate})).map((function(e){return e.name})).value(),a=0,l=n;a<l.length;a++){var c=l[a],p=r.projections[c];if(!_.isEmpty(p))for(var d=p.all(),v=0,h=d;v<h.length;v++){var g=h[v],f=r.defn.select().withName(g.queryRef);if(f&&s.isAggregation(f.expr))return f.expr}}}},r.prototype.mockVisualContainer=function(e){var t={name:c.generateGuid(),config:{singleVisual:e},layouts:o.createWithId(),filters:[]};return t.layouts.push({id:0,position:{x:0,y:0,width:0,height:0}}),t},r.prototype.onSectionChanged=function(){var e=this;if(this.drillToDetailsContext){this.explorationNavigationService.getCurrentSection();switch(this.drillToDetailsContext.navigationState){case 0:this.timeout((function(){i.selectionUtils.selectVisualContainer(e.drillToDetailsContext.targetVisualContainer,e.selectionService),e.popOut.popOutVisualContainer(e.drillToDetailsContext.targetVisualContainer,1)}),0);break;case 1:var r=t.SectionUtils.findSectionIndexForSection(this.explorationNavigationService.getCurrentExploration(),this.drillToDetailsContext.targetSection),o=this.drillToDetailsContext.sourceVisualContainer;this.drillToDetailsContext=null,this.rootScope.$emit(t.constants.deleteSectionEvent,r),this.timeout((function(){i.selectionUtils.selectVisualContainer(o,e.selectionService),e.undoRedo.clear()}),0)}}},r.prototype.onPopOutModeChanged=function(){if(this.drillToDetailsContext){var e=this.explorationNavigationService.getCurrentSection();if(e!==this.drillToDetailsContext.sourceSection){var t=this.popOut.getPoppedOutVisualContainer();t!==this.drillToDetailsContext.targetVisualContainer&&this.clear()}}},r.prototype.drillToDetailsCore=function(e,i,r){var o=this.explorationNavigationService.getCurrentSection();if(o){var n=this.explorationSerializer.serializePage(o,1),a=this.explorationSerializer.deserializePage(n),s={name:"Drill to Details",displayName:"Drill to Details",filters:a.filters,size:a.size,visualContainers:[r],transient:!0};this.drillToDetailsContext=new p(o,i,s,r,0),this.rootScope.$emit(t.constants.insertSectionEvent,s)}},r.prototype.addCrossFilters=function(e,t,i,r,o){var n=this.filterGenerator.getVisualContainerCrossFilters(t,e,o);if(n.dataFilters)for(var a=0,s=n.dataFilters;a<s.length;a++){var l=s[a];this.addVisualFilters(i,l,o,!1)}r&&this.addVisualFilters(i,n.highlightFilter,o,r)},r.prototype.addVisualFilters=function(e,t,i,r){var o=n.fromSemanticFilter(t,i);if(o)for(var s=0,l=o;s<l.length;s++){var c=l[s];a.add(e,c)}else{var u={name:a.getNextFilterName(e.filters),restatement:a.getNextAutoGenRestatement(e.filters,"DetailVisual_CrossFilter",this.localizationService),filter:t,howCreated:0};a.add(e,u)}},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new i}e.createExplorationCapabilitiesService=t;var i=(function(){function e(){this.options={showAppBar:!0,showTaskPane:!0,showVisualizationPane:!0,showNavContentPane:!0,visualContainerOptions:{showMenu:!0,showPin:!0,showContextMenu:!0,disablePin:!1,disableQueryCacheUpdates:!1},showBackButtonOnAppBar:!1}}return e.prototype.setCapabilities=function(e){_.merge(this.options,e)},e.prototype.getCapabilities=function(){return this.options},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o){return new l(e,t,i,o,r)}var o=e.data.SemanticFilter,n=e.data.SQExprConverter,a=e.data.SQExprUtils,s=e.explore.util.VisualHostServicesUtil;i.createFilterRestatementService=r;var l=(function(){function i(e,t,i,r,o){this.conceptualSchemaProxy=e,this.filterGenerator=t,this.promiseFactory=i,this.visualQueryGenerator=r,this.dataProxy=o}return i.prototype.loadRestatement=function(e,i,r){var n=this,s=i.filter;return!s||o.isAnyFilter(s)?this.promiseFactory.resolve(null):this.conceptualSchemaProxy.get(e).then((function(l){if(o.isDefaultFilter(s)){var c=a.getDefaultValue(i.expression,l);return t.viewModels.RestatementHelper.fromDefault(c?c.value:"")}return n.loadRestatementForSQExpr(l,i,e,r)}))},i.prototype.loadRestatementForSQExpr=function(e,t,i,r){var o=t.expression,n=o.hasGroupOnKeys(e);return n?this.loadRestatementForSQExprWithGroupOnKeys(e,t,i):this.promiseFactory.resolve(this.getRestatementForSimpleSQExpr(e,t,r))},i.prototype.getRestatementForSimpleSQExpr=function(e,i,r){var o=this.getSelectedScopeIdsContainerFromFilter(e,i);return o&&t.viewModels.RestatementHelper.fromDataViewScopeIdentities(o.scopeIds,o.isNot,r)},i.prototype.loadRestatementForSQExprWithGroupOnKeys=function(e,i,r){var o,n,a=this.getSelectedScopeIdsContainerFromFilter(e,i);if(a&&(o=a.isNot,n=a.scopeIds),_.isEmpty(n))return this.promiseFactory.resolve(null);var s=i.cachedValueItems;return _.isEmpty(s)||s.length!==n.length?this.runQueryToGetRestatement(e,i,o,n,r):this.promiseFactory.resolve(t.viewModels.RestatementHelper.fromLabels(s,o))},i.prototype.runQueryToGetRestatement=function(i,r,o,n,a,l){var c=r.config&&r.config.singleVisual;if(!a||!c)return this.promiseFactory.resolve(null);var u=e.DataViewScopeIdentity.filterFromIdentity(n,!1),p=e.Prototype.inherit(s.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,t){return{dataFilter:u}}})),d={dataSources:a,schema:i,config:c,additionalFilters:p.getFilters(this.filterGenerator,i)},v=this.visualQueryGenerator.execute(d);return v.error?this.promiseFactory.resolve(null):this.dataProxy.execute(v.options).then((function(e){for(var i=e.dataReaderResult.dataView,n=i&&i.categorical&&i.categorical.categories[0],a=n&&n.values?n.values.length:0,s=[],c=0;c<a;c++){var u=n.identity&&n.identity[c],p=n.values&&n.values[c],d=l?l.format(p):p;s.push({displayName:d,identity:u})}return r.cachedValueItems=s,t.viewModels.RestatementHelper.fromLabels(s,o)}))},i.prototype.getSelectedScopeIdsContainerFromFilter=function(e,t){var i=t.expression.getKeyColumns(e);if(i){var r=t.filter;return r?n.asScopeIdsContainer(r,i):void 0}},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n){return new a(e,t,i,r,o,n)}var o=jsCommon.FreezeUtility,n=e.common.helpers.TelemetryHelper;i.createFormFactorProvider=r;var a=(function(){function r(e,t,i,r,o,n){this.canvasLayout=0,this.canvasLayoutCapabilities=this.initializeLayoutCapabilities(),this.eventBridge=e,this.selection=t,this.servicePauser=i,this.timeout=r,this.viewModeState=o,this.telemetry=n}return r.prototype.getCurrentLayout=function(){return this.canvasLayout},r.prototype.changeFormFactor=function(r,o){var a=this;if(this.canvasLayout!==r){this.telemetry.logEvent(e.telemetry.EXChangeCanvasLayout,n.getTelemetryCanvasLayout(this.canvasLayout),n.getTelemetryCanvasLayout(r),this.getTelemetryViewMode(this.viewModeState.getMode())),this.selection.clearSelection(),this.setCurrentLayout(r);var s=o.exploration.contract,l=s.activeSectionIndex;o.exploration.exploreCanvas=t.viewModels.ViewModelFactory.convertSectionToExploreCanvas(s,s.sections[l],this.canvasLayout),this.updateViewModeState();var c={layout:r};this.timeout((function(){return a.eventBridge.publishToChannel(i.events.formFactorChanged,c)}))}},r.prototype.getCurrentLayoutCapabilities=function(){return this.canvasLayoutCapabilities[this.canvasLayout]},r.prototype.setCurrentLayout=function(e){this.canvasLayout=e,0===this.canvasLayout?this.servicePauser.resume():this.servicePauser.pause()},r.prototype.updateViewModeState=function(){var e=this.getCurrentLayoutCapabilities();this.viewModeState.updateConfig((function(t){t.displayOptions.showMobilePane=e.canShowMobileVisualizationPane()}))},r.prototype.initializeLayoutCapabilities=function(){var e=this,t=function(){return 1===e.viewModeState.getMode()},i=function(){return 0===e.viewModeState.getMode()},r=(n={},n[0]={canMoveMultipleVisuals:_.noopTrue,canShowCanvasBackground:_.noopTrue,canShowCanvasBackdrop:_.noopFalse,canShowCodePane:_.noopTrue,canShowVisualContainerHeader:_.noopTrue,canShowVisualContainerHeaderInset:_.noopFalse,canShowMobileVisualizationPane:_.noopFalse,canShowLayoutGrid:t,canRemoveVisualFromLayout:_.noopFalse,canCutCopyPaste:_.noopTrue,canDelete:_.noopTrue,canPassUnhandledKeysToSelectedVisual:_.noopTrue,canAddRemoveSections:t,canShowVisualToolbar:t},n[1]={canMoveMultipleVisuals:_.noopFalse,canShowCanvasBackground:_.noopTrue,canShowCanvasBackdrop:t,canShowCodePane:_.noopFalse,canShowVisualContainerHeader:i,canShowVisualContainerHeaderInset:_.noopTrue,canShowMobileVisualizationPane:t,canShowLayoutGrid:t,canRemoveVisualFromLayout:t,canCutCopyPaste:_.noopFalse,canDelete:_.noopFalse,canPassUnhandledKeysToSelectedVisual:_.noopFalse,canAddRemoveSections:_.noopFalse,canShowVisualToolbar:_.noopFalse},n[2]={canMoveMultipleVisuals:_.noopFalse,canShowCanvasBackground:_.noopTrue,canShowCanvasBackdrop:_.noopTrue,canShowCodePane:_.noopFalse,canShowVisualContainerHeader:_.noopFalse,canShowVisualContainerHeaderInset:_.noopFalse,canShowMobileVisualizationPane:_.noopTrue,canShowLayoutGrid:_.noopFalse,canRemoveVisualFromLayout:_.noopTrue,canCutCopyPaste:_.noopFalse,canDelete:_.noopFalse,canPassUnhandledKeysToSelectedVisual:_.noopFalse,canAddRemoveSections:_.noopFalse,canShowVisualToolbar:_.noopFalse},n);return o.deepFreeze(r),r;var n},r.prototype.getTelemetryViewMode=function(t){switch(t){case 0:return e.telemetry.ViewMode.View;case 1:return e.telemetry.ViewMode.Edit}},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o){return new s(e,t,i,r,o)}var r=e.visuals.plugins.multiRowCard,o=e.data.SemanticQuery,n=e.explore.util.VisualHostServicesUtil,a=e.explore.contracts.VisualQuery;t.createGroupQueryService=i;var s=(function(){function i(e,t,i,r,o){this.conceptualSchemaProxy=i,this.visualQueryGenerator=r,this.promiseFactory=o,this.singleExecutableDataProxyFactory=e,this.filterGenerator=t,this.reset()}return i.prototype.getValuesForColumn=function(t,i,r){var s=this,l=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(i).then((function(c){var u=new a(o.create(),{});u.add(t,"Values"),s.runQueryImpl({dataSources:i,schema:c,config:{visualType:e.visuals.plugins.table.name,query:u},hostServices:n.createQueryVisualHostServices(),visualQueryGenerator:s.visualQueryGenerator,isLoadMore:r,preferCurrentData:!r,allowCache:!1,isInitialLoad:!r}).then((function(e){s.lastResult=e?{table:e.dataReaderResult.dataView.table,canLoadMore:s.dataProxy.canLoadMore()}:s.lastResult,l.resolve(s.lastResult)}),(function(e){l.reject(e)}))}),(function(e){l.reject(e.clientError)})),l.promise},i.prototype.getAggregatesForColumn=function(e,t){var i=this,s=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(t).then((function(l){var c=new a(o.create(),{}),u=r.capabilities.dataRoles[0].name;c.add(e,u),c.setAggregate(u,0,3,l),c.add(e,u),c.setAggregate(u,1,4,l),c.add(e,u),c.setAggregate(u,2,5,l),i.runQueryImpl({dataSources:t,schema:l,config:{visualType:r.name,query:c},hostServices:n.createQueryVisualHostServices(),visualQueryGenerator:i.visualQueryGenerator,isLoadMore:!1,preferCurrentData:!1,allowCache:!1}).then((function(e){var t,i=e.dataReaderResult.dataView.table,r=i&&i.rows;if(r&&r.length>0){var o=r[0];t=o?{min:{formatString:i.columns[0].format,value:o[0]},max:{formatString:i.columns[1].format,value:o[1]},count:o[2]}:void 0}s.resolve(t)}),(function(e){s.reject(e)}))}),(function(e){s.reject(e.clientError)})),s.promise},i.prototype.reset=function(){this.conceptualSchemaProxy.clearCache(),this.dataProxy=t.createExploreVisualDataProxyService(this.singleExecutableDataProxyFactory.create(),this.filterGenerator)},i.prototype.runQueryImpl=function(e){return this.dataProxy.runQuery(e)},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,n,a,l,c,u,p){return new s(u,o,e,r,t,n,l,p,c,i,a)}var r=e.explore.services.events,o=e.explore.util.ResourcePackageUtils;t.createImportVisualService=i;var n="/powerbi/content/visual",a=".pbiviz",s=(function(){function t(e,t,i,r,o,n,a,s,l,c,u){this.eventBridge=e,this.modalDialogService=t,this.$rootScope=i,this.localizationService=r,this.errorService=o,this.notificationToast=n,this.telemetryService=a,this.visualPluginService=s,this.upload=l,this.localFileService=c,this.promiseFactory=u}return t.prototype.importWithDialog=function(e){var t=this,i=this.promiseFactory.defer();i.promise.then((function(i){return t.handleImport(e,i)})),this.localFileService.chooseLocalFile(i,a)},t.prototype.handleImport=function(t,i){var r=this,o=e.common.httpService.powerbiRequestOptions();o.retryCount=0,o.headers[e.common.constants.uploadFileSizeHeaderName]=i.size.toString(),this.notifyWhenLoadingCustomVisual("ImportCustomVisualLoadingTitle",0,"ImportCustomVisualLoadingMessage");var a=this.telemetryService.startEvent(e.telemetry.EXImportCustomViz,i.name,-1,"");this.upload.post(n,[i],o).then((function(e){var i=e.data;null==i.type&&(i.type=0);for(var o=0,n=i.items;o<n.length;o++){var s=n[o];null==s.type&&(s.type=0)}r.import(t,i),a.event.info.resourcePackageId=i.id,a.event.info.resourcePackageName=i.name,a.resolve()}),(function(e){r.showImportErrorDialog();var t=e&&e.error?e.error.code:"-1",i={errorCode:"Import of custom visual failed -> code: "+t};a.reject(i)}))},t.prototype.showImportErrorDialog=function(){var e=this.$rootScope.$new();e.errorService=this.errorService;var t={
dialogName:this.localizationService.get("ImportVisual_ErrorDialogHeader"),isDismissable:!0,scope:e,template:"<import-visual-error-dialog></import-visual-error-dialog>",dialogCssClass:"importVisualError"};this.modalDialogService.showLegacyWebModalDialog(t)},t.prototype.import=function(e,t){var i=this;return this.visualPluginService.ensurePlugins([t],!0).then((function(){o.ensureResourcePackages(e),_.remove(e.resourcePackages,(function(e){return e.name===t.name})),e.resourcePackages.push(t),i.eventBridge.publishToChannel(r.addCustomVisual,t),i.eventBridge.publishToChannel(r.visualPluginsChanged),i.notificationToast.hide(i.toastNotificationId),i.toastNotificationId=void 0}))},t.prototype.notifyWhenLoadingCustomVisual=function(t,i,r){var o=this;this.localizationService.ensureLocalization((function(){o.toastNotificationId=o.notificationToast.notify({title:o.localizationService.get(t),message:o.localizationService.get(r),notificationType:e.common.NotificationToastType.Loading})}))},t})()})(i=t.services||(t.services={}))})(t=e.exploreui||(e.exploreui={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r){return new v(e,t,i,r)}var o=e.explore.contracts.FilterType,n=e.data.Selector,a=e.data.SemanticFilter,s=e.data.SQExpr,l=e.data.SQExprBuilder,c=e.data.SQExprUtils,u=e.visuals.valueFormatter,p=e.data.VariationRewriter,d=e.explore.util.VisualContainerUtils;i.createIncludeExcludeService=r;var v=(function(){function r(e,t,i,r){this.eventBridge=e,this.localizationService=t,this.undoRedoService=i,this.telemetry=r}return r.prototype.setFilter=function(r,a,s){var l=this,c=_.map(a,(function(e){return n.convertSelectorsByColumnToSelector(e)})),u=_.find(s.filters,(function(e){return e.howCreated===r})),p=2;u||(u={howCreated:r,name:t.FilterUtils.getNextFilterName(s.filters),type:3===r?o.Include:o.Exclude},p=1);var v=u.filter;v=3===r?this.getIncludeFilter(c):this.getExcludeFilter(v,c),this.undoRedoService.register("UpdateIncludeExcludeFilter",(function(){u.filter=v;var o={container:s,scopeType:0};1===p&&(t.FilterUtils.add(o.container,u),l.telemetry.logEvent(e.telemetry.EXAddFilter,3===r?e.telemetry.FilterType.Include:e.telemetry.FilterType.Exclude,e.telemetry.FilterScopeType.Visual,e.telemetry.FieldKind.Entity,d.hasGroupByItemsInQuery(s)));var n={filter:u,changeType:p,scope:o};l.eventBridge.publishToChannel(i.events.filterContainerChanged,n)}))},r.prototype.buildViewModel=function(e,t){for(var i=e.where(),r=[],o=0,n=i;o<n.length;o++){var a=n[o],s=a.condition,l=new h;s.accept(l),r.push.apply(r,l.dataPoints)}return{points:r,filter:e,restatement:this.getRestatement(t,r.length)}},r.prototype.updateFilterContainer=function(e,t){var r=this,o=e.contract,n=o.type,a=this.buildFilter(t,n);this.undoRedoService.register("UpdateIncludeExcludeFilter",(function(){var t=e.getFilterContainerScope();o.filter=a;var n={filter:o,changeType:2,scope:t};r.eventBridge.publishToChannel(i.events.filterContainerChanged,n)}))},r.prototype.isIncludeExcludeSupported=function(e,t,i){if(e&&e.config&&e.config.singleVisual){var r=e.config.singleVisual,o=r.query;if(o){if(i&&t){var n=t.schema(void 0);if(n&&n.capabilities&&n.capabilities.supportsMultiTableTupleFilters)return!0}for(var a=o.defn.select(),l=void 0,u=0,d=a;u<d.length;u++){var v=d[u],h=v.expr;if(!c.isMeasure(h)){h=p.run(h,t);var g=h.getTargetEntity();if(l){if(!s.equals(l,g))return!1}else l=g}}return!0}}return!1},r.prototype.buildFilter=function(t,i){for(var r,n=t.points[0],a=l.inValues(n.columns,[n.values]),s=1;s<t.points.length;s++)n=t.points[s],r=l.inValues(n.columns,[n.values]),a=l.or(a,r);return i===o.Exclude&&(a=l.not(a)),e.data.SemanticFilter.fromSQExpr(a)},r.prototype.getRestatement=function(e,t){var i=null;return i=e===o.Include?this.localizationService.get("FilterPane_Include"):this.localizationService.get("FilterPane_Exclude"),i+" ("+t+")"},r.prototype.getIncludeFilter=function(t){var i=n.filterExprsFromSelectors(t);return e.DataViewScopeIdentity.filterFromExprs(i,!1)},r.prototype.getExcludeFilter=function(t,i){var r=n.filterExprsFromSelectors(i);if(t){var o=_.find(t.where(),(function(e){return 16===e.condition.kind}));if(o){for(var s=o.condition,c=s.arg,u=0,p=r;u<p.length;u++){var d=p[u],v=e.data.ScopeIdentityExtractor.getInExpr(d);c=l.or(c,v)}return c=l.not(c),a.fromSQExpr(c)}}return e.DataViewScopeIdentity.filterFromExprs(r,!0)},r})();i.IncludeExcludeService=v;var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dataPoints=[],t}return __extends(t,e),t.prototype.visitNot=function(e){e.arg.accept(this)},t.prototype.visitOr=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitIn=function(e){for(var t=[],i=e.args,r=0;r<e.values.length;r++){var o=e.values[r];t.push({values:o,columns:i,text:this.getDataPointText(i,o),expr:e,index:r})}(n=this.dataPoints).push.apply(n,t);var n},t.prototype.getDataPointText=function(e,t){for(var i="",r=0;r<e.length;r++){var o=t[r],n=e[r];i+=u.format(o.value)+" ("+n.ref+") - "}return i=i.slice(0,i.length-3)},t})(e.data.DefaultSQExprVisitor)})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){var e=250,t=250;return new i(e,t)}e.createLayoutInsertionHelper=t;var i=(function(){function e(e,t){this.emptySpaceMinWidth=e,this.emptySpaceMinHeight=t}return e.prototype.getEmptySpaces=function(e,t){for(var i=this.getNonOverlapingRects(e,t),r=this.filterWithMinimumWidth(i),o=[],n=0,a=r;n<a.length;n++){var s=a[n],l=this.extendRect(s,i);l.height>=this.emptySpaceMinHeight&&o.push(l)}return o},e.prototype.extendRect=function(e,t){for(var i,r=!1,o=0,n=t;o<n.length;o++){var a=n[o];if(a!==e){var s=!1,l=!1;if(this.doIntersect(a,e)&&(s=a.y+a.height===e.y,l=a.y===e.y+e.height),!(a.width<e.width))if(l){var c={x:e.x,y:e.y,width:e.width,height:e.height+a.height},u=this.getIntersectingRectangle(c,a);u&&u.width===c.width&&(r=!0,i=c)}else if(s){var c={x:e.x,y:a.y,width:e.width,height:e.height+a.height},u=this.getIntersectingRectangle(c,a);u&&u.width===c.width&&(r=!0,i=c)}}}return r?this.extendRect(i,t):e},e.prototype.getIntersectingRectangle=function(e,t){var i=Math.max(e.x,t.x),r=Math.min(e.x+e.width,t.x+t.width),o=Math.max(e.y,t.y),n=Math.min(e.y+e.height,t.y+t.height);return i<=r&&o<=n?{x:i,y:o,width:r-i,height:n-o}:null},e.prototype.doIntersect=function(e,t){return!(t.x>e.x+e.width||t.x+t.width<e.x||t.y>e.y+e.height||t.y+t.height<e.y)},e.prototype.filterWithArea=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];o.width>0&&o.height>0&&t.push(o)}return t},e.prototype.filterWithMinimumWidth=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];o.width>=this.emptySpaceMinWidth&&t.push(o)}return t},e.prototype.splitRectangleOnIntersection=function(e,t){var i=this.getIntersectingRectangle(e,t);return i?this.filterWithArea([{x:e.x,y:e.y,width:e.width,height:i.y-e.y},{x:e.x,y:i.y+i.height,width:e.width,height:e.y+e.height-(i.y+i.height)},{x:e.x,y:i.y,width:i.x-e.x,height:i.height},{x:i.x+i.width,y:i.y,width:e.x+e.width-(i.x+i.width),height:i.height}]):[e]},e.prototype.getNonOverlapingRects=function(e,t){if(!t.length)return[];for(var i=[e],r=0;r<t.length;r++){for(var o=[],n=0;n<i.length;n++)o=o.concat(this.splitRectangleOnIntersection(i[n],t[r]));i=o}return i},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a){return new l(e,t,i,r,o,n,a)}var o=jsCommon.ArrayExtensions,n=e.data.QueryProjectionsByRole,a=e.data.dsr.transformDataQueryToSemanticQueryDataShapeCommand,s=t.util.VisualContainerUtils;i.createPinVisualService=r;var l=(function(){function t(e,t,i,r,o,n,a){this.conceptualSchemaProxy=e,this.displayNameService=t,this.dataProxy=i,this.featureSwitchService=r,this.resourcePackagesService=o,this.visualQueryGenerator=n,this.visualPlugin=a}return t.prototype.getPinData=function(e,t,i,r,o,n,a,l,c){var u,p=e.config.singleVisual;if(c&&!this.hasRegisteredResourcePackageReferences(c,a,p)&&(c=void 0),n){var d=n.options.query.command,v=s.describeForPinning(this.displayNameService,l,p.query,this.visualPlugin.capabilities(p.visualType),r?r.filterMetadata:null),h=v.queryMetadata;u={dataTransforms:n.transforms,dataViewSource:o?o.dataViewSource:null,elements:v.visualElements,query:d,queryMetadata:h,themeName:a,tileLayoutType:t,visualContainer:e};var g=e.config.singleVisual.title;g&&g.text?u.tileHeading=g.text:this.setPinDataHeadings(o,h,u)}else u={dataViewSource:{data:void 0},themeName:a,tileLayoutType:t,visualContainer:e};var f=this.gatherModelExtensions(i);return f&&(u.modelExtensions=f),this.addResourcePackageIdsToPinData(p.visualType,u,c)},t.prototype.gatherModelExtensions=function(e){var t=_.find(e,(function(e){return"exploration"===e.type}));if(t){var i=t.exploration;if(i)return i.getModelExtensions()}},t.prototype.setPinDataHeadings=function(t,i,r){var o,n,a,s=t&&t.dataViewSource&&t.dataViewSource.data.descriptor;if(s){var l=new e.data.dsr.QueryDescription(i,s);o=l.getMeasureRestatements(),n=l.getFilterRestatements(),a=l.getGroupRestatements()}else{for(var c=[],u=[],p=0,d=i.Select;p<d.length;p++){var v=d[p];3===v.Type||1===v.Type?c.push(v.Restatement):4!==v.Type&&2048!==v.Type||u.push(v.Restatement)}u.length>0&&(a=u),c.length>0&&(o=c)}o?r.tileHeading=this.joinList(o):a&&(r.tileHeading=this.joinList(a)),n&&(r.tileFilterDetails=this.joinList(n)),o&&a&&(r.tileSubDisplay=e.common.localize.format("TileHeadings_By",[this.joinList(a)]))},t.prototype.joinList=function(t){return t.join(e.common.localize.get("ListJoin_Separator"))},t.prototype.pinVisualContainer=function(t,i,r,o,n){var s=this,l=i.config.singleVisual,c=l.visualType,u=this.handler,p=c===e.visuals.plugins.image.name?e.common.contracts.TileLayoutType.Full:e.common.contracts.TileLayoutType.Default;this.conceptualSchemaProxy.get(t).then((function(d){var v;if(s.visualQueryGenerator.shouldExecute(l,t)){var h=e.common.GridLayoutConstants.getDefaultGridItemViewport(e.common.GridLayoutConstants.getMediumLandscapeGridItem());v=s.visualQueryGenerator.execute({config:l,dataSources:t,schema:d,additionalFilters:r,dataWindow:h,ignoreViewportForCache:!0,allowClientSideFilters:!1})}if(v){var g=v.options.query.command,f=a(g);s.modifyPinnedVisualDataShapeBinding(f.Binding,l.query,d,c),s.dataProxy.execute(v.options).then((function(e){var a=s.getPinData(i,p,t,r,e,v,o,d,n);u&&u.pinVisual(a)}),(function(){}))}else{var m=s.getPinData(i,p,t,null,null,null,o,null,n);u&&u.pinVisual(m)}}))},t.prototype.canPinVisualType=function(t){return null!=t&&null!=this.visualPlugin.getPlugin(t)&&t!==e.visuals.plugins.slicer.name&&t!==e.visuals.plugins.basicShape.name},t.prototype.setHandler=function(e){this.handler=e},t.prototype.modifyPinnedVisualDataShapeBinding=function(e,i,r,a){var s=this.visualPlugin.capabilities(a);if(t.isTableOrMatrix(a))return e.DataReduction||(e.DataReduction={}),void(e.DataReduction.Primary={Window:{Count:100}});if(t.supportsScalarCategoryAxis(s)){var l=i.projections,c=i.defn.select();if(!l||_.isEmpty(c))return;var u="Category",p=n.getRole(l,u);if(!p||_.isEmpty(p.all()))return;var d=p.getLastActiveQueryReference()||p.all()[0].queryRef,v=o.findItemWithName(c,d);if(!v)return;var h=v.expr.getMetadata(r);h&&0===h.kind&&h.type.dateTime&&(e.DataReduction||(e.DataReduction={}),e.DataReduction.Primary={Bottom:{}})}},t.prototype.hasRegisteredResourcePackageReferences=function(e,t,i){return!(!e||_.isEmpty(e.items))&&!(!t||!_.find(e.items,(function(e){return e.name===t})))},t.prototype.addResourcePackageIdsToPinData=function(e,t,i){var r=[];if(this.visualPlugin.isCustomVisual(e)){var o=this.resourcePackagesService.getPackage(e);o&&r.push(o.id)}return i&&r.push(i.id),_.isEmpty(r)||(t.resourcePackageIds=_.uniq(r)),t},t.supportsScalarCategoryAxis=function(e){return e.objects&&e.objects.categoryAxis&&e.objects.categoryAxis.properties&&void 0!==e.objects.categoryAxis.properties.axisType},t.isTableOrMatrix=function(t){var i=e.visuals.plugins;return t===i.table.name||t===i.matrix.name},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,c,u){return new l(e,t,i,r,o,n,a,s,c,u)}var o=e.data.services.SemanticQuerySerializer,n=e.data.SQExpr,a=e.data.SQExprUtils,s=t.util.VisualContainerUtils;i.createQuickCalcService=r;var l=(function(){function i(e,t,i,r,o,n,a,s,l,c){this.aggrOps=e,this.conceptualSchemaProxy=t,this.dataSources=i,this.modalDialogService=r,this.modelAuthoring=o,this.modelChangeHandler=n,this.promiseFactory=a,this.daxTemplateService=s,this.visualAuthoringService=l,this.telemetryService=c}return i.prototype.createQuickCalc=function(t,i){var r=this,o=this.promiseFactory.defer(),l=this.dataSources.get();return this.conceptualSchemaProxy.get(l).then((function(c){var u;if(i)u=_.sortBy(s.getSelectExprs(i.visualContainer),(function(e){return n.equals(t,e.expr)?0:1}));else{var p=t,d=p.getMetadata(c);d&&d.type.numeric&&!e.data.SQExprUtils.discourageAggregation(t,c)&&(p=r.aggrOps.createExprWithAggregate(t,c,!0,[{numeric:!0}])),u=[{expr:p,name:void 0}]}var v=r.telemetryService.logEvent(e.telemetry.EXQuickMeasuresOpenDialog,i?e.telemetry.QuickMeasureEntryPoint.FieldWell:e.telemetry.QuickMeasureEntryPoint.FieldList,u.length),h=r.telemetryService.startChildEvent(v,e.telemetry.EXQuickMeasuresDialogResult,void 0),g=e.explore.constants.DefaultSchemaName,f=r.showQuickCalcDialog(u,g,v);o.promise.catch((function(){return f.reject()})),f.then((function(e){return e?r.daxTemplateService.getTemplates(g).then((function(t){var i=_.find(t,(function(t){return t.capabilities.name===e.template.name}));return i?(h.event.info.selectedQuickMeasure=i.capabilities.name,h.resolve(),r.createNewMeasure(e,i,c)):(h.event.info.selectedQuickMeasure="Cancel",h.resolve(),r.promiseFactory.reject())})):(h.event.info.selectedQuickMeasure="Cancel",h.resolve(),r.promiseFactory.reject())})).then((function(o){if(i){var n=e.data.SQExprBuilder.measureRef(e.data.SQExprBuilder.entity(o.schema,o.entity),o.measureDefinition.name);return r.visualAuthoringService.addFieldToVisual(n,l,i.visualContainer).catch((function(){return a.isMeasure(t)?r.visualAuthoringService.replaceProjection(n,i.role,i.index,i.visualContainer,l):r.promiseFactory.resolve()}))}return r.promiseFactory.resolve()})).then((function(){return o.resolve(null)})).catch((function(){return o.reject()}))})),e.RejectablePromise(o)},i.prototype.showQuickCalcDialog=function(e,i,r){var n=this.dataSources.get(),a={selects:_.map(e,(function(e){return o.serializeExpr(e.expr)})),dataSources:t.contracts.createDataSourceArray(_.filter(n,(function(e){return e.dsr&&!e.exploration}))),schemaName:i,openDialogEvent:r},s={dialogName:"DaxTemplateDialog",definitionTemplateCachePath:"components/daxTemplateDialog/daxTemplateDialogDefinition.html",bindings:{args:a},dialogCssClass:"daxTemplateDialog"};return this.modalDialogService.showHostModalDialog(s)},i.prototype.createNewMeasure=function(e,t,i){var r=this,n=this.promiseFactory.defer(),a=_.mapValues(e.parameters,(function(e){return{expression:o.deserializeExpr(e.expression)}}));return t.apply({schemaName:e.newMeasureMetadata.schema,inputValues:a}).then((function(o){var a={newQuickCalc:{schema:e.newMeasureMetadata.schema,entity:e.newMeasureMetadata.entity,name:e.newMeasureMetadata.measureName,expression:o.dax,daxTemplateName:t.capabilities.name}};r.applyAndHandleSchemaChange(a,(function(t){var o=t.changes,a=_.find(o,(function(e){return e.newMeasureCreated}));if(a){var s=r.promiseFactory.defer();return r.applyFormatting(a.newMeasureCreated,e,i).then((function(e){n.resolve(e),s.resolve(null)})),s.promise}}))})),n.promise},i.prototype.applyFormatting=function(e,t,i){var r=this,o=this.promiseFactory.defer(),n=this.getFormattingSchemaChange(t.newMeasureMetadata,e.measureDefinition.name,i);return n?this.applyAndHandleSchemaChange(n,(function(t){var i=t.changes;if(_.find(i,(function(e){return e.setFormatting||e.copyFormatting})))return o.resolve(e),r.promiseFactory.resolve()})):o.resolve(e),o.promise},i.prototype.getFormattingSchemaChange=function(e,t,i){if(null!=e.formatType){var r=this.convertFormatToFormatKind(e.formatType);if(r)return{setFormatting:{schema:e.schema,entity:e.entity,property:t,format:r}}}else if(e.formatSource){var o=this.getActualFormattingSource(e.formatSource,i);if(o)return{copyFormatting:{schema:e.schema,sourceEntity:o.entity,sourceProperty:o.property,targetEntity:e.entity,targetProperty:t}}}},i.prototype.getActualFormattingSource=function(e,t){var i=o.deserializeExpr(e);if(n.isMeasure(i)){var r=i.source.getTargetEntity();return r&&{entity:r.entity,property:i.ref}}if(n.isAggregation(i)){var a=i.arg.getTargetColumnRef(t);if(!a)return;var s=i.getMetadata(t),l=a.getMetadata(t),r=a.source.getTargetEntity();return s&&l&&r&&s.type.isCompatibleFrom(l.type)&&{entity:r.entity,property:a.ref}}},i.prototype.convertFormatToFormatKind=function(e){if(0===e)return"Percentage"},i.prototype.applyAndHandleSchemaChange=function(e,t){var i=this.modelChangeHandler.register(t);this.modelAuthoring.apply({changes:[e]}).finally((function(){return i.stopHandling()}))},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(){return{canShowHiddenSchemaItem:_.noopFalse,canToggleSchemaItems:_.noopTrue,setShowHiddenSchemaItem:_.noop,areScriptVisualsApproved:_.noopTrue,approveScriptVisuals:function(){e.contract.fail("ShellService.approveScriptVisuals is not available in ExploreUI view")},showEditQueriesEditor:_.noop}}t.createShellService=i})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n){return new u(e,t,i,r,o,n)}var o=e.data.FieldExprPattern,n=t.viewModels.ShowValueAsNoCalculation,a=t.viewModels.ShowValueAsPercentOfGrandTotalCalculation,s=t.viewModels.ShowValueAsPercentOfRoleTotalCalculation,l=e.data.SQExprConverter,c=e.data.SQExprUtils;i.createShowValueAsService=r;var u=(function(){function t(e,t,i,r,o,n){this.localizationService=e,this.promiseFactory=t,this.telemetryService=i,this.undoRedo=r,this.visualAuthoring=o,this.visualPlugin=n}return t.prototype.createShowValueAsMenuItems=function(t,i,r){var c=o.getSchema(l.asFieldPattern(t));if(!i.schema(c).capabilities.supportsScopedEval)return[];var u=[];if(this.aggregateSupportsShowValueAs(t,i)){var p=new n(e.common.localize);u.push(this.showValueAsMenuItemBuilder(p));var d=new a(e.common.localize);u.push(this.showValueAsMenuItemBuilder(d));var v=this.visualPlugin.capabilities(r),h=v&&v.dataRoleTotals;if(!_.isEmpty(h))for(var g=0,f=h;g<f.length;g++){var m=f[g],y=new s(this.localizationService,m.roles,e.data.getDisplayName(m.displayName,this.localizationService));u.push(this.showValueAsMenuItemBuilder(y))}}return u},t.prototype.applyShowValueAs=function(t,i,r){var o=this;this.undoRedo.register("applying quick calc "+r.kind,(function(){return o.removeShowValueAs(t,i).then((function(){switch(r.kind){case void 0:return o.promiseFactory.resolve();case 0:return o.visualAuthoring.setPercentOfGrandTotal(t.visualDataRole.name,t.roleIndex,t.visual,t.dataSources);case 1:return o.visualAuthoring.setPercentOfRoleTotal(r.roles,t.visualDataRole.name,t.roleIndex,t.visual,t.dataSources);default:return o.promiseFactory.reject()}})).then((function(){return o.telemetryService.logEvent(e.telemetry.EXChangeQuickCalc,o.showValueAsKindToTelemetryId(i.kind),o.showValueAsKindToTelemetryId(r.kind)),o.promiseFactory.resolve()}))}))},t.prototype.showValueAsMenuItemBuilder=function(e){var t={type:0};return t.key={action:5,showValueAs:e},t.text=e.name,t},t.prototype.aggregateSupportsShowValueAs=function(e,t){var i=e.getMetadata(t);return i&&i.type&&i.type.numeric&&c.isMeasure(e)},t.prototype.removeShowValueAs=function(e,t){var i;switch(t.kind){case void 0:i=this.promiseFactory.resolve();break;case 0:i=this.visualAuthoring.removePercentOfGrandTotal(e.visualDataRole.name,e.roleIndex,e.visual,e.dataSources);break;case 1:i=this.visualAuthoring.removePercentOfRoleTotal(e.visualDataRole.name,e.roleIndex,e.visual,e.dataSources);break;default:i=this.promiseFactory.reject()}return i},t.prototype.showValueAsKindToTelemetryId=function(e){switch(e){case void 0:return"None";case 0:return"PercentOfGrandTotal";case 1:return"PercentOfRoleTotal"}},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new n(e,t,i)}var r=e.common.models.CollapsiblePaneExpandedWidth,o=e.common.constants.TaskPaneCollapsiblePaneMode;t.createSubscriptionPaneService=i;var n=(function(){function e(e,t,i){this.taskPaneSliderService=e,this.userInfo=t,this.localizationService=i}return e.prototype.expandPaneForReportSubscription=function(e,t){this.taskPaneSliderService.isPaneExpanded()||(this.info={reportInfo:e},this.currentSubscriptionGUID=t,this.taskPaneSliderService.expandPane(o.EmailSubscription,r.Small))},e.prototype.expandPaneForDashboardSubscription=function(e,t){this.info={dashboardInfo:e},this.currentSubscriptionGUID=t,this.taskPaneSliderService.expandPane(o.EmailSubscription,r.Small)},e.prototype.collapseSubscriptionPane=function(){this.taskPaneSliderService.isPaneExpanded()&&(this.taskPaneSliderService.collapsePane(),this.currentSubscriptionGUID=void 0)},e.prototype.getInfo=function(){return this.info},e.prototype.getCurrentSubscriptionGUID=function(){return this.currentSubscriptionGUID},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new a(e,t,i)}var r="uicomponents",o="ColorPicker",n={javascript:"uiComponents"};t.createUIComponentService=i;var a=(function(){function e(e,t,i){this.$compile=e,this.moduleLoader=t,this.promiseFactory=i}return e.prototype.getUIComponentFactory=function(e){return new s(e,this.$compile,this.moduleLoader,this.promiseFactory)},e})(),s=(function(){function t(e,t,i,r){this.$scope=e,this.$compile=t,this.moduleLoader=i,this.promiseFactory=r}return t.prototype.createColorPicker=function(t,i,a){return __awaiter(this,void 0,e.Promise,(function(){var s,l=this;return __generator(this,(function(c){return s=this.promiseFactory.defer(),this.moduleLoader.require(n).then((function(){var n=e[r][o],c=new n(l.$scope,l.$compile,t,i,a);s.resolve(c)})),[2,s.promise]}))}))},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new n}function i(){return{supportsPinning:void 0,supportsDeletion:void 0,enablePenAnnotation:!1,visualDoubleClickEnabled:!1,displayOptions:{canShowCanvasWatermark:!1,showVisualBordersInViewMode:!1,hideVisualizationPane:!1,hideVisualBodyTitle:!1,hideTileMenu:!1,hideNavigationPane:!1,disableFadeout:!1,showMobilePane:!1,hideInFocusBar:!1,hideInFocusTileMenu:!1,hideCanvasSwipeHandles:!1,extendBackgroundToWholeCanvas:!1},touchOptions:{deselectVisualOnCanvasScroll:!1,disableCanvasScrollOnSelectedVisual:!1,disableTouchZoom:!1,isCanvasSwipeable:!1,touchEventsOnSelectedVisualOnly:!1,disableCanvasPinch:!1},penProperties:{strokeStyle:r.DefaultPenStrokeStyle,lineWidth:r.DefaultPenLineWidth,opacity:r.DefaultPenOpacity}}}var r,o=jsCommon.FreezeUtility;!(function(e){e.DefaultPenStrokeStyle="#939598",e.DefaultPenLineWidth=20,e.DefaultPenOpacity=1})(r=e.annotations||(e.annotations={})),e.createViewModeState=t;var n=(function(){function e(){this.config=i(),this.freeze()}return e.prototype.getConfig=function(){return this.frozenConfig},e.prototype.updateConfig=function(e){e&&(e(this.config),this.freeze())},e.prototype.getMode=function(){return this.mode},e.prototype.setMode=function(e){this.mode=e},e.prototype.freeze=function(){var e=_.cloneDeep(this.config);o.deepFreeze(e),this.frozenConfig=e},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l,c,p,d,v,h,g,f,m,y,w,C,S,b){return new u(e,t,i,r,o,n,a,s,l,c,p,v,d,h,g,f,m,y,w,C,S,b)}var o=(e.data,e.data.segmentation.DataViewMerger),n=e.data.services.DataViewTransformActionsSerializer,a=e.data.dsr,s=e.visualHost.ResourcePackageReferenceResolver,l=t.util.VisualContainerUtils,c=e.visualHost;i.createVisualContainerQueryHandler=r;var u=(function(){function r(e,i,r,o,n,a,s,l,c,u,p,d,v,h,g,f,m,y,w,C,S,b){this.queryExecutionServices=e,this.hostServices=i,this.promiseFactory=r,this.conceptualSchemaProxy=o,this.featureSwitchService=n,this.visualQueryGenerator=s,this.visualPlugin=l,this.embedModeService=d,this.filterGenerator=h,this.scriptVisuals=g,this.displayNameService=f,this.explorationNavigation=m,this.resourceLoader=y,this.eventBridge=w,this.shell=C,this.localizationService=S,this.trustedVisual=b,this.visualDataProxyExecutionService=t.services.createVisualDataProxyExecutionService(r,o,n,a,s,l,c,u,t.services.createExploreVisualDataProxyService(v.create(),h),p,d)}return r.prototype.runQuery=function(e){var t=this,i=this.queryExecutionServices.getDataSources(),r=e.contract;if(!this.shouldBlockVisualQuery(r)&&this.visualQueryGenerator.shouldExecute(r.config.singleVisual,i)){var o=this.visualDataProxyExecutionService.runQuery({dataSources:i,contract:r,viewport:e.viewport,hostServices:this.hostServices,initialLoad:e.initialLoad,useVisualContainerCache:e.useVisualContainerCache,preferCurrentData:e.preferCurrentData,allowCache:e.allowCache,generatedQuery:e.generatedQuery}),n=r.config.singleVisual.visualType,a=r.config.singleVisual.objects,s=this.loadResourcePackageReferences(n,a);e.geocodingTracker&&e.geocodingTracker.newQuery(),this.queryExecutionServices.notifyStart();var l=!1;o.previewPromise.then((function(e){e&&!l&&t.resolveResourcePackageReferences(n,e.dataProxyQuery.transforms.objects).then((function(i){t.handleQueryResult(r,e.result,e.dataProxyQuery,i)}))})),o.finalPromise.then((function(i){s.then((function(){var o;i&&(o={updateContractCache:!0,updateServerCache:i.updateServerVisualContainerCache},t.resolveResourcePackageReferences(n,i.dataProxyQuery.transforms.objects).then((function(n){t.handleQueryResult(r,i&&i.result,i.dataProxyQuery,n,o,e.currentData)})))}))}),(function(e){t.queryExecutionServices.handleErrors(e)})).finally((function(){l=!0,t.queryExecutionServices.notifyEnd()}))}},r.prototype.loadMoreData=function(e){var t=this;this.queryExecutionServices.notifyStart(),this.getNextDataSegment(e).then((function(i){i&&t.mergeMoreData(i.result,i.dataProxyQuery,e.currentData)})).finally((function(){t.queryExecutionServices.notifyEnd()}))},r.prototype.getNextDataSegment=function(e){var t=this,i=this.promiseFactory.defer();return this.visualDataProxyExecutionService.canLoadMoreData()?this.visualDataProxyExecutionService.loadMoreData({dataSources:this.queryExecutionServices.getDataSources(),contract:e.contract,hostServices:this.hostServices,viewport:e.viewport,useVisualContainerCache:e.useVisualContainerCache}).then((function(e){t.handleLoadMoreDataWarnings(e&&e.result,e&&e.dataProxyQuery),i.resolve(e)}),(function(e){t.queryExecutionServices.handleErrors(e),i.reject(e)})):i.reject("Cannot load more data"),i.promise},r.prototype.mergeMoreData=function(e,t,i){var n=r.getDataProxyQueryExecutionResultWarnings(e,t),a=e?e.dataReaderResult.dataView:null;if(a){var s=i.dataView;o.mergeDataViews(s,a);var l={dataView:s,dataViewSource:e&&e.dataViewSource,isFirstSegment:!1};_.isEmpty(n)||(l.warnings=n),this.queryExecutionServices.loadMergedData(l)}},r.prototype.visualizeDataViewSource=function(e,t,i){var r=this,o=a.read(31,t.data),n=o.error;if(n)return void this.queryExecutionServices.handleErrors(n);var s=this.queryExecutionServices.getDataSources(),l=e&&e.config&&e.config.singleVisual;s&&l&&this.conceptualSchemaProxy.get(s).then((function(n){var a=r.visualQueryGenerator.execute({config:l,dataSources:s,schema:n,additionalFilters:r.hostServices.getFilters(r.filterGenerator,n),restartToken:o.restartToken,dataWindow:i});if(a){var c=r.promiseFactory.defer();c.resolve(a.options),r.handleQueryResult(e,{dataViewSource:t,dataReaderResult:o},{transforms:a.transforms,error:a.error,warnings:a.warnings,options:c.promise},null,{updateContractCache:!0})}}))},r.prototype.updateNonQueryVisual=function(e,t){var i=this,r={dataView:null,dataViewSource:null};if(t){var o=e.config.singleVisual.visualType,n=e.config.singleVisual.objects;this.queryExecutionServices.notifyStart(),this.resolveResourcePackageReferences(o,n).then((function(e){i.queryExecutionServices.applyUpdate(r,t,e)})).finally((function(){i.queryExecutionServices.notifyEnd()}))}else this.queryExecutionServices.applyUpdate(r,t,null)},r.prototype.validate=function(t){if(l.isScriptVisual(t,this.visualPlugin)){var i=this.scriptVisuals.getScriptVisualErrorDetails();if(i)return{details:i,code:this.shell.areScriptVisualsApproved()?"ScriptVisualError":"ScriptVisualsNotEnabled"}}var o=l.getVisualType(t);if(o)if(this.trustedVisual.isTrustedVisual(o)){var n=this.trustedVisual.validate(o);if(n)return{details:n,code:"TrustedVisualError"}}else{if(this.visualPlugin.isCustomVisual(o)&&!this.featureSwitchService.featureSwitches.customVisuals){var i=r.buildErrorDetails(this.localizationService.get("VisualContainer_CustomVisualDisabledMessage"),this.localizationService.get("VisualContainer_CustomVisualDisabledKey"),this.localizationService.get("VisualContainer_CustomVisualDisabledValue"));return{details:i,code:"UnsupportedVisual"}}if(!this.visualPlugin.getPlugin(o)&&!this.visualPlugin.isCustomVisual(o)){var i=r.buildErrorDetails(this.localizationService.get("VisualContainer_UnableToFindVisualMessage"),this.localizationService.get("VisualContainer_UnableToFindVisualKey"),this.localizationService.get("VisualContainer_UnableToFindVisualValue"));return{details:i,code:"UnsupportedVisual"}}if(c.utils.shouldDisableVisual(o,e.common.localize.shouldDisableMap())){var i=r.buildErrorDetails(this.localizationService.get("VisualContainer_NotSupportedForLocaleMessage"),this.localizationService.get("VisualContainer_NotSupportedForLocaleKey"),this.localizationService.get("VisualContainer_NotSupportedForLocaleValue"));return{details:i,code:"NotSupportedForLocale"}}}},r.prototype.updateContractCache=function(t,i,r){var o=this;if(!t)return this.promiseFactory.reject(null);var n=this.queryExecutionServices.getDataSources();if(!n)return this.promiseFactory.reject(null);var a=t.cachedData&&t.cachedData.dataUpdatedTime?t.cachedData.dataUpdatedTime:null,s=i&&i.dataViewSource?i.dataViewSource.data:void 0,c=r&&r.error;return i&&i.dataReaderResult&&i.dataReaderResult.disallowPersisting&&(a=null,s=null,c=new e.IgnorableClientError),this.conceptualSchemaProxy.get(n).then((function(e){return r.options.then((function(i){var n={transforms:r.transforms,error:c,warnings:r.warnings,options:i};t.cachedData=l.createCacheEntry(o.visualPlugin,o.displayNameService,s,n,e,t.config.singleVisual,o.filterGenerator.generateFilterMetadata(t.filters),a)}))}))},r.prototype.handleQueryResult=function(e,t,o,n,a,s){var c=this;void 0===a&&(a={}),this.queryExecutionServices.clearErrors();var u=r.getDataProxyQueryExecutionResultWarnings(t,o);u&&this.queryExecutionServices.handleWarnings(u,o.transforms);var p;if(t){p={dataView:t&&t.dataReaderResult?t.dataReaderResult.dataView:null,dataViewSource:t&&t.dataViewSource?t.dataViewSource:null},u&&(p.warnings=u);var d=l.isSegment(p.dataView);d&&(p.isFirstSegment=d)}else p={dataView:s&&s.dataView,dataViewSource:s&&s.dataViewSource};if(this.queryExecutionServices.applyUpdate(p,o.transforms,n),a.updateContractCache){var v=t&&t.dataViewSource?t.dataViewSource.data:void 0,h=this.updateContractCache(e,v,o);a.updateServerCache&&h.then((function(){o.options.then((function(t){var r=e.id,o={visualContainerId:r,query:JSON.stringify(t.query.command),dataTransforms:c.getCachedTransformsString(e)};c.eventBridge.publishToChannel(i.events.newQueryCacheResultAvailable,o);
}))}))}},r.prototype.handleLoadMoreDataWarnings=function(e,t){this.queryExecutionServices.clearErrors();var i=r.getDataProxyQueryExecutionResultWarnings(e,t);i&&this.queryExecutionServices.handleWarnings(i,t.transforms)},r.prototype.getCachedTransformsString=function(e){if(e.cachedData){var t=e.cachedData.transformsObject;if(t)return n.serializeTransformActions(t)}},r.prototype.shouldBlockVisualQuery=function(e){if(l.isScriptVisual(e,this.visualPlugin)&&(!this.shell.areScriptVisualsApproved()||this.scriptVisuals.shouldBlockScriptVisual())){var t=l.getVisualType(e);return this.eventBridge.publishToChannel(i.events.visualContainerQueryBlocked,{visualType:t}),!0}return!1},r.prototype.loadResourcePackageReferences=function(e,t){var i=this.visualPlugin.capabilities(e),r=i&&i.objects,o=this.explorationNavigation.getCurrentExploration();return s.loadFromDataViewObjects(t,r,o?o.resourcePackages:null,this.resourceLoader,this.promiseFactory)},r.prototype.resolveResourcePackageReferences=function(e,t){var i=this.visualPlugin.capabilities(e),r=i&&i.objects,o=this.explorationNavigation.getCurrentExploration();return s.loadAndResolveFromDataViewObjects(t,r,o?o.resourcePackages:null,this.resourceLoader,this.promiseFactory)},r.getDataProxyQueryExecutionResultWarnings=function(e,t){return t&&!_.isEmpty(t.warnings)?t.warnings:e&&e.dataReaderResult&&!_.isEmpty(e.dataReaderResult.warnings)?e.dataReaderResult.warnings:void 0},r.buildErrorDetails=function(e,t,i){return{message:e,displayableErrorInfo:[{errorInfoKey:t,errorInfoValue:i}]}},r})();i.VisualContainerQueryHandler=u})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new o(e,t,i)}var r=e.explore.util.VisualContainerUtils;t.createVisualContainerDataSelectionService=i;var o=(function(){function e(e,t,i){this.visualContainer=e,this.queryService=t,this.visualPluginOps=i}return e.prototype.getSelectedValues=function(e){var t=r.getVisualType(this.visualContainer.contract),i=r.getVisualQuery(this.visualContainer.contract),o=this.visualPluginOps.dataViewKinds(t,i);return this.queryService.query(this.getDataViews(),e,o)},e.prototype.getDataViews=function(){return this.visualContainer&&this.visualContainer.readOnlyState.visual&&this.visualContainer.readOnlyState.visual.dataViews},e})();t.VisualContainerDataSelectionService=o})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,l,c,u,p){return new s(e,t,i,r,o,n,a,l,c,u,p)}var o=e.data.services.DataViewTransformActionsSerializer,n=e.data.dsr,a=t.util.VisualContainerUtils;i.createVisualDataProxyExecutionService=r;var s=(function(){function t(e,t,i,r,o,n,a,s,l,c,u){this.promiseFactory=e,this.conceptualSchemaProxy=t,this.featureSwitchService=i,this.telemetryService=r,this.visualQueryGenerator=o,this.visualPlugin=n,this.visualPluginOps=a,this.dataProxy=s,this.visualDataProxyService=l,this.networkAvailability=c,this.embedTypeDescription=u.getEmbedTypeDescription()}return t.prototype.runQuery=function(e){var t=this,i=this.promiseFactory.defer(),r=this.promiseFactory.defer(),o={previewPromise:i.promise,finalPromise:r.promise};return this.applyVisualCache(e,i,r).then((function(i){i&&t.runQueryImpl(e,r,!1)})),o},t.prototype.applyVisualCache=function(t,i,r){var o=this,n=this.promiseFactory.defer(),s=this.featureSwitchService.featureSwitches.embeddedEnabled,l=t.contract;if(t.useVisualContainerCache&&t.initialLoad||s){var c=a.hasOnPremDataSource(t.dataSources);this.retrieveFromVisualContainerCache(t.dataSources,l,t.viewport,t.hostServices).then((function(t){t.isFinal||s||!o.networkAvailability.isNetworkAvailable()?(i.reject(),r.resolve(t.result),n.resolve(!1),s||o.telemetryService.logEvent(e.telemetry.EXVisualFirstLoad,e.telemetry.VisualInitialLoadType.Cache,c,e.telemetry.VisualInitialLoadTypeWarning.None,o.embedTypeDescription)):(i.resolve(t.result),n.resolve(!0),s||o.telemetryService.logEvent(e.telemetry.EXVisualFirstLoad,e.telemetry.VisualInitialLoadType.StaleCache,c,e.telemetry.VisualInitialLoadTypeWarning.None,o.embedTypeDescription))}),(function(t){i.reject(),l.useInitialCachedQuery=!1,s?(r.reject(),n.resolve(!1)):(n.resolve(!0),o.telemetryService.logEvent(e.telemetry.EXVisualFirstLoad,e.telemetry.VisualInitialLoadType.NoCache,c,t,o.embedTypeDescription))}))}else i.reject(),n.resolve(!0);return n.promise},t.prototype.runQueryImpl=function(e,t,i){var r=this,o=e.contract,n=e.dataSources,a=e.initialLoad&&!!e.useVisualContainerCache;return!o||!o.config||o.useInitialCachedQuery&&a||!this.visualQueryGenerator.shouldExecute(o.config.singleVisual,n)?void t.resolve(null):void this.conceptualSchemaProxy.get(n).then((function(s){var l={dataSources:n,schema:s,config:o.config.singleVisual,hostServices:e.hostServices,visualQueryGenerator:r.visualQueryGenerator,isLoadMore:i,isInitialLoad:a,allowCache:e.allowCache,preferCurrentData:e.preferCurrentData,viewport:e.viewport,generatedQuery:e.generatedQuery};r.visualDataProxyService.runQuery(l).then((function(i){return r.loadData(i,s,o,a,e.useVisualContainerCache,t)}),(function(e){return t.reject(e)}))}),(function(e){t.reject(e?e.clientError:null)}))},t.prototype.canLoadMoreData=function(){return this.visualDataProxyService.canLoadMore()},t.prototype.loadMoreData=function(e){var t=this.promiseFactory.defer();return this.visualDataProxyService.canLoadMore()?this.runQueryImpl(e,t,!0):t.reject(),t.promise},t.prototype.loadData=function(e,t,i,r,o,n){var a=this.visualDataProxyService.lastExecutedQuery(),s=r&&o&&(this.isMissingVisualQueryOrDataTransformsContract(i)||this.isGeneratedQueryDifferentToContainerQuery(i,a)),l=this.promiseFactory.defer();l.resolve(a.options),n.resolve({result:e,dataProxyQuery:{transforms:a.transforms,error:a.error,warnings:a.warnings,options:l.promise},schema:t,updateServerVisualContainerCache:s})},t.prototype.isMissingVisualQueryOrDataTransformsContract=function(e){var t=a.getVisualType(e);return!(!t||!this.visualPluginOps.isQueryVisual(t))&&(null==e.cachedData||null==e.cachedData.query&&null==e.cachedData.queryObject||!e.cachedData.transforms)},t.prototype.isGeneratedQueryDifferentToContainerQuery=function(e,t){var i=e.cachedData;if(i&&i.query){var r=JSON.stringify(t.options.query.command);return r!==i.query}return!1},t.prototype.retrieveFromVisualContainerCache=function(t,i,r,o){if(i.cachedData&&i.cachedData.data)return this.processVisualContainerCache(t,i,r,o);var n=this.promiseFactory.defer();return n.reject(e.telemetry.VisualInitialLoadTypeWarning.CacheMissing),n.promise},t.prototype.processVisualContainerCache=function(t,i,r,s){var l,c=this,u=this.promiseFactory.defer(),p=jsCommon.GzipUtility.uncompress(i.cachedData.data);try{l=JSON.parse(p)}catch(t){return u.reject(e.telemetry.VisualInitialLoadTypeWarning.JsonParseFailed),u.promise}var d=null;try{d=n.read(31,l)}catch(t){return u.reject(e.telemetry.VisualInitialLoadTypeWarning.DsrReadFailed),u.promise}if(!d)return u.reject(e.telemetry.VisualInitialLoadTypeWarning.DataObjectNull),u.promise;var v={data:l},h=a.getVisualType(i),g=this.visualPlugin.capabilities(h),f=g?g.objects:void 0,m=jsCommon.JsonExtensions.tryParseJSON(i.cachedData.transforms),y=m?o.deserializeDataViewTransformActions(m,f):void 0,w=this.promiseFactory.defer(),C={result:{dataViewSource:v,dataReaderResult:d},dataProxyQuery:{transforms:y,warnings:d.warnings?d.warnings:void 0,error:d.error,options:w.promise},schema:void 0,updateServerVisualContainerCache:!1};return d.error||!y?u.reject(d.error?e.telemetry.VisualInitialLoadTypeWarning.DsrHasOdataError:e.telemetry.VisualInitialLoadTypeWarning.DataTransformsMissing):(u.resolve({isFinal:i.useInitialCachedQuery,result:C}),i.useInitialCachedQuery&&this.conceptualSchemaProxy.get(t).then((function(e){var o=c.visualDataProxyService.generateQuery({dataSources:t,schema:e,config:i.config.singleVisual,hostServices:s,visualQueryGenerator:c.visualQueryGenerator,isLoadMore:!1,isInitialLoad:!1,allowCache:!0,viewport:r});c.dataProxy.setLocalCacheResult(o.options,l),w.resolve(o.options)}))),u.promise},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t){return new n(e,t)}var r=jsCommon.JsonComparer,o=jsCommon.PerfTimer;t.createExploreVisualDataProxyService=i;var n=(function(){function t(t,i){this.dataProxy=t,this.promiseFactory=e.createJQueryPromiseFactory(),this.filterGenerator=i}return t.prototype.generateQuery=function(e){var t=o.start("visualQueryGenerator("+e.config.visualType+")"),i=e.visualQueryGenerator.execute({config:e.config,dataSources:e.dataSources,schema:e.schema,additionalFilters:e.hostServices.getFilters(this.filterGenerator,e.schema),restartToken:e.preferCurrentData?this.currentDataToken:this.moreDataToken,cacheResponseOnServer:e.isInitialLoad,allowCache:e.allowCache,dataWindow:e.viewport});return t(),i},t.prototype.runQuery=function(t){var i=this,o=this.promiseFactory.defer(),n=this.moreDataToken;if(t.isLoadMore||(this.moreDataToken=void 0),t.isLoadMore&&!this.moreDataToken)o.reject();else{var a=t.generatedQuery||this.generateQuery(t);if(a)if(a.error)o.reject(a.error),this.generatedQuery=void 0;else{if(!(this.generatedQuery&&t.preferCurrentData&&r.equals(a.options,this.generatedQuery.options))){var s=this.dataProxy.execute(a.options);return s.then((function(e){i.generatedQuery=a,i.currentDataToken=i.moreDataToken,i.moreDataToken=e&&e.dataReaderResult&&e.dataReaderResult.restartToken,o.resolve(e)}),(function(e){i.generatedQuery=void 0,o.reject(e)})),s}o.resolve(null),this.generatedQuery=a,this.moreDataToken=n}else this.generatedQuery=void 0,o.reject()}return e.RejectablePromise2(o)},t.prototype.canLoadMore=function(){return null!=this.moreDataToken},t.prototype.lastExecutedQuery=function(){return this.generatedQuery},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r){return new o(e,t,i,r)}var r={"0.00 %;-0.00 %;0.00 %":"Percentage","0.0 %;-0.0 %;0.0 %":"Percentage1"},o=(function(){function t(e,t,i,r){this.promiseFactoryValue=e,this.moduleLoader=t,this.geolocationService=i,this.geocoderService=r}return t.initialize=function(i){e.visuals.valueFormatter.setLocaleOptions(t.createLocaleOptions(i)),e.visuals.TooltipManager.setLocalizedStrings(t.createTooltipLocaleOptions(i)),e.data.DataViewTransform.setLocalizationOptions(t.createDataViewTransformLocalizationOptions(i))},t.createLocaleOptions=function(e){return{null:e.get("NullValue"),true:e.get("BooleanTrue"),false:e.get("BooleanFalse"),NaN:e.get("NaNValue"),infinity:e.get("InfinityValue"),negativeInfinity:e.get("NegativeInfinityValue"),beautify:function(i){return t.beautify(e,i)},describe:function(i){return t.describeUnit(e,i)},restatementComma:e.get("FilterRestatement_Comma"),restatementCompoundAnd:e.get("FilterRestatement_CompoundAnd"),restatementCompoundOr:e.get("FilterRestatement_CompoundOr")}},t.createTooltipLocaleOptions=function(t){return{highlightedValueDisplayName:t.get(e.visuals.ToolTipComponent.highlightedValueDisplayNameResorceKey)}},t.createDataViewTransformLocalizationOptions=function(t){return{quarterPrefix:t.get(e.visuals.ForecastHelper.quarterHierarchyLevelPrefixResorceKey)}},t.prototype.getLocalizedString=function(t){return e.common.localize.get(t)},t.prototype.onDragStart=function(){},t.prototype.canSelect=function(){return!1},t.prototype.onSelecting=function(){},t.prototype.onSelect=function(){},t.prototype.onContextMenu=function(){},t.prototype.loadMoreData=function(){},t.prototype.persistProperties=function(e){},t.prototype.onCustomSort=function(e){},t.prototype.getViewMode=function(){return 0},t.prototype.getEditMode=function(){return 0},t.prototype.setWarnings=function(e){},t.prototype.setToolbar=function(e){},t.prototype.shouldRetainSelection=function(){return!1},t.prototype.geocoder=function(){return this.geocoderService},t.prototype.geolocation=function(){return this.geolocationService},t.prototype.locale=function(){return e.common.unmappedCultureInfo},t.prototype.promiseFactory=function(){return this.promiseFactoryValue},t.prototype.analyzeFilter=function(t){return e.explore.services.createAnalyzedFilter(t,!1)},t.prototype.getIdentityDisplayNames=function(e){},t.prototype.setIdentityDisplayNames=function(e){},t.prototype.tooltips=function(){},t.prototype.telemetry=function(){},t.prototype.loader=function(){return this.moduleLoader},t.prototype.getUIComponentFactory=function(){},t.prototype.applyJsonFilter=function(e,t,i){},t.beautify=function(e,t){var i=r[t];return i?e.getOptional(i)||t:t},t.describeUnit=function(e,t){var i=t===-1?"Auto":t.toString(),r=e.getOptional("DisplayUnitSystem_E"+i+"_Title"),o=t<=0?"{0}":e.getOptional("DisplayUnitSystem_E"+i+"_LabelFormat");if(r||o)return{title:r,format:o}},t})();t.VisualHostServices=o,t.createVisualHostServices=i})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,a){return new n(e,t,i,r,o,a)}var r=jsCommon.ArrayExtensions,o=e.data.SQExpr;t.createVisualSortHelper=i;var n=(function(){function e(e,t,i,r,o,n){this.setting=e,this.model=t,this.sort=i,this.undoRedo=r,this.timeout=o,this.visualAuthoring=n,this.sortDelay=500}return e.prototype.resetSortSettings=function(e,t){this.setting.defaultSortBehavior=t,this.setting.sortableFields=e},e.prototype.toggleSort=function(e,t){var i=this;this.sortPromise&&this.timeout.cancel(this.sortPromise),this.sortPromise=this.timeout((function(){i.undoRedo.register("VisualContainerToggleSort",(function(){var r=!1;return e?(t&&(e.sortDirection=t),i.toggleSortByField(e),r=!0):void 0!==i.model.readOnlyState.actualSortDirection&&(i.sortByOrder(),r=!0),i.sortPromise=void 0,r}))}),this.sortDelay)},e.prototype.toggleDirection=function(e){return 1===e?2:1},e.prototype.sortByOrder=function(){var e=this.model.contract.config.singleVisual.query.defn.orderBy();if(!_.isEmpty(e)){for(var t=0,i=e;t<i.length;t++){var r=i[t];r.direction=this.toggleDirection(this.model.readOnlyState.actualSortDirection)}this.visualAuthoring.setOrderBy(this.model.contract,e)}},e.prototype.toggleSortByField=function(e){var t=this,i=_.map(e.exprs,(function(t){return{direction:e.sortDirection||2,expr:t.expr}})),r=this.model.contract.config.singleVisual.query;e.active?this.visualAuthoring.removeOrderBy(this.model.contract,i.map((function(e){return e.expr}))):(this.sort.resetSort(r),this.resetSortableFieldsStatus(!1,!1),this.visualAuthoring.setOrderBy(this.model.contract,i));var o=_.find(this.setting.sortableFields,(function(i){return t.compareSortableFieldExprs(e,i)}));o&&(o.active=!e.active)},e.prototype.applySortByFields=function(e){var t=this;this.sortPromise&&this.timeout.cancel(this.sortPromise),this.resetSortableFieldsStatus(!1,!0);var i=this.findMatchingSortableFields(e);this.sortPromise=this.timeout((function(){t.undoRedo.register("VisualContainerApplySort",(function(){for(var e=[],r=0,o=i;r<o.length;r++)for(var n=o[r],a=0,s=n.exprs;a<s.length;a++){var l=s[a];e.push({expr:l.expr,direction:n.sortDirection})}var c=t.model.contract,u=c.config.singleVisual.query;return t.sort.resetSort(u),t.visualAuthoring.setOrderBy(c,e),t.sortPromise=void 0,!0}))}),this.sortDelay)},e.prototype.findMatchingSortableFields=function(e){var t=[],i=this.setting.sortableFields;if(_.isEmpty(i)||_.isEmpty(e))return[];for(var r=0,o=i;r<o.length;r++){for(var n=o[r],a=!1,s=null,l=function(t){var i=_.find(e,(function(e){return e.queryName===t.name}));if(!i)return a=!1,"break";if(null==s)s=i.sortDirection;else if(s!==i.sortDirection)return a=!1,"break";a=!0},c=0,u=n.exprs;c<u.length;c++){var p=u[c],d=l(p);if("break"===d)break}a&&(n.sortDirection=s,n.active=!0,t.push(n))}return t},e.prototype.areAllSortDescriptorsIncluded=function(e,t){for(var i=0,r=e;i<r.length;i++){for(var o=r[i],n=!1,a=0,s=t;a<s.length;a++){for(var l=s[a],c=0,u=l.exprs;c<u.length;c++){var p=u[c];if(p.name===o.queryName){n=!0;break}}if(n)break}if(!n)return!1}return!0},e.prototype.resetSortableFieldsStatus=function(e,t){if(this.setting.sortableFields)for(var i=0,r=this.setting.sortableFields;i<r.length;i++){var o=r[i];o.active=e,t&&(o.sortDirection=void 0)}},e.prototype.compareSortableFieldExprs=function(e,t){var i=e.exprs,n=t.exprs;return r.sequenceEqual(i,n,(function(e,t){return o.equals(e.expr,t.expr)}))},e})();t.VisualSortHelper=n})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new p(e,t,i)}var r=e.visuals.ToolTipComponent;t.createVisualHostTooltipService=i;var o=350,n=350,a=350,s=350,l=500,c=12,u="body",p=(function(){function t(t,i,o){this.$timeout=t,this.parentContainer=i||$(u);var n=this.parentContainer.get(0);this.tooltipContainer=o||new e.visuals.TooltipContainer(n,r.DefaultTooltipOptions)}return t.prototype.show=function(e){var t=this;this.clearTooltipTimeout();var i;i=this.tooltipContainer.isVisible()?16:e.isTouchEvent?a:o,this.move(e),this.delayedTooltipPromise=this.$timeout((function(){t.tooltipContainer.show(e.dataItems),t.startLongPause(e.identities)}),i)},t.prototype.move=function(e){var t=this.getClickedArea(e.coordinates,e.isTouchEvent);this.tooltipContainer.move(e.dataItems,t),this.startLongPause(e.identities)},t.prototype.hide=function(t){var i,r=this;i=t.immediately?0:t.isTouchEvent?s:n,this.clearTooltipTimeout(),this.delayedTooltipPromise=this.$timeout((function(){r.tooltipContainer.hide(),e.visuals.TooltipManager.ToolTipInstance.hide()}),i),this.longPauseDebounced&&(this.longPauseDebounced.cancel(),this.longPauseDebounced=void 0)},t.prototype.container=function(){return this.parentContainer.get(0)},t.prototype.enabled=function(){return e.visuals.TooltipManager.ShowTooltips},t.prototype.onLongPause=function(e){this.longPauseDebounced=void 0},t.prototype.startLongPause=function(e){var t=this;this.longPauseDebounced||(this.longPauseDebounced=_.debounce((function(){return t.onLongPause(e)}),l)),this.longPauseDebounced()},t.prototype.clearTooltipTimeout=function(){null!=this.delayedTooltipPromise&&(this.$timeout.cancel(this.delayedTooltipPromise),this.delayedTooltipPromise=void 0)},t.prototype.getClickedArea=function(t,i){var r=0,o=t[0],n=t[1];if(i){r=c;var a=r/2;o=Math.max(o-a,0),n=Math.max(n-a,0)}return new e.visuals.Rect(o,n,r,r)},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t){return new o(e,t)}var r=e.extensibility.convertVisualEventType;t.createVisualHostTelemetryService=i;var o=(function(){function t(e,t){this.telemetryService=e,this.visualType=t,this.instanceId=jsCommon.Utility.generateGuid()}return t.prototype.trace=function(t,i){var o=r(t);if(o&&e.telemetry[o]){var n=e.telemetry[o];this.telemetryService.logEvent(n,this.visualType,this.instanceId,i)}},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){var t=e.sectionStatus.currentSectionNumber;return t<0&&e.exploration.sections.length>0&&(t=0),e.exploration.sections[t]}var o=e.explore.services.DrillToDetailsContext,n=e.explore.services.selectionUtils,a=(function(){function i(){}return i.createUndoRedoHandler=function(i,a,s,l,c,u,p,d,v,h,g){return{takeSnapshot:function(t){var o=r(i).contract.name,n=e.explore.services.selectionUtils.getSelectedVisuals(s),a=[];if(n)for(var v=i.exploration.exploreCanvas.visualContainers,h=0;h<n.length;h++)for(var g=0;g<v.length;g++)if(n[h]===v[g].contract){a.push(g);break}var f,m={withPopOut:!0,withTransientPages:!0},y=l.getContext();f=t&&null!=t.canvasLayout?t.canvasLayout:c&&c.getCurrentLayout();var w=u.serializeExploration(i.exploration.contract,m);return{contract:w,linguisticSchema:d.getSchema(i.exploration.contract.reportId),selectedSlide:o,selectedVisualsIndex:a,drillToDetailsState:y?y.toSnapshot(p):void 0,canvasLayout:f,getReferences:function(){var e=u.deserializeExploration(w,[],!0);return u.getReferencedRegisteredResources(e)}}},rollback:function(e){l.clearContext();var f=u.deserializeExploration(e.contract,[],!0),m=u.getReferencedRegisteredResources(f);g.restoreReferences(_.map(m,(function(e){return e.name}))).then((function(){var u=p.getCurrentExploration();if(u){var g=t.services.getRegisteredResourcePackage(u.resourcePackages);if(!g||_.isEmpty(g.items)){var m=t.services.getRegisteredResourcePackage(f.resourcePackages);m&&(m.items=[])}else{var m=t.services.ensureRegisteredResourcePackage(f);m.items=_.map(g.items,(function(e){return _.clone(e)}))}}h.removeAllCustomVisuals();var y=_.filter(f.resourcePackages,(function(e){return 0===e.type}));h.ensurePlugins(y).finally((function(){v.publishToChannel(t.services.events.visualPluginsChanged)}));var w=t.SectionUtils.findSectionIndexForSectionName(f,e.selectedSlide);i.sectionStatus.currentSectionNumber=w,i.exploration=t.viewModels.ViewModelFactory.convertExploration(f,e.canvasLayout,w),d.setSchema(f.reportId,e.linguisticSchema);var C=r(i);p.loadExploration(i.exploration.contract),p.goto(C.contract),a((function(){var t=i.exploration.exploreCanvas.visualContainers,r=[];if(e.selectedVisualsIndex.length>0){for(var a=0;a<e.selectedVisualsIndex.length;a++)t.length>e.selectedVisualsIndex[a]&&r.push(t[e.selectedVisualsIndex[a]].contract);n.selectVisualContainers(r,s),e.drillToDetailsState&&l.setContext(o.fromSnapshot(e.drillToDetailsState,p))}else s.clearSelection();c.changeFormFactor(e.canvasLayout,i)}),0)}))}}},i})();i.ExploreUndoRedoHandlerUtility=a})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),angular.module("powerbi.explore").run(["$templateCache",function(e){e.put("components/boxGrid/boxGrid.html",'<triggered-recompile trigger="$ctrl.viewModel"><svg class="box-grid" ng-attr-width="{{::$ctrl.getSvgWidth()}}" ng-attr-height="{{::$ctrl.getSvgHeight()}}"><g ng-repeat="row in ::$ctrl.getRows()"><rect ng-repeat="column in ::$ctrl.getColumns()" ng-attr-width="{{::$ctrl.getBoxWidth()}}" ng-attr-height="{{::$ctrl.getBoxHeight()}}" ng-attr-x="{{::$ctrl.getBoxX(column)}}" ng-attr-y="{{::$ctrl.getBoxY(row)}}"></rect></g></svg></triggered-recompile>'),e.put("components/canvasVisualErrorOverlay/canvasVisualErrorOverlay.html",'<div class="errorMessage"><div ng-switch="$ctrl.errorInfo.overlayType"><div class="glyphicon pbi-glyph-error glyph-med" ng-switch-default></div><div class="glyphicon pbi-glyph-blockedsite glyph-med" ng-switch-when="1"></div></div><div><span class="errorSpan" ng-bind="$ctrl.errorInfo.details.message" ng-show="$ctrl.showErrorMessage"/><ng-switch on="$ctrl.errorInfo.details.errorType"><a localize="VisualContainer_ShowErrorDetails" localize-tooltip="VisualContainer_ShowErrorDetails" class="errorSeeMore" href ng-click="$ctrl.showErrorDetails()" ng-if="!$ctrl.errorInfo.hideSeeDetails" ng-switch-default/><a localize="LearnMore" localize-tooltip="VisualContainer_LearnMoreLinkText" class="errorSeeMore" ng-href="{{ $ctrl.errorInfo.details.helpLink }}" target="_blank" ng-switch-when="1"/></ng-switch></div><div class="fixThisContainer"> <button class="primary" ng-show="$ctrl.isFixButtonVisible" ng-click="$ctrl.fixErrors() "><ng-switch on="$ctrl.errorInfo.fixableError"><span ng-switch-when="1" localize="Fix_This" localize-tooltip="FixReferences_ToolTip"></span><span ng-switch-when="2" localize="Fix_This" localize-tooltip="RelationshipDetection_Tooltip"></span><span ng-switch-when="3" localize="Fix_This" localize-tooltip="FixReferences_ToolTip"></span><span ng-switch-when="4" localize="VisualContainer_EnableScriptVisuals"></span></ng-switch></button></div></div>'),e.put("components/clusteringDialog/clusteringDialog.html",'<dialog-frame><dialog-header><span localize="ClusteringDialog_Title"></span></dialog-header><dialog-body><section class="topPanel"><div class="row"><div class="cell cellContentFlowX"><label localize="GroupsDialog_Name"></label> <input type="text" spellcheck="false" ng-model="$ctrl.viewModel.groupingColumnName" maxlength="100"/></div><div class="cell cellContentFlowX lastItemInRow"><label localize="GroupsDialog_FromColumnName"></label> <input type="text" spellcheck="false" ng-model="::$ctrl.viewModel.sourcePropertyName" disabled/></div></div><div class="row"><label localize="ClusteringDialog_Description"></label> <input type="text" spellcheck="false" ng-model="$ctrl.viewModel.description" maxlength="250"/></div></section><section class="mainPanel"><div class="scrollableContainer cell" ng-if="$ctrl.viewModel.partitions.length> 0"><div class="partitionsList"><div class="partitionNode" ng-click="$ctrl.onNodeClick(partition, $event)" ng-class="{\'editDisabled\': !partition.isNameEditable,                                    \'isNameInvalid\': partition.hasNameCollision}" tooltip tooltip-config="$ctrl.getTooltipConfig(partition)" ng-repeat="partition in ::$ctrl.viewModel.partitions"><editable-label class="unselectable" view-model="partition" cancel="$ctrl.cancelEditName(partition)" ng-dblclick="$ctrl.startEditName(partition, $event)" on-blur="$ctrl.rename(partition, newName)" editable="!!partition.isNameEditable && !!partition.isEditingName" disable-click="true" input-match-label-width="false" custom-tooltip="true"></editable-label><label ng-bind-template="({{::partition.numberOfItems}})"></label></div></div></div><form name="$ctrl.clusteringParametersForm" class="parametersContainer cell lastItemInRow"><label class="numberOfClustersLabel" localize="ClusteringDialog_NumberOfClusters"></label> <label class="clustersUpdateWarningLabel" ng-if="$ctrl.viewModel.partitions.length>0" localize="ClusteringDialog_DiscardNames"></label> <input type="number" class="numberOfClustersParameter" ng-model="$ctrl.viewModel.numberOfClusters" localize-attr="{placeholder: \'ClusteringDialog_NumberOfClustersAutoPlaceholder\'}" ng-min="1" ng-max="25" ng-pattern="/^\\d+$/"/><div class="warning" ng-if="!$ctrl.clusteringParametersForm.$valid"><i class="errorIcon"></i><span localize="ClusteringDialog_NumberClustersOutOfRange"></span></div></form></section><section class="messagePanel"><div class="warning" ng-if="$ctrl.viewModel.errorMessage"><i class="errorIcon"></i><span ng-bind="$ctrl.viewModel.errorMessage"></span></div><div class="warning" ng-if="$ctrl.isGroupingColumnNameEmpty()"><i class="errorIcon"></i><span localize="ClusteringDialog_ClusteringColumnNameCannotBeEmpty"></span></div><div class="warning" ng-if="$ctrl.viewModel.hasDuplicatePartitionNames"><i class="errorIcon"></i><span localize="ClusteringDialog_DuplicateNames"></span></div></section></dialog-body><dialog-footer> <button type="submit" localize="OK_ButtonText" ng-disabled="!$ctrl.canCommit()" ng-click="$ctrl.commit()" class="actionButton primary" ng-disabled="!$ctrl.clusteringParametersForm.$valid"></button> <button class="cancel" autofocus localize="Cancel_ButtonText" ng-click="$ctrl.cancel()"></button></dialog-footer></dialog-frame>'),e.put("components/clusteringDialog/clusteringDialogDefinition.html",'<clustering-dialog args="args"></clustering-dialog>'),e.put("components/conditionalFormattingDialog/conditionalFormattingDialog.html",'<form name="conditionalFormattingForm"><dialog-frame><dialog-header><span localize="ConditionalFormattingDialog_Title"></span></dialog-header><dialog-body><p class="description" localize="ConditionalFormattingDialog_Description"></p><section><fieldset><legend localize="ConditionalFormattingDialog_BaseValueHeader"></legend><h2 class="displayNameSelectItem" ng-bind="::$ctrl.viewModel.baseExprDisplayName"></h2></fieldset></section><section class="sectionSettings"><fieldset><legend localize="ConditionalFormattingDialog_FormatNull" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.nullStrategyOption" ng-options="element.value for element in ::$ctrl.viewModel.nullStrategyOptions track by element.id"/><color-picker class="whiteTheme" color="$ctrl.viewModel.gradientSettings.nullColor" on-change-color="$ctrl.updateGradientNullColor" type="::$ctrl.viewModel.colorPickerType" ng-style="{\'visibility\': $ctrl.viewModel.nullStrategyOption.disableInput ? \'hidden\' : \'visible\'}"></color-picker></section></fieldset></section><section class="sectionSettings"><fieldset><legend localize="ConditionalFormattingDialog_MinimumHeader" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.minimumSelectedOption" ng-change="$ctrl.selectedOptionsChange($ctrl.viewModel.minimumSelectedOption)" ng-options="element.value for element in ::$ctrl.viewModel.minimumSelectOptions track by element.id"/><color-picker class="whiteTheme" color="$ctrl.viewModel.gradientSettings.minColor" on-change-color="$ctrl.updateGradientMinColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></section> <input type="number" ng-disabled="$ctrl.viewModel.minimumSelectedOption.disableInput" ng-required="!$ctrl.viewModel.minimumSelectedOption.disableInput" ng-model="$ctrl.viewModel.gradientSettings.minValue" localize-attr="{placeholder: \'ConditionalFormattingDialog_LowestValuePlaceHolder\'}" localize-tooltip="ConditionalFormattingDialog_LowestValuePlaceHolder"/></fieldset><fieldset ng-if="$ctrl.viewModel.gradientSettings.diverging"><legend localize="ConditionalFormattingDialog_CenterHeader" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.centerSelectedOption" ng-change="$ctrl.selectedOptionsChange($ctrl.viewModel.centerSelectedOption)" ng-options="element.value for element in ::$ctrl.viewModel.centerSelectOptions track by element.id"/><color-picker class="whiteTheme" color="$ctrl.viewModel.gradientSettings.midColor" on-change-color="$ctrl.updateGradientMidColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></section> <input type="number" ng-disabled="$ctrl.viewModel.centerSelectedOption.disableInput" ng-required="!$ctrl.viewModel.centerSelectedOption.disableInput" ng-model="$ctrl.viewModel.gradientSettings.midValue" localize-attr="{placeholder: \'ConditionalFormattingDialog_MiddleValuePlaceHolder\'}" localize-tooltip="ConditionalFormattingDialog_MiddleValuePlaceHolder"/></fieldset><fieldset><legend localize="ConditionalFormattingDialog_MaximumHeader" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.maximumSelectedOption" ng-change="$ctrl.selectedOptionsChange($ctrl.viewModel.maximumSelectedOption)" ng-options="element.value for element in ::$ctrl.viewModel.maximumSelectOptions track by element.id"/><color-picker class="whiteTheme" color="$ctrl.viewModel.gradientSettings.maxColor" on-change-color="$ctrl.updateGradientMaxColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></section> <input type="number" ng-disabled="$ctrl.viewModel.maximumSelectedOption.disableInput" ng-required="!$ctrl.viewModel.maximumSelectedOption.disableInput" ng-model="$ctrl.viewModel.gradientSettings.maxValue" localize-attr="{placeholder: \'ConditionalFormattingDialog_HighestValuePlaceHolder\'}" localize-tooltip="ConditionalFormattingDialog_HighestValuePlaceHolder"/></fieldset></section><section class="checkBoxSettings"> <input type="checkbox" id="divergingCheckbox" ng-model="$ctrl.viewModel.gradientSettings.diverging" ng-change="$ctrl.updateGradientBar()" onclick="event.stopPropagation()"/><label for="divergingCheckbox" onclick="event.stopPropagation()"/><h2 localize="ConditionalFormattingDialog_Diverging" ng-click="$ctrl.updateDiverging()"></h2></section><section class="gradientValue"><gradient-bar ng-model="$ctrl.viewModel.gradientBarValue"></gradient-bar></section></dialog-body><dialog-footer> <button autofocus type="submit" ng-click="conditionalFormattingForm.$valid && $ctrl.apply()" class="actionButton primary" localize="OK_ButtonText"></button> <button class="cancel" autofocus localize="Cancel_ButtonText" ng-click="$ctrl.cancel()"></button></dialog-footer></dialog-frame></form>'),
e.put("components/conditionalFormattingDialog/conditionalFormattingDialogDefinition.html",'<conditional-formatting-dialog view-model="viewModel"></conditional-formatting-dialog>'),e.put("components/dataBarsDialog/dataBarsDialog.html",'<form name="dataBarsForm"><dialog-frame><dialog-header><span localize="DataBarsDialog_Title"></span></dialog-header><dialog-body><p class="description" localize="DataBarsDialog_Description"></p><section><fieldset><legend localize="ConditionalFormattingDialog_BaseValueHeader"></legend><h2 class="displayNameSelectItem" ng-bind="::$ctrl.viewModel.fieldDisplayName"></h2></fieldset></section><section class="checkBoxSettings"> <input type="checkbox" id="hideTextCheckbox" ng-model="$ctrl.viewModel.hideText" onclick="event.stopPropagation()"/><label for="hideTextCheckbox" onclick="event.stopPropagation()"/><h2 localize="DataBarsDialog_HideText" ng-click="$ctrl.viewModel.hideText = !$ctrl.viewModel.hideText"></h2></section><section class="sectionSettings"><fieldset><legend localize="ConditionalFormattingDialog_MinimumHeader" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.minimumSelectedOption" ng-options="element.value for element in ::$ctrl.viewModel.minimumSelectOptions track by element.id"/></section> <input type="number" ng-disabled="$ctrl.viewModel.minimumSelectedOption.disableInput" ng-required="!$ctrl.viewModel.minimumSelectedOption.disableInput" ng-model="$ctrl.viewModel.minValue" localize-attr="{placeholder: \'ConditionalFormattingDialog_LowestValuePlaceHolder\'}" localize-tooltip="ConditionalFormattingDialog_LowestValuePlaceHolder"/></fieldset><fieldset><legend localize="ConditionalFormattingDialog_MaximumHeader" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.maximumSelectedOption" ng-options="element.value for element in ::$ctrl.viewModel.maximumSelectOptions track by element.id"/></section> <input type="number" ng-disabled="$ctrl.viewModel.maximumSelectedOption.disableInput" ng-required="!$ctrl.viewModel.maximumSelectedOption.disableInput" ng-model="$ctrl.viewModel.maxValue" localize-attr="{placeholder: \'ConditionalFormattingDialog_HighestValuePlaceHolder\'}" localize-tooltip="ConditionalFormattingDialog_HighestValuePlaceHolder"/></fieldset></section><section class="sectionSettings"><fieldset><legend localize="DataBarsDialog_PositiveBar" localize-tooltip></legend><color-picker class="whiteTheme colorpicker-left" color="$ctrl.viewModel.positiveColor.solid.color" on-change-color="$ctrl.updatePositiveColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></fieldset><fieldset><legend localize="DataBarsDialog_BarDirection" localize-tooltip></legend> <select ng-model="$ctrl.viewModel.barDirectionOption" ng-options="element.value for element in ::$ctrl.viewModel.barDirectionOptions track by element.id"/></fieldset></section><section class="sectionSettings"><fieldset><legend localize="DataBarsDialog_NegativeBar" localize-tooltip></legend><color-picker class="whiteTheme colorpicker-left" color="$ctrl.viewModel.negativeColor.solid.color" on-change-color="$ctrl.updateNegativeColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></fieldset><fieldset><legend localize="DataBarsDialog_BarAxis" localize-tooltip></legend><color-picker class="whiteTheme" color="$ctrl.viewModel.axisColor.solid.color" on-change-color="$ctrl.updateAxisColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></fieldset></section></dialog-body><dialog-footer> <button autofocus type="submit" ng-click="dataBarsForm.$valid && $ctrl.apply()" class="actionButton primary" localize="OK_ButtonText"></button> <button class="cancel" autofocus localize="Cancel_ButtonText" ng-click="$ctrl.cancel()"></button></dialog-footer></dialog-frame></form>'),e.put("components/dataBarsDialog/dataBarsDialogDefinition.html",'<databars-dialog view-model="viewModel"></databars-dialog>'),e.put("components/dateTimePicker/dateTimePicker.html",'<div class="datetimePicker" pbi-lazy-load-contents="$ctrl.moduleConfig"> <input type="text" class="inputFieldInSlice" ng-blur="$ctrl.dateTextUpdated()" ng-model="$ctrl.textVal" ng-class="{\'ng-invalid\': $ctrl.inputInvalid}" placeholder="{{::$ctrl.placeholder}}"/> <button class="calendar" type="button" dropdown-overlay-invoke="calendar"></button><dropdown-overlay class="calendarDropDown" dropdown-overlay-name="calendar"><datepicker class="calendar" ng-model="$ctrl.dateVal" ng-change="$ctrl.dateSelected()" onclick="event.stopPropagation()" show-weeks="false" min-date="$ctrl.validators.min" max-date="$ctrl.validators.max"></datepicker></dropdown-overlay></div>'),e.put("components/dotGrid/dotGrid.html",'<div class="container"><div class="hideEdgeDots"><div class="background"></div></div></div>'),e.put("components/explorationFooter/explorationFooter.html",'<div class="explorationNavigationContent unselectable {{$ctrl.getModeString()}}" tabindex="0" focus-group="ctrl-F6"><div class="background"></div><ul class="pane sections" role="tablist"><carousel auto-resize="true"><li class="section static" ng-if="$ctrl.isEditMode()" ng-class="{\'selected\' : page.selected}" ng-repeat="page in $ctrl.viewModel.exploration.sections"><exploration-navigation-tab class="section dynamic" view-model="page" is-editing="true" tab-index="$index" ng-style="page.style" is-only-tab="$ctrl.viewModel.exploration.sections.length === 1"></exploration-navigation-tab></li><li class="section static" ng-if="!$ctrl.isEditMode()" ng-class="{selected : page.selected}" ng-repeat="page in $ctrl.viewModel.exploration.sections"><exploration-navigation-tab class="section dynamic" view-model="page" is-editing="false" tab-index="$index" ng-style="page.style"></exploration-navigation-tab></li></carousel><li ng-if="$ctrl.isEditMode()" class="section static create" ng-click="$ctrl.createSection()" localize-tooltip="Carousel_NewPage"><div class="thumbnail-container"><div class="thumbnail"></div></div></li></ul></div>'),e.put("components/fieldPicker/fieldPicker.html",'<div class="fieldPicker" ng-right-click="$ctrl.showMenu($event)" drop="$ctrl.dropConfig" drop-handler="$ctrl.drop()" drop-action="$ctrl.getDropAction()" ng-class="{\'noValue\': !$ctrl.ngModel.$viewValue}"><span ng-bind="$ctrl.expressionDisplayName" title="{{$ctrl.tooltip}}"></span><pbi-icon ng-if="$ctrl.menuItems.length> 0" size="micro" name="flickup" ng-click="$ctrl.showMenu($event)"></pbi-icon><pbi-icon ng-if="$ctrl.ngModel.$viewValue" size="micro" name="close" ng-click="$ctrl.deleteField()"></pbi-icon></div>'),e.put("components/includeExcludeFilter/includeExcludeFilter.html",'<div class="cardHeader"><i ng-if="::$ctrl.filterViewModel.invalid" class="filterPaneIcon error"/><span class="caption trimmedTextWithEllipsis item-fill" ng-bind="$ctrl.viewModel.restatement"></span> <button class="fieldWellIcon dropDown item-auto" ng-class="$ctrl.isExpanded ? \'expand\' : \'collapse\'" ng-click="$ctrl.expand()"></button> <button class="delete glyphicon pbi-glyph-close glyph-micro item-auto" ng-click="$ctrl.deleteFilter($event, filterViewModel)" localize-tooltip="FilterPane_DeleteFilter"></button></div><div class="include-exclude-filter-items" ng-if="$ctrl.isExpanded"><ng-scrollbars ng-scrollbars-config="::$ctrl.scrollbarsConfig"><div class="include-exclude-filter-item flex" ng-repeat="dataPoint in $ctrl.viewModel.points"><div class="smallFontSize trimmedTextWithEllipsis unselectable item-fill" ng-bind-attr="{title: dataPoint.text}" ng-bind="dataPoint.text"></div> <button type="button" class="delete glyphicon pbi-glyph-close glyph-micro" ng-click="$ctrl.delete($event, dataPoint, $index)"></button></div></ng-scrollbars></div>'),e.put("components/instancePicker/instancePicker.html",'<visual ng-if="$ctrl.ngModel.$viewValue.field" class="slicerVisual" view-model="$ctrl.visual"></visual>'),e.put("components/mobileVisualizationPane/mobileVisualizationPane.html",'<article class="sidePane rightSidePane visualizationPane smallFontSize"><div class="paneHeader"><div class="toggleBtn"><h2 class="sidePaneHorizontalTitle unselectable sidePaneTitle largeFontSize trimmedTextWithEllipsis" localize="VisualizationPane_Title"></h2><div class="paneClearButton" ng-click="$ctrl.clearAllVisualsFromCanvasPressed()"><div class="glyphicon pbi-glyph-eraser glyph-mini"></div><h2 class="paneClearTitle unselectable smallFontSize" localize="RemoveAllVisuals_Title"></h2></div></div></div><div class="paneContents flex"><div class="sectionHost item-fill"><ng-scrollbars ng-scrollbars-config="::$ctrl.scrollbarsConfig"><ul><visual-container-thumbnail ng-repeat="visual in $ctrl.visuals" visual="visual" viewport="$ctrl.viewport" drag="visual-container-thumbnail" drag-context="{ source: visual }"></visual-container-thumbnail></ul></ng-scrollbars></div></div></article>'),e.put("components/penAnnotation/penAnnotation.html",'<canvas class="penAnnotationCanvas"></canvas>'),e.put("components/tableViewDialog/tableViewDialog.html",'<dialog-frame><dialog-header><span localize="$ctrl.titleKey"></span></dialog-header><dialog-body><section class="table" ng-if="::($ctrl.columnNames && $ctrl.columnNames.length> 0) || ($ctrl.tableValues && $ctrl.tableValues.length > 0)"><div class="tableViewDialogOverflow"><table><thead ng-if="::($ctrl.columnNames && $ctrl.columnNames.length> 0)"><tr><th ng-repeat="th in ::$ctrl.columnNames track by $index" ng-bind="::th"></th></tr></thead><tbody ng-if="::($ctrl.tableValues && $ctrl.tableValues.length> 0)"><tr ng-repeat="tr in ::$ctrl.tableValues track by $index"><td ng-repeat="td in ::tr track by $index" ng-bind="::td"></td></tr></tbody></table></div></section></dialog-body><dialog-footer> <button autofocus type="submit" ng-click="$ctrl.close()" class="primary" localize="TableViewDialog_CloseButtonText"></button></dialog-footer></dialog-frame>'),e.put("components/tableViewDialog/tableViewDialogDefinition.html",'<table-view-dialog title-key="titleKey" column-names="columnNames" table-values="tableValues"></table-view-dialog>'),e.put("components/topNFilter/topNFilter.html",'<form name="$ctrl.topNFilterForm" class="topNFilter" ng-submit="$ctrl.applyFilter()" ng-class="{ invalid: $ctrl.viewModel.cardType.invalid }"><pbi-alert ng-if="$ctrl.viewModel.cardType.invalid" kind="\'warning\'" message-warning="\'TopNFilter_SingleTopNAllowedWarning\'"></pbi-alert><fieldset class="filterOptions" ng-disabled="$ctrl.viewModel.cardType.invalid"><legend localize="TopNFilter_ShowItems"></legend><div class="topNSelector topNInputArea flex"> <select class="item-fill topNInputBox" ng-options="filterType.text for filterType in ::$ctrl.vm.filterTypes track by filterType.text" ng-model="$ctrl.vm.targetType"/> <input class="item-fill topNInputBox" type="number" ng-pattern="/^[1-9][0-9]{0,6}$/" ng-model="$ctrl.vm.itemCount"/></div></fieldset><fieldset class="orderBy" ng-disabled="$ctrl.viewModel.cardType.invalid"><legend localize="TopNFilter_Value"></legend><div class="topNInputArea ui-droppable dropzone topNInputBox" ng-class="{filled: $ctrl.vm.orderByDisplayName}" drop="$ctrl.dropConfig" drop-handler="$ctrl.dropFilterTarget()" drop-action="$ctrl.getDropAction()"><div class="flex orderByPill" ng-if="$ctrl.vm.orderByDisplayName"><span class="displayName trimmedTextWithEllipsis item-fill" ng-bind="$ctrl.vm.orderByDisplayName"></span> <button ng-if="$ctrl.vm.availableAggregates.items.length> 0" class="fieldWellIcon dropDown item-auto" type="button" ng-click="$ctrl.showContextMenu($event)"></button><pbi-button ng-click="$ctrl.removeOrderBy()" class="removeOrderBy" kind="icon" icon-name="close" icon-size="micro"></pbi-button></div><div class="dragHereWatermark trimmedTextWithEllipsis" localize="FieldDropZone_Watermark" ng-if="!$ctrl.vm.orderByDisplayName"></div></div></fieldset> <button type="submit" class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-disabled="!$ctrl.canApplyFilter()"/></form>'),e.put("components/visualContainerDrill/visualContainerDrill.html",'<button class="drillDownLevelGrouped glyphicon glyph-small pbi-glyph-drillup" ng-click="$ctrl.drillUp()" ng-if="$ctrl.canDrill()" ng-disabled="!$ctrl.canDrillUp" localize-tooltip="DrillUp_ToolTip"></button> <button class="drillDownLevelGrouped glyphicon glyph-small pbi-glyph-expand" ng-click="$ctrl.drillDownLevel()" ng-if="$ctrl.canDrill()" ng-disabled="!$ctrl.canDrillDownWithoutCurrentGroup" title="{{$ctrl.drillLevelTitle()}}"></button> <button class="drillDownLevelGrouped glyphicon glyph-small pbi-glyph-inline-drill" ng-click="$ctrl.drillDownLevelGrouped()" ng-if="$ctrl.canDrill()" ng-disabled="!$ctrl.canDrillDownWithCurrentGroup" title="{{$ctrl.drillLevelGroupedTitle()}}"></button>'),e.put("components/visualContainerDrillToggle/visualContainerDrillToggle.html",'<button class="drillDownLevelGrouped glyphicon glyph-small pbi-glyph-drilldowndisabled" ng-class="{\'pbi-glyph-drilldownenabled\': $ctrl.isDrillDownEnabled() }" ng-click="$ctrl.toggleDrillMode(1)" ng-if="$ctrl.canDrill()" title="{{$ctrl.drillTitle()}}"></button>'),e.put("components/visualContainerHeader/visualContainerHeader.html",'<div class="vcHeader"><div class="iconContainer"><canvas-visual-header-icon ng-if="$ctrl.visual.warningInfo" details="$ctrl.visual.warningInfo.details" icon-type="\'warning\'" ng-click="$ctrl.showWarningDetails()"></canvas-visual-header-icon><canvas-visual-header-icon ng-if="$ctrl.visual.transformWarningInfo" details="$ctrl.visual.transformWarningInfo.details" icon-type="\'error\'" ng-click="$ctrl.showTransformWarningDetails()" show-by-default="true"></canvas-visual-header-icon><canvas-visual-header-icon ng-if="$ctrl.visual.visualInfo" details="$ctrl.visual.visualInfo.details" icon-type="\'info\'" ng-click="$ctrl.showInfoDetails()"></canvas-visual-header-icon></div><visual-container-drill visual="::$ctrl.visual"></visual-container-drill><i class="dragGrip glyphicon pbi-glyph-gripperbarhorizontal glyph-small"></i><div class="optionsMenu"><visual-container-relationship-filters class="optionSection visualRelationshipFilters" visual="::$ctrl.visual" on-visual-container-changed="$ctrl.onVisualContainerChanged()" ng-if="$ctrl.canSetVisualRelationshipFilterAction()"></visual-container-relationship-filters><visual-container-drill-toggle class="optionSection" visual="::$ctrl.visual"></visual-container-drill-toggle><visual-container-pin-button class="optionSection" visual="::$ctrl.visual" disable-pin="$ctrl.disablePin"></visual-container-pin-button><div class="optionSection"> <button class="vcPopOutBtn" ng-click="$ctrl.popOutVisualContainer()" ng-if="$ctrl.canPopOut()" localize-tooltip="FocusModeVisual_ToolTip"><i class="glyphicon pbi-glyph-miniexpand glyph-small"></i></button> <button class="toggleSeeDataLayout" ng-click="$ctrl.toggleSeeDataLayout()" ng-if="$ctrl.visual.contract.popOutMode === 2" title="{{$ctrl.getSeeDataLayoutTitle()}}"><i class="glyphicon pbi-glyph-rotatevertical glyph-small" ng-class="{ \'pbi-glyph-rotatevertical\': $ctrl.visual.contract.detailVisualLayout !== 2, \'pbi-glyph-rotatehorizontal\': $ctrl.visual.contract.detailVisualLayout === 2 }"></i></button><visual-container-options-menu menu-id="::$ctrl.menuId" visual="::$ctrl.visual" menu-options="::$ctrl.menuOptions" ng-if="$ctrl.menuOptions.hasMoreOptions"></visual-container-options-menu></div></div></div>'),e.put("components/visualContainerPinButton/visualContainerPinButton.html",'<button class="vcPinBtn" ng-disabled="$ctrl.disablePin" ng-click="$ctrl.pinVisualContainer($event)" ng-show="$ctrl.showPin()" ng-if="$ctrl.canPin()" title="{{$ctrl.getPinTileTitle()}}"><i class="glyphicon pbi-glyph-pinned glyph-small"></i></button>'),e.put("components/visualContainerRelationshipFilters/visualContainerRelationshipFilters.html",'<button class="glyphicon glyph-small alwaysVisible" ng-if="$ctrl.supportsVisualRelationshipFilterAction(1)" ng-class="{ \'pbi-glyph-filterfilled\': $ctrl.filterAction === 1,  \'pbi-glyph-filter\': $ctrl.filterAction !== 1}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 1)" localize-tooltip="VisualRelationships_DataFilter"></button> <button class="glyphicon glyph-small alwaysVisible" ng-if="$ctrl.supportsVisualRelationshipFilterAction(2)" ng-class="{ \'pbi-glyph-crosshighlightfilled\': $ctrl.filterAction === 2,  \'pbi-glyph-crosshighlight\': $ctrl.filterAction !== 2}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 2)" localize-tooltip="VisualRelationships_HighlightFilter"></button> <button class="glyphicon glyph-small alwaysVisible" ng-if="$ctrl.supportsVisualRelationshipFilterAction(3)" ng-class="{ \'pbi-glyph-disablefilled\': $ctrl.filterAction === 3, \'pbi-glyph-disable\': $ctrl.filterAction !== 3}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 3)" localize-tooltip="VisualRelationships_NoFilter"></button>'),e.put("components/visualContainerThumbnail/visualContainerThumbnail.html",'<div apply-style="::$ctrl.style"><div class="thumbnailContainer disable-visual-interactivity" apply-style="::$ctrl.visualStyle"><div class="visualContainerScreen"></div><visual view-model="$ctrl.visualDefinition" allow-deferred-rendering="true"></visual></div><canvas-visual-error-overlay ng-if="$ctrl.errorInfo" error-info="$ctrl.errorInfo" view-mode="$ctrl.viewMode" viewport="$ctrl.viewport"></canvas-visual-error-overlay></div>'),e.put("components/visualOptionsMenu/visualContainerOptionsMenu.html",'<button class="vcMenuBtn" ng-click="$ctrl.showOptionsMenu($event)" localize-tooltip="Options_Menu"><i class="glyphicon pbi-glyph-more glyph-small"></i></button>'),e.put("views/advancedFilter.html",'<li class="advanced"><h3 class="description" localize="AdvancedFilter_Description"/><div ng-repeat="condition in advFilterCard.conditions"> <select class="comparisonOperator advancedControl" ng-model="condition.operator" ng-change="markDirty()" ng-disabled="viewModel.readOnlyState.disabled" ng-options="operatorInfo.value as operatorInfo.label for operatorInfo in advFilterCard.operators"/><div class="advancedControl conditionValue flex" ng-if="!advFilterCard.isDateTime" ng-show="condition.valueRequired"> <input type="text" class="item-fill" ng-model="condition.value.stringValue" ng-disabled="viewModel.readOnlyState.disabled" ng-focus="handleFocusedInputChanged($event, condition)" ng-blur="handleInputBlur()" ng-change="validateFilterInput(condition); markDirty();" fast-keyup="keyUp($event)"/><span class="errorIcon item-auto" ng-if="condition.isInvalid" tooltip tooltip-config="tooltipConfig"></span></div><section class="datetime datetimePicker" ng-if="advFilterCard.isDateTime" ng-show="condition.valueRequired" pbi-lazy-load-contents="moduleConfig"><div class="datePicker flex"> <input type="text" class="calendarInput item-fill" ng-blur="dateTextUpdateComplete(condition)" ng-change="dateTextUpdated(condition); markDirty();" ng-model="condition.value.value" ng-disabled="!condition.valueRequired || viewModel.readOnlyState.disabled" fast-keyup="keyUp($event)"/> <button type="button" class="filterPaneIcon calendar item-auto" ng-disabled="!condition.valueRequired || viewModel.readOnlyState.disabled" dropdown-overlay-invoke="calendar"></button><dropdown-overlay class="datetime calendarDropDown" dropdown-overlay-name="calendar"><datepicker class="calendar" ng-model="condition.value.dateValue" ng-disabled="!condition.valueRequired || viewModel.readOnlyState.disabled" ng-change="dateSelected(condition)" onclick="event.stopPropagation()" show-weeks="false"></datepicker></dropdown-overlay></div><timepicker class="timePicker" readonly-input="viewModel.readOnlyState.disabled" ng-model="condition.value.timePickerValue" ng-model-options="{ getterSetter: true }" ng-change="timeSelected(condition)"></timepicker></section><section class="logicalOperator advancedControl" ng-if="$index < (advFilterCard.conditions.length -1)"> <label class="logicalOperatorField"><input type="radio" ng-model="advFilterCard.logicalOperator" ng-value="advFilterCard.logicalAndOperator" ng-disabled="viewModel.readOnlyState.disabled" ng-change="markDirty()" ng-checked="advFilterCard.logicalOperator === advFilterCard.logicalAndOperator"/><span localize="Logical_And_Operator"/></label> <label class="logicalOperatorField"><input type="radio" ng-model="advFilterCard.logicalOperator" ng-value="advFilterCard.logicalOrOperator" ng-disabled="viewModel.readOnlyState.disabled" ng-change="markDirty()" ng-checked="advFilterCard.logicalOperator === advFilterCard.logicalOrOperator"/><span localize="Logical_Or_Operator"/></label></section></div> <button class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-click="applyFilter()" ng-disabled="!canApplyFilter()"/></li>'),e.put("views/canvasVisualHeaderIcon.html",'<button tooltip tooltip-config="$ctrl.tooltipConfigManager.getTooltipConfig()" ng-disabled="!$ctrl.isClickable()" ng-switch="$ctrl.iconType"><i class="infoIcon pbi-glyph-info glyphicon" ng-switch-when="info"></i><i class="warningIcon pbi-glyph-warning glyphicon" ng-switch-when="warning"></i><i class="errorIcon pbi-glyph-error glyphicon" ng-switch-when="error"></i></button>'),e.put("views/carousel.html",'<div class="carouselControl" fast-mouseenter="updateNavButtonVisibility()" on-resize="carouselResized()"> <button class="carouselNavButton previousPage" ng-click="scrollToPrevious()" localize-tooltip="Carousel_PreviousPages"><i class="glyphicon pbi-glyph-caretleft glyph-mini"></i></button> <button class="carouselNavButton nextPage" ng-click="scrollToNext()" localize-tooltip="Carousel_NextPages"><i class="glyphicon pbi-glyph-caretright  glyph-mini"></i></button><div class="carouselScrollPane" ng-transclude></div></div>'),e.put("views/codePaneContainer.html",'<div ng-show="showCodePanel"><div class="codePaneContainer" ng-class="{codePaneContainerMinimized: isMinimized}" v-resizable v-resizable-container-id="desktopExplorationHost" v-resizable-expanded="{{ !isMinimized }}" v-resizable-container-resize="{{canvasResize}}" v-resizable-default-height="34%" v-resizable-min-height="150" v-resizable-collapsed-height="34" v-resizable-other-siblings-height="37" v-resizable-on-resize-callback="onResize"><div class="codePaneTopBar unselectable"><span localize="CodePaneTopBarTitle"></span> <button class="codePaneTopBarButton" fast-click="minimizeToggle()" localize-tooltip="{{isMinimized ? \'CodePane_ExpandTooltip\' : \'CodePane_MinimizeTooltip\' }}" dynamic-tooltip-update><i class="glyphicon glyph-mini" ng-class="{\'pbi-glyph-chevronupmedium\':isMinimized, \'pbi-glyph-chevrondownmedium\':!isMinimized}"></i></button> <button class="codePaneTopBarButton" fast-click="launchExternalIDEClicked()" ng-if="::canLaunchExternalIDE" ng-disabled="!(datafields.length> 0)" localize-tooltip="CodePane_LaunchExternalIDEButtonTooltip"><i class="glyphicon pbi-glyph-go glyph-mini"></i></button> <button class="codePaneTopBarButton" fast-click="optionsButtonClicked()" localize-tooltip="CodePane_RScriptOptionsButtonTooltip"><i class="glyphicon pbi-glyph-gear glyph-mini"></i></button> <button class="codePaneTopBarButton" fast-click="runButtonClicked()" ng-disabled="!(datafields.length> 0 && scriptInput.length > 0)" localize-tooltip="CodePane_RunButtonTooltip"><i class="glyphicon pbi-glyph-play glyph-mini"></i></button></div><div class="codePaneWarningBar" ng-show="showWarningBar && !isMinimized && datafields && datafields.length> 0"><i class="glyphicon glyph-small pbi-glyph-warning"></i> {{warningText}} <button class="codePaneWarningBarButton" fast-click="hideWarning()"><i class="glyphicon glyph-mini pbi-glyph-close"></i></button></div><div class="codePaneMain" ng-style="{\'height\':currentHeight-((showWarningBar && datafields && datafields.length> 0)?68:34)+\'px\'}" ng-hide="isMinimized"><div class="codePaneDataHintsContainer selectable" ng-hide="isMinimized || !(datafields && datafields.length> 0)"><div># Create dataframe</div><div># {{dataFrameName}} &lt;- data.frame({{dataFieldsNamesList}})</div><br/><div># Remove duplicated rows</div><div># {{dataFrameName}} &lt;- unique({{dataFrameName}})</div></div><div class="codePaneScriptContainer" ng-hide="isMinimized || !(datafields && datafields.length> 0)"><pre><span>{{scriptInput}}</span><br/><br/><br/><br/></pre><textarea type="text" placeholder="Paste or type your R-script code here" ng-model="scriptInput" ng-change="scriptInputChanged()" ng-trim="false" spellcheck="false" autocorrect="off"></textarea></div><div class="codePaneContainerDisabled unselectable" ng-show="!isMinimized && !(datafields && datafields.length> 0)" localize="CodePane_DisabledNoDatafields" ng-style="{\'height\':currentHeight-34+\'px\'}"></div></div></div></div>'),e.put("views/deleteVisualWarningDialog.html",'<div><div class="warningMessage"> {{::deleteVisualWarningText}}</div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="deleteVisual()">{{::deleteVisualButtonText}}</button> <button class="btn button" ng-click="closeDialog()" localize="DeleteVisual_Cancel"></button></div></div>'),e.put("views/detailVisual.html",'<div class="detailVisual" ng-switch="viewModel.hasData"><visual view-model="viewModel.visual" ng-switch-when="true"></visual><div class="noDataOverlay" ng-switch-when="false"></div></div>'),e.put("views/dropdowns/appBarEditReportMenu.html",'<dropdown-overlay dropdown-overlay-name="editReportMenu"><ul class="angular-dropdown explorationAppBarMenu active" ng-class="{dark: getMode() === 0}"><li ng-repeat="item in getMenuActions()" class="dropdown-item" ng-mousedown="menuActionSelected(item); $event.stopPropagation();" ng-disabled="item.disabled"><a href="" target="_blank"><div class="dropdown-content {{::item.itemClass}}"><i class="glyphicon glyph {{::item.itemClass}}"></i><div class="dropdown-label" ng-bind="::item.text"></div><div class="dropdown-description" title="{{::item.tooltip}}" ng-bind="::item.description"></div></div></a></li></ul></dropdown-overlay>'),e.put("views/dropdowns/appBarExploreMenu.html",'<dropdown-overlay dropdown-overlay-name="exploreMenu"><ul class="angular-dropdown explorationAppBarMenu explore active" ng-class="{dark: getMode() === 0}"><li ng-repeat="item in getMenuActions()" class="dropdown-item explore" ng-class="{\'selected\': item.selected}" ng-disabled="item.disabled" ng-mousedown="menuActionSelected(item); $event.stopPropagation();"><a href="" target="_blank"><div class="dropdown-content {{::item.itemClass}}"><i class="glyphicon glyph {{::item.itemClass}} glyph-small"></i><div class="dropdown-label" ng-bind="::item.text"></div></div></a></li></ul></dropdown-overlay>'),e.put("views/dropdowns/appBarFileMenu.html",'<dropdown-overlay dropdown-overlay-name="fileMenu"><ul class="angular-dropdown explorationAppBarMenu active" ng-class="{dark: getMode() === 0}"><li ng-repeat="item in getMenuActions()" ng-if="::item.show" class="dropdown-item" ng-mousedown="menuActionSelected(item); $event.stopPropagation();" ng-disabled="item.disabled"><a href="" target="_blank"><div class="dropdown-content {{::item.itemClass}}"><i class="glyphicon glyph {{::item.itemClass}}"></i><div class="dropdown-label" ng-bind="::item.text"></div><div class="dropdown-description" title="{{::item.tooltip}}" ng-bind="::item.description"></div></div></a></li></ul></dropdown-overlay>'),e.put("views/dropdowns/appBarMoreOptionsMenu.html",'<dropdown-overlay dropdown-overlay-name="reportMoreOptionsMenu"><ul class="angular-dropdown explorationAppBarMenu active" ng-class="{dark: getMode() === 0}"><li ng-repeat="item in getMenuActions()" class="dropdown-item moreOptions" ng-class="{\'selected\': item.selected}" ng-mousedown="menuActionSelected(item); $event.stopPropagation();"><a href="" target="_blank"><div class="dropdown-content {{::item.itemClass}}"><div class="dropdown-label" ng-bind="::item.text"></div></div></a></li></ul></dropdown-overlay>'),e.put("views/dropdowns/appBarViewMenu.html",'<dropdown-overlay dropdown-overlay-name="viewMenu"><ul class="angular-dropdown explorationAppBarMenu active" ng-class="{dark: getMode() === 0}"><li ng-repeat="item in getMenuActions()" class="themeYellowDark dropdown-item view-menu" ng-class="{\'selected\': item.selected, \'dropdown-separator\': item.type === 2}" ng-disabled="item.disabled" ng-mousedown="menuActionSelected(item); $event.stopPropagation(); $event.preventDefault() "><a href="" target="_blank"><div class="dropdown-content {{::item.itemClass}}"><i class="glyphicon glyph {{::item.itemClass}} glyph-small"></i><div class="dropdown-label" ng-bind="::item.text"></div><pbi-toggle class="base4" ng-if="item.checkbox" ng-model="item.checked" no-label on-state-text="ToggleSwitchOn" off-state-text="ToggleSwitchOff"></pbi-toggle></div></a></li></ul></dropdown-overlay>'),e.put("views/dropdowns/visualContainerOptionsMenu.html",'<dropdown-overlay dropdown-overlay-name="visualContainerOptionsMenu" class="vcOptionsMenu"><ul><li ng-if="menuOptions().canSearch" ng-click="toggleSearch();" class="trimmedTextWithEllipsis toggle" ng-class="{\'selected\': isSearchOn}"><i class="itemIcon glyphicon pbi-glyph-search glyph-small"></i><span class="itemLabel trimmedTextWithEllipsis" localize="Slicer_SearchBox_Text"></span></li><li class="sort toggle" ng-repeat="sortableField in menuOptions().sortSetting.sortableFields" ng-if="menuOptions().canSort" ng-class="{\'selected\': sortableField.active}"> <button class="toggleSortBtn" ng-disabled="!sortableField.active || !actualSortDirection()" ng-click="toggleSort()"><ng-switch on="actualSortDirection()"><span ng-switch-when="1" class="glyphicon pbi-glyph-atoz glyph-small" localize-tooltip="Sort_Desc"></span><span ng-switch-when="2" class="glyphicon pbi-glyph-ztoa glyph-small" localize-tooltip="Sort_Asc"></span><span ng-switch-default class="glyphicon pbi-glyph-atoz glyph-small" localize-tooltip="Sort_SortBy"></span></ng-switch></button><span localize="Sort_SortBy" ng-click="toggleSort(sortableField)" class="caption itemLabel trimmedTextWithEllipsis" localize-fragments><span fragment-index="0" ng-bind="sortableField.displayName"></span></span></li><li ng-if="menuOptions().canEdit" ng-click="enterAdvancedEditMode();" class="trimmedTextWithEllipsis"><i class="itemIcon glyphicon pbi-glyph-edit glyph-mini"></i><span class="itemLabel trimmedTextWithEllipsis" localize-tooltip="InFocus_Edit" localize="InFocus_Edit"></span></li><li ng-if="menuOptions().canExport" ng-click="exportVisualData();" class="trimmedTextWithEllipsis"><i class="itemIcon glyphicon pbi-glyph-export glyph-small"></i><span class="itemLabel trimmedTextWithEllipsis" localize="ExportData_MenuItem"></span></li><li ng-if="menuOptions().canDelete" ng-click="deleteVisualContainer();" class="trimmedTextWithEllipsis"><i class="itemIcon glyphicon pbi-glyph-close glyph-mini"></i><span class="itemLabel trimmedTextWithEllipsis" localize-tooltip="Remove_ToolTip" localize="Remove_visual"></span></li><li ng-if="menuOptions().canCluster" ng-click="getClusters();" class="trimmedTextWithEllipsis"><span class="itemLabel trimmedTextWithEllipsis" localize-tooltip="Visual_Cluster_FindGroups" localize="Visual_Cluster_FindGroups"></span></li><li ng-if="menuOptions().canSpatialCluster" ng-click="getSpatialClusters();" class="trimmedTextWithEllipsis"><span class="itemLabel trimmedTextWithEllipsis" localize-tooltip="Visual_Cluster_FindGroups_Spatial" localize="Visual_Cluster_FindGroups_Spatial"></span></li></ul></dropdown-overlay>'),e.put("views/embedModalDialog.html",'<div class="reportEmbed"><div ng-switch="viewModel.publishState"><div ng-switch-when="0"><span localize="Embed_ShowCodeTitle" class="title publishTitle"></span><div class="centeredSpinner" ng-show="viewModel.publishState == 0"><spinner modern></spinner></div></div><div ng-switch-when="1"><span localize="Embed_DialogTitle" class="title publishTitle"></span><div><span class="legalText regularText" localize="Embed_Warning_Public"></span><span class="legalText regularText" localize="Embed_Warning_UpdateLiveReport"></span></div><div class="buttons"> <button localize="Embed_PublishToWeb" class="primary button embedCodeButton" ng-hide="viewModel.embedTab.generating || viewModel.embedTab.disabled || showEmbedCode()" ng-click="goToConfirmation()"></button> <button localize="Embed_PublishToWeb" class="primary button disabled embedCodeButton" ng-show="viewModel.embedTab.disabled && !showEmbedCode()"></button> <button localize="Embed_Close" class="button actionButton" ng-click="closeDialog()" ng-show="viewModel.publishState==1"></button></div></div><div ng-switch-when="2"><span localize="Embed_DialogTitle" class="title publishTitle"></span><span class="legalText regularText" localize="Embed_LegalTitle"></span><span class="legalText regularText" localize="Embed_LegalText"></span><div ng-show="viewModel.embedTab.generating" class="loading"><i class="glyphicon pbi-spinner-large"></i><span localize="Embed_GeneratingEmbedCode" class="semiBoldBlackText loadingText"></span></div></div><div ng-if="viewModel.publishState == 3 || viewModel.publishState == 4"><span ng-if="viewModel.publishState == 3" localize="Embed_SuccessTitle" class="title successTitle"></span><span ng-if="viewModel.publishState == 4" localize="Embed_ShowCodeTitle" class="title successTitle"></span><span class="successLabel semiLightBlackText" localize="Embed_LinkTitle"></span> <input class="succesInputBox semiBoldBlackText" readonly ng-show="showEmbedCode()" onClick="this.setSelectionRange(0, this.value.length);" ng-model="viewModel.embedTab.embed.link"/><span class="successLabel semiLightBlackText" localize="Embed_EmbedCodeTitle"></span> <input class="succesInputBox semiBoldBlackText" readonly ng-show="showEmbedCode()" onClick="this.setSelectionRange(0, this.value.length);" ng-model="viewModel.embedTab.embed.embedCode"/><span class="semiBoldBlackText" localize="Embed_Size"></span> <select ng-change="updateSize()" ng-options="size.name for size in viewModel.embedTab.sizes" ng-model="viewModel.embedTab.selectedEmbedSize" class="sizeOptions regularBlackText"></select></div><div ng-switch-when="5"><span localize="Embed_SharepointTitle" class="title publishTitle"></span><div><span class="successLabel regularBlackText" localize="Embed_SharePointLinkTitle"></span><a href="https://go.microsoft.com/fwlink/?LinkID=825698" target="_blank"><span class="successLabel regularBlackText" localize="LearnMore"></span></a> <input class="sharePointEmbedCodeInputBox semiBoldBlackText" readonly onClick="this.setSelectionRange(0, this.value.length);" ng-model="viewModel.embedTab.embed.link"/></div><div class="spEmbedButtons"> <button localize="Embed_Close" class="button actionButton" ng-click="closeDialog()"></button></div></div><div class="buttons"> <button localize="Embed_GenerateEmbedCode" class="button embedCodeButton actionButton" ng-hide="viewModel.embedTab.disabled || showEmbedCode() || viewModel.publishState !== 2" ng-click="generateEmbedCodeAndGoToSuccess()"></button> <button localize="Embed_Close" class="button actionButton" ng-click="closeDialog()" ng-hide="viewModel.publishState==1 || viewModel.publishState==5"></button></div></div></div>'),
e.put("views/esriConsentDialog.html",'<div><div class="esriDialogTitle"><div class="EsriConsentDialog_Esri" localize="EsriConsentDialog_Esri"></div><div class="EsriConsentDialog_WelcomeTo" localize="EsriConsentDialog_WelcomeTo"></div><div class="EsriConsentDialog_ArcGISMaps" localize="EsriConsentDialog_ArcGISMaps"></div></div><div class="esriDialogBody"><div class="EsriConsentDialog_GetMore" localize="EsriConsentDialog_GetMore"></div><div class="EsriConsentDialog_ByClicking" ng-bind-html="::byClickingText"></div><div class="EsriConsentDialog_LearnMore"><a ng-href="{{::learnMoreLink}}" target="_blank" localize="EsriConsentDialog_LearnMore"></a></div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="acceptTermsOfService()" localize="EsriConsentDialog_OK"></button> <button class="btn button" ng-click="rejectTermsOfService()" localize="EsriConsentDialog_Cancel"></button></div></div></div>'),e.put("views/exploration.html",'<div class="exploration {{isMasterFormFactor()? \'\': \'phone-form-factor-background\'}}" toolbar-container><explore-canvas view-model="viewModel.exploreCanvas" disable-print="disablePrint" canvas-options="canvasOptions" ng-class=\'{"master-form-factor": isMasterFormFactor(), "phone-form-factor": !isMasterFormFactor(), "disable-visual-interactivity": isMobileLayoutAuthoring()}\' canvas-scroll></explore-canvas></div>'),e.put("views/explorationAppBar.html",'<div class="explorationAppBarContent appBar trimmedTextWithEllipsis unselectable"><div class="appBarSection left"><ul><li ng-if="$ctrl.viewModel.options.showBackButtonOnAppBar" ng-click="$ctrl.navigateBack()"><i class="glyphicon pbi-glyph-pageleft glyph-small backBtn"></i></li><li class="file-menu" ng-click="$ctrl.showMenu($event, $ctrl.getFileMenuProperties)" tabindex="0"><span localize="ReportAppBar_FileButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li><li class="pageview-menu" ng-click="$ctrl.showMenu($event, $ctrl.getViewMenuProperties)" tabindex="0" localize-tooltip="ReportAppBar_ViewButton" ng-if="!$ctrl.isPopOutMode"><span localize="ReportAppBar_ViewButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li><li localize="ReportAppBar_SwitchModeButton" ng-click="$ctrl.stopEditing()" class="switch" ng-if="$ctrl.showSwitchMode() && $ctrl.viewModeState.getMode() === 1 && $ctrl.viewModel.canWrite"></li><li localize="ReportAppBar_EditReportButton" ng-click="$ctrl.edit()" class="edit" ng-if="$ctrl.canOpenEditReport()"></li><li localize="ReportAppBar_EditReportButton" localize-tooltip="ReportAppBar_EditReportButtonSharedDisabled" class="edit-disabled" ng-if="$ctrl.showEditReportDisabled()"></li><li class="editreport-menu" ng-click="$ctrl.showMenu($event, $ctrl.getEditReportMenuProperties)" tabindex="0" ng-if="$ctrl.viewModeState.getMode() === 0 && $ctrl.viewModel.canEdit && $ctrl.isEditInDesktopEnabled()"><span localize="ReportAppBar_EditReportButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li></ul></div><div class="appBarSection right"><ul><li class="appBarDivider"></li><li class="explore" ng-click="$ctrl.showMenu($event, $ctrl.getExploreMenuProperties)" tabindex="0" localize-tooltip="ReportAppBar_ExploreButton"><i class="glyphicon pbi-glyph-seedata glyph-small"></i><span localize="ReportAppBar_ExploreButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li><li ng-if="$ctrl.viewModeState.getMode() === 1 && !$ctrl.isPopOutMode" class="insert-textbox" ng-click="$ctrl.insertTextbox()"><i class="glyphicon pbi-glyph-inserttextbox glyph-small"></i><span localize="ReportAppBar_InsertTextboxButton"></span></li><li class="insert-shape" dropdown-menu dropdown-items="$ctrl.shapeMenuActions" dropdown-class="explorationAppBarMenu" dropdown-on-item-selected="$ctrl.shapeMenuActionSelected(selected)" ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.shapeMenuActions && !$ctrl.isPopOutMode"><i class="glyphicon pbi-glyph-shapes glyph-small"></i><span localize="ReportAppBar_ShapeButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li><li ng-click="$ctrl.toggleVisualInteractions()" class="visualInteractions" ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.toggleVisualInteractions && !$ctrl.isPopOutMode" ng-class="{ \'active\': $ctrl.viewModeState.getConfig().showRelationships }"><i class="glyphicon pbi-glyph-visualsinteraction glyph-mini"></i><span localize="ReportAppBar_VisualInteractionsButton"></span></li><li ng-click="$ctrl.refresh()" class="refresh" localize-tooltip="ReportAppBar_RefreshButton"><i class="glyphicon pbi-glyph-refresh glyph-mini" aria-hidden="true"></i><span localize="ReportAppBar_RefreshButton"></span></li><li ng-click="$ctrl.duplicateReportPage()" class="duplicate" ng-if="$ctrl.canDuplicatePage()"><i class="glyphicon pbi-glyph-chromerestore glyph-small" aria-hidden="true"></i><span localize="ReportAppBar_duplicateButton_Text"></span></li><li ng-click="$ctrl.save()" class="save" ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.viewModel.canWrite"><i class="glyphicon pbi-glyph-save glyph-small" aria-hidden="true"></i><span localize="ReportAppBar_SaveReportButton"></span></li><li ng-if="$ctrl.showPinPage() && $ctrl.canPinPage()" localize-tooltip="ReportAppBar_PinPage" class="pin-report" ng-click="$ctrl.showPinReportPageDialog()"><i class="glyphicon pbi-glyph-pinned glyph-small"></i><span localize="ReportAppBar_PinPage"></span></li><li ng-if="$ctrl.showPinPage() && $ctrl.pinPageDisabled()" localize-tooltip="PinTile_NotSupportedTitle" class="pin-disabled"><i class="glyphicon pbi-glyph-pinned glyph-small"></i><span localize="ReportAppBar_PinPage"></span></li><li ng-if="$ctrl.canPause && !$ctrl.viewModeState.getConfig().pauseQueryExecution" class="pause" localize-tooltip="ReportAppBar_PauseQueries" ng-click="$ctrl.togglePlayPause()"><span localize="ReportAppBar_PauseQueries"></span></li><li ng-if="$ctrl.canPause && $ctrl.viewModeState.getConfig().pauseQueryExecution" class="play" localize-tooltip="ReportAppBar_ResumeQueries" ng-click="$ctrl.togglePlayPause()"><span localize="ReportAppBar_ResumeQueries"></span></li><li class="moreOptionsItem rightFloatedOptionsItem"> <button ng-if="$ctrl.showReportMoreOptionsMenu()" class="moreOptionsDashboardButton" ng-click="$ctrl.showMenu($event, $ctrl.getMoreOptionsMenuProperties)" localize-tooltip="Options_Menu"><i class="glyphicon glyph-small pbi-glyph-more"></i></button></li><li ng-if="$ctrl.isEmailSubscriptionEnabled()" class="subscription rightFloatedOptionsItem" localize-tooltip="ReportAppBar_Subscribe" ng-click="$ctrl.showSubscriptionPane()"><i class="glyphicon pbi-glyph-mail glyph-small"></i><span localize="ReportAppBar_Subscribe"></span></li><li ng-if="$ctrl.isViewRelatedContentEnabled()" class="related rightFloatedOptionsItem" localize-tooltip="DashboardAppBar_ViewRelated" ng-click="$ctrl.showRelatedContentPane()"><i class="glyphicon pbi-glyph-link glyph-small"></i><span localize="DashboardAppBar_ViewRelated"></span></li><li ng-if="$ctrl.canOpenUsageMetricsReport()" class="usageMetricsReport rightFloatedOptionsItem" localize-tooltip="UsageMetrics" ng-click="$ctrl.openUsageMetricsReport()"><i class="glyphicon pbi-glyph-chart glyph-small"></i><span localize="UsageMetrics"></span></li></ul></div></div>'),e.put("views/explorationHost.html",'<div class="fillAvailableSpace verticalItemsContainer" ng-transclude></div>'),e.put("views/explorationNavigationTab.html",'<div drag="sections" class="thumbnail-container" ng-dblclick="beginEditSection()" accessible-click="changeSection($event)" focus-element role="tab" tabindex="0" aria-selected="{{viewModel.selected}}"><div dropdown-menu dropdown-items="dropdownItems" dropdown-on-item-selected="selectMenuItem(selected)" dropdown-on-left-click="false" dropdown-on-right-click="isEditing" dropdown-follow-mouse-position="true"><editable-label class="section-index" on-blur="renameSection(newName)" view-model="viewModel" editable="viewModel.isTabEditable && isEditing" disable-click="true"></editable-label><div class="sectionDeleteIcon" ng-if="isEditing && !isOnlyTab" ng-click="deleteSection($event)" localize-tooltip="Carousel_DeletePage">x</div></div></div>'),e.put("views/explorationPaginator.html",'<div class="paginator unselectable"><span class="prev" ng-click="prev()"></span><span class="status"><span localize="ReportPaginator_Page"></span> <span>{{getSelectedPageIndex() + 1}}</span><span localize="ReportPaginator_PageOf"></span><span ng-bind="viewModel.exploration.sections.length"></span></span><span class="next" ng-click="next()"></span></div>'),e.put("views/exploreCanvas.html",'<div class="{{getExploreCanvasClass()}}" drop="dropConfig" drop-handler="drop(event, ui)" ng-click="clearSelection($event)" ng-keydown="keyDown($event)" on-resize="canvasResized()" canvas-layout pinchable="{ \'startHandler\' : \'canvasPinchStart(scale)\', \'endHandler\' : \'canvasPinchEnd(scale)\', \'scrollParentSelector\' : \'.exploration\', \'zoomDisabled\': \'shouldDisableZoom()\', \'childDisplaySelector\': \'.displayArea\' }" enable-pinch="{{canPinch()}}" swipeable="{ enabled: {{canSwipe()}}, ignoreFrom: \'.swipeable-blocked\' }" canvas-navigation="{{canSwipe()}}"><canvas-watermark canvas-view-model="viewModel"></canvas-watermark><div class="canvasBackdrop" ng-if="isCanvasBackdropVisible()"></div><div class="displayArea" explore-canvas-printer disable-print="{{::disablePrint}}"><div class="visualBackgroundContainer" ng-class="imageFitClass" ng-style="backgroundStyle"><div ng-if="imageSource" class="visualBackgroundImageContainer"> <img class="visualBackgroundImage" ng-src="{{imageSource}}" ng-style="imageStyle"/></div></div><div class="visualContainerHost" focus-group=\'ctrl-F6\'><dot-grid ng-if="showDotGrid() && dotGridViewModel" view-model="dotGridViewModel"></dot-grid><box-grid ng-if="showBoxGrid() && boxGridLayout" view-model="boxGridLayout"></box-grid><visual-container ng-repeat="visualContainer in viewModel.visualContainers" view-model="visualContainer" ng-repeat-finish-event="visualContainerRepeatFinished"></visual-container></div><pen-annotation ng-if="$ctrl.viewModeState.getConfig().enablePenAnnotation"></pen-annotation></div></div>'),e.put("views/fieldList.html",'<section class="fieldList unselectable"><search-box filter="searchString" on-change="onSearchStringChanged()"></search-box><hr/><ng-scrollbars ng-scrollbars-config="::scrollbarsConfig" ng-right-click="showContextMenu($event)"><div ng-if="viewModel.isLoaded"><field-list-entity ng-repeat="entity in viewModel.schema.entities | orderBy:[\'!isMeasureGroup\', \'displayName\']" view-model="entity" search-string="searchString" ng-if="(!entity.hidden || entity.showHidden) && entity.isShownInSearch !== false && entity.userEntity"></field-list-entity></div><div class="centeredSpinner" ng-if="!viewModel.isLoaded"><spinner></spinner></div></ng-scrollbars></section>'),e.put("views/fieldListEntity.html",'<li class="entityContainer"><h1 ng-click="toggle($event)" ng-right-click="showContextMenu($event)" class="fieldListEntity flex smallFontSize" ng-class="{selected: viewModel.selected, inactive: viewModel.hidden && viewModel.showHidden}"><i class="caret glyphicon pbi-glyph-caretright glyph-mini smallFontSize item-auto" ng-class="{expanded : viewModel.expanded || viewModel.isShownInSearch}"/><i class="entity fieldListIcon item-auto" ng-class="viewModel.iconClassName"/><editable-label class="unselectable title item-fill" ng-class="{hasCheckedProperties: viewModel.hasCheckedProperties}" view-model="viewModel" on-blur="rename(newName)" validate="isNameValid" editable="viewModel.isEditingLabel" disable-click="true" search-string="searchString" ng-dblclick="editLabel()" tooltip tooltip-config="tooltipConfigManager.getTooltipConfig()" custom-tooltip="true"></editable-label> <i ng-if="::viewModel.hasMenu" class="menuContainer item-auto"><button class="optionsMenu" ng-click="showContextMenu($event)"><span class="glyphicon pbi-glyph-more"></span></button></i></h1><div class="entityFields" ng-if="viewModel.expanded || viewModel.isShownInSearch"><ol class="entityList"><field-list-property ng-repeat="prop in viewModel.properties | filter:filterProperties" ng-if="prop.isShownInSearch || (prop.isShownInSearch !== false && prop.visible)" search-string="searchString" view-model="prop" id="{{::\'container\'+$id}}"></field-list-property><li class="lastLineBorder"/></ol></div></li>'),e.put("views/fieldListProperty.html",'<li class="fieldListProperty flex" ng-click="ctrl.select($event)" ng-right-click="ctrl.showContextMenu($event)" ng-class="ctrl.getPropertyStyle()" drag="{{::ctrl.viewModel.draggable ? \'field\' : undefined}}" drag-context="ctrl.getDragContext()" drop="{{::ctrl.dropConfig}}" drop-handler="ctrl.drop(event, ui, dropAction)" drop-action="ctrl.getDropAction(dropPosition)" drop-container-id="{{::\'container\'+$parent.$id}}" tooltip tooltip-config="ctrl.tooltipConfigManager.getTooltipConfig()" ng-style="::ctrl.getIndentationStyle()"><ng-include src="ctrl.viewModel.template"></ng-include><editable-label class="propertyText propertyContent item-fill" ng-class="{hasCheckedChildren: ctrl.viewModel.hasCheckedChildren}" view-model="ctrl.viewModel" search-string="ctrl.searchString" on-blur="ctrl.rename(newName)" editable="ctrl.viewModel.isEditingLabel" disable-click="true" ng-dblclick="ctrl.editLabel()" custom-tooltip="true"></editable-label> <i ng-if="::ctrl.viewModel.hasMenu" class="menuContainer propertyMenu item-auto"><button class="optionsMenu" ng-click="ctrl.showContextMenu($event)"><span class="glyphicon pbi-glyph-more"></span></button></i></li>'),e.put("views/fieldListPropertyDefault.html",'<input class="pane-checkbox propertyContent item-auto" type="checkbox" id="{{::ctrl.elementId}}" ng-change="ctrl.toggle()" ng-model="ctrl.viewModel.checked" onclick="event.stopPropagation()"/><label class="propertyContent item-auto caption" for="{{::ctrl.elementId}}" onclick="event.stopPropagation()"/><i class="fieldListIcon propertyContent item-auto {{ctrl.getIconClassName()}}"/>'),e.put("views/fieldListPropertyFolder.html",'<span class="caret glyphicon pbi-glyph-caretright glyph-mini propertyContent item-auto" ng-class="{expanded : ctrl.viewModel.expanded || ctrl.viewModel.isShownInSearch}" ng-click="ctrl.toggleExpand($event)"/><i class="fieldListIcon propertyContent item-auto {{::ctrl.getIconClassName()}}"/>'),e.put("views/fieldListPropertyHierarchy.html",' <span class="caret glyphicon pbi-glyph-caretright glyph-mini propertyContent item-auto" ng-class="{expanded : ctrl.viewModel.expanded || ctrl.viewModel.isShownInSearch}" ng-click="ctrl.toggleExpand($event)"/><input class="pane-checkbox propertyContent item-auto" type="checkbox" id="{{::ctrl.elementId}}" ng-change="ctrl.toggle()" ng-model="ctrl.viewModel.checked" onclick="event.stopPropagation()"/><label class="propertyContent item-auto caption" for="{{::ctrl.elementId}}" onclick="event.stopPropagation()"/><i class="fieldListIcon propertyContent item-auto {{::ctrl.getIconClassName()}}"/>'),e.put("views/fieldListPropertyKpi.html",'<span class="caret glyphicon pbi-glyph-caretright glyph-mini propertyContent item-auto" ng-class="{expanded : ctrl.viewModel.expanded || ctrl.viewModel.isShownInSearch}" ng-click="ctrl.toggleExpand($event)"/><i class="fieldListIcon propertyContent item-auto {{ctrl.getIconClassName()}}"/>'),e.put("views/fieldListPropertyLeaf.html",'<input class="pane-checkbox propertyContent item-auto" type="checkbox" id="{{::ctrl.elementId}}" ng-change="ctrl.toggle()" ng-model="ctrl.viewModel.checked" onclick="event.stopPropagation()"/><label class="propertyContent item-auto caption" for="{{::ctrl.elementId}}" onclick="event.stopPropagation()"/><i class="fieldListIcon propertyContent item-auto {{::ctrl.getIconClassName()}}"/>'),e.put("views/filter.html",'<li class="card unselectable" ng-switch="viewModel.readOnlyState.type"><div class="passthroughCardHeader" ng-switch-when="3"> <button type="button" class="delete glyphicon pbi-glyph-close glyph-micro" ng-click="deleteFilter($event, viewModel)" localize-tooltip="FilterPane_DeleteFilter"></button><h2 class="passthroughRestatement unselectable trimmedTextWithEllipsis smallFontSize" ng-bind="viewModel.restatement"></h2></div><include-exclude-filter ng-switch-when="6" filter-view-model="viewModel"></include-exclude-filter><include-exclude-filter ng-switch-when="7" filter-view-model="viewModel"></include-exclude-filter><div ng-switch-default><div class="filterCardTitleSection" ng-click="toggle($event, viewModel)"><div class="cardHeader" ng-attr-tooltip="viewModel.readOnlyState.invalid" tooltip-config="tooltipConfigManager.getTooltipConfig()"> <button class="delete glyphicon pbi-glyph-close glyph-micro" ng-click="deleteFilter($event, viewModel)" localize-tooltip="FilterPane_DeleteFilter" ng-if="viewModel.howCreated === 1 || viewModel.readOnlyState.invalid"></button><span ng-if="!viewModel.readOnlyState.invalid" ng-class="viewModel.readOnlyState.expanded ? \'expand\' : \'collapse\'" ng-bind-attr="{title: viewModel.readOnlyState.expanded ?  viewModel.chevronCollapseDescription : viewModel.chevronExpandDescription}"></span><h2 class="title trimmedTextWithEllipsis unselectable smallFontSize" ng-bind-attr="{title: viewModel.tooltip}"><i ng-if="viewModel.readOnlyState.invalid" class="filterPaneIcon error"/><span ng-bind="viewModel.displayName"></span><span ng-if="!viewModel.restatement" localize="FilterRestatement_All"></span></h2></div><div ng-class="{\'cardCollapsed\': !viewModel.readOnlyState.expanded && !viewModel.restatement}" class="controlPanel"> <button ng-if="!viewModel.hasDefaultValue && viewModel.restatement" class="filterPaneIcon clear largeFontSize" ng-class="{\'cardExpanded\': viewModel.readOnlyState.expanded}" ng-click="clearFilter($event, viewModel)" localize-tooltip="FilterPane_ClearFilter"></button> <button ng-if="viewModel.hasDefaultValue" class="filterPaneIcon clear largeFontSize" ng-class="{\'cardExpanded\': viewModel.readOnlyState.expanded}" ng-click="restoreDefaultFilter($event, viewModel)" localize-tooltip="FilterPane_ResetDefault"></button><h2 ng-if="viewModel.restatement" class="restatement trimmedTextWithEllipsis smallFontSize" ng-bind-attr="{title: viewModel.restatement}" ng-bind="viewModel.restatement"></h2></div></div><div ng-show="viewModel.readOnlyState.expanded"><div ng-if="viewModel.availableTypes.length> 1 && !viewModel.isSingleSelectionRequired && !viewModel.invalid"><h2 class="typeSelectTitle trimmedTextWithEllipsis smallFontSize" localize="FilterCardTypeSwitchLabel"></h2> <select class="typeSwitchOptions" ng-class="{ invalidType: viewModel.cardType.invalid }" localize="FilterCardTypeSwitchLabel" ng-options="cardType.label for cardType in ::viewModel.availableTypes track by cardType.label" ng-model="viewModel.cardType" ng-change="switchCardType(viewModel.cardType, viewModel)"/></div><ul><advanced-filter view-model="viewModel" ng-if="viewModel.cardType.type === 2"></advanced-filter><filter-visual view-model="viewModel" ng-if="(viewModel.cardType.type === 0 || viewModel.cardType.type === 4)"></filter-visual><top-n-filter view-model="viewModel" ng-if="viewModel.cardType.type === 5"></top-n-filter></ul></div><div class="cardFooter" ng-if="viewModel.readOnlyState.canToggleSingleSelect"><div class="required flex"> <input class="item-auto" type="checkbox" ng-click="updateRequiredState()" ng-model="viewModel.isSingleSelectionRequired" ng-disabled="::viewModel.disableSelectionModeToggle"><span localize="PageFilter_SingleSelectionRequired" class="label item-fill trimmedTextWithEllipsis" localize-tooltip="PageFilter_SingleSelectionRequired_Tooltip"></span></div></div></div></li>'),e.put("views/filterPane.html",'<section class="filterPane"><div id="visualFilterContainer" ng-if="isVisualFiltersVisible()"><h3 class="header unselectable trimmedTextWithEllipsis smallFontSize" localize="FilterPane_Visual" localize-tooltip="FilterPane_VisualDescription"></h3><div class="cards" drop="dropConfig" drop-handler="dropVisualFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.visualFilters" view-model="filter"></filter></ul><div ng-if="viewModeState.getMode() === 1" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.visualFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.visualFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}"> {{viewModel.visualFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}</div></div></div><div id="pageFilterContainer" ng-if="isPageFiltersVisible()"><h3 class="header smallFontSize unselectable" localize="FilterPane_Page" localize-tooltip="FilterPane_PageDescription"></h3><div class="cards" drop="dropConfig" drop-handler="dropPageFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.pageFilters" view-model="filter"></filter></ul><div ng-if="viewModeState.getConfig().alwaysPopulatePanes || viewModeState.getMode() === 1" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.pageFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.pageFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}"> {{viewModel.pageFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}</div></div></div><div id="exploreFilterContainer" ng-if="isReportFiltersVisible()"><h3 class="header smallFontSize unselectable" localize="FilterPane_Report" localize-tooltip="FilterPane_ReportDescription"></h3><div class="cards" drop="dropConfig" drop-handler="dropReportFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.reportFilters" view-model="filter"></filter></ul><div ng-if="viewModeState.getConfig().alwaysPopulatePanes || viewModeState.getMode() === 1" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.reportFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.reportFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}"> {{viewModel.reportFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}</div></div></div></section>'),e.put("views/filterVisual.html",'<div class="filterVisual"><visual ng-if="$ctrl.dataLoaded" view-model="$ctrl.viewModel.readOnlyState.visual"></visual><div class="filterSpinner" ng-if="$ctrl.viewModel.isLoading && !$ctrl.dataLoaded"><spinner></spinner><span class="message" localize="FilterCard_Loading"/></div><div class="filterError" ng-if="$ctrl.hasQueryError"><i class="icon filterPaneIcon error"/><span class="message" localize="FilterCard_ErrorMessage"/></div></div>'),e.put("views/importVisualErrorDialog.html",'<div><div class="importFailMessage" localize="ImportVisual_ErrorDialogMessage"></div><div class="buttons errorButton"> <button class="btn button primary" localize="ImportVisual_Close" ng-click="closeDialog()"></button></div></div>'),e.put("views/importVisualWarningDialog.html",'<div><div class="warningMessage" localize="ImportVisual_CautionDialogMessage"></div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="importVisual()" localize="ImportVisual_Import"></button> <button class="btn button" ng-click="closeDialog()" localize="ImportVisual_Cancel"></button></div></div>'),e.put("views/inputFields/propertyPaneTextBox.html",'<form name="inputForm" novalidate> <input type="{{::inputType}}" class="inputFieldInSlice" pbi-validate="validators" autocomplete="off" ng-change="onChange()" ng-model="sliceValue" ng-model-options="{ debounce: 400 }" tooltip tooltip-config="getErrorMessage()" placeholder="{{::placeholder}}" maxlength="250" name="inputField" ng-keydown="onKeydown($event)"/></form>'),e.put("views/inputFields/selectionBox.html",'<div class="popup-container-toggle" ng-click="showDropdown=!showDropdown"><div class="selection-box selection-box-position"><div class=\'selection-box-selected-block\'><span class=\'selection-box-icon\'></span><span class=\'selection-box-selected-item\' ng-bind="selectedItem.displayName"></span></div><popup-container ng-if="showDropdown" close="$parent.showDropdown=false" bind-parent-width><ul class="selection-box-menu"><li ng-repeat="item in items | filter: ( hasHideableItems ? {isHidden : false} : \'\') track by $index" class=\'selection-box-item trimmedTextWithEllipsis\' ng-click="itemSelected(item)" ng-class="{\'selected\': selectedItem === item}"><span ng-bind="item.displayName"></span></li></ul></popup-container></div></div>'),e.put("views/svg/visualsWatermarks.svg",'<?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 479 492" enable-background="new 0 0 479 492" xml:space="preserve"><symbol id="100stackedbar"><rect x="0" y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="20.6" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="74.7" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="129.8" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="184" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="241" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="20.6" fill="#D0D2D3" width="313.6" height="39"/><rect x="0" y="74.7" fill="#D0D2D3" width="284.9" height="39"/><rect x="0" y="129.8" fill="#D0D2D3" width="318.8" height="39"/><rect x="0" y="184" fill="#D0D2D3" width="308.6" height="39"/><rect x="0" y="241" fill="#D0D2D3" width="278.6" height="39"/><rect x="0" y="20.6" opacity="0.5" fill="#A6A8AB" width="211.1" height="39"/><rect x="0" y="74.7" opacity="0.5" fill="#A6A8AB" width="186.2" height="39"/><rect x="0" y="129.8" opacity="0.5" fill="#A6A8AB" width="211.1" height="39"/><rect x="0" y="184" opacity="0.5" fill="#A6A8AB" width="200" height="39"/><rect x="0" y="241" opacity="0.5" fill="#A6A8AB" width="184" height="39"/></symbol><symbol id="100stackedcolumn"><rect x="-0.1" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="73.4" x2="400" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.8" x2="400" y2="147.8"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="222.3" x2="400" y2="222.3"/><rect x="19" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="83.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="147.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="211.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="275.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="339.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="19" y="104.6" fill="#D0D2D3" width="40.9" height="195.5"/><rect x="83.1" y="58" fill="#D0D2D3" width="40.9" height="242.1"/><rect x="147.1" y="94.6" fill="#D0D2D3" width="40.9" height="205.5"/><rect x="211.1" y="99.5" fill="#D0D2D3" width="40.9" height="200.6"/><rect x="275.1" y="60.6" fill="#D0D2D3" width="40.9" height="239.5"/><rect x="339.1" y="136.5" fill="#D0D2D3" width="40.9" height="163.6"/><rect x="19" y="197.6" opacity="0.5" fill="#A6A8AB" width="40.9" height="102.5"/><rect x="83.1" y="173.2" opacity="0.5" fill="#A6A8AB" width="40.9" height="126.9"/><rect x="147.1" y="192.3" opacity="0.5" fill="#A6A8AB" width="40.9" height="107.8"/><rect x="211.1" y="184.7" opacity="0.5" fill="#A6A8AB" width="40.9" height="115.4"/><rect x="275.1" y="162.3" opacity="0.5" fill="#A6A8AB" width="40.9" height="137.8"/><rect x="339.1" y="206" opacity="0.5" fill="#A6A8AB" width="40.9" height="94.1"/></symbol><symbol id="area"><rect x="0.1" fill="#F4F4F4" width="399.8" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="73.5" x2="399.8" y2="73.5"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="147.9" x2="399.8" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="222.4" x2="399.8" y2="222.4"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.2" y1="73.5" x2="399.8" y2="73.5"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.9" x2="399.8" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="222.4" x2="399.8" y2="222.4"/><g><g><g><polygon fill="#E1E2E3" points="345.1,93.4 287.8,77 230.6,82.1 173.9,211.9 115.1,204.3 56.9,217.5 0.1,172.3 0.1,300           399.8,300 399.8,82.3"/></g></g></g><g><polygon fill="#D0D2D3" points="115.1,206.7 175,214.5 231.8,84.9 287.3,80 344.6,96.4 399.8,85.2 399.8,81.1 344.8,92.3       288.1,76.1 287.7,76 229,81.2 172.5,210.1 114.9,202.7 57.5,215.7 0.1,170.2 0.1,175.3 56.5,220"/></g></symbol><symbol id="bar"><rect y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="20.6" fill="#D0D2D3" width="179.9" height="39"/><rect x="0" y="74.7" fill="#D0D2D3" width="253.4" height="39"/><rect x="0" y="129.8" fill="#D0D2D3" width="224.6" height="39"/><rect x="0" y="184" fill="#D0D2D3" width="311.1" height="39"/><rect x="0" y="241" fill="#D0D2D3" width="367.2" height="39"/></symbol><symbol id="kpi"><g id="Creation" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"><g id="KPI-Canvas" sketch:type="MSArtboardGroup"><rect id="BG" fill="#FAFAFA" sketch:type="MSShapeGroup" x="0" y="0" width="400" height="299.441341"></rect><g id="Rectangle-20-+-Rectangle-21-+-Triangle-3" sketch:type="MSLayerGroup" transform="translate(122.000000, 123.000000)"><rect id="Rectangle-20" fill="#BABABA" sketch:type="MSShapeGroup" x="0" y="0" width="146" height="24"></rect><rect id="Rectangle-21" fill="#DDDDDD" sketch:type="MSShapeGroup" x="32" y="35" width="82" height="10"></rect><polygon id="Triangle-3" fill="#DDDDDD" sketch:type="MSShapeGroup" points="173.444444 1 186.888889 23 160 23 "></polygon></g><path d="M-2.30078125 266.449219 32.9472656 292.931641 66.9375 285.017578 100.927734 291.078125 134.900391 222.228516 167.779297 219.632812 198.302734 227.175781 242.171875 250.173828 286.412109 226.193359 316.695312 229.787109 352.632812 216.943359 425.914062 225.597656 425.914062 367.497434-34.7301703 367.497434-34.7301703 273.284528-2.30078125 266.449219Z" id="Path-2" stroke="#DDDDDD" stroke-width="2" fill="#EAEAEA" sketch:type="MSShapeGroup"></path></g></g></symbol><symbol id="card"><rect x="0" y="0.3" fill="#F4F4F4" width="400" height="299.6"/><rect x="0" y="0.3" fill="#A6A6A6" width="8" height="299.6"/><rect x="221.6" y="42.2" fill="#A6A6A6" width="139.9" height="4"/><rect x="221.6" y="109.7" fill="#A6A6A6" width="139.9" height="4"/><rect x="221.6" y="180" fill="#A6A6A6" width="141.7" height="4"/><rect x="221.6" y="249.5" fill="#A6A6A6" width="141.7" height="4"/><rect x="34.1" y="41.8" opacity="0.5" fill="#A6A8AB" width="142" height="142"/><rect x="36.1" y="249.5" fill="#A6A6A6" width="141.7" height="4"/></symbol><symbol id="clusteredBar"><rect x="-0.1" y="0" fill="#F4F4F4" width="400.1" height="300"/><rect x="0" y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="25.1" fill="#E1E2E3" width="290.1" height="13.5"/><rect x="0" y="71.1" fill="#E1E2E3" width="338.1" height="13.5"/><rect x="0" y="103.8" fill="#E1E2E3" width="237.1" height="13.5"/><rect x="0" y="182.6" fill="#E1E2E3" width="237.1" height="13.5"/><rect x="0" y="260.8" fill="#E1E2E3" width="313.1" height="13.5"/><rect x="0" y="38.8" fill="#ACACAC" width="211.1" height="13.5"/><rect x="0" y="136.5" fill="#E1E2E3" width="284.1" height="13.5"/><rect x="0" y="215" fill="#E1E2E3" width="240.1" height="13.5"/><rect x="0" y="150.2" fill="#ACACAC" width="336.1" height="13.5"/><rect x="0" y="228.4" fill="#ACACAC" width="284.1" height="13.5"/></symbol><symbol id="clusteredColumn"><rect x="-0.1" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="73.4" x2="400" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.8" x2="400" y2="147.8"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="222.3" x2="400" y2="222.3"/><rect x="43.7" y="163.6" fill="#D0D2D3" width="40.9" height="135.7"/><rect x="84.4" y="196.8" fill="#ACACAC" width="40.9" height="102.5"/><rect x="147.7" y="52.2" fill="#D0D2D3" width="40.9" height="247.1"/><rect x="315.4" y="131" fill="#D0D2D3" width="40.9" height="168.3"/><rect x="252" y="160.6" fill="#ACACAC" width="40.9" height="138.7"/><rect x="211.1" y="103.8" fill="#D0D2D3" width="40.9" height="195.5"/></symbol><symbol id="column"><rect x="0" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="73.5" x2="400" y2="73.5"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="147.9" x2="400" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="222.4" x2="400" y2="222.4"/><rect x="19.1" y="193.3" fill="#D0D2D3" width="40.9" height="106.9"/><rect x="83.1" y="167.8" fill="#D0D2D3" width="40.9" height="132.4"/><rect x="147.1" y="187.8" fill="#D0D2D3" width="40.9" height="112.4"/><rect x="211.2" y="82.1" fill="#D0D2D3" width="40.9" height="218.1"/><rect x="275.2" y="39.9" fill="#D0D2D3" width="40.9" height="260.3"/><rect x="339.2" y="122.3" fill="#D0D2D3" width="40.9" height="177.9"/></symbol><symbol id="combo"><rect x="0" y="0.3" fill="#F4F4F4" width="399.8" height="299.7"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="73.4" x2="399.7" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="147.9" x2="399.7" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="222.3" x2="399.7" y2="222.3"/><rect x="20.4" y="189.5" fill="#D0D2D3" width="40.7" height="110.6"/><rect x="84.1" y="163.1" fill="#D0D2D3" width="40.7" height="137"/><rect x="147.9" y="183.8" fill="#D0D2D3" width="40.7" height="116.4"/><rect x="211.6" y="74.4" fill="#D0D2D3" width="40.7" height="225.8"/><rect x="275.3" y="30.7" fill="#D0D2D3" width="40.7" height="269.5"/><rect x="339" y="116.1" fill="#D0D2D3" width="40.7" height="184.1"/><polyline opacity="0.5" fill="none" stroke="#A6A8AB" stroke-width="4" stroke-miterlimit="10" points="399.3,95.6 344.1,106.8     287.4,90.5 230.7,95.6 174.6,224.8 116.4,217.1 58.8,230.3 2.4,185.2 "/></symbol><symbol id="defaultWatermark"><g><rect x="0" y="1" opacity="0.5" fill="#F4F4F4" width="400" height="300"/><path fill="#929497" d="m93.79999 69.79999v47l30.20001 36.09998c10.29999-8.59998 16.79999-21.59998 16.79999-36.09998l0 0c0-25.89999-21.09998-47-47-47z"/><path fill="#D0D2D3" d="m46.7 116.9c0 22.1 15.3 40.49999 35.6 45.7l11.39999-45.7h-47l0 0 0 0z"/><path fill="#E1E2E3" d="m93.79999 116.89999-11.39999 45.69999c3.69998.90001 7.39999 1.5 11.39999 1.5 11.5 0 22-4.09999 30.20001-11l-30.20001-36.19999z"/><path fill="#A6A8AB" d="m93.79999 69.79999c-25.99998 0-46.99998 21-46.99998 47l0 0h46.99998v-47l0 0z"/><g><polygon fill="#E1E2E3" points="200.89999389648438 193.5999755859375 167.70001220703125 185.0999755859375 134.29998779296875 187.70001220703125 101.29998779296875 254.9000244140625 67.10000610351562 251 33.30000305175781 257.79998779296875 0.1999969482421875 234.4000244140625 0.1999969482421875 300.5 399.9000244140625 300.5 399.9000244140625 187.9000244140625 349.20001220703125 182.0999755859375 314.1000061035156 194.5999755859375 286.8999938964844 191.0999755859375 242 214.5 "/></g><g><polyline fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" points="399.9000244140625 187.70001220703125 349.20001220703125 182.0999755859375 314.1000061035156 194.5999755859375 286.8999938964844 191.0999755859375 242 214.5 200.89999389648438 193.4000244140625 167.70001220703125 185 134.29998779296875 187.5999755859375 101.29998779296875 254.79998779296875 67.10000610351562 251 33.30000305175781 257.70001220703125 0.1999969482421875 234.4000244140625 "/></g><rect x="185.6" y="115.9" fill="#E1E2E3" width="20.7" height="48"/><rect x="217.8" y="104.4" fill="#E1E2E3" width="20.7" height="59.5"/><rect x="250.1" y="113.4" fill="#E1E2E3" width="20.7" height="50.5"/><rect x="282.3" y="66" fill="#E1E2E3" width="20.7" height="97.9"/><rect x="314.6" y="47" fill="#E1E2E3" width="20.7" height="116.9"/><rect x="346.8" y="84" fill="#E1E2E3" width="20.7" height="79.9"/><rect x="185.6" y="129.5" fill="#D0D2D3" width="20.7" height="34.4"/><rect x="217.8" y="121.2" fill="#D0D2D3" width="20.7" height="42.7"/><rect x="250.1" y="127.7" fill="#D0D2D3" width="20.7" height="36.1"/><rect x="282.3" y="93.7" fill="#D0D2D3" width="20.7" height="70.2"/><rect x="314.6" y="80.1" fill="#D0D2D3" width="20.7" height="83.8"/><rect x="346.8" y="106.6" fill="#D0D2D3" width="20.7" height="57.2"/><rect x="185.6" y="145.1" opacity="0.5" fill="#A6A8AB" width="20.7" height="18.7"/><rect x="217.8" y="140.7" opacity="0.5" fill="#A6A8AB" width="20.7" height="23.2"/><rect x="250.1" y="144.1" opacity="0.5" fill="#A6A8AB" width="20.7" height="19.7"/><rect x="282.3" y="125.6" opacity="0.5" fill="#A6A8AB" width="20.7" height="38.2"/><rect x="314.6" y="118.3" opacity="0.5" fill="#A6A8AB" width="20.7" height="45.6"/><rect x="346.8" y="132.7" opacity="0.5" fill="#A6A8AB" width="20.7" height="31.1"/></g></symbol><symbol id="donut"><rect x="1.3" y="0.2" fill="#F4F4F4" width="398.7" height="299.8"/><path fill="#929497" d="M200.6 55.6v94.5l60.6 72.5c20.7-17.3 33.9-43.4 33.9-72.5v0C295.1 97.9 252.8 55.6 200.6 55.6z"/><path fill="#D0D2D3" d="M106.1 150.1c0 44.3 30.5 81.4 71.6 91.7l22.9-91.7H106.1z"/><path fill="#E1E2E3" d="M200.6 150.1l-22.9 91.7c7.3 1.8 15 2.8 22.9 2.8 23.1 0 44.2-8.3 60.6-22L200.6 150.1z"/><path fill="#A6A8AB" d="M200.6 55.6c-52.2 0-94.5 42.3-94.5 94.5v0h94.5V55.6z"/><circle fill="#F4F4F4" cx="200.6" cy="151" r="53.4"/></symbol><symbol id="funnel"><rect x="1.3" y="0" fill="#F4F4F4" width="398.7" height="300"/><g><g><g><rect x="46.5" y="59.7" fill="#D0D2D3" width="317.6" height="33.9"/></g><g><rect x="82.7" y="97.9" fill="#D0D2D3" width="245.2" height="33.9"/></g><g><rect x="141.2" y="136.2" fill="#D0D2D3" width="128.3" height="33.9"/></g><g><rect x="181.2" y="174.4" fill="#D0D2D3" width="48.3" height="33.9"/></g><g><rect x="194.1" y="212.6" fill="#D0D2D3" width="23.4" height="33.9"/></g></g></g></symbol><symbol id="filledMap"><rect x="0.7" y="0" opacity="0.5" fill="#F4F4F4" width="401.4" height="302.1"/><g><defs><rect id="SVGID_1_" x="0.2" y="0" width="401.4" height="302.1"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" overflow="visible"/></clipPath><path clip-path="url(#SVGID_2_)" fill="#E1E2E3" d="M49.4-9.3l18.3 44.6-97.2 30.3c-2.2.7-3.4 3-2.7 5.2.6 1.8 2.2 2.9 4 2.9.4 0 .8-.1 1.2-.2l57.4-17.9-1.9 32.9-59.3-4c-2.3-.2-4.3 1.6-4.4 3.9-.2 2.3 1.6 4.3 3.9 4.4l59.4 4-6.3 111-50.9-26.4c-2-1.1-4.5-.3-5.6 1.8-1.1 2-.3 4.5 1.8 5.6l56.6 29.4c0 0 0 0 0 0l21.2 11-71 60c-1.1.9-1.6 2.3-1.4 3.7.2 1.4 1 2.6 2.2 3.2l62.9 31.8c.6.3 1.2.4 1.9.4 1.5 0 3-.8 3.7-2.3 1-2 .2-4.5-1.8-5.6l-57.3-29 68.8-58.1 20.9 10.9-4.6 79.7c-.1 2.3 1.6 4.2 3.9 4.4.1 0 .2 0 .2 0 2.2 0 4-1.7 4.1-3.9l4.3-76 39 20.2-41.7 53c-1.4 1.8-1.1 4.4.7 5.8.8.6 1.7.9 2.6.9 1.2 0 2.4-.5 3.3-1.6L180.7 206l54.3 26.3-44.4 89.9c-1 2.1-.2 4.5 1.9 5.6.6.3 1.2.4 1.8.4 1.5 0 3-.8 3.7-2.3l44.4-90 40.4 19.6-34.1 66.7c-1 2-.2 4.5 1.8 5.6.6.3 1.2.5 1.9.5 1.5 0 3-.8 3.7-2.3l34.2-66.8 63.2 30.6-2.9 34c-.2 2.3 1.5 4.3 3.8 4.5.1 0 .2 0 .4 0 2.1 0 3.9-1.6 4.1-3.8l2.9-34.6L400 295c2.2-.5 3.6-2.8 3-5-.5-2.2-2.8-3.6-5-3l-35.5-5.9 4.3-51H399c2.3 0 4.1-1.9 4.1-4.1 0-2.3-1.9-4.1-4.1-4.1h-48.8l-32.4-16.4 1.2-2.4c.1-.3.2-.5.3-.8l3.4-12.9 76.1 2.9c.1 0 .1 0 .2 0 2.2 0 4.1-1.8 4.1-4 .1-2.3-1.7-4.2-4-4.3l-74.2-2.8 14.3-54c14.8 3.5 31.6 5.8 50.3 5.8 3.2 0 6.4-.1 9.6-.2 2.3-.1 4.1-2 4-4.3-.1-2.3-2-4.1-4.3-4-21.6.9-40.8-1.5-57.4-5.5l4.7-17.8c14.6 3.3 27.6 4.2 37.1 4.2 9.7 0 15.8-.9 16.3-1 2.3-.3 3.8-2.5 3.5-4.7-.3-2.3-2.4-3.8-4.7-3.5-.2 0-21.4 3.1-48.3-2.7l5.8-76.7 42.9 3.3c2.3.2 4.3-1.5 4.5-3.8.2-2.3-1.5-4.3-3.8-4.5l-45.4-3.5-17.5-31.4c-1.5-1.5-3.9-1.7-5.6-.3l-62.7 64.2c-9.9-13.8-17.7-30.2-23.5-48.9-.7-2.2-3-3.4-5.2-2.7-2.2.7-3.4 3-2.7 5.2 6.5 20.9 15.2 37.9 25.2 51.6l-19.1 16.1c-2.6-1.8-33.6-24.6-44.4-76.8-.5-2.2-2.7-3.7-4.9-3.2-2.2.5-3.7 2.7-3.2 4.9.7 3.3 1.4 6.5 2.3 9.5l-80.5 25.1c-11.6-10.9-7.7-34.5-7.7-34.8.4-2.3-1.1-4.4-3.4-4.8-2.3-.4-4.4 1.1-4.8 3.4-.2 1.1-4.1 24.4 7.2 38.9l-27.8 8.7c0 0 0 0 0-.1L55.8-15.6c-.8-1.8-2.7-2.9-4.7-2.5M307.8 206.7l-7 13.6-40.7-20.2 10.9-22 16 9.2c.6.3 1.2.5 1.9.6l25.4 1-2.8 10.7-2.2 4.3M286.3 71.9c6.9 5.7 13.9 10.4 20.9 14.3-.1.2-.3.4-.4.6l-8.1 16.4c-12.3-6.2-20.8-12.1-25-15.3l12.4-15.8C286.2 72.1 286.2 72 286.3 71.9zM268.5 94.5c4.5 3.5 13.4 9.8 26.4 16.3l-42.2 85.6-46.3-23.1L268.5 94.5zM316.5 180.6l-26.2-1-15.6-9 27.7-56.2c8.3 3.8 17.9 7.4 28.8 10.4L316.5 180.6zM333.4 116.7c-10.2-2.9-19.3-6.4-27.2-9.9l8-16.3c.1-.2.1-.4.2-.6 6.4 3.1 12.7 5.5 18.7 7.4 1.7.5 3.4 1 5 1.5L333.4 116.7zM333.1-14.8l14.6 28.5-5.8 77.7c-2.1-.6-4.1-1.2-6.2-1.9-25.4-8.2-46.3-22.3-62.4-42.3L333.1-14.8zM280.2 66.5c-.2.2-.4.4-.6.6l-82.9 105.2 0 0-18.4 23.4-51.4-24.9L267 52.3C271.2 57.5 275.6 62.3 280.2 66.5zM86.8 160.6l24.9 12.1-26.9 22.7L86.8 160.6zM87.4 151.6l3-52.7 8.4-4.6 2.2 3.5v14.7c0 2.3 1.9 4.1 4.1 4.1h27.7c1.1 0 2.1-.4 2.9-1.1L165.6 87l20.7 22.7-67.6 57.1L87.4 151.6zM184.9 47.6l4 5.6-57.7 55.1h-21.9V96.6c0-.8-.2-1.6-.6-2.2l-2.6-4L184.9 47.6zM236.3 67.4l-43.7 36.9-21-23.1 25.7-24.5c1.5-1.4 1.7-3.7.5-5.4l-5.5-7.7 16.2-8.8C219.5 53.4 231.5 63.7 236.3 67.4zM204.5 27.5 90.9 89.1l3-53.3L194.9 4.3C197.7 13 201 20.7 204.5 27.5zM38.8 53l46.7-14.6-3.1 53.8-45.7-3.1L38.8 53zM29.8 212l6.5-114.6 45.7 3.1-5.8 102.2-24.4 20.6L29.8 212zM59.7 227.5l15.8-13.4L74.3 235 59.7 227.5zM126.1 261.9l-43.7-22.7 1.9-32.5 35.7-30.2 53.1 25.7L126.1 261.9zM185.9 199.3l15.2-19.3 47.9 23.8-10.4 21L185.9 199.3zM246.1 228.5l10.3-21 40.6 20.2-10.4 20.4L246.1 228.5zM294.1 251.7l12.3-24c0 0 0 0 0 0l0 0 7.7-15 33.3 16.9c.6.3 1.2.4 1.9.4h9.3l-4.3 50.8L294.1 251.7z"/></g><g><polygon fill="#A6A8AB" points="119.4,172.5 81.5,203.8 79.7,244.4 127.5,265.1 178.4,199.4 \t"/><path fill="#A6A8AB" d="M127.5 270.4c-.7 0-1.4-.1-2.1-.4l-47.8-20.7c-2-.9-3.3-2.9-3.2-5.1l1.8-40.5c.1-1.5.8-2.9 1.9-3.8l37.9-31.3c1.6-1.3 3.7-1.6 5.6-.7l59 26.9c1.5.7 2.6 2 2.9 3.5.4 1.6 0 3.2-1 4.5l-50.9 65.7C130.7 269.6 129.1 270.4 127.5 270.4zM85.2 240.9l40.7 17.6 44.3-57.1-50-22.7-33.5 27.7L85.2 240.9z"/></g><g><path fill="#A6A8AB" d="M301.3 108.4l-30.6 62.9L289 183l30.9.6 16-61.9C336 121.7 324 121 301.3 108.4z"/><path fill="#A6A8AB" d="M320 188.9C319.9 188.9 319.9 188.9 320 188.9l-31-.6c-1 0-1.9-.3-2.8-.8l-18.3-11.7c-2.3-1.5-3.1-4.4-1.9-6.8l30.6-62.9c.6-1.3 1.8-2.3 3.2-2.8 1.4-.4 2.9-.3 4.2.4 20.9 11.7 32.2 12.6 32.4 12.6 1.6.1 3 .9 4 2.2.9 1.3 1.2 2.9.9 4.4l-16 61.9C324.5 187.3 322.4 188.9 320 188.9zM290.6 177.7l25.2.5 13.5-52.3c-5.3-1.3-14-4.1-25.7-10.2l-26.1 53.6L290.6 177.7z"/></g><g><polygon fill="#A6A8AB" points="99.7,90.8 104.9,98.1 104.9,111.3 132,111.3 192.9,53.8 185.9,42.8 \t"/><path fill="#A6A8AB" d="M132 116.6h-27.1c-2.9 0-5.3-2.4-5.3-5.3V99.8l-4.3-5.9c-.9-1.2-1.2-2.8-.9-4.3.3-1.5 1.3-2.8 2.6-3.5l86.3-47.9c1.9-1 4.2-.8 5.8.5l6.9 10.9c1.2 1 1.9 2.4 2 3.9.1 1.5-.5 3-1.6 4.1l-60.8 57.5C134.7 116 133.4 116.6 132 116.6zM110.2 106h19.7l54.9-51.9-2.4-1.9-74.9 40.4 1.7 2.4c.7.9 1 2 1 3.1V106z"/></g><g><polygon fill="#A6A8AB" points="4.8,91.4 30.6,92.8 24.6,213.1 4.8,201.8 \t"/><path fill="#A6A8AB" d="M24.6 218.4c-.9 0-1.8-.2-2.6-.7L2.2 206.4c-1.7-.9-2.7-2.7-2.7-4.6V91.4c0-1.4.6-2.8 1.6-3.8 1.1-1 2.5-1.5 3.9-1.4l25.8 1.3c2.9.1 5.2 2.6 5 5.5l-5.9 120.3c-.1 1.8-1.1 3.5-2.7 4.4C26.4 218.1 25.5 218.4 24.6 218.4zM10.1 198.7l9.7 5.5L25 97.8 10.1 97V198.7z"/></g><g><polygon fill="#A6A8AB" points="240.1,229.5 255.4,202.2 301.3,225.5 287.4,251.5 \t"/><path fill="#A6A8AB" d="M287.4 256.8c-.8 0-1.5-.2-2.2-.5l-47.3-22c-1.3-.6-2.4-1.8-2.8-3.2s-.3-2.9.4-4.2l15.3-27.3c1.4-2.5 4.5-3.4 7.1-2.1l45.9 23.3c1.3.6 2.2 1.8 2.7 3.2.4 1.4.3 2.9-.4 4.1l-14 26C291.1 255.8 289.3 256.8 287.4 256.8zM247.6 227.1l37.5 17.4 9-16.7-36.5-18.5L247.6 227.1z"/></g><g><polygon fill="#A6A8AB" points="358.4,272.1 364.6,226.4 396.5,226.4 397,271.7 \t"/><path fill="#A6A8AB" d="M358.4 277.4c-1.5 0-3-.7-4-1.8-1-1.2-1.5-2.7-1.3-4.2l6.2-45.7c.4-2.6 2.6-4.6 5.3-4.6h31.9c2.9 0 5.3 2.4 5.3 5.3l.4 45.3c0 2.9-2.3 5.3-5.3 5.4L358.4 277.4C358.4 277.4 358.4 277.4 358.4 277.4zM369.2 231.7l-4.8 35 27.1-.3-.3-34.7H369.2z"/></g><g><path fill="#A6A8AB" d="M198.6 5c0 0 6.2 34.2 43.5 62.6L314 5.4 198.6 5z"/><path fill="#A6A8AB" d="M242.1 72.9c-1.1 0-2.3-.4-3.2-1.1-38.5-29.3-45.2-64.4-45.5-65.8-.3-1.6.1-3.2 1.2-4.4 1-1.2 2.5-1.9 4.1-1.9L314 .1c2.2 0 4.2 1.4 5 3.5.8 2.1.2 4.4-1.5 5.9l-71.9 62.1C244.6 72.4 243.4 72.9 242.1 72.9zM205.7 10.3c3.5 10.3 13 31.4 36.3 50.3l57.8-49.9L205.7 10.3z"/></g><g><path fill="#A6A8AB" d="M56.3 5l15 31.3 37-11.5c0 0-3.1-4.4-7.9-20.3L56.3 5z"/><path fill="#A6A8AB" d="M71.2 41.5c-2 0-3.9-1.1-4.8-3l-15-31.3c-.8-1.6-.7-3.5.3-5.1s2.6-2.5 4.4-2.5l44.1-.4c0 0 0 0 .1 0 2.3 0 4.4 1.5 5.1 3.7 4.4 14.4 7.2 18.8 7.3 18.9 1 1.4 1.2 3.1.6 4.7-.5 1.6-1.9 2.8-3.5 3.3l-37 11.5C72.3 41.5 71.8 41.5 71.2 41.5zM64.6 10.2 74 29.8l26.7-8.3c-1.2-2.7-2.6-6.5-4.3-11.7L64.6 10.2z"/></g><g><path fill="#A6A8AB" d="M397.4 21.9l-1.6 78.5c-29.3 4.7-49.9-4.7-49.9-4.7L353 17l-8.4-12h53.2L397.4 21.9z"/><path fill="#A6A8AB" d="M379.4 107c-21.2 0-35.1-6.2-35.7-6.4-2.1-.9-3.3-3.1-3.1-5.3l6.9-76.8-7.3-10.4c-1.1-1.6-1.3-3.8-.4-5.5.9-1.8 2.7-2.9 4.7-2.9h53.2c1.4 0 2.8.6 3.8 1.6 1 1 1.5 2.4 1.5 3.9L402.7 22l-1.6 78.5c-.1 2.6-1.9 4.7-4.5 5.2C391 106.6 385.2 107 379.4 107zM351.6 92.2c5 1.6 14.9 4.2 27.8 4.2 3.7 0 7.5-.2 11.2-.6l1.5-74 .3-11.4h-37.5l2.5 3.6c.7 1 1.1 2.3.9 3.5L351.6 92.2z"/></g></symbol><symbol id="gauge"><rect y="0.4" opacity="0.5" fill="#F4F4F4" width="400.1" height="299.6"/><path fill="#E1E2E3" d="M200 82.3c-73.7 0-133.4 59.7-133.4 133.4h51.6c0-45.2 36.6-81.8 81.8-81.8s81.8 36.6 81.8 81.8h51.6C333.4 142 273.7 82.3 200 82.3z"/><path fill="#A6A8AB" d="M94.4 134.3C77 156.8 66.7 185 66.7 215.7h51.6c0-18.9 6.4-36.2 17.1-50.1L94.4 134.3z"/></symbol><symbol id="line"><rect x="0.1" fill="#F4F4F4" width="399.3" height="300.2"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.1" y1="73" x2="399.4" y2="73"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.1" y1="147" x2="399.4" y2="147"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.1" y1="220.9" x2="399.4" y2="220.9"/><g><polygon fill="#D0D2D3" points="115.1,206.7 175,214.5 231.8,84.9 287.3,80 344.6,96.4 399.8,85.2 399.8,81.1 344.8,92.3       288.1,76.1 287.7,76 229,81.2 172.5,210.1 114.9,202.7 57.5,215.7 0.1,170.2 0.1,175.3 56.5,220 \t"/></g></symbol><symbol id="map"><g><defs><rect id="SVGID_1_" x="0.9" y="0.2" width="399.1" height="299.6"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" overflow="visible"/></clipPath><path clip-path="url(#SVGID_2_)" fill="#E1E2E3" d="M54.1-9.8l19.8 48.3L-31.3 71.3c-2.4.7-3.7 3.3-2.9 5.6.6 1.9 2.4 3.2 4.3 3.2.4 0 .9-.1 1.3-.2l62.1-19.4-2 35.6-64.1-4.4c-2.5-.2-4.6 1.7-4.8 4.2-.2 2.5 1.7 4.6 4.2 4.8L31 105l-6.8 120.1-55-28.5c-2.2-1.1-4.9-.3-6.1 1.9-1.1 2.2-.3 4.9 1.9 6.1l61.3 31.8c0 0 0 0 0 0l22.9 11.9-76.8 64.9c-1.2 1-1.7 2.5-1.6 4 .2 1.5 1.1 2.8 2.4 3.5l68.1 34.4c.6.3 1.3.5 2 .5 1.6 0 3.2-.9 4-2.5 1.1-2.2.2-4.9-2-6l-62-31.4 74.4-62.9 22.7 11.8-4.9 86.3c-.1 2.5 1.8 4.6 4.2 4.7.1 0 .2 0 .3 0 2.4 0 4.3-1.8 4.5-4.2l4.7-82.2 42.2 21.9-45.2 57.3c-1.5 1.9-1.2 4.8.7 6.3.8.6 1.8 1 2.8 1 1.3 0 2.6-.6 3.5-1.7l102.9-130.5 58.8 28.5-48 97.3c-1.1 2.2-.2 4.9 2 6 .6.3 1.3.5 2 .5 1.7 0 3.2-.9 4-2.5l48-97.4 43.7 21.2-36.9 72.2c-1.1 2.2-.3 4.9 2 6 .7.3 1.4.5 2 .5 1.6 0 3.2-.9 4-2.4l37-72.3 68.4 33.1-3.1 36.8c-.2 2.5 1.6 4.6 4.1 4.9.1 0 .3 0 .4 0 2.3 0 4.3-1.8 4.5-4.1l3.2-37.5 41.3 5.7c2.4-.6 3.9-3 3.3-5.4-.6-2.4-3-3.9-5.4-3.3l-38.4-6.4 4.7-55.2h34.8c2.5 0 4.5-2 4.5-4.5s-2-4.5-4.5-4.5h-52.8l-35.1-17.8 1.4-2.6c.1-.3.3-.6.3-.9l3.7-14 82.3 3.1c.1 0 .1 0 .2 0 2.4 0 4.4-1.9 4.5-4.3.1-2.5-1.8-4.6-4.3-4.7l-80.3-3 15.5-58.4c16 3.8 34.2 6.3 54.4 6.3 3.4 0 6.9-.1 10.4-.2 2.5-.1 4.4-2.2 4.3-4.7-.1-2.5-2.2-4.4-4.7-4.3-23.3 1-44.1-1.6-62.1-6l5.1-19.3c15.8 3.6 29.9 4.5 40.2 4.5 10.5 0 17.1-1 17.7-1 2.5-.4 4.1-2.7 3.8-5.1-.4-2.5-2.7-4.1-5.1-3.8-.3 0-23.2 3.3-52.3-2.9l6.2-83 46.4 3.6c2.5.2 4.6-1.7 4.8-4.1.2-2.5-1.7-4.6-4.1-4.8L383.6 9l-18.9-34c-1.6-1.7-4.2-1.8-6.1-.4l-67.8 69.5c-10.7-15-19.2-32.6-25.5-52.9-.7-2.4-3.3-3.7-5.6-3-2.4.7-3.7 3.2-3 5.6 7 22.7 16.5 41 27.2 55.9l-20.7 17.5c-2.8-2-36.3-26.7-48-83.1-.5-2.4-2.9-4-5.3-3.5-2.4.5-4 2.9-3.5 5.3.7 3.6 1.6 7 2.5 10.3l-87.1 27.2c-12.6-11.8-8.4-37.4-8.3-37.6.4-2.4-1.2-4.8-3.6-5.2-2.5-.4-4.8 1.2-5.2 3.6-.2 1.2-4.4 26.4 7.8 42.1l-30.1 9.4c0 0 0 0 0-.1L61-16.7c-.8-2-2.9-3.1-5-2.7M333.7 223.9l-7.5 14.7-44-21.9 11.8-23.8 17.3 10c.6.4 1.3.6 2.1.6l27.4 1-3.1 11.6-2.4 4.6M310.5 78c7.4 6.2 15.1 11.3 22.6 15.4-.2.2-.3.4-.4.7l-8.8 17.8c-13.3-6.7-22.5-13.1-27-16.5l13.4-17.1C310.3 78.2 310.4 78.1 310.5 78zM291.2 102.5c4.9 3.8 14.6 10.6 28.6 17.7l-45.7 92.6L224 187.8 291.2 102.5zM343.1 195.6l-28.4-1.1-16.9-9.7 30-60.8c9 4.1 19.4 8 31.2 11.3L343.1 195.6zM361.4 126.5c-11.1-3.1-20.9-6.9-29.4-10.7l8.7-17.7c.1-.2.2-.4.2-.6 7 3.4 13.8 6 20.2 8.1 1.8.6 3.6 1.1 5.4 1.6L361.4 126.5zM361.1-15.8 376.9 15l-6.3 84c-2.2-.6-4.5-1.3-6.8-2-27.5-8.8-50.1-24.2-67.6-45.8L361.1-15.8zM303.8 72.2c-.2.2-.4.4-.6.6l-89.7 113.8 0 0-19.9 25.3-55.7-27L289.5 56.9C294.1 62.5 298.9 67.6 303.8 72.2zM94.6 174l26.9 13-29.1 24.6L94.6 174zM95.2 164.3l3.3-57.1 9.1-4.9 2.4 3.8V122c0 2.5 2 4.5 4.5 4.5h29.9c1.2 0 2.3-.4 3.1-1.2l32.3-30.9 22.4 24.6L129 180.7 95.2 164.3zM200.7 51.7l4.3 6.1-62.5 59.7h-23.7v-12.7c0-.9-.2-1.7-.7-2.4l-2.8-4.4L200.7 51.7zM256.3 73.2 209 113.1l-22.8-25L214 61.6c1.6-1.5 1.9-4 .6-5.8l-5.9-8.3 17.6-9.5C238.2 58.1 251.1 69.2 256.3 73.2zM221.9 30 99 96.7l3.3-57.7L211.5 4.9C214.6 14.3 218.1 22.7 221.9 30zM42.7 57.6l50.5-15.8L89.9 100l-49.4-3.4L42.7 57.6zM32.9 229.6l7.1-124 49.4 3.4L83 219.6l-26.4 22.3L32.9 229.6zM65.2 246.4l17.1-14.5L81 254.6 65.2 246.4zM137 283.6l-47.3-24.5 2-35.2 38.6-32.6 57.5 27.8L137 283.6zM201.8 215.9l16.5-20.9 51.8 25.8-11.2 22.8L201.8 215.9zM267 247.5l11.2-22.7 43.9 21.8-11.3 22L267 247.5zM318.9 272.6l13.3-26c0 0 0 0 0 0l0 0 8.3-16.3 36.1 18.3c.6.3 1.3.5 2 .5h10.1l-4.6 55L318.9 272.6z"/></g><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="45.5" cy="62.9" r="18.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="158.8" cy="177.3" r="12.8"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="228.2" cy="235" r="12.8"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="297.6" cy="157.2" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="20.8" cy="230.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="382.6" cy="250.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="374.7" cy="22.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="240.9" cy="111.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="182.7" cy="26" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="268.6" cy="95.6" r="13.6"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.0954" stroke-miterlimit="10" cx="63.2" cy="124.9" r="11.3"/></symbol><symbol id="matrix"><rect x="0" y="0.1" fill="#F4F4F4" width="400" height="299.9"/><rect x="0.3" y="0" fill="#E1E2E3" width="92.8" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0.5" x2="199.7" y2="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="300"/><rect x="14.7" y="46.4" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="46.4" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="46.4" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="46.4" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="79.7" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="79.7" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="79.7" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="79.7" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="114" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="114" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="114" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="114" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="148.5" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="148.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="148.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="148.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="182.3" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="182.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="182.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="182.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="215.3" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="215.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="215.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="215.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="248.6" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="248.6" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="248.6" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="248.6" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="281.5" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="281.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="281.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="281.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="15.2" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="15.2" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="15.2" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="15.2" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="0" y="0" fill="#D0D2D3" width="399.8" height="30.4"/></symbol><symbol id="multiRowCard"><rect x="-0.1" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><rect x="22" y="21" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="22" y="91" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="22" y="160.3" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="22" y="231" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="36.7" y="35.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="36.7" y="46.2" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="36.7" y="105.4" fill="#ACACAC" width="56.4" height="7.7"/><rect x="36.7" y="116.1" fill="#D0D2D3" width="46.3" height="7.7"/><rect x="36.7" y="174.7" fill="#ACACAC" width="65.8" height="7.7"/><rect x="36.7" y="185.4" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="36.7" y="245.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="36.7" y="256.2" fill="#D0D2D3" width="28.2" height="7.7"/><rect x="163.1" y="35.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="163.1" y="46.2" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="163.1" y="105.4" fill="#ACACAC" width="56.4" height="7.7"/><rect x="163.1" y="116.1" fill="#D0D2D3" width="46.3" height="7.7"/><rect x="163.1" y="174.7" fill="#ACACAC" width="65.8" height="7.7"/><rect x="163.1" y="185.4" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="163.1" y="245.5" fill="#ACACAC" width="39.3" height="7.7"/><rect x="163.1" y="256.2" fill="#D0D2D3" width="28.2" height="7.7"/><rect x="289.5" y="35.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="289.5" y="46.2" fill="#D0D2D3" width="75.4" height="7.7"/><rect x="289.5" y="105.4" fill="#ACACAC" width="37.7" height="7.7"/><rect x="289.5" y="116.1" fill="#D0D2D3" width="87.4" height="7.7"/><rect x="289.5" y="174.7" fill="#ACACAC" width="28.2" height="7.7"/><rect x="289.5" y="185.4" fill="#D0D2D3" width="56.4" height="7.7"/><rect x="289.5" y="245.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="289.5" y="256.2" fill="#D0D2D3" width="87.4" height="7.7"/></symbol><symbol id="pie"><rect y="0.2" fill="#F4F4F4" width="400" height="299.8"/><path fill="#929497" d="M200 55.3v94.8l60.8 72.7c20.8-17.4 34-43.5 34-72.7v0C294.8 97.7 252.3 55.3 200 55.3z"/><path fill="#D0D2D3" d="M105.2 150.1c0 44.4 30.6 81.7 71.8 92l23-92H105.2z"/><path fill="#E1E2E3" d="M200 150.1l-23 92c7.4 1.8 15.1 2.8 23 2.8 23.1 0 44.3-8.3 60.8-22.1L200 150.1z"/><path fill="#A6A8AB" d="M200 55.3c-52.3 0-94.8 42.4-94.8 94.8v0H200V55.3z"/></symbol><symbol id="scatterplot"><rect x="1.3" y="0" fill="#F4F4F4" width="398.7" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="133.9" y1="0.4" x2="133.9" y2="298"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="266.9" y1="0.4" x2="266.9" y2="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="149.8" x2="400" y2="149.8"/><circle fill="#D0D2D3" cx="74.9" cy="214.1" r="36.2"/><circle fill="#D0D2D3" cx="186" cy="94" r="12.9"/><circle fill="#D0D2D3" cx="266.9" cy="124.1" r="17.2"/><circle fill="#D0D2D3" cx="310.4" cy="193.8" r="26.3"/><circle fill="#D0D2D3" cx="214.5" cy="176.3" r="18.6"/><circle fill="#D0D2D3" cx="137" cy="150.2" r="12.9"/><circle fill="#D0D2D3" cx="346.4" cy="68.1" r="12.9"/></symbol><symbol id="shapeMap"><rect x="0.7" y="0" opacity="0.5" fill="#F4F4F4" width="401.4" height="302.1"/><g><path fill-rule="evenodd" clip-rule="evenodd" fill="#EEEEEE" d="M379.2 0H400v10.75l-14.2-1.5c-1.672-.266-2.738-1.016-3.2-2.25L379.2 0zM218.775 0h39c7.22 18.663 16.17 35.087 26.85 49.275L261.85 68.55C243.634 49.55 229.275 26.7 218.775 0zM0 62V0h57.725L73.15 38.875 0 62zM78.175 300H1.25l55.925-47.325L80.2 264.775 78.175 300zM231.05 300h-96.475l60.575-76.7 59.575 28.851L231.05 300zM400 206.675v34.575h-18.5l-37.15-18.025 1.825-3.475 3.875-14.825L400 206.675zM400 142.875v55.05l-47.675-1.649 15.725-59.95C378.267 138.94 388.917 141.123 400 142.875zM361.275 125.875c-10.32-2.924-20.153-6.332-29.5-10.225l9.5-19.175c7.915 3.922 16.273 7.272 25.074 10.05L361.275 125.875zM326.425 238.75 281.6 217.025 293.45 193.1l17.3 9.15c1.639.954 3.472 1.454 5.5 1.5l24.4.85-3.7 14.15L326.425 238.75zM304.65 71.4 192.9 212.875l-56.4-27.3 153.325-129.75C294.472 61.398 299.414 66.59 304.65 71.4zM121.25 187.5l-30.1 25.475L93.375 174 121.25 187.5zM39.55 105.2l49.6 3.2-6.375 111.65L56.25 242.475l-24.7-12.949L39.55 105.2zM258.45 244.65l-57.976-28.101 17.075-21.625L270.4 220.5 258.45 244.65z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M369.4 0l7.024 14.975L371 99.15c-30.688-8.892-55.647-25.2-74.875-48.925L345.425 0H369.4zM400 114.05v20.15c-10.34-1.591-20.281-3.575-29.825-5.95l5-19.175C383.115 111.174 391.39 112.833 400 114.05zM333.675 0l-42.85 43.325C281.736 30.743 274.086 16.301 267.875 0H333.675zM353.45 300H304l10.05-19.1L353.45 300zM240.55 300l21.825-44.15 43.9 21.275L294.25 300H240.55zM0 212.95V102.675l30.925 1.975-7.75 120.475L0 212.95zM111.975 0H196.1l-75.025 23.725C115.636 18.07 112.603 10.162 111.975 0zM0 290.075v-67.4l49.175 25.8L0 290.075zM124.1 300H86.175l1.775-31.15 42.95 22.525L124.1 300zM392.025 300l5.225-49.85H400V300H392.025zM384.275 300H372.7l-54.75-26.525 22.524-42.875 37.551 18.226c1.563.898 3.389 1.34 5.475 1.325h6L384.275 300zM359.175 133.9l-16.25 62.05L316 195l-18.6-9.875 30.75-62.15C337.978 127.132 348.319 130.773 359.175 133.9zM295.35 96.425l15.5-19.625c7.126 5.878 14.751 11.103 22.875 15.675l-9.774 19.75C313.812 107.567 304.277 102.3 295.35 96.425zM199.925 51.6l4.575 5.9-62 59.75h-25.3l.75-11.25c-.098-2.051-.498-3.617-1.2-4.7L114.3 98 199.925 51.6zM40.075 97l2.575-39.975L93 41.1l-3.375 59.075L40.075 97zM80.75 255.325l-16.475-8.65L82.1 231.6 80.75 255.325zM136.325 284.5 88.5 259.4l2-34.9 39-33 58.075 28.125L136.325 284.5zM310.175 269.7 266.1 248.35l11.95-24.149 44.65 21.649L310.175 269.7z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#F8F8F8" d="M66.725 0h36.325c.458 11.727 3.549 20.561 9.275 26.5L81.15 36.35 66.725 0zM0 94.425V70.5l33.8-10.675L31.45 96.45 0 94.425zM400 19.825V105.1c-6.929-.898-13.62-2.106-20.075-3.625l5.351-83.225L400 19.825zM223.075 29.2l-125.3 67.925 3.35-58.6L211.05 3.775C214.647 12.659 218.656 21.134 223.075 29.2zM207.675 47.4l19.7-10.7c8.162 13.625 17.57 26 28.225 37.125l-46.875 39.65-23.3-25.825L213.5 60.6c1.147-1.6 1.364-3.2.65-4.8L207.675 47.4zM320.35 119.525l-46.399 93.8-51.3-24.851 67.675-85.7C299.695 108.996 309.704 114.579 320.35 119.525zM179.125 93.725l22.925 25.4-73.775 62.45L93.9 164.925l3.3-57.625 9.7-5.275 2.95 3.975-1 15.1c.133 3.4 1.916 5.15 5.35 5.25h28.65c1.682.015 3.099-.568 4.25-1.75L179.125 93.725z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#D9D9D9" d="M400 10.75v9.075l-14.725-1.575-5.351 83.225c6.455 1.519 13.146 2.727 20.075 3.625v8.95c-8.61-1.217-16.885-2.875-24.825-4.975l-5 19.175c9.544 2.375 19.485 4.359 29.825 5.95v8.675c-11.083-1.752-21.733-3.935-31.95-6.55l-15.725 59.95L400 197.925v8.75l-49.95-1.75-3.875 14.825-1.825 3.475 37.15 18.025H400v8.9h-2.75L392.025 300h-7.75l5.225-49.85h-6c-2.086.015-3.911-.427-5.475-1.325L340.475 230.6l-22.524 42.875L372.7 300h-19.25l-39.4-19.1L304 300h-9.75l12.025-22.875-43.9-21.275L240.55 300h-9.5l23.675-47.85L195.15 223.3 134.575 300H124.1l6.8-8.625L87.95 268.85 86.175 300h-8l2.025-35.225-23.025-12.101L1.25 300H0v-9.925l49.175-41.601L0 222.675v-9.725l23.175 12.175 7.75-120.475L0 102.675v-8.25l31.45 2.025 2.35-36.625L0 70.5V62l73.15-23.125L57.725 0h9L81.15 36.35l31.175-9.85c-5.726-5.939-8.818-14.773-9.275-26.5h8.925c.627 10.162 3.661 18.07 9.1 23.725L196.1 0h22.675c10.5 26.7 24.858 49.55 43.074 68.55l22.775-19.275c-10.68-14.188-19.63-30.612-26.85-49.275h10.1c6.211 16.301 13.861 30.743 22.95 43.325L333.675 0h11.75l-49.3 50.225C315.353 73.95 340.312 90.258 371 99.15l5.425-84.175L369.4 0h9.8l3.399 7c.462 1.234 1.528 1.984 3.2 2.25L400 10.75zM361.275 125.875l5.074-19.35c-8.801-2.778-17.159-6.128-25.074-10.05l-9.5 19.175C341.122 119.543 350.955 122.951 361.275 125.875zM359.175 133.9c-10.855-3.126-21.197-6.768-31.024-10.925l-30.75 62.15L316 195l26.925.95L359.175 133.9zM326.425 238.75l10.525-20 3.7-14.15-24.4-.85c-2.028-.046-3.861-.546-5.5-1.5l-17.3-9.15L281.6 217.025 326.425 238.75zM304.65 71.4c-5.236-4.81-10.179-10.001-14.825-15.575L136.5 185.575l56.4 27.3L304.65 71.4zM295.35 96.425c8.928 5.875 18.462 11.142 28.601 15.8l9.774-19.75c-8.124-4.572-15.749-9.797-22.875-15.675L295.35 96.425zM223.075 29.2c-4.419-8.066-8.428-16.541-12.025-25.425l-109.925 34.75-3.35 58.6L223.075 29.2zM207.675 47.4l6.476 8.4c.714 1.6.497 3.2-.65 4.8l-28.075 27.05 23.3 25.825 46.875-39.65c-10.654-11.125-20.063-23.5-28.225-37.125L207.675 47.4zM199.925 51.6 114.3 98l2.45 3.3c.703 1.083 1.103 2.649 1.2 4.7l-.75 11.25h25.3l62-59.75L199.925 51.6zM320.35 119.525c-10.646-4.946-20.654-10.529-30.024-16.75l-67.675 85.7 51.3 24.851L320.35 119.525zM179.125 93.725 147.1 124.6c-1.151 1.182-2.568 1.765-4.25 1.75H114.2c-3.434-.1-5.217-1.85-5.35-5.25l1-15.1-2.95-3.975-9.7 5.275-3.3 57.625 34.375 16.65 73.775-62.45L179.125 93.725zM40.075 97l49.55 3.175L93 41.1 42.65 57.025 40.075 97zM121.25 187.5 93.375 174l-2.225 38.975L121.25 187.5zM39.55 105.2l-8 124.325 24.7 12.949 26.525-22.425L89.15 108.4 39.55 105.2zM136.325 284.5l51.25-64.875L129.5 191.5l-39 33-2 34.9L136.325 284.5zM80.75 255.325 82.1 231.6l-17.825 15.075L80.75 255.325zM258.45 244.65l11.95-24.15-52.851-25.575-17.075 21.625L258.45 244.65zM310.175 269.7 322.7 245.85 278.05 224.2 266.1 248.35 310.175 269.7z"/></g></symbol><symbol id="slicer"><rect x="-0.1" y="0" fill="#F4F4F4" width="400.1" height="300"/><rect x="11.8" y="17.7" fill="#D0D2D3" width="34.7" height="15.3"/><rect x="34.1" y="57" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="55" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="12.8" y="79" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="105" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="103" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="129" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="127" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="153" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="151" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="177" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="175" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="201" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="199" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="225" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="223" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="249" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="247" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="273" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="271" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="81.7" fill="#D0D2D3" width="33.8" height="7.7"/><line fill="none" stroke="#D0D2D3" stroke-miterlimit="10" x1="3.4" y1="44.3" x2="389.4" y2="44.3"/></symbol><symbol id="stackedarea"><rect id="XMLID_263_" x="0" opacity="0.5" fill="#F1F2F2" width="400" height="300"/><line id="XMLID_262_" opacity="0.5" fill="#F4F4F4" x1="0" y1="38" x2="400" y2="38"/><line id="XMLID_261_" opacity="0.5" fill="#F4F4F4" x1="0" y1="75.4" x2="400" y2="75.4"/><line id="XMLID_260_" opacity="0.5" fill="#F4F4F4" x1="0" y1="112.8" x2="400" y2="112.8"/><line id="XMLID_259_" opacity="0.5" fill="#F4F4F4" x1="0" y1="150.3" x2="400" y2="150.3"/><line id="XMLID_258_" opacity="0.5" fill="#F4F4F4" x1="400" y1="187.7" x2="0" y2="187.7"/><line id="XMLID_257_" opacity="0.5" fill="#F4F4F4" x1="0" y1="225.1" x2="400" y2="225.1"/><line id="XMLID_256_" opacity="0.5" fill="#F4F4F4" x1="0" y1="262.6" x2="400" y2="262.6"/><polygon id="XMLID_242_" fill="#A6A8AB" points="0,107.5 83.6,96.9 139.6,113 200,97.1 265.8,116.6 336,107.7 400,116.3 400,199.3 \t  0,199.3 "/><polygon id="XMLID_239_" fill="#D0D2D3" points="0,157.6 60.4,153 132.4,169.6 216.9,159 279.1,177.7 334.2,162.7 400,172.5 400,253.2 \t  0,253.2 "/><polygon id="XMLID_236_" fill="#E1E2E3" points="0,224.1 69.3,241.5 156,219.5 252,241.5 332,219.5 400,227.8 400,300 0,300 "/><polyline id="XMLID_138_" fill="none" stroke="#797A7A" stroke-width="4" stroke-miterlimit="10" points="0,107.5 83.6,96.9 139.6,113 200,97.1 265.8,116.6 336,107.7 400,116.3 "/><polyline id="XMLID_294_" fill="none" stroke="#929497" stroke-width="4" stroke-miterlimit="10" points="0,157.6 60.4,153 132.4,169.6 216.9,159 279.1,177.7 334.2,162.7 400,172.5 "/><polyline id="XMLID_301_" fill="none" stroke="#A6A8AB" stroke-width="4" stroke-miterlimit="10" points="0,224.1 69.3,241.5 156,219.5 252,241.5 332,219.5 400,227.8 "/></symbol><symbol id="stackedbar"><rect y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="20.6" fill="#E1E2E3" width="179.9" height="39"/><rect x="0" y="74.7" fill="#E1E2E3" width="253.4" height="39"/><rect x="0" y="129.8" fill="#E1E2E3" width="224.6" height="39"/><rect x="0" y="184" fill="#E1E2E3" width="311.1" height="39"/><rect x="0" y="241" fill="#E1E2E3" width="367.2" height="39"/><rect x="0" y="20.6" fill="#D0D2D3" width="138.7" height="39"/><rect x="0" y="74.7" fill="#D0D2D3" width="195.3" height="39"/><rect x="0" y="129.8" fill="#D0D2D3" width="173.1" height="39"/><rect x="0" y="184" fill="#D0D2D3" width="239.8" height="39"/><rect x="0" y="241" fill="#D0D2D3" width="283" height="39"/><rect x="0" y="20.6" opacity="0.5" fill="#A6A8AB" width="90.2" height="39"/><rect x="0" y="74.7" opacity="0.5" fill="#A6A8AB" width="127" height="39"/><rect x="0" y="129.8" opacity="0.5" fill="#A6A8AB" width="112.5" height="39"/><rect x="0" y="184" opacity="0.5" fill="#A6A8AB" width="155.9" height="39"/><rect x="0" y="241" opacity="0.5" fill="#A6A8AB" width="184" height="39"/></symbol><symbol id="stackedcolumn"><rect x="0.2" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.2" y1="73.4" x2="400.2" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.2" y1="147.9" x2="400.2" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.2" y1="222.3" x2="400.2" y2="222.3"/><rect x="19.3" y="193.2" fill="#E1E2E3" width="40.9" height="106.9"/><rect x="83.3" y="167.7" fill="#E1E2E3" width="40.9" height="132.4"/><rect x="147.3" y="187.7" fill="#E1E2E3" width="40.9" height="112.4"/><rect x="211.3" y="82" fill="#E1E2E3" width="40.9" height="218.1"/><rect x="275.4" y="39.8" fill="#E1E2E3" width="40.9" height="260.3"/><rect x="339.4" y="122.3" fill="#E1E2E3" width="40.9" height="177.9"/><rect x="19.3" y="219.2" fill="#D0D2D3" width="40.9" height="80.9"/><rect x="83.3" y="199.9" fill="#D0D2D3" width="40.9" height="100.2"/><rect x="147.3" y="215.1" fill="#D0D2D3" width="40.9" height="85"/><rect x="211.3" y="129.8" fill="#D0D2D3" width="40.9" height="170.3"/><rect x="275.4" y="103.2" fill="#D0D2D3" width="40.9" height="197"/><rect x="339.4" y="165.6" fill="#D0D2D3" width="40.9" height="134.6"/><rect x="19.3" y="254" opacity="0.5" fill="#A6A8AB" width="40.9" height="46.1"/><rect x="83.3" y="243" opacity="0.5" fill="#A6A8AB" width="40.9" height="57.1"/><rect x="147.3" y="251.6" opacity="0.5" fill="#A6A8AB" width="40.9" height="48.5"/><rect x="211.3" y="206.1" opacity="0.5" fill="#A6A8AB" width="40.9" height="94.1"/><rect x="275.4" y="187.8" opacity="0.5" fill="#A6A8AB" width="40.9" height="112.3"/><rect x="339.4" y="223.4" opacity="0.5" fill="#A6A8AB" width="40.9" height="76.7"/></symbol><symbol id="table"><rect x="0" y="0" fill="#F4F4F4" width="399.8" height="265.4"/><rect x="0" y="0" fill="#D0D2D3" width="399.8" height="30.1"/><rect x="14.4" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="64.8" x2="400" y2="64.8"/><rect x="14.4" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="98.6" x2="399.3" y2="98.6"/><rect x="14.4" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="132.7" x2="400" y2="132.7"/><rect x="14.4" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="166.2" x2="400" y2="166.2"/><rect x="14.4" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="198.8" x2="400" y2="198.8"/><rect x="14.4" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="231.7" x2="400" y2="231.7"/><rect x="14.4" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="0" y="265.4" fill="#F4F4F4" width="399.3" height="34.6"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="265.4" x2="400" y2="265.4"/><rect x="14.4" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/></symbol><symbol id="tree"><rect x="204.3" y="0" fill="#E1E2E3" width="195.3" height="150"/><rect x="0" y="0" fill="#D0D2D3" width="204.3" height="150"/><rect x="0" y="150" fill="#E1E2E3" width="180.9" height="79.6"/><rect x="0" y="229.6" fill="#A6A8AB" width="180.9" height="70.4"/><rect x="180.9" y="150" fill="#F4F4F4" width="121.1" height="103.8"/><rect x="302" y="150" opacity="0.5" fill="#A6A8AB" width="97.7" height="103.8"/><rect x="180.9" y="253.8" fill="#E1E2E3" width="218.8" height="46.2"/></symbol><symbol id="waterfall"><rect x="-0.1" y="0" fill="#F4F4F4" width="400.3" height="299.6"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="73.1" x2="400.2" y2="73.1"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.6" x2="400.2" y2="147.6"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="222" x2="400.2" y2="222"/><rect x="75.3" y="128" fill="#D0D2D3" width="44" height="89.1"/><rect x="143.8" y="27.1" fill="#D0D2D3" width="44" height="103"/><rect x="212.3" y="27.1" fill="#D0D2D3" width="44" height="205.3"/><rect x="280.8" y="230.2" fill="#D0D2D3" width="44" height="55"/><rect x="349.2" y="283.1" fill="#D0D2D3" width="44" height="16.5"/><rect x="6.9" y="214.9" fill="#D0D2D3" width="44" height="84.7"/><rect x="50.8" y="214.9" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="119.3" y="128" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="187.8" y="27.1" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="256.3" y="230.2" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="324.7" y="283.1" fill="#D0D2D3" width="24.5" height="2.1"/></symbol><symbol id="scriptvisual"><rect x="0" y="0" fill="#F4F4F4" width="400" height="100"/><rect x="0" y="100" fill="#FFFFFF" width="400" height="100"/><rect x="0" y="200" fill="#F4F4F4" width="400" height="100"/><path fill="#E1E2E3" d="M138.8 90h-65.5v-8h65.5V90z"/><path fill="#E1E2E3" d="M22.3 81l-8.2-9.7 25.1-21.2-25.1-21.3 8.2-9.7 35.9 30.3v1.4L22.3 81z"/><path fill="#E1E2E3" d="M168.2 193.4h-14.5v-14.5h14.5V193.4z"/><path fill="#E1E2E3" d="M199.3 160.2v33.4h-16v-87.2h36.3c3 0 6 .5 9.1 1.5 3.1 1.1 5.9 2.6 8.4 4.8 2.5 2.1 4.6 4.9 6.2 8.3 1.6 3.4 2.4 7.5 2.4 12.3 0 3.6-.4 6.6-1.3 9.4-.8 2.8-2 5.1-3.5 7.2-1.5 2-3.2 3.8-5.2 5.2-1.9 1.4-4 2.5-6.2 3.3l18.5 35.1h-17.2l-16.6-33.4h-14.9V160.2zM217.2 145.5c1.4 0 2.8-.2 4.3-.5 1.5-.4 2.9-1.1 4.2-2 1.2-1 2.4-2.2 3.2-3.7.8-1.5 1.2-3.5 1.2-5.9 0-2.4-.4-4.4-1.2-5.9-.9-1.6-1.9-2.8-3.2-3.8-1.2-1-2.6-1.6-4.2-2-1.5-.4-2.9-.6-4.3-.6h-18v24.3L217.2 145.5 217.2 145.5z"/></symbol></svg>'),
e.put("views/taskPane.html",'<article class="taskPane sidePane rightSidePane smallFontSize" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" modeling-context-changer><div class="paneHeader"> <button class="toggleBtn" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" ng-click="toggleTaskPane()" localize-tooltip="Pane_Toggle"><div class="btnIcon glyphicon pbi-glyph-chevronrightmedium glyph-mini"></div><h2 class="sidePaneHorizontalTitle sidePaneTitle unselectable fieldsTab largeFontSize trimmedTextWithEllipsis" ng-if="viewModel.isPaneExpanded" localize="TaskPane_Fields"></h2><div class="verticalTitle"><h2 class="largeFontSize" localize="TaskPane_Fields"></h2></div></button></div><div class="paneContents" ng-if="viewModel.isPaneExpanded"><field-list field-list-config="::fieldListConfig"></field-list></div></article>'),e.put("views/virtualList.html",'<div class="virtual-list-container"><ng-scrollbars class="virtual-list" ng-scrollbars-config="::scrollbarsConfig"><ng-transclude></ng-transclude></ng-scrollbars></div>'),e.put("views/visualContainer.html",'<div class="visualContainer unselectable" canvas-visual-error canvas-layout-item drop="dropConfig" drop-handler="drop(event, ui)" ng-click="toggleSelect($event)" double-click="onDoubleClick($event)" fast-focus="toggleSelect($event)" ng-class="getVisualContainerStyle()" apply-style="::viewModel.readOnlyState.style" tabindex="0" transform transform-restriction="parent" transform-restrict-draw="{{shouldRestrictTransformDraw()}}" auto-scroll-parent-selector=".displayArea" drag-resize-disabled="{{viewModel.disableResize || viewModeState.getMode() === 0 || hasPositionOverride()}}" toolbar-anchor focus-element aria-label="{{viewModel.tooltip}}" preserve-aspect-ratio="{{viewModel.lockAspectRatio}}"><div class="visualContainerBorder"></div><div class="visualContainerScreen"></div><toolbar-overlay view-model="viewModel.toolbarViewModel"></toolbar-overlay><spinner delay="1000" class="xsmall" ng-if="viewModel.showProgressBar"></spinner><visual-container-header visual="::viewModel" menu-options="::menuOptions" disable-pin="disablePin" show-warning-details="ctrlError.showWarningDetails()" show-transform-warning-details="ctrlError.showTransformWarningDetails()" show-info-details="ctrlError.showInfoDetails()" on-visual-container-changed="onVisualContainerChanged()" ng-if="isHeaderVisible()"></visual-container-header><i class="removeFromLayout itemIcon glyphicon pbi-glyph-close glyph-mini" ng-click="removeVisualFromLayout()" ng-if="canRemoveFromLayout()"></i><visual-container-pop-out-bar ng-if="isPopOutBarVisible()"></visual-container-pop-out-bar><div class="vcBody" apply-style="::viewModel.readOnlyState.visualViewportStyle" ng-switch="viewModel.showWatermark" fast-click="ensureFocus($event)"><div class="visualTitle preTextWithEllipsis" ng-switch-when="false" ng-if="viewModel.visualTitleVisible()" title="{{viewModel.visualTitle.text}}" apply-style="::viewModel.readOnlyState.titleStyle" ng-bind="viewModel.visualTitle.text"></div><visual ng-switch-when="false" view-model="viewModel.readOnlyState.visual" allow-deferred-rendering="::viewModel.allowDeferredRendering"></visual><detail-visual ng-if="viewModel.contract.popOutMode === 2" view-model="viewModel.readOnlyState.detailVisual"></detail-visual><visual-watermark ng-switch-when="true" visual-type="viewModel.contract.config.singleVisual.visualType"></visual-watermark><canvas-visual-error-overlay ng-if="viewModel.errorInfo" error-info="viewModel.errorInfo" view-mode="viewModeState.getMode()" viewport="viewModel.position" show-error-details="ctrlError.showErrorDetails()" fix-errors="ctrlError.fixErrors()"></canvas-visual-error-overlay></div></div>'),e.put("views/visualContainerPopOutBar.html",'<ul class="popOutBar"><li> <button ng-click="closePopOut()"><i class="glyphicon iconBox pbi-glyph-chevronleftmedium glyph-small"></i><span class="menuItem" localize="VisualContainer_PopOut_BackToReportButton"></span></button></li><li class="divider"></li><li class="title trimmedTextWithEllipsis" ng-bind="viewModel.readOnlyState.popOutBarTitle" title="{{viewModel.readOnlyState.popOutBarTitle}}"></li><li class="subtitle" ng-bind="viewModel.readOnlyState.popOutBarSubtitle"></li><li class="visualLastRefreshTime" ng-if="viewModel.lastUpdateAttemptTime"><span localize="ReportAppBar_LastRefresh"></span><span class="dataUpdatedTime" ng-bind="viewModel.lastUpdateAttemptTime"></span></li></ul>'),e.put("views/visualizationPane.html",'<article class="visualizationPane sidePane rightSidePane smallFontSize" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" modeling-context-changer><div class="paneHeader"> <button class="toggleBtn" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" ng-click="toggle()" localize-tooltip="Pane_Toggle"><div class="btnIcon glyphicon pbi-glyph-chevronrightmedium glyph-mini"></div><h2 class="sidePaneHorizontalTitle unselectable sidePaneTitle largeFontSize trimmedTextWithEllipsis" ng-bind="viewModel.header" ng-show="viewModel.isPaneExpanded"></h2><h2 class="verticalTitle verticalText" ng-show="!viewModel.isPaneExpanded"><span class="collapsedVisualsTitle largeFontSize" localize="VisualizationPane_Title" ng-show="populatePanes"></span><span class="collapsedFiltersTitle largeFontSize" localize="VisualizationPane_Filters"></span></h2></button></div><div class="paneContents flex" ng-if="viewModel.isPaneExpanded"><section ng-if="showVisualTypes" class="lazy-load-wrapper" pbi-lazy-load-contents="exploreUIShellConfig"><visual-types-container visual-plugin-filter="viewModel.visualPluginFilter"></visual-types-container></section><nav class="sectionHeader item-auto" ng-if="viewModel.sections.length && !isNonQueryVisual && populatePanes"><ul><li ng-repeat="section in viewModel.sections" ng-click="setActiveSection(section.sectionType)" class="sectionTab" ng-class="{active: section.sectionType === viewModel.activeSection}" title="{{::section.displayName}}"><i ng-class="[\'sectionIcon\', section.cssClass]"></i></li></ul></nav><nav class="sectionHeader item-auto" ng-if="viewModel.pagePaneSections.length && populatePanes"><ul><li ng-repeat="section in viewModel.pagePaneSections" ng-click="setActivePagePaneSection(section.sectionType)" class="sectionTab" ng-class="{active: section.sectionType === viewModel.activePageSection}" title="{{::section.displayName}}"><i ng-class="[\'sectionIcon\', section.cssClass]"></i></li></ul></nav><div class="sectionHost item-fill" ng-if="showFieldWellOrFilters" ng-class="{\'readOnly\' : !populatePanes}"><ng-scrollbars ng-scrollbars-config="::scrollbarsConfig"><section ng-if="showFieldWell" class="lazy-load-wrapper" pbi-lazy-load-contents="exploreUIShellConfig"><field-well></field-well></section><h3 class="sectionHeader" ng-if="showFieldWell || showVisualTypes"><span class="sectionTitle sidePaneTitle unselectable largeFontSize" localize="VisualizationPane_Filters"></span></h3><filter-pane></filter-pane></ng-scrollbars></div><section ng-if="showPropertyPane" class="lazy-load-wrapper item-fill" pbi-lazy-load-contents="exploreUIShellConfig"><property-pane class="stretch"></property-pane></section><section ng-if="showPagePropertyPane" class="lazy-load-wrapper item-fill" pbi-lazy-load-contents="exploreUIShellConfig"><page-property-pane class="stretch"></page-property-pane></section><section ng-if="showAnalyticsPane" class="lazy-load-wrapper item-fill" pbi-lazy-load-contents="exploreUIShellConfig"><analytics-pane class="stretch propertyPaneContents"></analytics-pane></section></div></article>')}]);var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.DOMConstants.KeyDictionary,i=(function(){function e(e){var i=this;this.focusService=e,this.restrict="A",this.link=function(e,r,o){if(!_.isEmpty(o.focusGroup)){for(var n={element:r.get(0),keycode:-1},a=o.focusGroup.split("-"),s=0,l=a;s<l.length;s++){var c=l[s];switch(c){case"shift":n.shift=!0;break;case"alt":n.alt=!0;break;case"ctrl":n.ctrl=!0;break;default:var u=t[c];n.keycode=u}}i.focusService.registerShortcut(n),e.$on("$destroy",(function(){return i.focusService.unregisterShortcut(n)}))}}}return e})();e.FocusGroup=i})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),define("ExploreUI/services/clustering",["require","exports"],(function(e,t){"use strict";function i(e,t,i,r,o,n,a,s,l,c,u,p,d){return new w(e,t,i,r,o,n,a,s,l,c,u,p,d)}var r=powerbi,o=r.data,n=r.explore,a=n.viewModels,s=o.dsr.DsrMessage,l=r.data.FieldExprPattern,c=r.data.transforms.plugins.KMeansClustering,u=r.data.transforms.plugins.SpatialClustering,p=r.data.contracts.SchemaChangeType.ObjectTypeEnum,d=r.RejectablePromise,v=o.services.SemanticGroupingSerializer,h=r.data.SQExprBuilder,g=r.ValueType,f=n.contracts.VisualContainer,m=a.VisualContainer,y=r.telemetry;t.create=i;var w=(function(){function e(e,t,i,r,o,n,a,s,l,c,u,p,d){this.conceptualSchemaProxy=e,this.clusteringAuthoringService=t,this.clusteringStateService=i,this.groupingDesignStateService=r,this.visualAuthoringService=o,this.visualPluginService=n,this.errorService=a,this.localizationService=s,this.modelChangeHandler=l,this.modalDialogService=c,this.promiseFactory=u,this.telemetryService=p,this.explorationSerializer=d,this.autoClustersNumber=-1,this.numberOfClustersParameter="NumberOfClusters",this.notEnoughDimensionsCode="ClusteringErrorType.NotEnoughDimensions",this.extraDimensionsCode="ClusteringErrorType.ExtraDimensions",this.notEnoughMeasuresCode="ClusteringErrorType.NotEnoughMeasures",this.extraMeasuresCode="ClusteringErrorType.ExtraMeasures",this.minimumDimensions=1,this.maximumDimensions=1,this.minimumMeasures=1,this.maximumMeasures=15,this.numericValueType=g.fromDescriptor({numeric:!0})}return e.prototype.isClusteringColumn=function(e){var t=l.getProperty(e);if(t){var i=this.groupingDesignStateService.getGroupingDesignState(t.entity,t.name);return!!i&&!!i.partitionTable}return!1},e.prototype.createClusters=function(e,t,i){var r=this;this.conceptualSchemaProxy.get(t).then((function(n){for(var a=e.contract,s=f.clone(a,r.explorationSerializer),l=new m(s,null,null),p=s.config.singleVisual.query,d=p.defn.select(),g=_.filter(d,(function(e){if(o.SQExprUtils.isMeasure(e.expr)){var t=e.expr.getMetadata(n);return!(t&&t.type.isCompatibleFrom(r.numericValueType))}})),w=0,C=g;w<C.length;w++){var S=C[w];p.removeExpr(S.expr,!1)}d=p.defn.select();var b,x=_.filter(d,(function(e){return o.SQExprUtils.isMeasure(e.expr)})).length,M=d.length-x;if(M<r.minimumDimensions?b=r.notEnoughDimensionsCode:M>r.maximumDimensions?b=r.extraDimensionsCode:x<r.minimumMeasures?b=r.notEnoughMeasuresCode:x>r.maximumMeasures&&(b=r.extraMeasuresCode),b)return r.telemetryService.logEvent(y.EXClusteringWarning,b),void r.errorService.infoCustom(r.localizationService.get("Clustering_InvalidColumnsTitle"),r.localizationService.get("Clustering_InvalidColumnsMessage"));var E=a.config.singleVisual;r.addClusteringToVisualContainer(s.config.singleVisual,i?u.name:c.name)&&r.clusteringAuthoringService.getClusteringDialogArgs(l,t).then((function(e){r.showDialog({description:e.description,entity:e.entity,groupingColumnName:e.groupingColumnName,sourcePropertyName:e.sourcePropertyName,schema:e.schema,isNewClustering:!0}).then((function(i){if(r.removeClusteringFromVisualContainer(s.config.singleVisual),i){var o=e.semanticGroupingDefinition.partitionTable.mappingTable.transforms(),n=_.find(o,(function(e){return e.algorithm===c.name})),l=i.numberOfClusters?i.numberOfClusters:r.autoClustersNumber;n&&(n.input.parameters=[{name:r.numberOfClustersParameter,expr:h.integer(l)}]);var u=r.telemetryService.startEvent(y.EXClusteringAddClustering,l,E.visualType,x,M,s.filters?s.filters.length:0),p=r.modelChangeHandler.register((function(e){u.resolve();var i=e.changes;if(!_.isEmpty(i)){var o=_.find(i,(function(e){return e.newClustering&&_.all(e.newClustering.definition.PartitionTable.Definition.ItemIdColumns,(function(e){return _.any(E.query.defn.select(),(function(t){return t.name===e}))}))})),n=r.visualPluginService.capabilities(E.visualType),s=n&&n.grouping&&n.grouping.cluster&&n.grouping.cluster.clusteringRole;if(o&&s){var l=o.newClustering,c=l.definition.PartitionTable.Result.TableName;r.checkToDisplayWarning(l.schema,c,t,u.event).then((function(e){if(!e){var i=v.deserialize(l.definition);r.visualAuthoringService.addFieldInRole(h.groupRef(l.name,h.entity(l.schema,l.entity),i.groupedColumns),s,t,a)}}))}}return r.promiseFactory.resolve()}));r.clusteringAuthoringService.applyClustering(i.description,e.entity,i.groupingColumnName,e.sourcePropertyName,e.schema,e.semanticGroupingDefinition).finally((function(){return p.stopHandling()}))}}))}))}))},e.prototype.editClustering=function(e,t){var i=this,r=this.clusteringStateService.getMetadata(e),n=l.getProperty(e),a=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(t).then((function(e){var l,c=i.groupingDesignStateService.getGroupingDesignState(n.entity,n.name),u=e.schema(n.schema),p=u.entities.withName(c.partitionTableResult.tableName);if(1===p.queryable){var d=p.errorMessage,v=new s({Code:d,Severity:"Warning",Message:void 0});if(o.dsr.KnownDsrMessages[d]){var h=v.getDetails(i.localizationService);l=h.displayableErrorInfo[0].errorInfoValue}else l=i.localizationService.get("ErrorMessage_DefaultTitle")}var g=_.some(r.partitions,(function(e){return 1===e.clusterIds.length&&!_.isNumber(e.clusterIds[0])})),f=r.partitions?r.partitions.length:void 0;g&&f>0&&f--;var m={entity:n.entity,groupingColumnName:n.name,sourcePropertyName:r.sourceColumnName,description:r.description,partitions:r.partitions,numberOfClusters:f,errorMessage:l},y=i.showDialog(m);a.promise.catch((function(){return y.reject()})),y.then((function(e){return i.checkToUpdateClustering(n.schema,m,e,t,c.partitionTableResult.tableName)})).then((function(){a.resolve(null)})).catch((function(){return a.reject()}))})),d(a)},e.prototype.showDialog=function(e){var t={dialogName:"ClusteringDialog",definitionTemplateCachePath:"components/clusteringDialog/clusteringDialogDefinition.html",bindings:{args:e},dialogCssClass:"clusteringDialog"};return this.modalDialogService.showHostModalDialog(t)},e.prototype.arePartitionNameToClusterIdsMappingsEqual=function(e,t){var i=_.sortBy(e,(function(e){return e.name})),r=_.sortBy(t,(function(e){return e.name}));return i.length===r.length&&_.every(i,(function(e,t){if(e.name!==r[t].name)return!1;var i=e.clusterIds,o=r[t].clusterIds;return i.length===o.length&&_.isEqual(_.sortBy(i),_.sortBy(o))}))},e.prototype.checkToDisplayWarning=function(e,t,i,r){var o=this,n=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(i).then((function(i){var a=i.schema(e),l=a.entities.withName(t);if(1===l.queryable){var c=l.errorMessage,u=new s({Code:c,Severity:"Warning",Message:void 0}),p=u.getDetails(o.localizationService);o.errorService.infoCustom(p.displayableErrorInfo[0].errorInfoKey,p.displayableErrorInfo[0].errorInfoValue),o.telemetryService.logChildEvent(r,y.EXClusteringWarning,c),n.resolve(!0)}else n.resolve(!1)}),(function(e){n.reject()})),n.promise},e.prototype.checkToUpdateClustering=function(e,t,i,r,o){if(!i)return this.promiseFactory.resolve(null);var n=t.groupingColumnName===i.groupingColumnName,a=t.description===i.description,s=this.arePartitionNameToClusterIdsMappingsEqual(t.partitions,i.partitions),l=t.numberOfClusters===i.numberOfClusters;if(n&&a&&s&&l)return this.promiseFactory.resolve(null);var c=this.telemetryService.startEvent(y.EXClusteringEditClustering,n,a,s,l,l?t.numberOfClusters:i.numberOfClusters);return l?this.editClusteringPartitions(e,t,i,r,c):this.editClusteringDefinition(e,t,i,r,c,o)},e.prototype.editClusteringPartitions=function(e,t,i,r,o){var n=this,a=this.modelChangeHandler.register((function(a){o.resolve();var s=n.promiseFactory.defer(),l=a.changes;if(_.isEmpty(l))s.resolve(null);else{var c=_.find(l,(function(i){var r=i.updateClusteringDefinition;return r&&r.schema===e&&r.entity===t.entity&&r.property===t.groupingColumnName})),u=t.groupingColumnName!==i.groupingColumnName,d=u?_.find(l,(function(i){var r=i.propertyRename;return r&&r.schema===e&&r.entity===t.entity&&r.before===t.groupingColumnName&&r.objectType===p.Column})):void 0;if(c&&(!u||d)){var v=n.groupingDesignStateService.getGroupingDesignState(t.entity,u?d.propertyRename.after:t.groupingColumnName);n.checkToDisplayWarning(e,v.partitionTableResult.tableName,r,o.event).finally((function(){s.resolve(null)}))}}return s.promise}));return this.clusteringAuthoringService.editClusteringPartitions(e,t.entity,t.groupingColumnName,i.groupingColumnName,i.description,i.partitions).finally((function(){return a.stopHandling()}))},e.prototype.editClusteringDefinition=function(e,t,i,r,o,n){var a=this,s=this.groupingDesignStateService.getGroupingDesignState(t.entity,t.groupingColumnName);if(!s||!s.partitionTable||!s.partitionTable.mappingTable)return this.promiseFactory.reject();var l=this.modelChangeHandler.register((function(t){o.resolve();var i=a.promiseFactory.defer(),s=t.changes,l=_.find(s,(function(e){return e.reevaluateClusteringDefinition}));return l?a.checkToDisplayWarning(e,n,r,o.event).finally((function(){i.resolve(null)})):i.resolve(null),i.promise})),u=s.partitionTable.mappingTable.transforms(),p=_.find(u,(function(e){return e.algorithm===c.name}));if(!p)return this.promiseFactory.reject();p.input.parameters=[{name:this.numberOfClustersParameter,expr:h.integer(i.numberOfClusters?i.numberOfClusters:this.autoClustersNumber)}];var d=__assign({},s);return d.partitionTable.mappingTable.transforms([p]),d.partitionTableResult=null,d.partitionTable.partitions=void 0,this.clusteringAuthoringService.editClusteringDefinition(e,t.entity,t.groupingColumnName,i.groupingColumnName,i.description,d).finally((function(){return l.stopHandling()}))},e.prototype.addClusteringToVisualContainer=function(e,t){var i={merge:[this.getClusteringObject(t)]};return this.visualAuthoringService.persistProperties(i,e)},e.prototype.removeClusteringFromVisualContainer=function(e){var t={removeObject:[this.getClusteringObject(c.name),this.getClusteringObject(u.name)]};return this.visualAuthoringService.persistProperties(t,e)},e.prototype.getClusteringObject=function(e){return{objectName:"clustering",selector:null,properties:{transform:{algorithm:e,parameters:[]}}}},e})()})),define("ExploreUI/services/clusteringAuthoring",["require","exports"],(function(e,t){"use strict";function i(e,t,i,r,o,n,a,s){return new g(t,e,i,r,o,n,a,s)}var r=powerbi,o=r.data,n=r.explore,a=n.contracts,s=o.services.SemanticGroupingSerializer,l=o.transforms.plugins.KMeansClustering,c=o.transforms.plugins.SpatialClustering,u=o.SQExpr,p=o.SQExprBuilder,d=powerbi.data.SQExprUtils,v=r.ValueType,h=o.VariationRewriter;t.create=i;var g=(function(){function e(e,t,i,r,o,n,a,s){this.promiseFactory=e,this.conceptualSchemaProxy=t,this.localizationService=i,this.transformPluginService=r,this.modelAuthoring=o,this.explorationNavigation=n,this.visualQueryGenerator=a,this.filterGenerator=s}return e.prototype.applyClustering=function(e,t,i,r,o,n){var a=n.partitionTable.partitions;n.partitionTable.partitions=this.getPartitionsWithEnsuredNullDefaults(a);var l={newClustering:{description:e,entity:t,name:i,property:r,schema:o,definition:s.serialize(n)}};return this.modelAuthoring.apply({changes:[l]})},e.prototype.getClusteringDialogArgs=function(e,t){var i=this,r=e.contract,o=r.config.singleVisual;return o&&t?this.conceptualSchemaProxy.get(t).then((function(n){var a=i.explorationNavigation.getCurrentExploration(),s=i.explorationNavigation.getCurrentSection(),l=i.filterGenerator.calculateVisualContainerFilter(a,s,r,n),c=i.createClusteringDialogArgs(o,t,n,l,e.visualTitle);return c?i.promiseFactory.resolve(c):i.promiseFactory.reject()}),(function(e){return i.promiseFactory.reject()})):this.promiseFactory.reject()},e.prototype.editClusteringPartitions=function(e,t,i,r,o,n){var a;n&&(a=_.map(n,(function(e){return{displayName:e.name,partitionIds:_.map(e.clusterIds,(function(e){return p.typedConstant(e,v.fromDescriptor({integer:!0}))}))}}))),a=this.getPartitionsWithEnsuredNullDefaults(a);var l={updateClustering:{schema:e,entity:t,property:i,newName:r,description:o,partitions:s.serializePartitions(a)}};return this.modelAuthoring.apply({changes:[l]})},e.prototype.editClusteringDefinition=function(e,t,i,r,o,n){var a=n.partitionTable.partitions;n.partitionTable.partitions=this.getPartitionsWithEnsuredNullDefaults(a);var l={reevaluateClustering:{schema:e,entity:t,groupingColumnName:i,newName:r,description:o,partitionTableDefinition:s.serialize(n).PartitionTable.Definition}};return this.modelAuthoring.apply({changes:[l]})},e.prototype.getPartitionsWithEnsuredNullDefaults=function(e){var t=e?e:[],i=p.nullConstant(),r=_.find(t,(function(e){return _.any(e.partitionIds,(function(e){return u.equals(e,i)}))}));return r||(t=t.concat({displayName:null,partitionIds:[p.nullConstant()]})),t},e.prototype.createClusteringDialogArgs=function(e,t,i,r,o){var n=this.createClusteringGroupingDefinition(e,t,i,r);if(n){var a,s,l=n.groupedColumns[0];if(u.isColumn(l)?(s=l.source,a=l.ref):u.isHierarchyLevel(l)&&(s=h.run(l,i).getTargetEntity(),a=l.level),s)return{entity:s.entity,groupingColumnName:this.getSuggestedClusteringColumnName(a),sourcePropertyName:a,schema:s.schema,description:jsCommon.StringExtensions.format(this.localizationService.get("ClusteringDialog_DefaultDescription"),o&&o.text&&""!==o.text.trim()?o.text:a),semanticGroupingDefinition:n}}},e.prototype.createClusteringGroupingDefinition=function(t,i,r,o){var n=this,s=a.SingleVisualConfig.clone(t);s.objects=void 0;var l=this.visualQueryGenerator.executeForFlattenedQuery({config:t,dataSources:i,schema:r,additionalFilters:o},(function(e){return n.getMappingTableQueryFromTransformedQuery(e)}));if(l){var c=e.getGroupedAndClusterIdColumn(l),u=c.groupedColumns,d=_.map(u,(function(t){return e.getGroupedColumnExpr(l,t)})),v={mappingTable:l,itemIdColumns:c.groupedColumns,partitionIdColumn:c.clusterIdColumn,defaultPartitionPrefix:this.localizationService.get("ClusteringLegend_Prefix"),partitions:[{displayName:null,partitionIds:[p.nullConstant()]}]};return{groupedColumns:d,partitionTable:v}}},e.prototype.getMappingTableQueryFromTransformedQuery=function(t){var i=e.getClusteringTransform(t);if(i){var r=i.input&&i.input.table;if(r){r.columns=_.filter(r.columns,(function(e){return!!e.role}));var o=i.output;if(o){var n=o.table;if(n){for(var a,s=[],l=0,c=t.select();l<c.length;l++){var p=c[l],d=e.getTransformTableColumn(p,n);d&&(u.isTransformOutputRoleRef(d.expression.expr)?a=p:e.isForClusteringGroupedColumn(i,d)&&s.push(p))}if(_.any(s)&&a){var v=s.concat(a);t=t.select(v);var h=_.map(v,(function(e){return e.expr.ref}));return i.output.table.columns=_.filter(i.output.table.columns,(function(e){return h.indexOf(e.expression.name)>=0})),t=t.transforms([i]),t=t.orderBy([])}}}}}},e.getGroupedAndClusterIdColumn=function(t){for(var i,r=t.transforms()[0].output.table,o=[],n=0,a=t.select();n<a.length;n++){var s=a[n],l=e.getTransformTableColumn(s,r);u.isTransformOutputRoleRef(l.expression.expr)?i=s:o.push(s)}return{groupedColumns:_.map(o,(function(e){return e.name})),clusterIdColumn:i.name}},e.getClusteringTransform=function(e){return _.find(e.transforms(),(function(e){return e.algorithm===l.name||e.algorithm===c.name}))},e.isForClusteringGroupedColumn=function(t,i){if(i&&i.expression&&i.expression.expr){var r=t.input.table,o=e.getTransformTableColumn(i.expression,r);return!(!o||!o.expression||!o.expression.expr||d.isMeasure(o.expression.expr))}return!1},e.getTransformTableColumn=function(e,t){var i=e.expr;if(u.isColumn(i)){var r=i,o=r.source;if(u.isTransformTableRef(o)&&o.source===t.name)return _.find(t.columns,(function(e){return e.expression.name===r.ref}))}},e.prototype.getSuggestedClusteringColumnName=function(e){return this.localizationService.format("ClusteringDialog_DefaultClusterColumnNamePattern",[e])},e.getGroupedColumnExpr=function(e,t){var i=_.find(e.select(),(function(e){return e.name===t})),r=e.transforms()[0],o=_.find(r.output.table.columns,(function(e){return e.expression.name===i.expr.ref})),n=_.find(r.input.table.columns,(function(e){return e.expression.name===o.expression.expr.ref})),a=n.expression.expr;return a},e})()}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e){return new o(e)}var r=e.common.FocusManager;t.createFocusService=i;var o=(function(){function e(e){this.focusManager=new r(document.documentElement)}return e.prototype.registerShortcut=function(e){this.focusManager.registerShortcut(e)},e.prototype.unregisterShortcut=function(e){this.focusManager.unregisterShortcut(e)},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e,t,i,r,n,a,s,l,c,u,p,d){return new o(e,t,i,r,n,a,s,l,c,u,p,d)}var r=e.components.VisualContainerContextMenu;t.createVisualContainerContextMenuFactoryService=i;var o=(function(){function e(e,t,i,r,o,n,a,s,l,c,u,p){this.conceptualSchemaProxy=e,this.dataSources=t,this.drill=i,this.drillToDetails=r,this.dropdown=o,this.featureSwitchService=n,this.groupAuthoring=a,this.includeExcludeService=s,this.localizationService=l,this.popOut=c,this.promiseFactory=u,this.visualAuthoring=p}return e.prototype.create=function(){return new r(this.conceptualSchemaProxy,this.dataSources,this.drill,this.drillToDetails,this.dropdown,this.featureSwitchService,this.groupAuthoring,this.includeExcludeService,this.localizationService,this.popOut,this.promiseFactory,this.visualAuthoring)},e})();t.VisualContainerContextMenuFactoryService=o})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));

window.parseTimeMarkers['powerbiportal.explore.bundle.min.js'].end = Date.now();
